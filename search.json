[{"title":"2025é«˜ç­‰æ•°å­¦è¾…å¯¼è®²ä¹‰ä¸¥é€‰é¢˜å¤šå…ƒå‡½æ•°å¾®åˆ†å­¦48é¢˜","url":"/2024/06/12/HM24-6-11/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>æ±‚æ¤­çƒé¢ $\\frac{x^2}{3}+\\frac{y^2}{2}+z^2&#x3D;1$ è¢«å¹³é¢ $x+y+z&#x3D;0$ æˆªå¾—çš„æ¤­åœ†çš„é•¿åŠè½´ä¸çŸ­åŠè½´<br>åˆ†æ: å°†ç©ºé—´å‡ ä½•é—®é¢˜è½¬åŒ–ä¸ºå‡½æ•°æå€¼é—®é¢˜ï¼Œåˆ©ç”¨æ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•è§£å‡ºæœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œå³å¯å¾—åˆ°ç»“æœã€‚</p>\n<p>è§£: å¯çŸ¥å¹³é¢ $x+y+z&#x3D;0$ è¿‡ç‚¹ $(0,0,0)$ ï¼Œä¹Ÿå°±æ˜¯è¿‡æ¤­çƒé¢ä¸­å¿ƒï¼Œè®¾æ¤­åœ†ä¸Šä»»æ„ä¸€ç‚¹ä¸º $(x, y, z)$ ï¼Œåˆ™åæ ‡åŸç‚¹åˆ° $(x, y, z)$ çš„è·ç¦»ä¸º $d&#x3D;\\sqrt{x^2+y^2+z^2}$, è®¾</p>\n<span id=\"more\"></span>\n\n<p>$$<br>\\begin{gathered}<br>F(x)&#x3D;x^2+y^2+z^2+\\lambda\\left(\\frac{x^2}{3}+\\frac{y^2}{2}+z^2-1\\right)+\\mu(x+y+z) \\\\<br>\\left(\\begin{gather}<br>F_x^{\\prime}&#x3D;2x+\\frac{2 \\lambda}{3}x+\\mu&#x3D;0 \\\\<br>F_y^{\\prime}&#x3D;2y+\\lambda y+\\mu&#x3D;0  \\\\<br>F_z^{\\prime}&#x3D;2z+2 \\lambda z+\\mu&#x3D;0  \\\\<br>F_\\lambda^{\\prime}&#x3D;\\frac{x^2}{3}+\\frac{y^2}{2}+z^2-1&#x3D;0  \\\\<br>F_\\mu^{\\prime}&#x3D;x+y+z&#x3D;0<br>\\end{gather}\\right.<br>\\end{gathered}<br>$$</p>\n<p>ç”±é¢˜æ„çŸ¥ï¼Œç›®æ ‡å‡½æ•°æ˜¯ $x^2+y^2+z^2$ ï¼Œæ‰€ä»¥å°† $(1) \\times x+(2) \\times y+(3) \\times z$ ï¼Œå¾—<br>$$<br>2\\left(x^2+y^2+z^2\\right)+\\lambda\\left(\\frac{2 x^2}{3}+ y^2+2 z^2\\right)+\\mu(x+y+z)&#x3D;0 \\tag 6<br>$$</p>\n<p>æ ¹æ®(4), (5)å¼è¿›ä¸€æ­¥åŒ–ç®€ $(6)$ å¼å¾— $2\\left( x^2+y^2+z^2 \\right)+2 \\lambda&#x3D;0$,å³$\\lambda&#x3D;-d^2$<br>$(7)$åŒç†å†æ ¹æ®(1), (2), (3)å¼æœ‰<br>$$<br>-\\mu&#x3D; x(2+\\frac{ 2\\lambda}{3})&#x3D; y(2+ \\lambda)&#x3D; z(2+2 \\lambda)<br>$$</p>\n<p>å°† $x$ï¼Œ$y$, $z$ ç”¨è¡¨ç¤º$\\lambda$ å’Œ$\\mu$ è¡¨ç¤ºï¼Œæœ‰ $x&#x3D;\\frac{-3 \\mu}{6+2 \\lambda} ï¼Œ y&#x3D;\\frac{- \\mu}{2+ \\lambda} ,z&#x3D;\\frac{- \\mu}{2+2 \\lambda}$ ï¼Œå†å¸¦å…¥(5)å¼ï¼Œæœ‰ $-\\frac{3 \\mu}{6+2 \\lambda} -\\frac{ \\mu}{2+ \\lambda} -\\frac{ \\mu}{2+2 \\lambda}&#x3D;0$ ï¼Œä¸éš¾éªŒè¯$\\mu&#x3D;0$æ—¶$x,y,z$å‡ä¸º$0$,ä¸$(4)$ç›¸çŸ›ç›¾ï¼ŒåŒ–ç®€å¾— $3 \\lambda^2+11 \\lambda+9&#x3D;0$ï¼Œ ï¼Œè§£å¾— $\\lambda_{1,2}&#x3D;\\frac{-11 \\pm \\sqrt{13}}{6}$ ï¼Œæ‰€ä»¥</p>\n<p>$$<br>d_{\\min }^2&#x3D;- \\lambda_1&#x3D;\\frac{11-\\sqrt{13}}{6}, d_{\\max }^2&#x3D;- \\lambda_2&#x3D;\\frac{11+\\sqrt{13}}{6}<br>$$</p>\n<p>å³æ¤­åœ†é•¿åŠè½´ä¸º $\\sqrt{\\frac{11+\\sqrt{13}}{6}}$ ï¼ŒçŸ­åŠè½´ä¸º $\\sqrt{\\frac{11-\\sqrt{13}}{6}}$</p>\n","categories":["é«˜ç­‰æ•°å­¦"]},{"title":"2025å¼ å®‡1000é¢˜æé«˜ç¯‡ç¬¬ä¸€ç« 35é¢˜","url":"/2024/06/13/HM24-6-12/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>å·²çŸ¥<br>$$<br>\\lim _{x \\rightarrow+\\infty} \\frac{\\int_0^x t^2 \\mathrm{e}^{x^2-t^2} \\mathrm{~d} t+a \\mathrm{e}^{x^2}}{x^b}&#x3D;-\\frac{1}{2}<br>$$<br>æ±‚ $a, b$ çš„å€¼.</p>\n<p>è§£ï¼šæå‡º$\\mathrm{e}^{x^2}$,</p>\n<p>$$\\lim _{x \\rightarrow+\\infty}\\frac{ \\mathrm{e}^{x^2}\\left(\\int_0^x t^2 \\mathrm{e}^{-t^2}\\mathrm{~d} t+a\\right)}{x^b}&#x3D;-\\frac{1}{2}$$<br>å¯å¾—</p>\n<span id=\"more\"></span>\n<p>$$\\lim _{x \\rightarrow+\\infty}\\int_0^x t^2 \\mathrm{e}^{-t^2} \\mathrm{~d} t+a&#x3D;0$$<br>å°†$e^{-t^2}$å‡‘å¾®åˆ†åˆ†éƒ¨ç§¯åˆ†å¾—</p>\n<p>$$a&#x3D;-\\frac{\\int_0^\\infty e^{-x^2}\\mathrm{~d}x}{2}&#x3D;-\\frac{\\sqrt\\pi}{4}$$</p>\n<p>åŸå¼å³ä¸º<br>$$<br>\\lim _{x \\rightarrow+\\infty}\\frac{\\int_0^x t^2 \\mathrm{e}^{-t^2}\\mathrm{~d} t-\\frac{\\sqrt\\pi}{4}}{x^b \\mathrm{e}^{-x^2}}$$<br>ä½¿ç”¨æ´›å¿…è¾¾æ³•åˆ™å¾—<br>$$<br>\\begin{aligned}<br>&amp;\\lim _{x \\rightarrow+\\infty} \\frac{x^2{e}^{-x^2}}{bx^{b-1} \\mathrm{e}^{-x^2}-2x^{b+1}e^{-x^2}}\\\\<br>&amp;&#x3D;\\lim _{x \\rightarrow+\\infty}\\frac{x^2}{bx^{b-1}-2x^{b+1}}\\\\<br>&amp;&#x3D;-\\frac{1}{2}<br>\\end{aligned}<br>$$<br>å³ $b&#x3D;1$</p>\n<p>ç»¼ä¸Šæ‰€è¿°ã€‚$a&#x3D;-\\frac{\\sqrt\\pi}{4}$, $b&#x3D;1$</p>\n","categories":["é«˜ç­‰æ•°å­¦"]},{"title":"Frullani ç§¯åˆ†","url":"/2024/06/15/HM24-6-15/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>è®¾å‡½æ•° $f(x)$ åœ¨ $[0,+\\infty)$ ä¸Šè¿ç»­ï¼Œä¸” $\\lim_{x \\rightarrow+\\infty} f(x)&#x3D;c \\in \\mathbb{R}$. åˆ™å¯¹ $a, b&gt;0$ æˆç«‹</p>\n<p>$$\\int_0^{+\\infty} \\frac{f(a x)-f(b x)}{x} \\mathrm{~d} x&#x3D;(f(0)-c) \\ln \\frac{b}{a}$$</p>\n<p>å¦‚æœå°†æ¡ä»¶æ”¹ä¸ºç§¯åˆ† $\\int_a^{+\\infty} \\frac{f(x)}{x} \\mathrm{~d} x$ å¯¹æŸä¸ª $a&gt;0$ æ”¶æ•›ï¼Œåˆ™æœ‰</p>\n<p>$$\\int_0^{+\\infty} \\frac{f(a x)-f(b x)}{x} \\mathrm{~d} x&#x3D;f(0) \\ln \\frac{b}{a}$$</p>\n<p>ä¸Šè¿°æ¡ä»¶è¦æ±‚ $f(x)$ åœ¨ $x&#x3D;0$ å¤„è¿ç»­ï¼Œä¹Ÿå¯å‡å¼±è‡³ $\\lim_{x \\rightarrow 0^{+}} f(x)$ å­˜åœ¨ï¼Œå¹¶å°†ç­‰å¼å³ä¾§çš„ç›¸åº” $f(0)$ åšä¿®æ”¹å³å¯ã€‚</p>\n<p>ä¸‹é¢ç»™å‡ºç¬¬ä¸€æ¡ç»“è®ºçš„è¯æ˜,å…¶ä½™ç±»ä¼¼<span id=\"more\"></span></p>\n<p>$$<br>\\begin{aligned}<br>F(t_1,t_2)&amp;&#x3D;\\int_{t_1}^{t_2} \\frac{f(a x)-f(b x)}{x} \\mathrm{d} x\\\\<br>&amp;&#x3D;\\int_{t_1}^{t_2} \\frac{f(a x)}{ax}\\mathrm{d} (ax)-\\int_{t_1}^{t_2} \\frac{f(b x)}{bx}\\mathrm{d} (bx)\\\\<br>&amp;&#x3D;\\int_{at_1}^{at_2} \\frac{f(x)}{x}\\mathrm{d} x-\\int_{bt_1}^{bt_2} \\frac{f(x)}{x}\\mathrm{d}x\\\\<br>&amp;&#x3D;\\int_{at_1}^{\\xi} \\frac{f(x)}{x}\\mathrm{d} x-\\int_{bt_1}^{\\xi} \\frac{f(x)}{x}\\mathrm{d}x+\\int_{\\xi}^{at_2} \\frac{f(x)}{x}\\mathrm{d} x-\\int_{\\xi}^{bt_2} \\frac{f(x)}{x}\\mathrm{d}x\\\\<br>&amp;&#x3D;\\int_{at_1}^{bt_1} \\frac{f(x)}{x}\\mathrm{d} x-\\int_{bt_2}^{at_2} \\frac{f(x)}{x}\\mathrm{d}x\\\\<br>\\end{aligned}<br>$$</p>\n<p>$$\\begin{aligned}<br>&amp;\\lim_{\\substack{t_1 \\rightarrow 0 \\\\t_2\\rightarrow+\\infty}}F(t_1,t_2)&#x3D;\\lim_{\\substack{t_1 \\rightarrow 0 }}   \\int_{at_1}^{bt_1} \\frac{f(x)}{x}\\mathrm{d} x-\\lim_{\\substack{t_2 \\rightarrow +\\infty }}\\int_{bt_2}^{at_2} \\frac{f(x)}{x}\\mathrm{d}x\\\\<br>&amp;\\text{ä½¿ç”¨ç§¯åˆ†ä¸­å€¼å®šç†å¾—}\\\\<br>&amp;\\lim_{\\substack{t_1 \\rightarrow 0 }}f(\\eta_1) \\int_{a t_1}^{b t_1} \\frac{1}{x} d x+ \\lim_{\\substack{t_2 \\rightarrow +\\infty }}f(\\eta_2) \\int_{b t_2}^{a t_2} \\frac{1}{x} d x. \\\\<br>&amp;&#x3D;\\lim_{\\substack{t_1 \\rightarrow 0 \\\\t_2\\rightarrow+\\infty}}\\left(f(\\eta_1)-f(\\eta_2) \\right)\\ln \\frac{b}{a}\\\\<br>&amp;0\\leq\\eta_1\\leq bt_1,min(at_2,bt_2)\\leq \\eta_2\\leq max (at_2,bt_2)\\\\<br>&amp;åˆf(x)åœ¨[0,+\\infty) ä¸Šè¿ç»­ï¼Œä¸” \\lim_{x \\rightarrow+\\infty} f(x)&#x3D;c,å¾—\\\\<br>\\end{aligned}$$</p>\n<p>$$\\int_0^{+\\infty} \\frac{f(a x)-f(b x)}{x} \\mathrm{~d} x&#x3D;\\lim_{\\substack{t_1 \\rightarrow 0 \\\\t_2\\rightarrow+\\infty}}F(t_1,t_2)&#x3D;(f(0)-c) \\ln \\frac{b}{a}$$</p>\n","categories":["é«˜ç­‰æ•°å­¦"]},{"title":"å›¾åƒå»å™ª","url":"/2024/06/26/cv1/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>ä¸ºäº†æ“ä½œæ–¹ä¾¿ï¼Œæˆ‘ä»¬å°†åŸå§‹è¾“å…¥çš„å½©è‰²å›¾ç‰‡è½¬ä¸ºé»‘ç™½</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">rgb2gray</span>(<span class=\"params\">adr</span>):</span><br><span class=\"line\">    img=cv2.imread(adr)</span><br><span class=\"line\">    width = img.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">    height = img.shape[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    grayimg = np.zeros([width,height],np.uint8) </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(width):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(height):</span><br><span class=\"line\">            grayimg[i,j] = <span class=\"number\">0.299</span> * img[i,j][<span class=\"number\">0</span>] + <span class=\"number\">0.587</span> * img[i,j][<span class=\"number\">1</span>] </span><br><span class=\"line\">            +  <span class=\"number\">0.114</span> * img[i,j][<span class=\"number\">2</span>]        </span><br><span class=\"line\">    cv2.imshow(<span class=\"string\">&#x27;grayimage&#x27;</span>, grayimg)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> grayimg</span><br></pre></td></tr></table></figure>\n<span id=\"more\"></span>\n<p>åŸå§‹å›¾åƒ</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/maid.jpg?raw=true\" alt=\"alt text\"></p>\n<p>ç°åº¦å›¾åƒ</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"æ·»åŠ æ¤’ç›å™ªå£°\"><a href=\"#æ·»åŠ æ¤’ç›å™ªå£°\" class=\"headerlink\" title=\"æ·»åŠ æ¤’ç›å™ªå£°\"></a>æ·»åŠ æ¤’ç›å™ªå£°</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">pepper_and_salt</span>(<span class=\"params\">img,percentage</span>):</span><br><span class=\"line\">    num=<span class=\"built_in\">int</span>(percentage*img.shape[<span class=\"number\">0</span>]*img.shape[<span class=\"number\">1</span>])<span class=\"comment\">#  æ¤’ç›å™ªå£°ç‚¹æ•°é‡</span></span><br><span class=\"line\">    random.randint(<span class=\"number\">0</span>, img.shape[<span class=\"number\">0</span>])</span><br><span class=\"line\">    img2=img.copy()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(num):</span><br><span class=\"line\">        X=random.randint(<span class=\"number\">0</span>,img2.shape[<span class=\"number\">0</span>]-<span class=\"number\">1</span>)<span class=\"comment\">#ä»0åˆ°å›¾åƒé•¿åº¦ä¹‹é—´çš„ä¸€ä¸ªéšæœºæ•´æ•°</span></span><br><span class=\"line\">        Y=random.randint(<span class=\"number\">0</span>,img2.shape[<span class=\"number\">1</span>]-<span class=\"number\">1</span>)<span class=\"comment\">#å› ä¸ºæ˜¯é—­åŒºé—´æ‰€ä»¥-1</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> random.randint(<span class=\"number\">0</span>,<span class=\"number\">1</span>) ==<span class=\"number\">0</span>: <span class=\"comment\">#é»‘ç™½è‰²æ¦‚ç‡55å¼€</span></span><br><span class=\"line\">            img2[X,Y] = (<span class=\"number\">255</span>)<span class=\"comment\">#ç™½è‰²</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            img2[X,Y] =(<span class=\"number\">0</span>)<span class=\"comment\">#é»‘è‰²</span></span><br><span class=\"line\">    <span class=\"comment\">#cv2.imshow(&quot;shabi_pepper_and_salt&quot;,img2)</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> img2</span><br></pre></td></tr></table></figure>\n\n\n<p>åŠ å™ªåå›¾åƒ</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-1.jpg?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"åŸºäºåƒç´ çš„å‡å€¼ã€ä¸­å€¼æ»¤æ³¢çš„å»å™ª\"><a href=\"#åŸºäºåƒç´ çš„å‡å€¼ã€ä¸­å€¼æ»¤æ³¢çš„å»å™ª\" class=\"headerlink\" title=\"åŸºäºåƒç´ çš„å‡å€¼ã€ä¸­å€¼æ»¤æ³¢çš„å»å™ª\"></a>åŸºäºåƒç´ çš„å‡å€¼ã€ä¸­å€¼æ»¤æ³¢çš„å»å™ª</h1><h2 id=\"å‡å€¼æ»¤æ³¢\"><a href=\"#å‡å€¼æ»¤æ³¢\" class=\"headerlink\" title=\"å‡å€¼æ»¤æ³¢\"></a>å‡å€¼æ»¤æ³¢</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">mean_fliter</span>(<span class=\"params\">img,size</span>):</span><br><span class=\"line\">        edge=<span class=\"built_in\">int</span>((size-<span class=\"number\">1</span>)/<span class=\"number\">2</span>)</span><br><span class=\"line\">        width = img.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">        height = img.shape[<span class=\"number\">1</span>]</span><br><span class=\"line\">        img_fliter = np.zeros([width,height,<span class=\"number\">1</span>],np.uint8) </span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(width-size):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(height-size):</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> i &lt;= edge - <span class=\"number\">1</span> <span class=\"keyword\">or</span> i &gt;= height - <span class=\"number\">1</span> - edge <span class=\"keyword\">or</span> </span><br><span class=\"line\">                    j &lt;= edge - <span class=\"number\">1</span> <span class=\"keyword\">or</span> j &gt;= height - edge - <span class=\"number\">1</span>:</span><br><span class=\"line\">                        img_fliter[i, j] = img[i, j]</span><br><span class=\"line\">                    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        img_fliter[i, j] = np.mean(img[i - edge:i + edge + <span class=\"number\">1</span>,</span><br><span class=\"line\">                         j - edge:j + edge + <span class=\"number\">1</span>])</span><br><span class=\"line\">        cv2.imshow(<span class=\"string\">&quot;mean fliter&quot;</span>,img_fliter)</span><br></pre></td></tr></table></figure>\n<p>å‡å€¼æ»¤æ³¢å›¾åƒ</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-2.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"ä¸­å€¼æ»¤æ³¢\"><a href=\"#ä¸­å€¼æ»¤æ³¢\" class=\"headerlink\" title=\"ä¸­å€¼æ»¤æ³¢\"></a>ä¸­å€¼æ»¤æ³¢</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">median_fliter</span>(<span class=\"params\">img,size</span>):</span><br><span class=\"line\">        edge=<span class=\"built_in\">int</span>((size-<span class=\"number\">1</span>)/<span class=\"number\">2</span>)</span><br><span class=\"line\">        width = img.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">        height = img.shape[<span class=\"number\">1</span>]</span><br><span class=\"line\">        img_fliter = np.zeros([width,height,<span class=\"number\">1</span>],np.uint8) </span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(width-size):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(height-size):</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> i &lt;= edge - <span class=\"number\">1</span> <span class=\"keyword\">or</span> i &gt;= height - <span class=\"number\">1</span> </span><br><span class=\"line\">                    - edge <span class=\"keyword\">or</span> j &lt;= edge - <span class=\"number\">1</span> <span class=\"keyword\">or</span> j &gt;= height - edge - <span class=\"number\">1</span>:</span><br><span class=\"line\">                        img_fliter[i, j] = img[i, j]</span><br><span class=\"line\">                    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">                        img_fliter[i, j] = np.median(img[i - edge:i + edge + <span class=\"number\">1</span>, </span><br><span class=\"line\">                        j - edge:j + edge + <span class=\"number\">1</span>])</span><br><span class=\"line\">        cv2.imshow(<span class=\"string\">&quot;meadian fliter&quot;</span>,img_fliter)</span><br></pre></td></tr></table></figure>\n<p>ä¸­å€¼æ»¤æ³¢å›¾åƒ</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-3.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"åŸºäºå·ç§¯çš„å‡å€¼æ»¤æ³¢\"><a href=\"#åŸºäºå·ç§¯çš„å‡å€¼æ»¤æ³¢\" class=\"headerlink\" title=\"åŸºäºå·ç§¯çš„å‡å€¼æ»¤æ³¢\"></a>åŸºäºå·ç§¯çš„å‡å€¼æ»¤æ³¢</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">kernel = np.array([[<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>],</span><br><span class=\"line\">                   [<span class=\"number\">2</span>, <span class=\"number\">4</span>, <span class=\"number\">2</span>],</span><br><span class=\"line\">                   [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">1</span>]])/<span class=\"number\">16</span> <span class=\"comment\"># å®šä¹‰å·ç§¯æ ¸</span></span><br><span class=\"line\">output = cv2.filter2D(img2,-<span class=\"number\">1</span>,kernel)<span class=\"comment\"># è¿›è¡Œå·ç§¯æ“ä½œ</span></span><br></pre></td></tr></table></figure>\n<p>å·ç§¯å›¾åƒ<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-5.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"éå±€éƒ¨å‡å€¼å»å™ª\"><a href=\"#éå±€éƒ¨å‡å€¼å»å™ª\" class=\"headerlink\" title=\"éå±€éƒ¨å‡å€¼å»å™ª\"></a>éå±€éƒ¨å‡å€¼å»å™ª</h1><h2 id=\"ç®—æ³•åŸç†\"><a href=\"#ç®—æ³•åŸç†\" class=\"headerlink\" title=\"ç®—æ³•åŸç†\"></a>ç®—æ³•åŸç†</h2><p>éå±€éƒ¨å‡å€¼å»å™ª (NL-means)<br>éå±€éƒ¨å‡å€¼ (NL-means) æ˜¯è¿‘å¹´æ¥æå‡ºçš„ä¸€é¡¹æ–°å‹çš„å»å™ªæŠ€æœ¯ã€‚è¯¥æ–¹æ³•å……åˆ†åˆ©ç”¨äº†å›¾åƒä¸­çš„å‡ ä½™ä¿¡æ¯ï¼Œåœ¨å»å™ªçš„åŒæ—¶èƒ½æœ€å¤§ç¨‹åº¦åœ°ä¿æŒå›¾åƒçš„ç»†èŠ‚ç‰¹å¾ã€‚åŸºæœ¬æ€æƒ³æ˜¯ï¼šå½“å‰åƒç´ çš„ä¼°è®¡å€¼ç”±å›¾åƒä¸­ä¸å®ƒå…·æœ‰ç›¸ä¼¼ä»¤åŸŸç»“æ„çš„åƒç´ åŠ æƒå¹³å‡å¾—åˆ°ã€‚</p>\n<p>ç†è®ºä¸Šï¼Œè¯¥ç®—æ³•éœ€è¦åœ¨æ•´ä¸ªå›¾åƒèŒƒå›´å†…åˆ¤æ–­åƒç´ é—´çš„ç›¸ä¼¼åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯å¤„ç†ä¸€ä¸ªåƒç´ ç‚¹æ—¶ï¼Œéƒ½è¦è®¡ç®—å®ƒä¸å›¾åƒä¸­æ‰€æœ‰åƒç´ ç‚¹é—´çš„ç›¸ä¼¼åº¦ã€‚ä½†æ˜¯è€ƒè™‘åˆ°æ•ˆç‡é—®é¢˜ï¼Œå®ç°çš„æ—¶å€™ï¼Œä¼šè®¾å®šä¸¤ä¸ªå›ºå®šå¤§å°çš„çª—å£: æœç´¢çª—å£ $(D \\times D, D&#x3D;2 * D s+1)$ å’Œé‚»åŸŸçª—å£ $(d \\times d, d&#x3D;2 * d s+1)$ ã€‚é‚»åŸŸçª—å£åœ¨æœç´¢çª—å£ä¸­æ»‘åŠ¨ï¼Œæ ¹æ®é‚»åŸŸé—´çš„ç›¸ä¼¼æ€§ç¡®å®šåƒç´ çš„æƒå€¼ã€‚</p>\n<p>ä¸‹å›¾æ˜¯NL-meansç®—æ³•æ‰§è¡Œè¿‡ç¨‹ï¼Œå¤§çª—å£æ˜¯ä»¥ç›®æ ‡åƒç´  $x$ ä¸ºä¸­å¿ƒçš„æœç´¢çª—å£ï¼Œä¸¤ä¸ªç°è‰²å°çª—å£åˆ†åˆ«æ˜¯ä»¥ $x ã€ y$ ä¸ºä¸­å¿ƒçš„é‚»åŸŸçª—å£ã€‚å…¶ä¸­ä»¥ $y$ ä¸ºä¸­å¿ƒçš„é‚»åŸŸçª—å£åœ¨æœç´¢çª—å£ä¸­æ»‘åŠ¨ï¼Œé€šè¿‡è®¡ç®—ä¸¤ä¸ªé‚»åŸŸçª—å£é—´çš„ç›¸ä¼¼ç¨‹åº¦ä¸º $y$èµ‹ä»¥æƒå€¼$w(x, y)$ ã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-6.png?raw=true\" alt=\"alt text\"></p>\n<p>è®¾å«å™ªå£°å›¾åƒä¸º $v$ ï¼Œå»å™ªåçš„å›¾åƒä¸º $\\tilde{u}$ ã€‚ $\\tilde{u}$ ä¸­åƒç´ ç‚¹ $x$ å¤„çš„ç°åº¦å€¼é€šè¿‡å¦‚ä¸‹æ–¹å¼å¾—åˆ°:<br>$$<br>\\tilde{u}(x)&#x3D;\\sum_{y \\in I} w(x, y) * v(y)<br>$$</p>\n<p>å…¶ä¸­æƒå€¼ $w(x, y)$ è¡¨ç¤ºåƒç´ ç‚¹ $x$ å’Œ $Y$ é—´çš„ç›¸ä¼¼åº¦ï¼Œå®ƒçš„å€¼ç”±ä»¥ $x, y$ ä¸ºä¸­å¿ƒçš„çŸ©å½¢é‚»åŸŸ $V(x) ã€ V(y)$ é—´çš„è·ç¦» $|V(x)-V(y)|^2$ å†³å®š:<br>$$<br>w(x, y)&#x3D;\\frac{1}{Z(x)} \\exp \\left(-\\frac{|V(x)-V(y)|^2}{h^2}\\right)<br>$$</p>\n<p>å…·ä¸­<br>$$<br>\\begin{aligned}<br>&amp; |V(x)-V(y)|^2&#x3D;\\frac{1}{d^2} \\sum_{|z|_{\\infty} \\leq d s}|v(x+z)-v(y+z)|^2 \\\\<br>&amp; Z(x)&#x3D;\\sum_y \\exp \\left(-\\frac{|V(x)-V(y)|^2}{h^2}\\right)<br>\\end{aligned}<br>$$<br>$Z(x)$ ä¸ºå½’ä¸€åŒ–ç³»æ•°ï¼Œ $h$ ä¸ºå¹³æ»‘å‚æ•°ï¼Œæ§åˆ¶é«˜æ–¯å‡½æ•°çš„è¡°å‡ç¨‹åº¦ã€‚ $h$ è¶Šå¤§é«˜æ–¯å‡½æ•°å˜åŒ–è¶Šå¹³ç¼“ï¼Œå»å™ªæ°´å¹³è¶Šé«˜ï¼Œä½†åŒæ—¶ä¹Ÿä¼šå¯¼è‡´å›¾åƒè¶Šæ¨¡ç³Šã€‚ $h$ è¶Šå°ï¼Œè¾¹ç¼˜ç»†èŠ‚æˆåˆ†ä¿æŒå¾—è¶Šå¤šï¼Œä½†ä¼šæ®‹ç•™è¿‡å¤šçš„å™ªå£°ç‚¹ã€‚ $h$ çš„å…·ä½“å–å€¼åº”å½“ä»¥å›¾åƒä¸­çš„å™ªå£°æ°´å¹³ä¸ºä¾æ®ã€‚</p>\n<h2 id=\"å…·ä½“å†…å®¹\"><a href=\"#å…·ä½“å†…å®¹\" class=\"headerlink\" title=\"å…·ä½“å†…å®¹\"></a>å…·ä½“å†…å®¹</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">NLM_fliter</span>(<span class=\"params\">img</span>):</span><br><span class=\"line\">    img2 = np.zeros([img.shape[<span class=\"number\">0</span>],img.shape[<span class=\"number\">1</span>]],np.uint8) </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>,img.shape[<span class=\"number\">0</span>]-<span class=\"number\">10</span>):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">10</span>,img.shape[<span class=\"number\">1</span>]-<span class=\"number\">10</span>):</span><br><span class=\"line\">            search_window=img[i-<span class=\"number\">10</span>:i+<span class=\"number\">11</span>,j-<span class=\"number\">10</span>:j+<span class=\"number\">11</span>]</span><br><span class=\"line\">            patch=img[i-<span class=\"number\">3</span>:i+<span class=\"number\">4</span>,j-<span class=\"number\">3</span>:j+<span class=\"number\">4</span>]</span><br><span class=\"line\">            img2[i,j]=pixel_estimation(search_window,patch,<span class=\"number\">100</span>/<span class=\"number\">256</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> img2</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">pixel_estimation</span>(<span class=\"params\">search_window,patch,h</span>):</span><br><span class=\"line\">    window_height=search_window.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">    window_width=search_window.shape[<span class=\"number\">1</span>]</span><br><span class=\"line\">    patch_height=patch.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">    patch_width=patch.shape[<span class=\"number\">1</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    similarity=np.zeros((window_height-patch_height//<span class=\"number\">2</span>*<span class=\"number\">2</span>,</span><br><span class=\"line\">    window_width-patch_width//<span class=\"number\">2</span>*<span class=\"number\">2</span>))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(patch_height//<span class=\"number\">2</span>,window_height-patch_height//<span class=\"number\">2</span>):</span><br><span class=\"line\">         <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(patch_width//<span class=\"number\">2</span>,window_width-patch_width//<span class=\"number\">2</span>):</span><br><span class=\"line\">              temp=search_window[i-patch_height//<span class=\"number\">2</span>:i+patch_height//<span class=\"number\">2</span>+<span class=\"number\">1</span>,</span><br><span class=\"line\">              j-patch_width//<span class=\"number\">2</span>:j+patch_width//<span class=\"number\">2</span>+<span class=\"number\">1</span>]</span><br><span class=\"line\">              similarity[i-patch_height//<span class=\"number\">2</span>,j-patch_width//<span class=\"number\">2</span>]=weight_eucledian_distance(patch,temp,h)</span><br><span class=\"line\">    Z=np.<span class=\"built_in\">sum</span>(similarity)</span><br><span class=\"line\">    weights=np.zeros(search_window.shape)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(patch_height//<span class=\"number\">2</span>,window_height-patch_height//<span class=\"number\">2</span>):</span><br><span class=\"line\">         <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(patch_width//<span class=\"number\">2</span>,window_width-patch_width//<span class=\"number\">2</span>):</span><br><span class=\"line\">              weights[i,j]=<span class=\"number\">1</span>/Z*similarity[i-patch_height//<span class=\"number\">2</span>,j-patch_width//<span class=\"number\">2</span>]</span><br><span class=\"line\">    NLM_estimation=np.<span class=\"built_in\">sum</span>(weights*search_window)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> NLM_estimation.astype(np.uint8)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">weight_eucledian_distance</span>(<span class=\"params\">patch1,patch2,h</span>):</span><br><span class=\"line\">     <span class=\"keyword\">return</span> np.exp(-(patch1-patch2)**<span class=\"number\">2</span>/(h*h))</span><br></pre></td></tr></table></figure>\n\n<p>NLMå›¾åƒ<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-4.png?raw=true\" alt=\"alt text\"></p>\n","categories":["Computer Vision"]},{"title":"æ— é¢˜ğ…¡","url":"/2024/06/14/HM24-6-13/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>$$<br>\\begin{array}{l}<br>f(x) \\text { åœ¨ }(0,2 \\pi) 2 \\text { é˜¶å¯å¯¼ } ï¼Œf^{\\prime \\prime}(x) \\neq f(x) &amp; \\\\<br>\\exists \\xi \\in(0,2 \\pi) \\text { ä½¿å¾— } \\tan \\xi&#x3D;\\frac{2 \\cdot f^{\\prime}(\\xi)}{f(\\xi)-f^{\\prime \\prime}(\\xi)}  \\text { æˆç«‹ }<br>\\end{array}<br>$$</p>\n<p>è§£ï¼š</p>\n<p>$$\\frac{sin(\\xi)}{cos(\\xi)}&#x3D;\\frac{2 \\cdot f^{\\prime}(\\xi)}{f(\\xi)-f^{\\prime \\prime}(\\xi)}$$<br>$ç”±äºf^{\\prime \\prime}(x)\\neq f(x),äº¤å‰ç›¸ä¹˜å¾—$<span id=\"more\"></span><br>$$<br>\\begin{array}{l}<br>f(\\xi)sin(\\xi)-f^{\\prime \\prime}(\\xi)sin(\\xi)&#x3D;2fâ€™(\\xi)cos(\\xi)\\\\<br>f(\\xi)sin(\\xi)-fâ€™(\\xi)cos(\\xi)&#x3D;f^{\\prime \\prime}(\\xi)sin(\\xi)+fâ€™(\\xi)cos(\\xi)\\\\<br>-\\left(f(\\xi)cos(\\xi)\\right)â€™&#x3D;(fâ€™(\\xi)sin(\\xi))â€™\\\\<br>\\left(f(\\xi)cos(\\xi)+fâ€™(\\xi)sin(\\xi)\\right)â€™&#x3D;0\\\\<br>\\left(f(\\xi)sin(\\xi)\\right)â€™â€™&#x3D;0<br>\\end{array}<br>$$<br>æ•…ä»¤$F(x)&#x3D;f(x)sin(x),F(0)&#x3D;F(\\pi)&#x3D;F(2\\pi)&#x3D;0$</p>\n<p>$\\exists \\xi_1 \\in(0,\\pi),\\exists \\xi_2 \\in(\\pi,2\\pi)$,ä½¿å¾—$Fâ€™(\\xi_1)&#x3D;Fâ€™(\\xi_2)&#x3D;0$</p>\n<p>$\\exists \\xi_3 \\in(0,2\\pi)$,ä½¿å¾—$Fâ€™â€™(\\xi_3)&#x3D;0$</p>\n","categories":["é«˜ç­‰æ•°å­¦"]},{"title":"2025æ­¦å¿ è¯¦é«˜æ•°è¾…å¯¼è®²ä¹‰ä¸¥é€‰é¢˜æ— ç©·çº§æ•°ç¬¬äºŒé¢˜ç¬¬ä¸‰é¡¹çš„åä¾‹","url":"/2024/06/19/HM24-6-19/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>è‹¥ $\\lim _{n \\rightarrow \\infty} \\frac{u_n}{v_n}&#x3D;l \\neq 0$, åˆ™ $\\sum_{n&#x3D;1}^{\\infty} u_n$ ä¸ $\\sum_{n&#x3D;1}^{\\infty} v_n$ åŒæ•›æ•£.</p>\n<p>åä¾‹<br>$$<br>\\begin{aligned}<br>&amp; u_n&#x3D;\\frac{(-1)^n}{\\sqrt{n}}+\\frac{1}{n} \\\\\\\\<br>&amp; v_n&#x3D;\\frac{(-1)^n}{\\sqrt{n}}<br>\\end{aligned}<br>$$<br>$$<br>\\lim _{n \\rightarrow \\infty}\\frac{\\frac{(-1)^n}{\\sqrt{n}}+\\frac{1}{n}}{\\frac{(-1)^n}{\\sqrt{n}}}&#x3D; \\frac{(-1)^n+\\frac{1}{\\sqrt{n}}}{(-1)^n}&#x3D;1<br>$$<br>æ˜¾ç„¶ $\\sum_{n&#x3D;1}^{\\infty} v_n$æ”¶æ•›è€Œ $\\sum_{n&#x3D;1}^{\\infty} u_n$å‘æ•£</p>\n","categories":["é«˜ç­‰æ•°å­¦"]},{"title":"æ— é¢˜â™ª","url":"/2024/07/12/HM24-7-2/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><p>è®¾ $f(x)$ åœ¨ $(-\\infty,+\\infty)$ä¸ŠäºŒé˜¶å¯å¯¼, ä¸” $f^{\\prime \\prime}(x) \\geqslant 0$.</p>\n<p>(1) è¯æ˜: å¯¹äºä»»æ„ $x_0, x \\in(-\\infty,+\\infty)$, æœ‰ $f(x) \\geqslant f(x_0)+f^{\\prime}(x_0)(x-x_0)$;</p>\n<p>(2) è¯æ˜: è‹¥å­˜åœ¨å¸¸æ•° $M&gt;0$, ä½¿å¾—ä»»æ„ $x \\in(-\\infty,+\\infty)$, å‡æœ‰ $|f(x)| \\leqslant M$, åˆ™ $f(x)$ ä¸ºå¸¸å€¼å‡½æ•°</p>\n<p>æ³°å‹’å±•å¼€å¾—<br>$$f(x)&#x3D;f(x_0)+f^{\\prime}(x)(x-x_0)+\\frac{f^{\\prime \\prime}(\\xi)}{2}(x-x_0)^2$$<br>åˆ$f^{\\prime \\prime}(x) \\geqslant 0$ï¼Œå¾—è¯ $f(x) \\geqslant f(x_0)+f^{\\prime}(x)(x-x_0)$</p>\n<p>è®¾$\\exists x_0$ ,ä½¿å¾—$f^{\\prime}(x_0) \\neq 0$, æœ‰$f(x) \\geqslant f^{\\prime}(x_0) x+f(x_0)-x_0 f^{\\prime}(x_0)$  ,$f(x)$ åœ¨ä¸€æ¡ç›´çº¿ä¸Šæ–¹ï¼Œå¯¹äº  $\\forall M$  ï¼Œå‡æœ‰ $|f(x)| &gt;M$  , ä¸$|f(x)| \\leqslant M$çŸ›ç›¾ï¼Œæ•…  $fâ€™(x)$æ’ä¸º $0$ ï¼Œå³$f(x)$ä¸ºå¸¸å‡½æ•°</p>\n","categories":["é«˜ç­‰æ•°å­¦"]},{"title":"è¾¹ç¼˜æ£€æµ‹","url":"/2024/06/26/cv2/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"cannyè¾¹ç¼˜æ£€æµ‹ç®—å­\"><a href=\"#cannyè¾¹ç¼˜æ£€æµ‹ç®—å­\" class=\"headerlink\" title=\"cannyè¾¹ç¼˜æ£€æµ‹ç®—å­\"></a>cannyè¾¹ç¼˜æ£€æµ‹ç®—å­</h1><h2 id=\"ç†è®ºåŸç†\"><a href=\"#ç†è®ºåŸç†\" class=\"headerlink\" title=\"ç†è®ºåŸç†\"></a>ç†è®ºåŸç†</h2><p>Canny ç®—å­æ˜¯å¸¸ç”¨çš„è¾¹ç¼˜æ£€æµ‹ç®—æ³•ï¼Œå…¶æ‰§è¡Œæ­¥éª¤å¦‚ä¸‹:</p>\n<ol>\n<li>åº”ç”¨é«˜æ–¯æ»¤æ³¢å™¨å¹³æ»‘å›¾åƒä»¥å»é™¤å™ªå£°</li>\n<li>è®¡ç®—å›¾åƒçš„å¼ºåº¦æ¢¯åº¦</li>\n<li>åº”ç”¨éæœ€å¤§æŠ‘åˆ¶ï¼ˆNon-maximum suppressionï¼‰æ¶ˆé™¤è¾¹ç¼˜æ£€æµ‹çš„è™šå‡å“åº”</li>\n<li>åº”ç”¨åŒé˜ˆå€¼ç¡®å®šæ½œåœ¨è¾¹ç¼˜</li>\n<li>é€šè¿‡æ»å (hysteresis ) æ–¹æ³•è·Ÿè¸ªè¾¹ç¼˜ï¼šé€šè¿‡æŠ‘åˆ¶æ‰€æœ‰å…¶ä»–å¼±è¾¹ç¼˜å’Œæœªè¿æ¥åˆ°å¼ºè¾¹ç¼˜çš„è¾¹ç¼˜ï¼Œå®Œæˆè¾¹ç¼˜æ£€æµ‹</li>\n</ol>\n<h3 id=\"é«˜æ–¯æ»¤æ³¢\"><a href=\"#é«˜æ–¯æ»¤æ³¢\" class=\"headerlink\" title=\"é«˜æ–¯æ»¤æ³¢\"></a>é«˜æ–¯æ»¤æ³¢</h3><span id=\"more\"></span>\n\n<p>é€šè¿‡é«˜æ–¯æ»¤æ³¢å»é™¤å›¾åƒå™ªå£°çš„å½±å“ï¼Œå¸¸ç”¨ $5 \\times 5$ å¤§å°çš„é«˜æ–¯æ ¸ï¼Œè®¾ç½® $\\sigma&#x3D;1.4$<br>$$<br>\\mathbf{B}&#x3D;\\frac{1}{159}\\left[\\begin{array}{ccccc}<br>2 &amp; 4 &amp; 5 &amp; 4 &amp; 2 \\\\<br>4 &amp; 9 &amp; 12 &amp; 9 &amp; 4 \\\\<br>5 &amp; 12 &amp; 15 &amp; 12 &amp; 5 \\\\<br>4 &amp; 9 &amp; 12 &amp; 9 &amp; 4 \\\\<br>2 &amp; 4 &amp; 5 &amp; 4 &amp; 2<br>\\end{array}\\right] * \\mathbf{A}<br>$$</p>\n<p>é«˜æ–¯æ»¤æ³¢æ ¸å°ºå¯¸è¶Šå¤§ï¼Œè¶Šèƒ½å¤Ÿå¹³æ»‘å™ªå£°å½±å“ï¼Œä½†ä¸æ­¤åŒæ—¶ Canny ç®—å­çš„è¾¹ç¼˜æ£€æµ‹çš„æ€§èƒ½ä¼šé™ä½</p>\n<h3 id=\"å›¾åƒæ¢¯åº¦è®¡ç®—\"><a href=\"#å›¾åƒæ¢¯åº¦è®¡ç®—\" class=\"headerlink\" title=\"å›¾åƒæ¢¯åº¦è®¡ç®—\"></a>å›¾åƒæ¢¯åº¦è®¡ç®—</h3><p>é€šè¿‡ Sobel ç®—å­è®¡ç®—å›¾åƒçš„æ°´å¹³å’Œå‚ç›´åå‘å¯¼æ•°ï¼Œç„¶åè®¡ç®—æ¢¯åº¦å¤§å°å’Œæ–¹å‘<br>$$<br>\\begin{aligned}<br>&amp; G&#x3D;\\sqrt{G_x^2+G_y^2} \\<br>&amp; \\theta&#x3D;\\arctan \\left(\\frac{G_y}{G_x}\\right)<br>\\end{aligned}<br>$$</p>\n<p>å°†æ¢¯åº¦æ–¹å‘é€šè¿‡å››èˆäº”å…¥æ–¹æ³•å½’å…¥åˆ°æ°´å¹³&#x2F;å‚ç›´&#x2F;å¯¹è§’ $\\left(0^{\\circ}, 45^{\\circ}, 90^{\\circ}\\right.$ å’Œ $\\left.135^{\\circ}\\right)$ ï¼Œæ¯”å¦‚ $\\left[0^{\\circ}, 22.5^{\\circ}\\right]$ å’Œ $\\left[157.5^{\\circ}, 180^{\\circ}\\right]$ æ˜ å°„ä¸º $0^{\\circ}$</p>\n<h3 id=\"éæœ€å¤§æŠ‘åˆ¶\"><a href=\"#éæœ€å¤§æŠ‘åˆ¶\" class=\"headerlink\" title=\"éæœ€å¤§æŠ‘åˆ¶\"></a>éæœ€å¤§æŠ‘åˆ¶</h3><p>éæœ€å¤§æŠ‘åˆ¶æ˜¯ä¸€ç§è¾¹ç¼˜ç»†åŒ–æŠ€æœ¯ã€‚è¿›è¡Œæ¢¯åº¦è®¡ç®—åçš„å›¾åƒè¾¹ç¼˜ä»æ—§å¾ˆæ¨¡ç³Šï¼Œè¾¹ç¼˜æ‹¥æœ‰å¤šä¸ªå€™é€‰ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦åº”ç”¨éæœ€å¤§æŠ‘åˆ¶æ¥å¯»æ‰¾â€œæœ€å¤§â€åƒç´ ç‚¹ï¼Œå³å…·æœ‰æœ€å¤§å¼ºåº¦å€¼å˜åŒ–çš„ä½ç½®ï¼Œç§»é™¤å…¶ä»–æ¢¯åº¦å€¼ï¼Œä¿è¯è¾¹ç¼˜å…·æœ‰å‡†ç¡®çš„å“åº”ã€‚å…¶åŸç†å¦‚ä¸‹</p>\n<ol>\n<li>å°†å½“å‰åƒç´ çš„è¾¹ç¼˜å¼ºåº¦ä¸åƒç´ åœ¨æ­£æ¢¯åº¦æ–¹å‘å’Œè´Ÿæ¢¯åº¦æ–¹å‘ä¸Šçš„è¾¹ç¼˜å¼ºåº¦è¿›è¡Œæ¯”è¾ƒ</li>\n<li>å¦‚æœä¸ç›¸åŒæ–¹å‘çš„æ©æ¨¡ä¸­çš„å…¶ä»–åƒç´ ç›¸æ¯”ï¼Œå½“å‰åƒç´ çš„è¾¹ç¼˜å¼ºåº¦æ˜¯æœ€å¤§çš„(ä¾‹å¦‚ï¼ŒæŒ‡å‘ $\\mathrm{y}$ è½´æ–¹å‘çš„åƒç´ å°†ä¸å‚ç›´è½´ä¸Šæ–¹å’Œä¸‹æ–¹çš„åƒç´ ç›¸æ¯”è¾ƒ) ï¼Œåˆ™è¯¥å€¼å°†è¢«ä¿ç•™ã€‚å¦åˆ™ï¼Œè¯¥å€¼å°†è¢«æŠ‘åˆ¶(å»é™¤æ¢¯åº¦å€¼ä¸º 0 )</li>\n</ol>\n<p>å…·ä½“å®ç°æ—¶ï¼Œå°†è¿ç»­æ¢¯åº¦æ–¹å‘åˆ†ç±»ä¸ºä¸€ç»„å°çš„ç¦»æ•£æ–¹å‘ï¼Œç„¶ååœ¨ä¸Šä¸€æ­¥çš„è¾“å‡º(å³è¾¹ç¼˜å¼ºåº¦å’Œæ¢¯åº¦æ–¹å‘ )ä¸Šç§»åŠ¨ $3 \\times 3$ æ»¤æ³¢å™¨ã€‚åœ¨æ¯ä¸ªåƒç´ å¤„ï¼Œå¦‚æœä¸­å¿ƒåƒç´ çš„å¤§å°ä¸å¤§äºæ¸å˜æ–¹å‘ä¸Šä¸¤ä¸ªç›¸é‚»åƒç´ çš„å¤§å°ï¼Œå®ƒå°†æŠ‘åˆ¶ä¸­å¿ƒåƒç´ çš„è¾¹ç¼˜å¼ºåº¦(é€šè¿‡å°†å…¶å€¼è®¾ç½®ä¸º 0 )</p>\n<ul>\n<li>å¦‚æœæ¢¯åº¦è§’åº¦ä¸º $0^{\\circ}$ ï¼ˆå³è¾¹ç¼˜åœ¨å—åŒ—æ–¹å‘ï¼‰ï¼Œå¦‚æœå…¶æ¢¯åº¦å¤§å°å¤§äºä¸œè¥¿æ–¹å‘åƒç´ å¤„çš„å¤§å°ï¼Œåˆ™è¯¥ç‚¹å°†è¢«è§†ä¸ºåœ¨è¾¹ç¼˜ä¸Š</li>\n<li>å¦‚æœæ¢¯åº¦è§’åº¦ä¸º $45^{\\circ}$ ï¼ˆå³è¾¹ç¼˜ä½äºè¥¿åŒ—-ä¸œå—æ–¹å‘ï¼‰ï¼Œå¦‚æœå…¶æ¢¯åº¦å¤§å°å¤§äºä¸œåŒ—å’Œè¥¿å—æ–¹å‘åƒç´ å¤„çš„å¤§å°ï¼Œåˆ™è¯¥ç‚¹å°†è¢«è§†ä¸ºä½äºè¾¹ç¼˜ä¸Š</li>\n<li>å¦‚æœæ¢¯åº¦è§’åº¦ä¸º $90^{\\circ}$ ï¼ˆå³è¾¹ç¼˜åœ¨ä¸œè¥¿æ–¹å‘ï¼‰ï¼Œå¦‚æœå…¶æ¢¯åº¦å¤§å°å¤§äºå—åŒ—æ–¹å‘åƒç´ å¤„çš„å¤§å°ï¼Œåˆ™è¯¥ç‚¹å°†è¢«è§†ä¸ºåœ¨è¾¹ç¼˜ä¸Š</li>\n<li>å¦‚æœæ¢¯åº¦è§’åº¦ä¸º $135^{\\circ}$ ï¼ˆå³è¾¹ç¼˜ä½äºä¸œåŒ—-è¥¿å—æ–¹å‘ï¼‰ï¼Œå¦‚æœå…¶æ¢¯åº¦å¤§å°å¤§äºè¥¿åŒ—å’Œä¸œå—æ–¹å‘åƒç´ å¤„çš„å¤§å°ï¼Œåˆ™è¯¥ç‚¹å°†è¢«è§†ä¸ºä½äºè¾¹ç¼˜ä¸Š</li>\n</ul>\n<h3 id=\"åŒè¾¹é˜ˆå€¼\"><a href=\"#åŒè¾¹é˜ˆå€¼\" class=\"headerlink\" title=\"åŒè¾¹é˜ˆå€¼\"></a>åŒè¾¹é˜ˆå€¼</h3><p>é€šè¿‡éæœ€å¤§æŠ‘åˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆç¡®å®šè¾¹ç¼˜çš„æœ€å¤§åƒç´ ç‚¹ï¼Œå‰©ä½™çš„è¾¹ç¼˜åƒç´ æä¾›äº†å›¾åƒä¸­çœŸå®è¾¹ç¼˜çš„æ›´ç²¾ç¡®è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œç”±äºå™ªå£°å’Œé¢œè‰²å˜åŒ–ï¼Œä¸€äº›è¾¹ç¼˜åƒç´ ä»ç„¶å­˜åœ¨ã€‚ä¸ºäº†å»é™¤è¿™äº›è™šå‡å“åº”ï¼Œå¿…é¡»æ»¤é™¤å…·æœ‰å¼±æ¢¯åº¦å€¼çš„è¾¹ç¼˜åƒç´ ï¼Œå¹¶ä¿ç•™å…·æœ‰é«˜æ¢¯åº¦å€¼çš„è¾¹ç¼˜åƒç´ ã€‚è¿™æ˜¯é€šè¿‡é€‰æ‹©é«˜é˜ˆå€¼å’Œä½é˜ˆå€¼æ¥å®ç°çš„ã€‚å¦‚æœè¾¹ç¼˜åƒç´ çš„æ¸å˜å€¼é«˜äºé«˜é˜ˆå€¼ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºå¼ºè¾¹ç¼˜åƒç´ ã€‚å¦‚æœè¾¹ç¼˜åƒç´ çš„æ¸å˜å€¼å°äºé«˜é˜ˆå€¼ä¸”å¤§äºä½é˜ˆå€¼ï¼Œåˆ™å°†å…¶æ ‡è®°ä¸ºå¼±è¾¹ç¼˜åƒç´ ã€‚å¦‚æœè¾¹ç¼˜åƒç´ çš„å€¼å°äºä½é˜ˆå€¼ï¼Œå®ƒå°†è¢«æŠ‘åˆ¶</p>\n<p>ä¸¤ä¸ªé˜ˆå€¼æ˜¯é€šè¿‡ç»éªŒç¡®å®šçš„ï¼Œå…¶å®šä¹‰å°†å–å†³äºç»™å®šè¾“å…¥å›¾åƒçš„å†…å®¹ã€‚é€šè¿‡å…¶æ¯”ç‡ï¼ˆ $upper: lower$ ï¼‰è®¾ç½®ä¸º $2: 1$ å’Œ $3: 1$ ä¹‹é—´</p>\n<h3 id=\"é€šè¿‡æ»åæ–¹æ³•è¿›è¡Œè¾¹ç¼˜è¿½è¸ª\"><a href=\"#é€šè¿‡æ»åæ–¹æ³•è¿›è¡Œè¾¹ç¼˜è¿½è¸ª\" class=\"headerlink\" title=\"é€šè¿‡æ»åæ–¹æ³•è¿›è¡Œè¾¹ç¼˜è¿½è¸ª\"></a>é€šè¿‡æ»åæ–¹æ³•è¿›è¡Œè¾¹ç¼˜è¿½è¸ª</h3><p>ç»è¿‡ä¸Šè¿°æ­¥éª¤å¤„ç†åï¼Œç»“æœå›¾åƒä»…åŒ…å«äº†å¼ºè¾¹ç¼˜åƒç´ å’Œå¼±è¾¹ç¼˜åƒç´ ã€‚å¯¹äºå¼±è¾¹ç¼˜åƒç´ è€Œè¨€ï¼Œè¿™äº›åƒç´ æ—¢å¯ä»¥ä»çœŸå®è¾¹ç¼˜æå–ï¼Œä¹Ÿå¯ä»¥ä»å™ªå£°&#x2F;é¢œè‰²å˜åŒ–ä¸­æå–</p>\n<p>é€šå¸¸ï¼Œç”±çœŸå®è¾¹ç¼˜å¼•èµ·çš„å¼±è¾¹ç¼˜åƒç´ å°†è¿æ¥åˆ°å¼ºè¾¹ç¼˜åƒç´ ï¼Œè€Œå™ªå£°å“åº”åˆ™ä¸è¿æ¥ã€‚ä¸ºäº†è·Ÿè¸ªè¾¹ç¼˜è¿æ¥ï¼Œé€šè¿‡è§‚å¯Ÿå¼±è¾¹ç¼˜åƒç´ åŠå…¶ 8 ä¸ªé‚»åŸŸåƒç´ æ¥è¿›è¡Œblobåˆ†æã€‚åªè¦ blob ä¸­åŒ…å«ä¸€ä¸ªå¼ºè¾¹ç¼˜åƒç´ ï¼Œå°±å¯ä»¥å°†è¯¥å¼±è¾¹ç¼˜ç‚¹è¯†åˆ«ä¸ºä¸€ä¸ªåº”è¯¥ä¿ç•™çš„ç‚¹</p>\n<h2 id=\"å…·ä½“å†…å®¹\"><a href=\"#å…·ä½“å†…å®¹\" class=\"headerlink\" title=\"å…·ä½“å†…å®¹\"></a>å…·ä½“å†…å®¹</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> cv2</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\">sys.setrecursionlimit(<span class=\"number\">3000</span>)</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">trace</span>(<span class=\"params\">M_supp,edge,i,j,LT</span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> edge[i,j]==<span class=\"number\">0</span>:</span><br><span class=\"line\">        edge[i,j]=<span class=\"number\">255</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> di,dj <span class=\"keyword\">in</span>[(-<span class=\"number\">1</span>,-<span class=\"number\">1</span>),(-<span class=\"number\">1</span>,<span class=\"number\">0</span>),(-<span class=\"number\">1</span>,<span class=\"number\">1</span>),(<span class=\"number\">0</span>,-<span class=\"number\">1</span>),(<span class=\"number\">0</span>,<span class=\"number\">1</span>),(<span class=\"number\">1</span>,-<span class=\"number\">1</span>),(<span class=\"number\">1</span>,<span class=\"number\">0</span>),(<span class=\"number\">1</span>,<span class=\"number\">1</span>)]:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> M_supp[i+di,j+dj]&gt;=LT:</span><br><span class=\"line\">                trace(M_supp,edge,i+di,j+dj,LT)</span><br><span class=\"line\">HT=<span class=\"number\">200</span></span><br><span class=\"line\">LT=<span class=\"number\">50</span></span><br><span class=\"line\">src=cv2.imread(<span class=\"string\">&#x27;E:\\shabi.jpg?raw=true&#x27;</span>)</span><br><span class=\"line\">dst=cv2.cvtColor(src,cv2.COLOR_BGRA2GRAY)</span><br><span class=\"line\">blur_dst=cv2.GaussianBlur(dst,(<span class=\"number\">5</span>,<span class=\"number\">5</span>),<span class=\"number\">0.5</span>)</span><br><span class=\"line\">dx=cv2.Sobel(blur_dst,cv2.CV_16S,<span class=\"number\">1</span>,<span class=\"number\">0</span>)</span><br><span class=\"line\">dy=cv2.Sobel(blur_dst,cv2.CV_16S,<span class=\"number\">0</span>,<span class=\"number\">1</span>)</span><br><span class=\"line\">M=<span class=\"built_in\">abs</span>(dx)+<span class=\"built_in\">abs</span>(dy)</span><br><span class=\"line\">theta=np.arctan2(dx,dy)</span><br><span class=\"line\">M_supp=np.zeros(M.shape)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,M.shape[<span class=\"number\">0</span>]-<span class=\"number\">1</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,M.shape[<span class=\"number\">1</span>]-<span class=\"number\">1</span>):</span><br><span class=\"line\">        x=dx[i,j]</span><br><span class=\"line\">        y=dy[i,j]</span><br><span class=\"line\">        angle=theta[i,j]/np.pi</span><br><span class=\"line\">        mag=M[i,j]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">abs</span>(angle)&lt;=<span class=\"number\">1</span>/<span class=\"number\">8.</span> <span class=\"keyword\">or</span> <span class=\"built_in\">abs</span>(angle)&gt;=<span class=\"number\">7</span>/<span class=\"number\">8.</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> mag&gt;=M[i-<span class=\"number\">1</span>,j] <span class=\"keyword\">and</span> mag&gt;=M[i+<span class=\"number\">1</span>,j]:</span><br><span class=\"line\">                M_supp[i,j]=mag</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"built_in\">abs</span>(angle-<span class=\"number\">1</span>/<span class=\"number\">2.</span>)&lt;=<span class=\"number\">1</span>/<span class=\"number\">8.</span> <span class=\"keyword\">or</span> <span class=\"built_in\">abs</span>(angle+<span class=\"number\">1</span>/<span class=\"number\">2.</span>)&lt;=<span class=\"number\">1</span>/<span class=\"number\">8.</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> mag&gt;=M[i,j-<span class=\"number\">1</span>] <span class=\"keyword\">and</span> mag&gt;=M[i,j+<span class=\"number\">1</span>]:</span><br><span class=\"line\">                M_supp[i,j]=mag</span><br><span class=\"line\">        <span class=\"keyword\">elif</span> <span class=\"built_in\">abs</span>(angle-<span class=\"number\">3</span>/<span class=\"number\">4.</span>)&lt;=<span class=\"number\">1</span>/<span class=\"number\">8.</span> <span class=\"keyword\">or</span> <span class=\"built_in\">abs</span>(angle+<span class=\"number\">3</span>/<span class=\"number\">4.</span>)&lt;=<span class=\"number\">1</span>/<span class=\"number\">8.</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> mag&gt;=M[i+<span class=\"number\">1</span>,j-<span class=\"number\">1</span>] <span class=\"keyword\">and</span> mag&gt;=M[i-<span class=\"number\">1</span>,j+<span class=\"number\">1</span>]:</span><br><span class=\"line\">                M_supp[i,j]=mag</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            <span class=\"keyword\">if</span> mag&gt;=M[i+<span class=\"number\">1</span>,j+<span class=\"number\">1</span>] <span class=\"keyword\">and</span> mag&gt;=M[i-<span class=\"number\">1</span>,j-<span class=\"number\">1</span>]:</span><br><span class=\"line\">                M_supp[i,j]=mag</span><br><span class=\"line\">M_supp=np.pad(M_supp,((<span class=\"number\">1</span>,<span class=\"number\">1</span>)),<span class=\"string\">&#x27;constant&#x27;</span>)</span><br><span class=\"line\">edge=np.zeros(M_supp.shape,dtype=np.uint8)</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,M_supp.shape[<span class=\"number\">0</span>]-<span class=\"number\">1</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,M_supp.shape[<span class=\"number\">1</span>]-<span class=\"number\">1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> M_supp[i,j]&gt;=HT:</span><br><span class=\"line\">            trace(M_supp,edge,i,j,LT)</span><br><span class=\"line\">edge=edge[<span class=\"number\">1</span>:-<span class=\"number\">1</span>,<span class=\"number\">1</span>:-<span class=\"number\">1</span>]</span><br><span class=\"line\">cv2.imshow(<span class=\"string\">&#x27;edge&#x27;</span>,edge)</span><br><span class=\"line\">cv2.imwrite(<span class=\"string\">&#x27;edge.jpg&#x27;</span>,edge)</span><br><span class=\"line\">cv2.waitKey(<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure>\n<p>åŸå§‹å›¾åƒ<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv1.jpg?raw=true\"></p>\n<p>è¾¹ç¼˜æ£€æµ‹<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/edge.jpg?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"åŸºäºé˜ˆå€¼çš„äºŒå€¼åŒ–åˆ†å‰²\"><a href=\"#åŸºäºé˜ˆå€¼çš„äºŒå€¼åŒ–åˆ†å‰²\" class=\"headerlink\" title=\"åŸºäºé˜ˆå€¼çš„äºŒå€¼åŒ–åˆ†å‰²\"></a>åŸºäºé˜ˆå€¼çš„äºŒå€¼åŒ–åˆ†å‰²</h1><h2 id=\"äººå·¥é€‰å–é˜ˆå€¼\"><a href=\"#äººå·¥é€‰å–é˜ˆå€¼\" class=\"headerlink\" title=\"äººå·¥é€‰å–é˜ˆå€¼\"></a>äººå·¥é€‰å–é˜ˆå€¼</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">human</span>(<span class=\"params\">gray_img,threhold</span>):</span><br><span class=\"line\">    dst=gray_img.copy()</span><br><span class=\"line\">    dst[dst&lt;threhold]=<span class=\"number\">0</span></span><br><span class=\"line\">    dst[dst&gt;=threhold]=<span class=\"number\">255</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> dst</span><br><span class=\"line\">dst2=human(src,<span class=\"number\">150</span>)</span><br></pre></td></tr></table></figure>\n<p>åˆ†å‰²åå›¾åƒ<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-7.png?raw=true\"></p>\n<h2 id=\"è¿­ä»£æ³•\"><a href=\"#è¿­ä»£æ³•\" class=\"headerlink\" title=\"è¿­ä»£æ³•\"></a>è¿­ä»£æ³•</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">iteration</span>(<span class=\"params\">gray_img</span>):</span><br><span class=\"line\">    dst=gray_img.copy()</span><br><span class=\"line\">    threhold=<span class=\"number\">128</span></span><br><span class=\"line\">    threhold1=<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span>(<span class=\"number\">1</span>):</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"built_in\">abs</span>(threhold-threhold1)&lt;=<span class=\"number\">1</span>):<span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>: threhold=threhold1</span><br><span class=\"line\">        n0=dst[np.where(dst&lt;threhold)]</span><br><span class=\"line\">        n1=dst[np.where(dst&gt;=threhold)]</span><br><span class=\"line\">        miu0=n0.mean() <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(n0)&gt;<span class=\"number\">0</span> <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">        miu1=n1.mean() <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(n1)&gt;<span class=\"number\">0</span> <span class=\"keyword\">else</span> <span class=\"number\">0</span></span><br><span class=\"line\">        threhold1=(miu0+miu1)/<span class=\"number\">2</span></span><br><span class=\"line\">    dst[dst&lt;threhold]=<span class=\"number\">0</span></span><br><span class=\"line\">    dst[dst&gt;=threhold]=<span class=\"number\">255</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> dst</span><br></pre></td></tr></table></figure>\n<p>åˆ†å‰²ç»“æœ<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-8.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"OSTUç®—æ³•\"><a href=\"#OSTUç®—æ³•\" class=\"headerlink\" title=\"OSTUç®—æ³•\"></a>OSTUç®—æ³•</h2><h3 id=\"ç†è®ºåŸç†-1\"><a href=\"#ç†è®ºåŸç†-1\" class=\"headerlink\" title=\"ç†è®ºåŸç†\"></a>ç†è®ºåŸç†</h3><p>å¤§æ´¥ç®—æ³•ï¼ˆOTSUç®—æ³•ï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„å›¾åƒäºŒå€¼åŒ–æ–¹æ³•ï¼Œç”¨äºå°†ç°åº¦å›¾åƒè½¬åŒ–ä¸ºäºŒå€¼å›¾åƒã€‚è¯¥ç®—æ³•ç”±æ—¥æœ¬å­¦è€…å¤§æ´¥å±•ä¹‹äº1979å¹´æå‡ºï¼Œå› æ­¤å¾—åã€‚</p>\n<p>å¤§æ´¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å¯»æ‰¾ä¸€ä¸ªé˜ˆå€¼ï¼Œå°†å›¾åƒçš„åƒç´ åˆ†ä¸ºä¸¤ä¸ªç±»åˆ«ï¼šå‰æ™¯å’ŒèƒŒæ™¯ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p>\n<ol>\n<li>ç»Ÿè®¡å›¾åƒçš„ç°åº¦ç›´æ–¹å›¾ï¼Œå¾—åˆ°æ¯ä¸ªç°åº¦çº§çš„åƒç´ æ•°ç›®ã€‚</li>\n<li>éå†æ‰€æœ‰å¯èƒ½çš„é˜ˆå€¼ï¼ˆ0åˆ°255ï¼‰ï¼Œè®¡ç®—æ ¹æ®è¯¥é˜ˆå€¼å°†å›¾åƒåˆ†ä¸ºå‰æ™¯å’ŒèƒŒæ™¯çš„ç±»å†…æ–¹å·®ã€‚</li>\n<li>æ ¹æ®ç±»å†…æ–¹å·®çš„æœ€å°å€¼ç¡®å®šæœ€ä½³é˜ˆå€¼ã€‚<br>åœ¨å¤§æ´¥ç®—æ³•ä¸­ï¼Œç±»å†…æ–¹å·®æ˜¯è¡¡é‡å‰æ™¯å’ŒèƒŒæ™¯ä¹‹é—´å·®å¼‚çš„åº¦é‡ã€‚é€šè¿‡é€‰æ‹©ä½¿ç±»å†…æ–¹å·®æœ€å°çš„é˜ˆå€¼ï¼Œå¯ä»¥å®ç°æœ€ä½³çš„å›¾åƒåˆ†å‰²æ•ˆæœã€‚</li>\n</ol>\n<p>å¤§æ´¥ç®—æ³•çš„ä¼˜ç‚¹æ˜¯ç®€å•æ˜“æ‡‚ï¼Œè®¡ç®—æ•ˆç‡é«˜ã€‚å®ƒé€‚ç”¨äºç°åº¦å›¾åƒçš„äºŒå€¼åŒ–å¤„ç†ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå…·æœ‰åŒå³°ç›´æ–¹å›¾çš„å›¾åƒæ•ˆæœæ›´å¥½ã€‚ç„¶è€Œï¼Œè¯¥ç®—æ³•å¯¹äºå…·æœ‰éåŒå³°ç›´æ–¹å›¾çš„å›¾åƒå¯èƒ½äº§ç”Ÿè¾ƒå·®çš„åˆ†å‰²ç»“æœã€‚å› æ­¤ï¼Œåœ¨åº”ç”¨å¤§æ´¥ç®—æ³•ä¹‹å‰ï¼Œéœ€è¦å¯¹å›¾åƒçš„ç›´æ–¹å›¾è¿›è¡Œåˆ†æï¼Œç¡®ä¿é€‚ç”¨æ€§ã€‚</p>\n<p>å¤§æ´¥ç®—æ³•åœ¨å›¾åƒå¤„ç†ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œä¾‹å¦‚åœ¨æ–‡æ¡£å›¾åƒå¤„ç†ã€ç›®æ ‡æ£€æµ‹ã€å›¾åƒåˆ†å‰²ç­‰é¢†åŸŸã€‚</p>\n<p>ä¸‹é¢æ¨å¯¼ç±»é—´æ–¹å·®å‡½æ•°ï¼š<br>è®¾é˜ˆå€¼ä¸ºç°åº¦ $\\mathrm{k}(k \\in[0, L-1], L&#x3D;256)$ ã€‚è¿™ä¸ªé˜ˆå€¼æŠŠå›¾åƒåƒç´ åˆ†å‰²æˆä¸¤ç±»ï¼ŒC1ç±»åƒç´ å°äºç­‰äº $\\mathrm{k} ï¼Œ \\mathrm{C} 2$ ç±»åƒç´ å¤§äº $\\mathrm{k}$ ã€‚è®¾è¿™ä¸¤ç±»åƒç´ å„è‡ªçš„å‡å€¼ä¸º $m_1, m_2$ ï¼Œå›¾åƒå…¨å±€å‡å€¼ä¸º $m_G$ ã€‚åŒæ—¶åƒç´ è¢«åˆ†ä¸º $\\mathrm{C} 1$ å’Œ $\\mathrm{C} 2$ ç±»çš„æ¦‚ç‡åˆ†åˆ«ä¸º $p_1, p_2$ ã€‚åˆ™æœ‰:<br>$$<br>\\begin{gathered}<br>p_1 m_1+p_2 m_2&#x3D;m_G \\\\<br>p_1+p_2&#x3D;1<br>\\end{gathered}<br>$$</p>\n<p>æ ¹æ®æ–¹å·®çš„æ¦‚å¿µï¼Œç±»é—´æ–¹å·®è¡¨è¾¾å¼ä¸º:<br>$$<br>\\sigma^2&#x3D;p_1\\left(m_1-m_G\\right)^2+p_2\\left(m_2-m_G\\right)^2<br>$$</p>\n<p>å±•å¼€:<br>$$<br>\\sigma^2&#x3D;p_1 m_1^2+p_1 m_G^2-2 p_1 m_1 m_G+p_2 m_2^2+p_2 m_G^2-2 p_2 m_2 m_G<br>$$</p>\n<p>åˆå¹¶2ï¼Œ5åŠ3ï¼Œ6é¡¹å¯å¾—:<br>$$<br>\\sigma^2&#x3D;p_1 m_1^2+p_2 m_2^2+m_G^2-2 m_G^2&#x3D;p_1 m_1^2+p_2 m_2^2-m_G^2<br>$$</p>\n<p>æˆ‘ä»¬å†æŠŠ $m_G&#x3D;p_1 m_1+p_2 m_2$å¸¦å›å¾—<br>$$<br>\\sigma^2&#x3D;\\left(p_1-p_1^2\\right) m_1^2+\\left(p_2-p_2^2\\right) m_2^2-2 p_1 p_2 m_1 m_2<br>$$</p>\n<p>å†æ³¨æ„åˆ° $p_1+p_2&#x3D;1$ ï¼Œæ‰€ä»¥ $p_1-p_1^2&#x3D;p_1\\left(1-p_1\\right)&#x3D;p_1 p_2 ï¼Œ p_2-p_2^2&#x3D;p_2\\left(1-p_2\\right)&#x3D;p_1 p_2$ ï¼Œä»è€Œå¾—åˆ°:<br>$$<br>\\sigma^2&#x3D;p_1 p_2\\left(m_1-m_2\\right)^2<br>$$</p>\n<p>å¯¹äºç»™å®šçš„é˜ˆå€¼ $k$ ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿè®¡å‡ºç°åº¦çº§çš„åˆ†å¸ƒåˆ—:</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">ç°åº¦å€¼</th>\n<th align=\"left\">0</th>\n<th align=\"left\">1</th>\n<th align=\"left\">$\\ldots$</th>\n<th align=\"left\">255</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">$p_i$</td>\n<td align=\"left\">$p_0$</td>\n<td align=\"left\">$p_1$</td>\n<td align=\"left\">$\\ldots$</td>\n<td align=\"left\">$p_{255}$</td>\n</tr>\n</tbody></table>\n<p>æ˜¾ç„¶æ ¹æ®åˆ†å¸ƒåˆ—æ€§è´¨æœ‰ $\\sum_{i&#x3D;0}^{L-1} p_i&#x3D;1$ (è¯·æ³¨æ„è¿™é‡Œçš„ $p_1, p_2$ æ˜¯åˆ†å¸ƒåˆ—ä¸­çš„ï¼Œä¸æ˜¯ä¸Šé¢çš„å®šä¹‰)é‚£ä¹ˆæœ‰:<br>$$<br>p_1&#x3D;\\sum_{i&#x3D;0}^{k-1} p_i, p_2&#x3D;\\sum_{i&#x3D;k}^{L-1} p_i, m_1&#x3D;\\sum_{i&#x3D;0}^{k-1} i p_i, m_2&#x3D;\\sum_{i&#x3D;k}^{L-1} i p_i<br>$$</p>\n<p>å°† $\\mathrm{k}$ ä» $[0, L-1]$ éå†ï¼Œæ‰¾å‡ºä½¿å¾— $\\sigma^2$ æœ€å¤§çš„ $\\mathrm{k}$ å€¼ï¼Œè¿™ä¸ª $\\mathrm{k}$ å€¼å°±æ˜¯é˜ˆå€¼ã€‚<br>å¯¹äºåˆ†å‰²ï¼Œè¿™ä¸ªåˆ†å‰²å°±æ˜¯äºŒå€¼åŒ–</p>\n<h3 id=\"å…·ä½“å†…å®¹-1\"><a href=\"#å…·ä½“å†…å®¹-1\" class=\"headerlink\" title=\"å…·ä½“å†…å®¹\"></a>å…·ä½“å†…å®¹</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">ostu</span>(<span class=\"params\">gray_img</span>):</span><br><span class=\"line\">    dst=gray_img.copy()</span><br><span class=\"line\">    h=dst.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">    w=dst.shape[<span class=\"number\">1</span>]</span><br><span class=\"line\">    threhold_t=<span class=\"number\">0</span></span><br><span class=\"line\">    max_g=<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> t <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">255</span>):</span><br><span class=\"line\">        n0=dst[np.where(dst&lt;t)]</span><br><span class=\"line\">        n1=dst[np.where(dst&gt;=t)]</span><br><span class=\"line\">        w0=<span class=\"built_in\">len</span>(n0)/(h*w)</span><br><span class=\"line\">        w1=<span class=\"built_in\">len</span>(n1)/(h*w)</span><br><span class=\"line\">        u0=np.mean(n0) <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(n0)&gt;<span class=\"number\">0</span> <span class=\"keyword\">else</span> <span class=\"number\">0.</span></span><br><span class=\"line\">        u1=np.mean(n1) <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(n1)&gt;<span class=\"number\">0</span> <span class=\"keyword\">else</span> <span class=\"number\">0.</span></span><br><span class=\"line\">        g=w0*w1*(u0-u1)**<span class=\"number\">2</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> g&gt;max_g:</span><br><span class=\"line\">            max_g=g</span><br><span class=\"line\">            threhold_t=t</span><br><span class=\"line\">    dst[dst&lt;threhold_t]=<span class=\"number\">0</span></span><br><span class=\"line\">    dst[dst&gt;=threhold_t]=<span class=\"number\">255</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> dst</span><br></pre></td></tr></table></figure>\n<p>åˆ†å‰²å›¾åƒ<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/cv-9.png?raw=true\" alt=\"alt text\"></p>\n","categories":["Computer Vision"]},{"title":"åŸºäºMATLABçš„å·ç§¯æ¼”ç¤ºç³»ç»Ÿ","url":"/2023/08/28/dsplab1/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„å’Œè¦æ±‚\"><a href=\"#å®éªŒç›®çš„å’Œè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒç›®çš„å’Œè¦æ±‚\"></a>å®éªŒç›®çš„å’Œè¦æ±‚</h1><h2 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h2><p>å·ç§¯ä½œä¸ºä¸€ç§åŸºæœ¬çš„ä¿¡å·å¤„ç†æ–¹æ³•ï¼Œæ‹¥æœ‰è®¸ å¤šä¸åŒçš„å˜ä½“å’Œåº”ç”¨ã€‚é€šè¿‡é€‰æ‹©åˆé€‚çš„å·ç§¯ç®— æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°å¤„ç†å„ç§ç±»å‹çš„ä¿¡å·æ•°æ®ï¼Œ ä»è€Œä¸ºæˆ‘ä»¬è§£å†³å®é™…é—®é¢˜æä¾›æ›´å¥½çš„æ”¯æŒã€‚ é€šè¿‡æœ¬æ¬¡è¯¾ç¨‹è®¾è®¡ï¼Œä½¿å¾—å­¦ç”Ÿèƒ½å¤Ÿå……åˆ†äº† è§£å·ç§¯çš„ç›¸å…³å®šä¹‰ã€è®¡ç®—å’Œå®šç†ï¼›ä½¿å¾—å­¦ç”Ÿèƒ½ å¤Ÿä½¿ç”¨GUI&#x2F;app designè¿›è¡Œå›¾å½¢åŒ–ç•Œé¢è®¾è®¡ã€‚</p>\n<h2 id=\"å®éªŒè¦æ±‚\"><a href=\"#å®éªŒè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒè¦æ±‚\"></a>å®éªŒè¦æ±‚</h2><ul>\n<li>ç”¨matlabå®Œæˆçº¿æ€§å·ç§¯çš„è®¡ç®—è¿‡ç¨‹ï¼Œå¹¶ç»˜å›¾;ä½¿ç”¨GUI&#x2F;app designè®¾è®¡ä¸€ä¸ªçº¿æ€§å·ç§¯çš„åŸºæœ¬æ¼” ç¤ºç³»ç»Ÿï¼›è¦æ±‚ä¸¤ä¸ªå·ç§¯ä¿¡å·çš„å‚æ•°å¯ä»¥è‡ªç”±ç»™å®šï¼›è®¾è®¡æ¡†å›¾ä¸­ç›´æ¥åŒ…å«â€œè®¡ç®—æŒ‰é’®â€ ï¼Œç›´æ¥è®¡ç®—å·ç§¯ç»“æœ</li>\n<li>åˆ†æå·ç§¯è®¡ç®—ç»“æœ<span id=\"more\"></span></li>\n</ul>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"çº¿æ€§å·ç§¯\"><a href=\"#çº¿æ€§å·ç§¯\" class=\"headerlink\" title=\"çº¿æ€§å·ç§¯\"></a>çº¿æ€§å·ç§¯</h2><p>è®¾ä¸¤åºåˆ— $x(n), h(n)$,å…¶çº¿æ€§å·ç§¯å®šä¹‰ä¸º<br>$$<br>y(n)&#x3D;\\sum_{m&#x3D;-\\infty}^{\\infty} x(m) * h(n-m)<br>$$<br>(1)ç¿»è¤¶: $\\quad h(m) \\rightarrow h(-m)$</p>\n<p>(2) ç§»ä½: $h(-m) \\rightarrow h(n-m)$</p>\n<p>(3) ç›¸ä¹˜: $x(m) h(n-m)$</p>\n<p>(4) ç›¸åŠ : $\\sum_{m&#x3D;-\\infty}^{\\infty} x(m) h(n-m)$</p>\n<h2 id=\"åœ†å‘¨å·ç§¯\"><a href=\"#åœ†å‘¨å·ç§¯\" class=\"headerlink\" title=\"åœ†å‘¨å·ç§¯\"></a>åœ†å‘¨å·ç§¯</h2><p>è®¾ $x(n), h(n)$ ä¸º $N$ ç‚¹æœ‰é™é•¿åºåˆ—, å…¶åœ†å‘¨å·ç§¯å®šä¹‰ä¸º<br>$$<br>y(n)&#x3D;\\sum_{m&#x3D;0}^{N-1} x_1(m) x_2((n-m))_N R_N(n)\\space\\space\\space\\space\\space\\space\\space\\space\\space N ç‚¹åœ†å‘¨å·ç§¯<br>$$<br>åœ†å‘¨å·ç§¯æ—¶åŸŸè¿‡ç¨‹:</p>\n<ol>\n<li>è¡¥é›¶: $x_1(n), x_2(n)$ è¡¥é›¶è‡³ $N$ ç‚¹é•¿</li>\n<li>å‘¨æœŸå»¶æ‹“: $x_2(m)$ å‘¨æœŸå»¶æ‹“ä¸º $x_2((m))_N$</li>\n<li>ç¿»è¤¶, å–ä¸»å€¼åºåˆ—: $x_2((-m))_N R_N(m)$</li>\n<li>åœ†å‘¨ç§»ä½: $x_2((n-m))_N R_N(m)$</li>\n<li>ç›¸ä¹˜ç›¸åŠ : $x_1(m) x_2((n-m))_N R_N(m)$</li>\n</ol>\n<p>åœ†å‘¨å·ç§¯é¢‘åŸŸè¿‡ç¨‹<br>$$<br>\\begin{gathered}<br>D F T\\left[x_1(n)\\right]&#x3D;X_1(k) \\quad \\operatorname{DFT}\\left[x_2(n)\\right]&#x3D;X_2(k) \\\\<br>\\text { è‹¥ } Y(k)&#x3D;X_1(k) \\cdot X_2(k) \\\\<br>y(n)&#x3D;I D F T[Y(k)]&#x3D;\\left[\\sum_{m&#x3D;0}^{N-1} x_1(m) x_2((n-m))_N\\right] R_N(n)<br>\\end{gathered}<br>$$</p>\n<h2 id=\"äºŒè€…å…³ç³»\"><a href=\"#äºŒè€…å…³ç³»\" class=\"headerlink\" title=\"äºŒè€…å…³ç³»\"></a>äºŒè€…å…³ç³»</h2><p>$$<br>x_1(n) â“ƒ  x_2(n)&#x3D;x_1(n) * x_2(n)\\left\\{\\begin{array}{c}<br>N \\geq N_1+N_2-1 \\\\<br>0 \\leq n \\leq N_1+N_2-2<br>\\end{array}\\right.<br>$$</p>\n<h1 id=\"å®éªŒæ–¹æ³•ä¸å†…å®¹\"><a href=\"#å®éªŒæ–¹æ³•ä¸å†…å®¹\" class=\"headerlink\" title=\"å®éªŒæ–¹æ³•ä¸å†…å®¹\"></a>å®éªŒæ–¹æ³•ä¸å†…å®¹</h1><h2 id=\"å®éªŒæ€è·¯\"><a href=\"#å®éªŒæ€è·¯\" class=\"headerlink\" title=\"å®éªŒæ€è·¯\"></a>å®éªŒæ€è·¯</h2><p>ç”¨matlabè®¾è®¡å·ç§¯æ¼”ç¤ºç•Œé¢ï¼Œç„¶åè®¾è®¡ä¸¤ä¸ªæœ‰é™é•¿åºåˆ—ï¼Œå½“æ¼”ç¤ºæ—¶è¿›è¡Œè¾“å…¥ã€‚è¦æ±‚èƒ½å¤Ÿä½“ç°ç¿»è¤¶ï¼Œç§»ä½ï¼Œç›¸åŠ ï¼Œç›¸ä¹˜ã€‚</p>\n<h2 id=\"éœ€æ±‚åˆ†æ\"><a href=\"#éœ€æ±‚åˆ†æ\" class=\"headerlink\" title=\"éœ€æ±‚åˆ†æ\"></a>éœ€æ±‚åˆ†æ</h2><h3 id=\"çº¿æ€§å·ç§¯éœ€æ±‚åˆ†æ\"><a href=\"#çº¿æ€§å·ç§¯éœ€æ±‚åˆ†æ\" class=\"headerlink\" title=\"çº¿æ€§å·ç§¯éœ€æ±‚åˆ†æ\"></a>çº¿æ€§å·ç§¯éœ€æ±‚åˆ†æ</h3><p>(1) çº¿æ€§å·ç§¯çš„ç¿»è¤¶: $h(m) \\rightarrow h(-m)$, å¯é€šè¿‡ä»¥ $\\mathrm{y}$ è½´ä¸ºå¯¹ç§°ç¿»è½¬ã€‚</p>\n<p>(2) çº¿æ€§å·ç§¯çš„ç§»ä½: å°† $h(-m)$ ç§»ä½ $n$, å¾— $h(n-m)$ ã€‚å½“ $n$ ä¸ºæ­£, å³ç§», $n$ ä¸ºè´Ÿ, å·¦ç§»ã€‚</p>\n<p>(3) çº¿æ€§å·ç§¯çš„ç›¸ä¹˜ï¼šå°†å¯¹åº”ç‚¹ç›¸ä¹˜ã€‚</p>\n<p>(4) çº¿æ€§å·ç§¯çš„ç›¸åŠ ï¼šå°†å¯¹åº”ç‚¹ç›¸åŠ ã€‚</p>\n<h3 id=\"åœ†å‘¨å·ç§¯éœ€æ±‚åˆ†æ\"><a href=\"#åœ†å‘¨å·ç§¯éœ€æ±‚åˆ†æ\" class=\"headerlink\" title=\"åœ†å‘¨å·ç§¯éœ€æ±‚åˆ†æ\"></a>åœ†å‘¨å·ç§¯éœ€æ±‚åˆ†æ</h3><p>åœ†å‘¨å·ç§¯å¯é€šè¿‡ä¸‰ä¸ªæ­¥éª¤å®Œæˆ</p>\n<p>(1) åˆå§‹åŒ–ï¼šç¡®å®š $\\mathrm{N}$ ï¼Œè‹¥åºåˆ—é•¿åº¦å°äº $\\mathrm{N}$ åˆ™è¡¥ 0</p>\n<p>(2) å³ç§»: å°†åºåˆ— $\\times(n)$ å¾ªç¯å³ç§», ç§»åŠ¨ $N$ æ¬¡, å¾—åˆ°çŸ©é˜µ</p>\n<p>(3) ç›¸ä¹˜ï¼šå°†å¾—åˆ°çš„çŸ©é˜µå’Œç¬¬äºŒä¸ªåºåˆ—ç›¸ä¹˜, å¾—åˆ°ç»“æœ</p>\n<p>ç„¶åè¿›è¡Œæ—¶åŸŸæ¼”ç¤ºå’Œé¢‘åŸŸæ¼”ç¤º</p>\n<h1 id=\"å®éªŒç»“æœåŠåˆ†æ\"><a href=\"#å®éªŒç»“æœåŠåˆ†æ\" class=\"headerlink\" title=\"å®éªŒç»“æœåŠåˆ†æ\"></a>å®éªŒç»“æœåŠåˆ†æ</h1><h2 id=\"çº¿æ€§å·ç§¯æ¼”ç¤º\"><a href=\"#çº¿æ€§å·ç§¯æ¼”ç¤º\" class=\"headerlink\" title=\"çº¿æ€§å·ç§¯æ¼”ç¤º\"></a>çº¿æ€§å·ç§¯æ¼”ç¤º</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp.gif?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"åœ†å‘¨å·ç§¯æ—¶åŸŸæ¼”ç¤º\"><a href=\"#åœ†å‘¨å·ç§¯æ—¶åŸŸæ¼”ç¤º\" class=\"headerlink\" title=\"åœ†å‘¨å·ç§¯æ—¶åŸŸæ¼”ç¤º\"></a>åœ†å‘¨å·ç§¯æ—¶åŸŸæ¼”ç¤º</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-1.gif?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"åœ†å‘¨å·ç§¯é¢‘åŸŸæ¼”ç¤º\"><a href=\"#åœ†å‘¨å·ç§¯é¢‘åŸŸæ¼”ç¤º\" class=\"headerlink\" title=\"åœ†å‘¨å·ç§¯é¢‘åŸŸæ¼”ç¤º\"></a>åœ†å‘¨å·ç§¯é¢‘åŸŸæ¼”ç¤º</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-2.png?raw=true\"></p>\n<h2 id=\"ä¸¤è€…å…³ç³»éªŒè¯\"><a href=\"#ä¸¤è€…å…³ç³»éªŒè¯\" class=\"headerlink\" title=\"ä¸¤è€…å…³ç³»éªŒè¯\"></a>ä¸¤è€…å…³ç³»éªŒè¯</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-1.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-3.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-4.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-5.png?raw=true\" alt=\"alt text\"><br>å½“ $\\mathrm{L}&#x3D;\\mathrm{N} 1+\\mathrm{N} 2$ æ—¶, çº¿æ€§å·ç§¯å’Œåœ†å‘¨å·ç§¯ç»“æœç›¸ç­‰ã€‚</p>\n","categories":["Digital Signal Processing"]},{"title":"åŸºäºMATLABçš„è¯­éŸ³ä¿¡å·å»å™ª","url":"/2023/11/15/dsplab2/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„å’Œè¦æ±‚\"><a href=\"#å®éªŒç›®çš„å’Œè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒç›®çš„å’Œè¦æ±‚\"></a>å®éªŒç›®çš„å’Œè¦æ±‚</h1><p>ç»¼åˆåº”ç”¨æ•°å­—ä¿¡å·å¤„ç†çš„ç†è®ºçŸ¥è¯†è¿›è¡Œä¿¡å·çš„é¢‘è°±åˆ†æå’Œæ»¤æ³¢å™¨è®¾è®¡ï¼Œé€šè¿‡ç†è®ºæ¨å¯¼å¾—åˆ°å“åº”ç»“è®ºï¼Œåˆ©ç”¨MATLABè¿›è¡Œè®¡ç®—æœºä»¿çœŸï¼ŒåŠ æ·±å¯¹æ‰€å­¦çŸ¥è¯†çš„ç†è®ºç•Œï¼Œèä¼šè´¯é€šæ‰€å­¦çŸ¥è¯†ã€‚</p>\n<p>é€šè¿‡æœ¬æ¬¡è¯¾ç¨‹è®¾è®¡ï¼ŒæŒæ¡ç”¨MATLABå¯¹è¯­éŸ³ä¿¡å·è¿›è¡Œåˆ†æå’Œå¤„ç†çš„èƒ½åŠ›ï¼Œå¹¶è¿›ä¸€æ­¥æŒæ¡MATLAB è®¾è®¡æ•°å­—æ»¤æ³¢å™¨çš„æ–¹æ³•ã€‚</p>\n<span id=\"more\"></span>\n<p>åŸºç¡€è®¾è®¡è¦æ±‚ï¼š</p>\n<p>(1)å½•åˆ¶æˆ–é‡‡é›†ä¸€æ®µè¯­éŸ³ä¿¡å·ï¼Œç”»å‡ºåŸå§‹è¯­éŸ³ä¿¡å·çš„æ—¶åŸŸæ³¢å½¢åŠé¢‘è°±ã€‚</p>\n<p>(2)åº”ç”¨Matlabå¹³å°ç»™è¯­éŸ³ä¿¡å·å åŠ é«˜æ–¯ç™½å™ªå£°ï¼›ç”»å‡ºåŠ å™ªä¿¡å·çš„æ—¶åŸŸæ³¢å½¢åŠé¢‘è°±ã€‚</p>\n<p>(3)ç¡®å®šè®¾è®¡æ€§èƒ½æŒ‡æ ‡ï¼Œè®¾è®¡IIRæ•°å­—æ»¤æ³¢å™¨è¿›è¡Œæ»¤æ³¢ï¼Œç”»å‡ºæ»¤æ³¢å™¨çš„é¢‘è°±ã€‚<br>(4)ä½¿ç”¨è®¾è®¡å¥½çš„æ»¤æ³¢å™¨å¯¹åŠ å™ªä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œå¾—åˆ°å»å™ªä¿¡å·ã€‚ç”»å‡ºå»å™ªä¿¡å·çš„æ—¶åŸŸåŠé¢‘è°±å›¾ã€‚å›æ”¾æ»¤æ³¢å‰åè¯­éŸ³ï¼Œå¯¹æ¯”æ»¤æ³¢æ•ˆæœã€‚</p>\n<p>æé«˜è®¾è®¡è¦æ±‚ï¼š</p>\n<p>(1)åœ¨åŸå§‹è¯­éŸ³ä¸Šå åŠ é«˜é¢‘å™ªéŸ³æˆ–ä½é¢‘å™ªéŸ³ï¼Œå®Œæˆæ»¤æ³¢å™¨è®¾è®¡è¿‡ç¨‹ã€‚</p>\n<p>(2)è®¾è®¡ä¸¤ç§åŠä»¥ä¸Šæ»¤æ³¢å™¨å¯¹è¯­éŸ³ä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œç»™å‡ºä¸åŒæ»¤æ³¢å™¨æ»¤æ³¢å‰åçš„ä¿¡å™ªæ¯”ï¼ˆSNRï¼‰ï¼Œåˆ†æå¾—å‡ºæ»¤æ³¢æ•ˆæœæœ€å¥½çš„æ»¤æ³¢å™¨ã€‚</p>\n<p>(3)ä½¿ç”¨GUI&#x2F;app designè®¾è®¡è¯­éŸ³å»å™ªç³»ç»Ÿç•Œé¢ã€‚</p>\n<p>(4)æŸ¥é˜…è¯¾æœ¬æˆ–æ–‡çŒ®ä½¿ç”¨å…¶ä»–æ»¤æ³¢ç®—æ³•å®Œæˆæ»¤æ³¢ã€‚(è°±å‡æ³•ã€å¡å°”æ›¼æ»¤æ³¢ç­‰)</p>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"è¯­è¨€å»å™ªæ­¥éª¤\"><a href=\"#è¯­è¨€å»å™ªæ­¥éª¤\" class=\"headerlink\" title=\"è¯­è¨€å»å™ªæ­¥éª¤\"></a>è¯­è¨€å»å™ªæ­¥éª¤</h2><p>åŸºäºMATLABçš„è¯­éŸ³ä¿¡å·å»å™ªè®¾è®¡ä¸»è¦åˆ†ä¸ºä»¥ä¸‹äº”ä¸ªæ­¥éª¤ï¼š</p>\n<p>ï¼ˆ1ï¼‰è¯­éŸ³é‡‡é›†ï¼šå¯åœ¨MATLABå¹³å°ä¸Šå½•å…¥ä¸€æ®µè¯­éŸ³ä¿¡å·ï¼Œä¹Ÿå¯ç›´æ¥å¯¼å…¥æ”¶é›†å¥½çš„è¯­éŸ³ä¿¡å·ï¼›</p>\n<p>ï¼ˆ2ï¼‰è¯­éŸ³åˆ†æï¼šç»˜åˆ¶åŸå§‹è¯­éŸ³ä¿¡å·æ—¶åŸŸåŠé¢‘è°±å›¾ï¼Œåˆ†æåŸå§‹è¯­éŸ³ä¿¡å·é¢‘è°±ç‰¹å¾ï¼›</p>\n<p>ï¼ˆ3ï¼‰è¯­éŸ³åŠ å™ªï¼šå¯¹åŸå§‹è¯­éŸ³ä¿¡å·å åŠ å™ªå£°ï¼Œå¹¶ç»˜åˆ¶åŠ å™ªä¿¡å·æ—¶åŸŸåŠé¢‘è°±å›¾ã€‚å¸¸è§å™ªå£°åŒ…æ‹¬é«˜æ–¯ç™½å™ªå£°ã€é«˜é¢‘å™ªå£°ã€ä½é¢‘å™ªå£°ç­‰ï¼›</p>\n<p>ï¼ˆ4ï¼‰æ»¤æ³¢å™¨è®¾è®¡ï¼šç»“åˆåŸå§‹è¯­éŸ³ä¿¡å·é¢‘è°±ï¼Œé’ˆå¯¹ä¸åŒçš„å åŠ å™ªå£°ï¼Œç¡®å®šæ»¤æ³¢å™¨è®¾è®¡æ€§èƒ½æŒ‡æ ‡ï¼Œè®¾è®¡ç›¸åº”æ»¤æ³¢å™¨ï¼Œå¹¶ç»˜åˆ¶æ»¤æ³¢å™¨çš„é¢‘è°±å›¾ï¼Œåˆ¤æ–­æ˜¯å¦ç¬¦åˆè®¾è®¡è¦æ±‚ï¼›</p>\n<p>ï¼ˆ5ï¼‰å»å™ªä¿¡å·åˆ†æï¼šåˆ©ç”¨è®¾è®¡çš„æ»¤æ³¢å™¨å¯¹åŠ å™ªä¿¡å·è¿›è¡Œæ»¤æ³¢ï¼Œç»˜åˆ¶å»å™ªä¿¡å·æ—¶åŸŸåŠé¢‘è°±å›¾ï¼Œå¹¶æ’­æ”¾å»å™ªè¯­éŸ³ä¿¡å·ï¼Œä¸åŸå§‹è¯­éŸ³ä¿¡å·è¿›è¡Œå¯¹æ¯”åˆ†æã€‚</p>\n<h2 id=\"è°±å‡æ³•çš„ç†è®ºåŸºç¡€\"><a href=\"#è°±å‡æ³•çš„ç†è®ºåŸºç¡€\" class=\"headerlink\" title=\"è°±å‡æ³•çš„ç†è®ºåŸºç¡€\"></a>è°±å‡æ³•çš„ç†è®ºåŸºç¡€</h2><p>å‡è®¾å¸¦å™ªè¯­éŸ³ä¸­çš„å™ªå£°æ˜¯åŠ æ€§çš„ï¼Œå¸¦å™ªè¯­éŸ³è°±å‡å»ä¼°è®¡å‡ºçš„å™ªå£°è°±ä¾¿å¯ä»¥å¾—åˆ°å¹²å‡€è¯­éŸ³è°±ã€‚<br>æ ¹æ®åŠ æ€§å‡è®¾ï¼Œå¹²å‡€è¯­éŸ³ã€å™ªå£°å’Œå¸¦å™ªè¯­éŸ³çš„å…³ç³»å¯ä»¥å†™æˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br>$$<br>y(n)&#x3D;x(n)+d(n)<br>$$</p>\n<p>å…¶ä¸­, $y(n)$ ä¸ºé‡‡é›†åˆ°çš„å¸¦å™ªè¯­éŸ³, $x(n)$ ä¸ºå¹²å‡€è¯­éŸ³, $d(n)$ ä¸ºå™ªå£°ã€‚ä¼ æ¢è‡³é¢‘åŸŸ:<br>$$<br>\\begin{aligned}<br>&amp; Y(\\omega)&#x3D;X(\\omega)+D(\\omega) \\<br>&amp; Y(\\omega)&#x3D;|Y(\\omega)| e^{j \\Phi_y(\\omega)}<br>\\end{aligned}<br>$$</p>\n<p>å…¶ä¸­ $|Y(\\omega)|$ ä¸ºå¹…åº¦è°± $e^{j \\Phi_y(\\omega)}$ ä¸ºä¿¡å·ç›¸ä½<br>åˆ™å¹²å‡€è¯­éŸ³å¯ä»¥é€šè¿‡å¸¦å™ªè¯­éŸ³å‡å»å™ªå£°è°±å¾—åˆ°:<br>$$<br>\\hat{X}(\\omega)&#x3D;[|Y(\\omega)|-\\hat{D}(\\omega)] e^{j \\Phi_y(\\omega)}<br>$$</p>\n<p>ä½†åœ¨å®è·µä¸­, $\\hat{X}(\\omega)$ å¾ˆæœ‰å¯èƒ½æ˜¯è´Ÿæ•°, æ‰€ä»¥å¸¸ä¼šåšä¸€ä¸ªåŠæ³¢æ•´æµ:</p>\n<p>ç”±äºå¯¹è´Ÿå€¼è¿›è¡ŒåŠæ³¢æ•´æµ, å¯¼è‡´å¸§é¢‘è°±çš„éšæœºé¢‘ç‡ä¸Šå‡ºç°å°çš„ã€ç‹¬ç«‹çš„å³°å€¼, å˜æ¢åˆ°æ—¶åŸŸä¸Šé¢, è¿™äº›å³°å€¼å¬èµ·æ¥å°±åƒå¸§ä¸å¸§ä¹‹é—´é¢‘ç‡éšæœºå˜åŒ–çš„å¤šé¢¤éŸ³, ä¹Ÿå°±æ˜¯é€šå¸¸æ‰€è¯´çš„ â€œéŸ³ä¹å™ªå£°â€ (Musical Noise)</p>\n<h1 id=\"å®éªŒæ–¹æ³•ä¸å†…å®¹\"><a href=\"#å®éªŒæ–¹æ³•ä¸å†…å®¹\" class=\"headerlink\" title=\"å®éªŒæ–¹æ³•ä¸å†…å®¹\"></a>å®éªŒæ–¹æ³•ä¸å†…å®¹</h1><h2 id=\"åŸºç¡€è®¾è®¡\"><a href=\"#åŸºç¡€è®¾è®¡\" class=\"headerlink\" title=\"åŸºç¡€è®¾è®¡\"></a>åŸºç¡€è®¾è®¡</h2><p>æˆ‘ä»¬é€‰å–äº†ä¸€æ®µCCTVçš„éŸ³é¢‘ï¼ŒéŸ³é¢‘çš„è¯»å–é€šè¿‡audioreadå‡½æ•°å®ç°<br>ç”±äºæˆ‘ä»¬é€‰å–çš„éŸ³é¢‘ä¸ºåŒé€šé“çš„ï¼Œä¸ºäº†åç»­å¤„ç†æ–¹ä¾¿å°†å…¶æ”¹ä¸ºå•é€šé“</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">y</span>=y(:,<span class=\"number\">1</span>)<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<p>é€šè¿‡plotå‡½æ•°å³å¯å¾—åˆ°å®ƒçš„æ—¶åŸŸå›¾ï¼Œé€šè¿‡fftå³å¯å¾—åˆ°å®ƒçš„é¢‘è°±å›¾ï¼Œé€šè¿‡randnå‡½æ•°æ¥ç”Ÿæˆç™½å™ªå£°</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">x</span>=randn(m,<span class=\"number\">1</span>)<span class=\"comment\">; %mä¸ºCCTVéŸ³é¢‘çš„é•¿åº¦</span></span><br></pre></td></tr></table></figure>\n\n<p>å°†å…¶ä¸åŸä¿¡å·ç›¸åŠ å³å¯å¾—åˆ°å¸¦å™ªä¿¡å·ï¼Œå†å¯¹å¸¦å™ªä¿¡å·ç”¨plotå‡½æ•°å³å¯ç”»å‡ºæ—¶åŸŸå›¾ï¼Œé€šè¿‡fftå¾—åˆ°å®ƒçš„é¢‘è°±å›¾</p>\n<p>é€šè¿‡è§‚å¯Ÿé¢‘è°±å›¾çš„ä¿¡å·å’Œå™ªå£°åˆ†å¸ƒï¼Œé€‰æ‹©åˆé€‚çš„æ€§èƒ½æŒ‡æ ‡ï¼Œé€šè¿‡buttordå‡½æ•°å¾—åˆ°ç›¸åº”çš„Nå’ŒWn</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">N,Wn</span>]=buttord(Wp,Ws,ap,<span class=\"keyword\">as</span>);</span><br></pre></td></tr></table></figure>\n<p>é€šè¿‡butterå‡½æ•°å¾—åˆ°ä¼ é€’å‡½æ•°çš„ç³»æ•°Bå’ŒA</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">[B,A]</span>=butter(N,Wn);</span><br></pre></td></tr></table></figure>\n<p>ç”¨filterå‡½æ•°å¾—åˆ°ç»é™å™ªåçš„éŸ³é¢‘</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">y2</span>=filter(B,A,y1)<span class=\"comment\">;</span></span><br></pre></td></tr></table></figure>\n<p>ç„¶åé€šè¿‡soundå‡½æ•°æ’­æ”¾é™å™ªå‰åçš„éŸ³é¢‘ï¼Œæ¯”å¯¹å¾—åˆ°æ»¤æ³¢æ•ˆæœçš„å¥½åå¹¶è°ƒæ•´æ€§èƒ½æŒ‡æ ‡</p>\n<h2 id=\"æé«˜è®¾è®¡\"><a href=\"#æé«˜è®¾è®¡\" class=\"headerlink\" title=\"æé«˜è®¾è®¡\"></a>æé«˜è®¾è®¡</h2><h3 id=\"éGUIè®¾è®¡\"><a href=\"#éGUIè®¾è®¡\" class=\"headerlink\" title=\"éGUIè®¾è®¡\"></a>éGUIè®¾è®¡</h3><p>é«˜é¢‘æˆ–ä½é¢‘å™ªå£°çš„è·å–å¯é€šè¿‡å¯¹é«˜æ–¯ç™½å™ªå£°é€šè¿‡ä¸€ä¸ªé«˜é€šæˆ–ä½é€šæ»¤æ³¢å™¨å¾—åˆ°ï¼Œç”±äºæˆ‘ä»¬é€‰æ‹©çš„éŸ³é¢‘ä¿¡æ¯éƒ½é›†ä¸­åœ¨ä½é¢‘æ®µï¼Œè‹¥æ·»åŠ ä½é¢‘å™ªå£°åˆ™ç”¨ä¼ ç»Ÿçš„æ»¤æ³¢å™¨å¾ˆéš¾æ¶ˆé™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©åœ¨åŸä¿¡å·ä¸Šæ·»åŠ é«˜é¢‘å™ªå£°</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">[N,<span class=\"built_in\">wc</span>]=buttord(0.8,0.5,3,35);</span><br><span class=\"line\">[B,A]=butter(N,<span class=\"built_in\">wc</span>,<span class=\"string\">&#x27;high&#x27;</span>);</span><br></pre></td></tr></table></figure>\n<p>é«˜æ–¯ç™½å™ªå£°é€šè¿‡è¿™æ ·ä¸€ä¸ªé«˜é€šæ»¤æ³¢å™¨å³å¯å˜ä¸ºé«˜é¢‘ä¿¡å·ï¼Œç”±äºä¿¡å·åœ¨ä½é¢‘ï¼Œå™ªå£°åœ¨é«˜é¢‘ï¼Œæ•…ä½é€šæ»¤æ³¢å™¨èƒ½å¤Ÿå¾ˆå¥½çš„æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œè€Œé€šè¿‡åŸºç¡€è®¾è®¡æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªå·´ç‰¹æ²ƒæ–¯ä½é€šæ»¤æ³¢å™¨ï¼Œåˆ™å¯ä»¥ç›´æ¥æ²¿ç”¨è¯¥æ»¤æ³¢å™¨è¿›è¡Œæ»¤æ³¢</p>\n<p>æˆ‘ä»¬è¿˜å¯ä»¥åˆ†åˆ«è®¾è®¡åˆ‡æ¯”é›ªå¤«â… å‹æ»¤æ³¢å™¨ï¼Œåˆ‡æ¯”é›ªå¤«â…¡å‹æ»¤æ³¢å™¨ï¼Œå’Œæ¤­åœ†æ»¤æ³¢å™¨æ¥å®Œæˆæ»¤æ³¢</p>\n<p>åˆ‡æ¯”é›ªå¤«â… å‹æ»¤æ³¢å™¨å¯é€šè¿‡cheb1ordå‡½æ•°å’Œcheby1å‡½æ•°å¾—åˆ°</p>\n<figure class=\"highlight csharp\"><table><tr><td class=\"code\"><pre><span class=\"line\">[<span class=\"meta\">N,Wn</span>]=cheb1ord(Wp,Ws,ap,<span class=\"keyword\">as</span>);</span><br><span class=\"line\">[<span class=\"meta\">B,A</span>]=cheby1(N,ap,Wn);</span><br><span class=\"line\">åˆ‡æ¯”é›ªå¤«â…¡å‹æ»¤æ³¢å™¨å¯é€šè¿‡cheb2ordå‡½æ•°å’Œcheby2å‡½æ•°å¾—åˆ°</span><br><span class=\"line\">[<span class=\"meta\">N,Wn</span>]=cheb2ord(wp,ws,ap,<span class=\"keyword\">as</span>);</span><br><span class=\"line\">[<span class=\"meta\">B,A</span>]=cheby2(N,Rs,Wn);</span><br></pre></td></tr></table></figure>\n<p>æ¤­åœ†æ»¤æ³¢å™¨å¯é€šè¿‡ellipordå‡½æ•°å’Œellipå‡½æ•°å¾—åˆ°</p>\n<figure class=\"highlight angelscript\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">[N,Wn]</span>=ellipord(wp,ws,Rp,Rs);</span><br><span class=\"line\"><span class=\"string\">[B,A]</span>=ellip(N,Rp,Rs,Wn);</span><br></pre></td></tr></table></figure>\n<p>ä¸ºäº†æ¯”è¾ƒæ»¤æ³¢å™¨çš„æ»¤æ³¢æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—æ»¤æ³¢å‰åçš„ä¿¡å™ªæ¯”ï¼Œè€Œæˆ‘ä»¬å¯ä»¥é€‰å–çš„å¸¦å™ªä¿¡å·ç›¸åŒï¼Œæœ‰ç›¸åŒçš„ä¿¡å™ªæ¯”ï¼Œåªéœ€è®¡ç®—æ»¤æ³¢åçš„ä¿¡å™ªæ¯”å¤§å°å°±èƒ½åˆ†ææ»¤æ³¢å™¨çš„æ€§èƒ½å¥½å</p>\n<p>ä½¿ç”¨æ»¤æ³¢å™¨è¿›è¡Œæ»¤æ³¢åçš„ä¿¡å™ªæ¯”è®¡ç®—æ–¹æ³•ä¸ºï¼š</p>\n<figure class=\"highlight vim\"><table><tr><td class=\"code\"><pre><span class=\"line\">SNR=<span class=\"number\">20</span>*<span class=\"built_in\">log10</span>(<span class=\"keyword\">norm</span>(y_flitered-x_flitered)/<span class=\"keyword\">norm</span>(x_flitered)) %y_fliteredä¸ºæ»¤æ³¢åçš„å¸¦å™ªä¿¡å·,x_fliteredä¸ºæ»¤æ³¢åçš„å™ªå£°,<span class=\"keyword\">norm</span>ä¸º<span class=\"number\">2</span>èŒƒæ•°</span><br></pre></td></tr></table></figure>\n<p>å³æ»¤æ³¢åçš„å¸¦å™ªä¿¡å·å‡å»æ»¤æ³¢åçš„å™ªå£°å³ä¸ºç»æ»¤æ³¢åçš„çº¯å‡€ä¿¡å·</p>\n<h3 id=\"GUIè®¾è®¡\"><a href=\"#GUIè®¾è®¡\" class=\"headerlink\" title=\"GUIè®¾è®¡\"></a>GUIè®¾è®¡</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-6.png?raw=true\" alt=\"alt text\"></p>\n<p>æˆ‘ä»¬åœ¨ç•Œé¢ä¸­æ”¾å…¥ä¸‰ä¸ªåæ ‡è½´ï¼Œåˆ†åˆ«ç”¨äºè§‚å¯ŸåŸä¿¡å·ï¼ŒåŠ å™ªä¿¡å·å»å™ªä¿¡å·çš„æ—¶åŸŸå’Œé¢‘åŸŸå›¾ã€‚</p>\n<p>æ”¾å…¥ä¸¤ä¸ªåˆ—è¡¨æ¡†ï¼Œç”¨äºé€‰æ‹©æ·»åŠ ä¿¡å·çš„ç±»å‹å’Œæ»¤æ³¢å™¨çš„ç±»å‹æˆ–è€…æ»¤æ³¢æ–¹æ³•ã€‚</p>\n<p>ç¬¬ä¸€ä¸ªåˆ—è¡¨æ¡†çš„é€‰é¡¹å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-7.png?raw=true\" alt=\"alt text\"></p>\n<p>ç¬¬äºŒä¸ªåˆ—è¡¨æ¡†é€‰é¡¹å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-8.png?raw=true\" alt=\"alt text\"></p>\n<p>åˆ—è¡¨æ¡†çš„é€‰æ‹©é€‰é¡¹åŠŸèƒ½ç”¨switchè¯­å¥å®ç°</p>\n<p>ä¸€ä¸ªå¯ç¼–è¾‘æ–‡æœ¬æ¡†ç”¨äºè®¾ç½®åŠ å™ªä¿¡å·çš„ä¿¡å™ªæ¯”ï¼Œè¾“å…¥å³ä¸ºSNR</p>\n<figure class=\"highlight ini\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">SNR</span>=<span class=\"number\">0</span><span class=\"comment\">;       %ä¿¡å™ªæ¯”å¤§å°</span></span><br><span class=\"line\"><span class=\"attr\">x</span>=x/norm(x,<span class=\"number\">2</span>).*<span class=\"number\">10</span>^(-SNR/<span class=\"number\">20</span>)*norm(y)<span class=\"comment\">; %xä¸ºå™ªå£°,yä¸ºåŸä¿¡å·</span></span><br></pre></td></tr></table></figure>\n<p>å››ä¸ªå¯ç¼–è¾‘æ–‡æœ¬æ¡†ç”¨äºè¾“å…¥æ»¤æ³¢å™¨çš„æ€§èƒ½æŒ‡æ ‡</p>\n<p>é€‰ç”¨ä¼ ç»Ÿæ»¤æ³¢å™¨æ»¤æ³¢åä¼šè®¡ç®—å‡ºç›¸åº”çš„ä¿¡å™ªæ¯”</p>\n<p>è‹¥é€‰ç”¨è°±å‡æ³•è¿›è¡Œæ»¤æ³¢ï¼Œç”±äºè¯¥æ–¹æ³•æ»¤æ³¢åçš„å¸¦å™ªä¿¡å·å‡å»æ»¤æ³¢åçš„å™ªå£°ä¸ä¸ºçº¯å‡€ä¿¡å·ï¼Œåˆ™æ— æ³•é€šè¿‡è¯¥æ–¹æ³•è®¡ç®—ä¿¡å™ªæ¯”</p>\n<p>ç»è®¡ç®—å¾—åˆ°çš„ä¿¡å™ªæ¯”è¾“å‡ºåœ¨å¯ç¼–è¾‘æ–‡æœ¬æ¡†ä¸­</p>\n<p>æœ‰ä¸‰ä¸ªæ’­æ”¾æŒ‰é’®ç”¨äºæ’­æ”¾åŸä¿¡å·ï¼ŒåŠ å™ªä¿¡å·ï¼Œé™å™ªä¿¡å·ï¼Œé€šè¿‡æ¯”å¯¹åˆ†ææ»¤æ³¢æ•ˆæœçš„å¥½å</p>\n<h1 id=\"å®éªŒåŸå§‹çºªå½•\"><a href=\"#å®éªŒåŸå§‹çºªå½•\" class=\"headerlink\" title=\"å®éªŒåŸå§‹çºªå½•\"></a>å®éªŒåŸå§‹çºªå½•</h1><figure class=\"highlight routeros\"><table><tr><td class=\"code\"><pre><span class=\"line\">[y,Fs]=audioread(<span class=\"string\">&quot;C:\\Users\\kiana\\Desktop\\cctv.wav&quot;</span>);</span><br><span class=\"line\">% <span class=\"attribute\">y</span>=y(:,1);</span><br><span class=\"line\"><span class=\"attribute\">m</span>=length(y);</span><br><span class=\"line\"><span class=\"attribute\">x</span>=randn(m,1);</span><br><span class=\"line\"><span class=\"attribute\">SNR</span>=0;                 %ä¿¡å™ªæ¯”å¤§å°</span><br><span class=\"line\"><span class=\"attribute\">x</span>=x/norm(x,2).*10^(-SNR/20)*norm(y);</span><br><span class=\"line\"><span class=\"attribute\">y1</span>=x+y;</span><br><span class=\"line\">% sound(y,Fs);</span><br><span class=\"line\">subplot(4,2,1);plot(y);</span><br><span class=\"line\">xlabel(<span class=\"string\">&#x27;æ—¶é—´&#x27;</span>);</span><br><span class=\"line\">ylabel(<span class=\"string\">&#x27;å¹…å€¼&#x27;</span>);</span><br><span class=\"line\">title(<span class=\"string\">&#x27;åŸå§‹è¯­éŸ³ä¿¡å·&#x27;</span>);</span><br><span class=\"line\">subplot(4,2,3);plot(y1)</span><br><span class=\"line\">xlabel(<span class=\"string\">&#x27;æ—¶é—´&#x27;</span>);</span><br><span class=\"line\">ylabel(<span class=\"string\">&#x27;å¹…å€¼&#x27;</span>);</span><br><span class=\"line\">title(<span class=\"string\">&#x27;åŠ å™ªè¯­éŸ³ä¿¡å·&#x27;</span>);</span><br><span class=\"line\">% sound(y1,Fs);</span><br><span class=\"line\">% audiowrite(<span class=\"string\">&#x27;C:\\Users\\kiana\\Desktop\\cctv_noise.wav&#x27;</span>,y1,Fs); </span><br><span class=\"line\">Y = fft(y);  % å‚…é‡Œå¶å˜æ¢</span><br><span class=\"line\"><span class=\"attribute\">Y1</span>=fft(y1);</span><br><span class=\"line\">P = abs(Y);  % åŒè¾¹é¢‘è°±</span><br><span class=\"line\"><span class=\"attribute\">P1</span>=abs(Y1);</span><br><span class=\"line\"><span class=\"attribute\">n</span>=0:m-1;</span><br><span class=\"line\"><span class=\"attribute\">w</span>=2*n/m;</span><br><span class=\"line\">subplot(4,2,2);plot(w,P);title(<span class=\"string\">&#x27;åŸå§‹è¯­éŸ³é¢‘è°±&#x27;</span>);</span><br><span class=\"line\">subplot(4,2,4);plot(w,P1);</span><br><span class=\"line\">xlabel(<span class=\"string\">&#x27;é¢‘ç‡\\omega/\\pi&#x27;</span>);</span><br><span class=\"line\">ylabel(<span class=\"string\">&#x27;å¹…åº¦&#x27;</span>);</span><br><span class=\"line\">title(<span class=\"string\">&#x27;åŠ å™ªè¯­éŸ³é¢‘è°±&#x27;</span>);</span><br><span class=\"line\"><span class=\"attribute\">fp</span>=0.15;fs=0.24;ap=3;as=35;</span><br><span class=\"line\">[N,Wn]=buttord(fp,fs,ap,as);</span><br><span class=\"line\">[B,A]=butter(N,Wn);</span><br><span class=\"line\">% [N,Wn]=cheb1ord(fp,fs,ap,as); %ä½¿ç”¨å…¶ä»–æ»¤æ³¢å™¨å³æ³¨é‡Šå½“å‰çš„æ»¤æ³¢å™¨å’Œå»ç›¸åº”æ»¤æ³¢å™¨çš„æ³¨é‡Š</span><br><span class=\"line\">% [B,A]=cheby1(N,ap,Wn);</span><br><span class=\"line\">% [N,Wn]=cheb2ord(fp,fs,ap,as);</span><br><span class=\"line\">% [B,A]=cheby2(N,ap,Wn);</span><br><span class=\"line\">[H,W]=freqz(B,A);</span><br><span class=\"line\">% plot(abs(H));</span><br><span class=\"line\">% [N,Wn]=ellipord(fp,fs,ap,as);</span><br><span class=\"line\">% [B,A]=ellip(N,ap,as,Wn);</span><br><span class=\"line\"><span class=\"attribute\">y2</span>=filter(B,A,y1);</span><br><span class=\"line\"><span class=\"attribute\">x2</span>=filter(B,A,x);</span><br><span class=\"line\"><span class=\"attribute\">Ps</span>=sum((y2-x2).^2);</span><br><span class=\"line\"><span class=\"attribute\">Pu</span>=sum(x2.^2);</span><br><span class=\"line\"><span class=\"attribute\">SNR1</span>=10*log10(Ps/Pu); </span><br><span class=\"line\">subplot( 4,2,5);plot(y2);xlabel(<span class=\"string\">&#x27;æ—¶é—´&#x27;</span>);</span><br><span class=\"line\">ylabel(<span class=\"string\">&#x27;å¹…å€¼&#x27;</span>);title(<span class=\"string\">&quot;å»å™ªè¯­éŸ³ä¿¡å·&quot;</span>);</span><br><span class=\"line\"><span class=\"attribute\">Y2</span>=fft(y2);</span><br><span class=\"line\"><span class=\"attribute\">P2</span>=abs(Y2);</span><br><span class=\"line\">subplot(4,2,6);plot(w,P2);xlabel(<span class=\"string\">&#x27;é¢‘ç‡\\omega/\\pi&#x27;</span>);</span><br><span class=\"line\">ylabel(<span class=\"string\">&#x27;å¹…åº¦&#x27;</span>);title(<span class=\"string\">&#x27;å»å™ªè¯­éŸ³é¢‘è°±&#x27;</span>);</span><br><span class=\"line\">subplot(4,2,7);plot(W/pi,20*log10(abs(H)));</span><br><span class=\"line\">% axis([0,1,-440,0]);title(<span class=\"string\">&quot;å·´ç‰¹æ²ƒæ–¯ä½é€šæ»¤æ³¢å™¨&quot;</span>);</span><br><span class=\"line\">xlabel(<span class=\"string\">&quot;\\omega/pi&quot;</span>);ylabel(<span class=\"string\">&quot;å¢ç›Š(dB)&quot;</span>);</span><br><span class=\"line\">% sound(y2,Fs);</span><br><span class=\"line\">% audiowrite(<span class=\"string\">&#x27;C:\\Users\\kiana\\Desktop\\cctv_denosied.wav&#x27;</span>,y2,Fs); </span><br></pre></td></tr></table></figure>\n<h1 id=\"å®éªŒç»“æœåŠåˆ†æ\"><a href=\"#å®éªŒç»“æœåŠåˆ†æ\" class=\"headerlink\" title=\"å®éªŒç»“æœåŠåˆ†æ\"></a>å®éªŒç»“æœåŠåˆ†æ</h1><h2 id=\"åŸºç¡€éƒ¨åˆ†\"><a href=\"#åŸºç¡€éƒ¨åˆ†\" class=\"headerlink\" title=\"åŸºç¡€éƒ¨åˆ†\"></a>åŸºç¡€éƒ¨åˆ†</h2><p>æˆ‘ä»¬é€‰å–çš„éŸ³é¢‘çš„æ—¶åŸŸå’Œé¢‘åŸŸå›¾å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-9.png?raw=true\" alt=\"alt text\"></p>\n<p>å¯ä»¥çœ‹åˆ°å®ƒçš„ä¿¡å·ä¸»è¦é›†ä¸­åœ¨ä½é¢‘éƒ¨åˆ†</p>\n<p>æ·»åŠ é«˜æ–¯ç™½å™ªå£°å¾—åˆ°ä¿¡å™ªæ¯”ä¸º0çš„å¸¦å™ªä¿¡å·ï¼Œå®ƒçš„æ—¶åŸŸå’Œé¢‘åŸŸå›¾å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-10.png?raw=true\" alt=\"alt text\"></p>\n<p>å‘ç°åŸæ¥å„é¢‘ç‡ä¸Šå‡å·²æœ‰å€¼ï¼Œå™ªå£°çš„å¹…åº¦å‡åŒ€åˆ†å¸ƒåœ¨å„é¢‘ç‡æ®µï¼Œé€šè¿‡è§‚å¯Ÿæˆ‘ä»¬å‘ç°ï¼Œåœ¨$0.15$ä¹‹å‰çš„é¢‘ç‡å°±åŒ…å«äº†åŸä¿¡å·é¢‘è°±çš„ç»å¤§éƒ¨åˆ†ï¼Œè€Œåœ¨$0.24$ä¹‹åå‡ ä¹æ²¡æœ‰å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾è®¡ç›¸åº”çš„æ»¤æ³¢å™¨ä»¥ä¿ç•™ä½é¢‘æ®µä¿¡æ¯ï¼Œæ»¤å»å…¶ä»–ä¿¡æ¯</p>\n<p>å¾—åˆ°çš„æ»¤æ³¢å™¨å“åº”æ›²çº¿</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-11.png?raw=true\" alt=\"alt text\"></p>\n<p>ç»è¿‡æ»¤åçš„ä¿¡å·çš„æ—¶åŸŸå’Œé¢‘åŸŸå›¾å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-12.png?raw=true\" alt=\"alt text\"></p>\n<p>é€šè¿‡å…ˆå‰çš„ä¿¡å™ªæ¯”è®¡ç®—æ–¹æ³•å¾—åˆ°æ»¤æ³¢åçš„ä¿¡å·ä¿¡å™ªæ¯”çº¦ä¸º$7.87$è¿™æ˜¯ä¸€ä¸ªåˆç†çš„å€¼ï¼Œç”±äºåŠ å™ªä¿¡å·ä¿¡å™ªæ¯”ä¸º $0$ï¼Œå³å™ªå£°åŠŸç‡$Pu$å’Œçº¯å‡€ä¿¡å·åŠŸç‡$Ps$ç›¸ç­‰ï¼Œæˆ‘ä»¬é€šè¿‡è®¡ç®—å¯å¾—å®ƒçš„å€¼åº”è¯¥å¤§äº$10\\times log10(Ps&#x2F;0.24Pu)&#x3D;6.19$,å°äº$10\\times log10ï¼ˆPs&#x2F;0.15Puï¼‰&#x3D;8.24$</p>\n<h2 id=\"æé«˜éƒ¨åˆ†\"><a href=\"#æé«˜éƒ¨åˆ†\" class=\"headerlink\" title=\"æé«˜éƒ¨åˆ†\"></a>æé«˜éƒ¨åˆ†</h2><p>æˆ‘ä»¬å‘åŸä¿¡å·ä¸­åŠ å…¥é«˜é¢‘å™ªå£°å¾—åˆ°ä¿¡å™ªæ¯”ä¸º0çš„åŠ å™ªä¿¡å·ï¼Œå®ƒçš„æ—¶åŸŸå’Œé¢‘åŸŸå›¾å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-13.png?raw=true\" alt=\"alt text\"></p>\n<p>å¯ä»¥çœ‹åˆ°å™ªå£°éƒ½é›†ä¸­åœ¨0.6åˆ°1ä¹‹é—´</p>\n<p>æˆ‘ä»¬å°†å…¶é€šè¿‡æ²¿ç”¨ä¹‹å‰çš„æ€§èƒ½æŒ‡æ ‡å¾—åˆ°çš„å·´ç‰¹æ²ƒæ–¯æ»¤æ³¢å™¨</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-14.png?raw=true\" alt=\"alt text\"></p>\n<p>å®ƒçš„ä¿¡å™ªæ¯”ä¸º$76.5$</p>\n<p>æˆ‘ä»¬å†è®¾è®¡åˆ‡æ¯”é›ªå¤«â… å‹æ»¤æ³¢å™¨ï¼Œå®ƒçš„å“åº”æ›²çº¿å’Œå»å™ªæ•ˆæœå¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-15.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-16.png?raw=true\" alt=\"alt text\"></p>\n<p>ä¿¡å™ªæ¯”ä¸º$75.3$<br>åˆ‡æ¯”é›ªå¤«â…¡å‹æ»¤æ³¢å™¨çš„å“åº”æ›²çº¿å’Œæ»¤æ³¢æ•ˆæœå¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-17.png?raw=true\" alt=\"alt text\"></p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-18.png?raw=true\" alt=\"alt text\"></p>\n<p>å®ƒçš„ä¿¡å™ªæ¯”ä¸º$42.5$<br>æ¤­åœ†æ»¤æ³¢å™¨çš„å“åº”æ›²çº¿å’Œæ»¤æ³¢æ•ˆæœå¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-19.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-20.png?raw=true\" alt=\"alt text\"></p>\n<p>å®ƒçš„ä¿¡å™ªæ¯”ä¸º$33.1$<br>é€šè¿‡æ¯”å¯¹æˆ‘ä»¬å¯ä»¥å‘ç°å·´ç‰¹æ²ƒæ–¯æ»¤æ³¢å™¨çš„æ•ˆæœæœ€å¥½ï¼Œåˆ‡æ¯”é›ªå¤«â… å‹ä¸å…¶ç›¸ä¼¼ï¼Œè€Œåˆ‡æ¯”é›ªå¤«â…¡å‹å’Œæ¤­åœ†æ»¤æ³¢å™¨çš„æ•ˆæœä¸å‰ä¸¤ä¸ªç›¸å·®è¾ƒå¤§</p>\n<p>è¿™æ˜¯ç”±ä»–ä»¬çš„å“åº”æ›²çº¿å†³å®šçš„ï¼Œåˆ‡æ¯”é›ªå¤«â… å‹åœ¨ä½é¢‘å¤„æœ‰æ³¢çº¹ä½¿å¾—å®ƒåœ¨ä¿ç•™ä½é¢‘ä¿¡æ¯ä¸ŠåŠ£äºå·´ç‰¹æ²ƒæ–¯ï¼Œè€Œåˆ‡æ¯”é›ªå¤«â…¡å‹å’Œæ¤­åœ†æ»¤æ³¢å™¨åœ¨é«˜é¢‘å‡ºçš„è¡°å‡ä¸å¦‚å‰ä¸¤ä¸ªæ»¤æ³¢å™¨å‰§çƒˆï¼Œä¹Ÿå°±æ˜¯å™ªå£°çš„æ¶ˆé™¤ä¸å¦‚å‰ä¸¤ä¸ªæ»¤æ³¢å™¨ï¼Œè€Œæ¤­åœ†æ»¤æ³¢å™¨çš„ä¿¡å™ªæ¯”ä¸å¦‚åˆ‡æ¯”é›ªå¤«â…¡å‹åˆ™æ˜¯ç”±äºå®ƒå¯¹ä½é¢‘ä¿¡å·çš„è¡°å‡æ˜æ˜¾å¼ºäºåˆ‡æ¯”é›ªå¤«â…¡å‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/dsp-21.png?raw=true\" alt=\"alt text\"></p>\n<p>æ’­æ”¾è°±å‡æ³•å¤„ç†åçš„éŸ³é¢‘æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨æœ€åæœ‰æ˜æ˜¾çš„å¤šé¢¤éŸ³ï¼Œè¿™ä¸€ç‚¹åœ¨æ—¶åŸŸå›¾ä¸Šä¹Ÿèƒ½çœ‹å‡ºï¼Œåœ¨$6$è‡³$8$å¤„çš„å¹…å€¼å¯¹æ¯”åŸéŸ³é¢‘æ—¶åŸŸå›¾æœ‰æ˜æ˜¾çš„è¡°å‡ï¼Œè¿™æ˜¯è°±å‡æ³•çš„ä¸€ä¸ªå¼Šç«¯ï¼Œå®ƒä¼šäº§ç”ŸéŸ³ä¹å™ªå£°ï¼Œè€Œè¿™ä¸€ç°è±¡åœ¨å¦ä¸€éŸ³é¢‘ä¸­ä½“ç°çš„å°¤ä¸ºæ˜æ˜¾</p>\n","categories":["Digital Signal Processing"]},{"title":"æœºå™¨ç¿»è¯‘","url":"/2024/06/23/lab13/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"èƒŒæ™¯çŸ¥è¯†\"><a href=\"#èƒŒæ™¯çŸ¥è¯†\" class=\"headerlink\" title=\"èƒŒæ™¯çŸ¥è¯†\"></a>èƒŒæ™¯çŸ¥è¯†</h1><h2 id=\"ç¼–ç å™¨â€”è§£ç å™¨ï¼ˆseq2seqï¼‰\"><a href=\"#ç¼–ç å™¨â€”è§£ç å™¨ï¼ˆseq2seqï¼‰\" class=\"headerlink\" title=\"ç¼–ç å™¨â€”è§£ç å™¨ï¼ˆseq2seqï¼‰\"></a>ç¼–ç å™¨â€”è§£ç å™¨ï¼ˆseq2seqï¼‰</h2><p>åœ¨è‡ªç„¶è¯­è¨€å¤„ç†çš„å¾ˆå¤šåº”ç”¨ä¸­ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½å¯ä»¥æ˜¯ä¸å®šé•¿åºåˆ—ã€‚ä»¥æœºå™¨ç¿»è¯‘ä¸ºä¾‹ï¼Œè¾“å…¥å¯ä»¥æ˜¯ä¸€æ®µä¸å®šé•¿çš„è‹±è¯­æ–‡æœ¬åºåˆ—ï¼Œè¾“å‡ºå¯ä»¥æ˜¯ä¸€æ®µä¸å®šé•¿çš„æ³•è¯­æ–‡æœ¬åºåˆ—ï¼Œä¾‹å¦‚</p>\n<blockquote>\n<p>è‹±è¯­è¾“å…¥ï¼šâ€œTheyâ€ã€â€œareâ€ã€â€œwatchingâ€ã€â€œ.â€</p>\n</blockquote>\n<blockquote>\n<p>æ³•è¯­è¾“å‡ºï¼šâ€œIlsâ€ã€â€œregardentâ€ã€â€œ.â€</p>\n</blockquote>\n<p>å½“è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ä¸å®šé•¿åºåˆ—æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¼–ç å™¨â€”è§£ç å™¨ï¼ˆencoder-decoderï¼‰ æˆ–è€…seq2seqæ¨¡å‹ã€‚è¿™ä¸¤ä¸ªæ¨¡å‹æœ¬è´¨ä¸Šéƒ½ç”¨åˆ°äº†ä¸¤ä¸ªå¾ªç¯ç¥ç»ç½‘ç»œï¼Œåˆ†åˆ«å«åšç¼–ç å™¨å’Œè§£ç å™¨ã€‚ç¼–ç å™¨ç”¨æ¥åˆ†æè¾“å…¥åºåˆ—ï¼Œè§£ç å™¨ç”¨æ¥ç”Ÿæˆè¾“å‡ºåºåˆ—ã€‚<span id=\"more\"></span></p>\n<p>å›¾10.8æè¿°äº†ä½¿ç”¨ç¼–ç å™¨â€”è§£ç å™¨å°†ä¸Šè¿°è‹±è¯­å¥å­ç¿»è¯‘æˆæ³•è¯­å¥å­çš„ä¸€ç§æ–¹æ³•ã€‚åœ¨è®­ç»ƒæ•°æ®é›†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªå¥å­åé™„ä¸Šç‰¹æ®Šç¬¦å·â€œ&lt;eos&gt;â€ï¼ˆend of sequenceï¼‰ä»¥è¡¨ç¤ºåºåˆ—çš„ç»ˆæ­¢ã€‚ç¼–ç å™¨æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥ä¾æ¬¡ä¸ºè‹±è¯­å¥å­ä¸­çš„å•è¯ã€æ ‡ç‚¹å’Œç‰¹æ®Šç¬¦å·â€œ&lt;eos&gt;â€ã€‚å›¾10.8ä¸­ä½¿ç”¨äº†ç¼–ç å™¨åœ¨æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ä½œä¸ºè¾“å…¥å¥å­çš„è¡¨å¾æˆ–ç¼–ç ä¿¡æ¯ã€‚è§£ç å™¨åœ¨å„ä¸ªæ—¶é—´æ­¥ä¸­ä½¿ç”¨è¾“å…¥å¥å­çš„ç¼–ç ä¿¡æ¯å’Œä¸Šä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºä»¥åŠéšè—çŠ¶æ€ä½œä¸ºè¾“å…¥ã€‚æˆ‘ä»¬å¸Œæœ›è§£ç å™¨åœ¨å„ä¸ªæ—¶é—´æ­¥èƒ½æ­£ç¡®ä¾æ¬¡è¾“å‡ºç¿»è¯‘åçš„æ³•è¯­å•è¯ã€æ ‡ç‚¹å’Œç‰¹æ®Šç¬¦å·â€&lt;eos&gt;â€ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè§£ç å™¨åœ¨æœ€åˆæ—¶é—´æ­¥çš„è¾“å…¥ç”¨åˆ°äº†ä¸€ä¸ªè¡¨ç¤ºåºåˆ—å¼€å§‹çš„ç‰¹æ®Šç¬¦å·â€&lt;bos&gt;â€ï¼ˆbeginning of sequenceï¼‰ã€‚</p>\n<div align=\"center\">\n<img width=\"500\" src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/10.9_seq2seq.svg?raw=true\">\n</div>\n<div align=\"center\">å›¾10.8 ä½¿ç”¨ç¼–ç å™¨â€”è§£ç å™¨å°†å¥å­ç”±è‹±è¯­ç¿»è¯‘æˆæ³•è¯­ã€‚ç¼–ç å™¨å’Œè§£ç å™¨åˆ†åˆ«ä¸ºå¾ªç¯ç¥ç»ç½‘ç»œ</div>\n\n\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†åˆ«ä»‹ç»ç¼–ç å™¨å’Œè§£ç å™¨çš„å®šä¹‰ã€‚</p>\n<h3 id=\"ç¼–ç å™¨\"><a href=\"#ç¼–ç å™¨\" class=\"headerlink\" title=\"ç¼–ç å™¨\"></a>ç¼–ç å™¨</h3><p>ç¼–ç å™¨çš„ä½œç”¨æ˜¯æŠŠä¸€ä¸ªä¸å®šé•¿çš„è¾“å…¥åºåˆ—å˜æ¢æˆä¸€ä¸ªå®šé•¿çš„èƒŒæ™¯å˜é‡$\\boldsymbol{c}$ï¼Œå¹¶åœ¨è¯¥èƒŒæ™¯å˜é‡ä¸­ç¼–ç è¾“å…¥åºåˆ—ä¿¡æ¯ã€‚å¸¸ç”¨çš„ç¼–ç å™¨æ˜¯å¾ªç¯ç¥ç»ç½‘ç»œã€‚</p>\n<p>è®©æˆ‘ä»¬è€ƒè™‘æ‰¹é‡å¤§å°ä¸º1çš„æ—¶åºæ•°æ®æ ·æœ¬ã€‚å‡è®¾è¾“å…¥åºåˆ—æ˜¯$x_1,\\ldots,x_T$ï¼Œä¾‹å¦‚$x_i$æ˜¯è¾“å…¥å¥å­ä¸­çš„ç¬¬$i$ä¸ªè¯ã€‚åœ¨æ—¶é—´æ­¥$t$ï¼Œå¾ªç¯ç¥ç»ç½‘ç»œå°†è¾“å…¥$x_t$çš„ç‰¹å¾å‘é‡$\\boldsymbol{x_t}$å’Œä¸Šä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€$\\boldsymbol{h}_{t-1}$å˜æ¢ä¸ºå½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€$\\boldsymbol{h}_t$ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°$f$è¡¨è¾¾å¾ªç¯ç¥ç»ç½‘ç»œéšè—å±‚çš„å˜æ¢ï¼š</p>\n<p>$$\\boldsymbol{h_t} &#x3D; f(\\boldsymbol{x_t}, \\boldsymbol{h}_{t-1})$$</p>\n<p>æ¥ä¸‹æ¥ï¼Œç¼–ç å™¨é€šè¿‡è‡ªå®šä¹‰å‡½æ•°$q$å°†å„ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€å˜æ¢ä¸ºèƒŒæ™¯å˜é‡</p>\n<p>$$<br>\\boldsymbol{c} &#x3D;  q(\\boldsymbol{h}_1, \\ldots, \\boldsymbol{h}_T).<br>$$</p>\n<p>ä¾‹å¦‚ï¼Œå½“é€‰æ‹©$q(\\boldsymbol{h}_1, \\ldots, \\boldsymbol{h}_T) &#x3D; \\boldsymbol{h}_T$æ—¶ï¼ŒèƒŒæ™¯å˜é‡æ˜¯è¾“å…¥åºåˆ—æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€$\\boldsymbol{h}_T$ã€‚</p>\n<p>ä»¥ä¸Šæè¿°çš„ç¼–ç å™¨æ˜¯ä¸€ä¸ªå•å‘çš„å¾ªç¯ç¥ç»ç½‘ç»œï¼Œæ¯ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€åªå–å†³äºè¯¥æ—¶é—´æ­¥åŠä¹‹å‰çš„è¾“å…¥å­åºåˆ—ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œæ„é€ ç¼–ç å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–ç å™¨æ¯ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€åŒæ—¶å–å†³äºè¯¥æ—¶é—´æ­¥ä¹‹å‰å’Œä¹‹åçš„å­åºåˆ—ï¼ˆåŒ…æ‹¬å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ï¼‰ï¼Œå¹¶ç¼–ç äº†æ•´ä¸ªåºåˆ—çš„ä¿¡æ¯ã€‚</p>\n<h3 id=\"è§£ç å™¨\"><a href=\"#è§£ç å™¨\" class=\"headerlink\" title=\"è§£ç å™¨\"></a>è§£ç å™¨</h3><p>åˆšåˆšå·²ç»ä»‹ç»ï¼Œç¼–ç å™¨è¾“å‡ºçš„èƒŒæ™¯å˜é‡$\\boldsymbol{c}$ç¼–ç äº†æ•´ä¸ªè¾“å…¥åºåˆ—$x_1, \\ldots, x_T$çš„ä¿¡æ¯ã€‚ç»™å®šè®­ç»ƒæ ·æœ¬ä¸­çš„è¾“å‡ºåºåˆ—$y_1, y_2, \\ldots, y_{Tâ€™}$ï¼Œå¯¹æ¯ä¸ªæ—¶é—´æ­¥$tâ€™$ï¼ˆç¬¦å·ä¸è¾“å…¥åºåˆ—æˆ–ç¼–ç å™¨çš„æ—¶é—´æ­¥$t$æœ‰åŒºåˆ«ï¼‰ï¼Œè§£ç å™¨è¾“å‡º$y_{tâ€™}$çš„æ¡ä»¶æ¦‚ç‡å°†åŸºäºä¹‹å‰çš„è¾“å‡ºåºåˆ—$y_1,\\ldots,y_{tâ€™-1}$å’ŒèƒŒæ™¯å˜é‡$\\boldsymbol{c}$ï¼Œå³$P(y_{tâ€™} \\mid y_1, \\ldots, y_{tâ€™-1}, \\boldsymbol{c})$ã€‚</p>\n<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦ä¸€ä¸ªå¾ªç¯ç¥ç»ç½‘ç»œä½œä¸ºè§£ç å™¨ã€‚åœ¨è¾“å‡ºåºåˆ—çš„æ—¶é—´æ­¥$t^\\prime$ï¼Œè§£ç å™¨å°†ä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡º$y_{t^\\prime-1}$ä»¥åŠèƒŒæ™¯å˜é‡$\\boldsymbol{c}$ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†å®ƒä»¬ä¸ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€$\\boldsymbol{s_{t^\\prime-1}}$å˜æ¢ä¸ºå½“å‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€$\\boldsymbol{s}_{t^\\prime}$ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°$g$è¡¨è¾¾è§£ç å™¨éšè—å±‚çš„å˜æ¢ï¼š</p>\n<p>$$<br>\\boldsymbol{s_{t^\\prime}} &#x3D; g(y_{t^\\prime-1}, \\boldsymbol{c}, \\boldsymbol{s}_{t^\\prime-1}).<br>$$</p>\n<p>æœ‰äº†è§£ç å™¨çš„éšè—çŠ¶æ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„è¾“å‡ºå±‚å’Œsoftmaxè¿ç®—æ¥è®¡ç®—$P(y_{t^\\prime} \\mid y_1, \\ldots, y_{t^\\prime-1}, \\boldsymbol{c})$ï¼Œä¾‹å¦‚ï¼ŒåŸºäºå½“å‰æ—¶é—´æ­¥çš„è§£ç å™¨éšè—çŠ¶æ€ $\\boldsymbol{s}_ {t^\\prime}$ã€ä¸Šä¸€æ—¶é—´æ­¥çš„è¾“å‡º$y_{t^\\prime-1}$ä»¥åŠèƒŒæ™¯å˜é‡$\\boldsymbol{c}$æ¥è®¡ç®—å½“å‰æ—¶é—´æ­¥è¾“å‡º$y_{t^\\prime}$çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p>\n<h3 id=\"è®­ç»ƒæ¨¡å‹\"><a href=\"#è®­ç»ƒæ¨¡å‹\" class=\"headerlink\" title=\"è®­ç»ƒæ¨¡å‹\"></a>è®­ç»ƒæ¨¡å‹</h3><p>æ ¹æ®æœ€å¤§ä¼¼ç„¶ä¼°è®¡ï¼Œæˆ‘ä»¬å¯ä»¥æœ€å¤§åŒ–è¾“å‡ºåºåˆ—åŸºäºè¾“å…¥åºåˆ—çš„æ¡ä»¶æ¦‚ç‡</p>\n<p>$$<br>\\begin{aligned}<br>P(y_1, \\ldots, y_{Tâ€™} \\mid x_1, \\ldots, x_T)<br>&amp;&#x3D; \\prod_{tâ€™&#x3D;1}^{Tâ€™} P(y_{tâ€™} \\mid y_1, \\ldots, y_{tâ€™-1}, x_1, \\ldots, x_T)\\\\<br>&amp;&#x3D; \\prod_{tâ€™&#x3D;1}^{Tâ€™} P(y_{tâ€™} \\mid y_1, \\ldots, y_{tâ€™-1}, \\boldsymbol{c}),<br>\\end{aligned}<br>$$</p>\n<p>å¹¶å¾—åˆ°è¯¥è¾“å‡ºåºåˆ—çš„æŸå¤±</p>\n<p>$$<br>-\\log P(y_1, \\ldots, y_{Tâ€™} \\mid x_1, \\ldots, x_T) &#x3D; -\\sum_{tâ€™&#x3D;1}^{Tâ€™} \\log P(y_{tâ€™} \\mid y_1, \\ldots, y_{tâ€™-1}, \\boldsymbol{c}),<br>$$</p>\n<p>åœ¨æ¨¡å‹è®­ç»ƒä¸­ï¼Œæ‰€æœ‰è¾“å‡ºåºåˆ—æŸå¤±çš„å‡å€¼é€šå¸¸ä½œä¸ºéœ€è¦æœ€å°åŒ–çš„æŸå¤±å‡½æ•°ã€‚åœ¨å›¾10.8æ‰€æè¿°çš„æ¨¡å‹é¢„æµ‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†è§£ç å™¨åœ¨ä¸Šä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºä½œä¸ºå½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ã€‚ä¸æ­¤ä¸åŒï¼Œåœ¨è®­ç»ƒä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†æ ‡ç­¾åºåˆ—ï¼ˆè®­ç»ƒé›†çš„çœŸå®è¾“å‡ºåºåˆ—ï¼‰åœ¨ä¸Šä¸€ä¸ªæ—¶é—´æ­¥çš„æ ‡ç­¾ä½œä¸ºè§£ç å™¨åœ¨å½“å‰æ—¶é—´æ­¥çš„è¾“å…¥ã€‚è¿™å«ä½œå¼ºåˆ¶æ•™å­¦ï¼ˆteacher forcingï¼‰ã€‚</p>\n<h2 id=\"æŸæœç´¢\"><a href=\"#æŸæœç´¢\" class=\"headerlink\" title=\"æŸæœç´¢\"></a>æŸæœç´¢</h2><p>ä¸Šä¸€èŠ‚ä»‹ç»äº†å¦‚ä½•è®­ç»ƒè¾“å…¥å’Œè¾“å‡ºå‡ä¸ºä¸å®šé•¿åºåˆ—çš„ç¼–ç å™¨â€”è§£ç å™¨ã€‚æœ¬èŠ‚æˆ‘ä»¬ä»‹ç»å¦‚ä½•ä½¿ç”¨ç¼–ç å™¨â€”è§£ç å™¨æ¥é¢„æµ‹ä¸å®šé•¿çš„åºåˆ—ã€‚</p>\n<p>ä¸Šä¸€èŠ‚é‡Œå·²ç»æåˆ°ï¼Œåœ¨å‡†å¤‡è®­ç»ƒæ•°æ®é›†æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåœ¨æ ·æœ¬çš„è¾“å…¥åºåˆ—å’Œè¾“å‡ºåºåˆ—åé¢åˆ†åˆ«é™„ä¸Šä¸€ä¸ªç‰¹æ®Šç¬¦å·â€&lt;eos&gt;â€è¡¨ç¤ºåºåˆ—çš„ç»ˆæ­¢ã€‚æˆ‘ä»¬åœ¨æ¥ä¸‹æ¥çš„è®¨è®ºä¸­ä¹Ÿå°†æ²¿ç”¨ä¸Šä¸€èŠ‚çš„å…¨éƒ¨æ•°å­¦ç¬¦å·ã€‚ä¸ºäº†ä¾¿äºè®¨è®ºï¼Œå‡è®¾è§£ç å™¨çš„è¾“å‡ºæ˜¯ä¸€æ®µæ–‡æœ¬åºåˆ—ã€‚è®¾è¾“å‡ºæ–‡æœ¬è¯å…¸$\\mathcal{Y}$ï¼ˆåŒ…å«ç‰¹æ®Šç¬¦å·â€&lt;eos&gt;â€ï¼‰çš„å¤§å°ä¸º$\\left|\\mathcal{Y}\\right|$ï¼Œè¾“å‡ºåºåˆ—çš„æœ€å¤§é•¿åº¦ä¸º$Tâ€™$ã€‚æ‰€æœ‰å¯èƒ½çš„è¾“å‡ºåºåˆ—ä¸€å…±æœ‰$\\mathcal{O}(\\left|\\mathcal{Y}\\right|^{Tâ€™})$ç§ã€‚è¿™äº›è¾“å‡ºåºåˆ—ä¸­æ‰€æœ‰ç‰¹æ®Šç¬¦å·â€&lt;eos&gt;â€åé¢çš„å­åºåˆ—å°†è¢«èˆå¼ƒã€‚</p>\n<h3 id=\"è´ªå©ªæœç´¢\"><a href=\"#è´ªå©ªæœç´¢\" class=\"headerlink\" title=\"è´ªå©ªæœç´¢\"></a>è´ªå©ªæœç´¢</h3><p>è®©æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆï¼šè´ªå©ªæœç´¢ï¼ˆgreedy searchï¼‰ã€‚å¯¹äºè¾“å‡ºåºåˆ—ä»»ä¸€æ—¶é—´æ­¥$tâ€™$ï¼Œæˆ‘ä»¬ä»$|\\mathcal{Y}|$ä¸ªè¯ä¸­æœç´¢å‡ºæ¡ä»¶æ¦‚ç‡æœ€å¤§çš„è¯</p>\n<p>$$<br>y _ { t ^ { \\prime } } &#x3D; \\underset { y \\in \\mathcal { Y } } { \\operatorname { argmax } } P \\left( y | y _ { 1 } , \\ldots , y _ { t ^ { \\prime } - 1 } , c \\right)<br>$$</p>\n<p>ä½œä¸ºè¾“å‡ºã€‚ä¸€æ—¦æœç´¢å‡ºâ€&lt;eos&gt;â€ç¬¦å·ï¼Œæˆ–è€…è¾“å‡ºåºåˆ—é•¿åº¦å·²ç»è¾¾åˆ°äº†æœ€å¤§é•¿åº¦$Tâ€™$ï¼Œä¾¿å®Œæˆè¾“å‡ºã€‚</p>\n<p>æˆ‘ä»¬åœ¨æè¿°è§£ç å™¨æ—¶æåˆ°ï¼ŒåŸºäºè¾“å…¥åºåˆ—ç”Ÿæˆè¾“å‡ºåºåˆ—çš„æ¡ä»¶æ¦‚ç‡æ˜¯$\\prod_{tâ€™&#x3D;1}^{Tâ€™} P(y_{tâ€™} \\mid y_1, \\ldots, y_{tâ€™-1}, \\boldsymbol{c})$ã€‚æˆ‘ä»¬å°†è¯¥æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„è¾“å‡ºåºåˆ—ç§°ä¸ºæœ€ä¼˜è¾“å‡ºåºåˆ—ã€‚è€Œè´ªå©ªæœç´¢çš„ä¸»è¦é—®é¢˜æ˜¯ä¸èƒ½ä¿è¯å¾—åˆ°æœ€ä¼˜è¾“å‡ºåºåˆ—ã€‚</p>\n<p>ä¸‹é¢æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚å‡è®¾è¾“å‡ºè¯å…¸é‡Œé¢æœ‰â€œAâ€â€œBâ€â€œCâ€å’Œâ€œ&lt;eos&gt;â€è¿™4ä¸ªè¯ã€‚å›¾10.9ä¸­æ¯ä¸ªæ—¶é—´æ­¥ä¸‹çš„4ä¸ªæ•°å­—åˆ†åˆ«ä»£è¡¨äº†è¯¥æ—¶é—´æ­¥ç”Ÿæˆâ€œAâ€â€œBâ€â€œCâ€å’Œâ€œ&lt;eos&gt;â€è¿™4ä¸ªè¯çš„æ¡ä»¶æ¦‚ç‡ã€‚åœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼Œè´ªå©ªæœç´¢é€‰å–æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„è¯ã€‚å› æ­¤ï¼Œå›¾10.9ä¸­å°†ç”Ÿæˆè¾“å‡ºåºåˆ—â€œAâ€â€œBâ€â€œCâ€â€œ&lt;eos&gt;â€ã€‚è¯¥è¾“å‡ºåºåˆ—çš„æ¡ä»¶æ¦‚ç‡æ˜¯$0.5\\times0.4\\times0.4\\times0.6 &#x3D; 0.048$ã€‚</p>\n<div align=\"center\">\n<img width=\"200\" src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/10.10_s2s_prob1.svg?raw=true\">\n</div>\n<div align=\"center\">å›¾10.9 åœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼Œè´ªå©ªæœç´¢é€‰å–æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„è¯</div>\n\n\n<p>æ¥ä¸‹æ¥ï¼Œè§‚å¯Ÿå›¾10.10æ¼”ç¤ºçš„ä¾‹å­ã€‚ä¸å›¾10.9ä¸­ä¸åŒï¼Œå›¾10.10åœ¨æ—¶é—´æ­¥2ä¸­é€‰å–äº†æ¡ä»¶æ¦‚ç‡ç¬¬äºŒå¤§çš„è¯â€œCâ€ã€‚ç”±äºæ—¶é—´æ­¥3æ‰€åŸºäºçš„æ—¶é—´æ­¥1å’Œ2çš„è¾“å‡ºå­åºåˆ—ç”±å›¾10.9ä¸­çš„â€œAâ€â€œBâ€å˜ä¸ºäº†å›¾10.10ä¸­çš„â€œAâ€â€œCâ€ï¼Œå›¾10.10ä¸­æ—¶é—´æ­¥3ç”Ÿæˆå„ä¸ªè¯çš„æ¡ä»¶æ¦‚ç‡å‘ç”Ÿäº†å˜åŒ–ã€‚æˆ‘ä»¬é€‰å–æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„è¯â€œBâ€ã€‚æ­¤æ—¶æ—¶é—´æ­¥4æ‰€åŸºäºçš„å‰3ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºå­åºåˆ—ä¸ºâ€œAâ€â€œCâ€â€œBâ€ï¼Œä¸å›¾10.9ä¸­çš„â€œAâ€â€œBâ€â€œCâ€ä¸åŒã€‚å› æ­¤ï¼Œå›¾10.10ä¸­æ—¶é—´æ­¥4ç”Ÿæˆå„ä¸ªè¯çš„æ¡ä»¶æ¦‚ç‡ä¹Ÿä¸å›¾10.9ä¸­çš„ä¸åŒã€‚æˆ‘ä»¬å‘ç°ï¼Œæ­¤æ—¶çš„è¾“å‡ºåºåˆ—â€œAâ€â€œCâ€â€œBâ€â€œ&lt;eos&gt;â€çš„æ¡ä»¶æ¦‚ç‡æ˜¯$0.5\\times0.3\\times0.6\\times0.6&#x3D;0.054$ï¼Œå¤§äºè´ªå©ªæœç´¢å¾—åˆ°çš„è¾“å‡ºåºåˆ—çš„æ¡ä»¶æ¦‚ç‡ã€‚å› æ­¤ï¼Œè´ªå©ªæœç´¢å¾—åˆ°çš„è¾“å‡ºåºåˆ—â€œAâ€â€œBâ€â€œCâ€â€œ&lt;eos&gt;â€å¹¶éæœ€ä¼˜è¾“å‡ºåºåˆ—ã€‚</p>\n<div align=\"center\">\n<img width=\"200\" src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/10.10_s2s_prob2.svg?raw=true\">\n</div>\n<div align=\"center\">å›¾10.10 åœ¨æ—¶é—´æ­¥2é€‰å–æ¡ä»¶æ¦‚ç‡ç¬¬äºŒå¤§çš„è¯â€œCâ€</div>\n\n\n<h3 id=\"ç©·ä¸¾æœç´¢\"><a href=\"#ç©·ä¸¾æœç´¢\" class=\"headerlink\" title=\"ç©·ä¸¾æœç´¢\"></a>ç©·ä¸¾æœç´¢</h3><p>å¦‚æœç›®æ ‡æ˜¯å¾—åˆ°æœ€ä¼˜è¾“å‡ºåºåˆ—ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç©·ä¸¾æœç´¢ï¼ˆexhaustive searchï¼‰ï¼šç©·ä¸¾æ‰€æœ‰å¯èƒ½çš„è¾“å‡ºåºåˆ—ï¼Œè¾“å‡ºæ¡ä»¶æ¦‚ç‡æœ€å¤§çš„åºåˆ—ã€‚</p>\n<p>è™½ç„¶ç©·ä¸¾æœç´¢å¯ä»¥å¾—åˆ°æœ€ä¼˜è¾“å‡ºåºåˆ—ï¼Œä½†å®ƒçš„è®¡ç®—å¼€é”€$\\mathcal{O}(\\left|\\mathcal{Y}\\right|^{Tâ€™})$å¾ˆå®¹æ˜“è¿‡å¤§ã€‚ä¾‹å¦‚ï¼Œå½“$|\\mathcal{Y}|&#x3D;10000$ä¸”$Tâ€™&#x3D;10$æ—¶ï¼Œæˆ‘ä»¬å°†è¯„ä¼°$10000^{10} &#x3D; 10^{40}$ä¸ªåºåˆ—ï¼šè¿™å‡ ä¹ä¸å¯èƒ½å®Œæˆã€‚è€Œè´ªå©ªæœç´¢çš„è®¡ç®—å¼€é”€æ˜¯$\\mathcal{O}(\\left|\\mathcal{Y}\\right|Tâ€™)$ï¼Œé€šå¸¸æ˜¾è‘—å°äºç©·ä¸¾æœç´¢çš„è®¡ç®—å¼€é”€ã€‚ä¾‹å¦‚ï¼Œå½“$|\\mathcal{Y}|&#x3D;10000$ä¸”$Tâ€™&#x3D;10$æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¯„ä¼°$10000\\times10&#x3D;10^5$ä¸ªåºåˆ—ã€‚</p>\n<h3 id=\"æŸæœç´¢-1\"><a href=\"#æŸæœç´¢-1\" class=\"headerlink\" title=\"æŸæœç´¢\"></a>æŸæœç´¢</h3><p>æŸæœç´¢ï¼ˆbeam searchï¼‰æ˜¯å¯¹è´ªå©ªæœç´¢çš„ä¸€ä¸ªæ”¹è¿›ç®—æ³•ã€‚å®ƒæœ‰ä¸€ä¸ªæŸå®½ï¼ˆbeam sizeï¼‰è¶…å‚æ•°ã€‚æˆ‘ä»¬å°†å®ƒè®¾ä¸º$k$ã€‚åœ¨æ—¶é—´æ­¥1æ—¶ï¼Œé€‰å–å½“å‰æ—¶é—´æ­¥æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„$k$ä¸ªè¯ï¼Œåˆ†åˆ«ç»„æˆ$k$ä¸ªå€™é€‰è¾“å‡ºåºåˆ—çš„é¦–è¯ã€‚åœ¨ä¹‹åçš„æ¯ä¸ªæ—¶é—´æ­¥ï¼ŒåŸºäºä¸Šä¸ªæ—¶é—´æ­¥çš„$k$ä¸ªå€™é€‰è¾“å‡ºåºåˆ—ï¼Œä»$k\\left|\\mathcal{Y}\\right|$ä¸ªå¯èƒ½çš„è¾“å‡ºåºåˆ—ä¸­é€‰å–æ¡ä»¶æ¦‚ç‡æœ€å¤§çš„$k$ä¸ªï¼Œä½œä¸ºè¯¥æ—¶é—´æ­¥çš„å€™é€‰è¾“å‡ºåºåˆ—ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬ä»å„ä¸ªæ—¶é—´æ­¥çš„å€™é€‰è¾“å‡ºåºåˆ—ä¸­ç­›é€‰å‡ºåŒ…å«ç‰¹æ®Šç¬¦å·â€œ&lt;eos&gt;â€çš„åºåˆ—ï¼Œå¹¶å°†å®ƒä»¬ä¸­æ‰€æœ‰ç‰¹æ®Šç¬¦å·â€œ&lt;eos&gt;â€åé¢çš„å­åºåˆ—èˆå¼ƒï¼Œå¾—åˆ°æœ€ç»ˆå€™é€‰è¾“å‡ºåºåˆ—çš„é›†åˆã€‚</p>\n<div align=\"center\">\n<img width=\"500\" src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/10.10_beam_search.svg?raw=true\">\n</div>\n<div align=\"center\">å›¾10.11 æŸæœç´¢çš„è¿‡ç¨‹ã€‚æŸå®½ä¸º2ï¼Œè¾“å‡ºåºåˆ—æœ€å¤§é•¿åº¦ä¸º3ã€‚å€™é€‰è¾“å‡ºåºåˆ—æœ‰Aã€Cã€ABã€CEã€ABDå’ŒCED</div>\n\n<p>å›¾10.11é€šè¿‡ä¸€ä¸ªä¾‹å­æ¼”ç¤ºäº†æŸæœç´¢çš„è¿‡ç¨‹ã€‚å‡è®¾è¾“å‡ºåºåˆ—çš„è¯å…¸ä¸­åªåŒ…å«5ä¸ªå…ƒç´ ï¼Œå³$\\mathcal{Y} &#x3D; {A, B, C, D, E}$ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªä¸ºç‰¹æ®Šç¬¦å·â€œ&lt;eos&gt;â€ã€‚è®¾æŸæœç´¢çš„æŸå®½ç­‰äº2ï¼Œè¾“å‡ºåºåˆ—æœ€å¤§é•¿åº¦ä¸º3ã€‚åœ¨è¾“å‡ºåºåˆ—çš„æ—¶é—´æ­¥1æ—¶ï¼Œå‡è®¾æ¡ä»¶æ¦‚ç‡$P(y_1 \\mid \\boldsymbol{c})$æœ€å¤§çš„2ä¸ªè¯ä¸º$A$å’Œ$C$ã€‚æˆ‘ä»¬åœ¨æ—¶é—´æ­¥2æ—¶å°†å¯¹æ‰€æœ‰çš„$y_2 \\in \\mathcal{Y}$éƒ½åˆ†åˆ«è®¡ç®—$P(y_2 \\mid A, \\boldsymbol{c})$å’Œ$P(y_2 \\mid C, \\boldsymbol{c})$ï¼Œå¹¶ä»è®¡ç®—å‡ºçš„10ä¸ªæ¡ä»¶æ¦‚ç‡ä¸­å–æœ€å¤§çš„2ä¸ªï¼Œå‡è®¾ä¸º$P(B \\mid A, \\boldsymbol{c})$å’Œ$P(E \\mid C, \\boldsymbol{c})$ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨æ—¶é—´æ­¥3æ—¶å°†å¯¹æ‰€æœ‰çš„$y_3 \\in \\mathcal{Y}$éƒ½åˆ†åˆ«è®¡ç®—$P(y_3 \\mid A, B, \\boldsymbol{c})$å’Œ$P(y_3 \\mid C, E, \\boldsymbol{c})$ï¼Œå¹¶ä»è®¡ç®—å‡ºçš„10ä¸ªæ¡ä»¶æ¦‚ç‡ä¸­å–æœ€å¤§çš„2ä¸ªï¼Œå‡è®¾ä¸º$P(D \\mid A, B, \\boldsymbol{c})$å’Œ$P(D \\mid C, E, \\boldsymbol{c})$ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬å¾—åˆ°6ä¸ªå€™é€‰è¾“å‡ºåºåˆ—ï¼šï¼ˆ1ï¼‰$A$ï¼›ï¼ˆ2ï¼‰$C$ï¼›ï¼ˆ3ï¼‰$A$ã€$B$ï¼›ï¼ˆ4ï¼‰$C$ã€$E$ï¼›ï¼ˆ5ï¼‰$A$ã€$B$ã€$D$å’Œï¼ˆ6ï¼‰$C$ã€$E$ã€$D$ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ ¹æ®è¿™6ä¸ªåºåˆ—å¾—å‡ºæœ€ç»ˆå€™é€‰è¾“å‡ºåºåˆ—çš„é›†åˆã€‚</p>\n<p>åœ¨æœ€ç»ˆå€™é€‰è¾“å‡ºåºåˆ—çš„é›†åˆä¸­ï¼Œæˆ‘ä»¬å–ä»¥ä¸‹åˆ†æ•°æœ€é«˜çš„åºåˆ—ä½œä¸ºè¾“å‡ºåºåˆ—ï¼š</p>\n<p>$$ \\frac{1}{L^\\alpha} \\log P(y_1, \\ldots, y_{L}) &#x3D; \\frac{1}{L^\\alpha} \\sum_{tâ€™&#x3D;1}^L \\log P(y_{tâ€™} \\mid y_1, \\ldots, y_{tâ€™-1}, \\boldsymbol{c}),$$</p>\n<p>å…¶ä¸­$L$ä¸ºæœ€ç»ˆå€™é€‰åºåˆ—é•¿åº¦ï¼Œ$\\alpha$ä¸€èˆ¬å¯é€‰ä¸º0.75ã€‚åˆ†æ¯ä¸Šçš„$L^\\alpha$æ˜¯ä¸ºäº†æƒ©ç½šè¾ƒé•¿åºåˆ—åœ¨ä»¥ä¸Šåˆ†æ•°ä¸­è¾ƒå¤šçš„å¯¹æ•°ç›¸åŠ é¡¹ã€‚åˆ†æå¯çŸ¥ï¼ŒæŸæœç´¢çš„è®¡ç®—å¼€é”€ä¸º$\\mathcal{O}(k\\left|\\mathcal{Y}\\right|Tâ€™)$ã€‚è¿™ä»‹äºè´ªå©ªæœç´¢å’Œç©·ä¸¾æœç´¢çš„è®¡ç®—å¼€é”€ä¹‹é—´ã€‚æ­¤å¤–ï¼Œè´ªå©ªæœç´¢å¯çœ‹ä½œæ˜¯æŸå®½ä¸º1çš„æŸæœç´¢ã€‚æŸæœç´¢é€šè¿‡çµæ´»çš„æŸå®½$k$æ¥æƒè¡¡è®¡ç®—å¼€é”€å’Œæœç´¢è´¨é‡ã€‚</p>\n<h2 id=\"æ³¨æ„åŠ›æœºåˆ¶\"><a href=\"#æ³¨æ„åŠ›æœºåˆ¶\" class=\"headerlink\" title=\"æ³¨æ„åŠ›æœºåˆ¶\"></a>æ³¨æ„åŠ›æœºåˆ¶</h2><p>åœ¨ç¼–ç å™¨â€”è§£ç å™¨ï¼ˆseq2seqï¼‰é‡Œï¼Œè§£ç å™¨åœ¨å„ä¸ªæ—¶é—´æ­¥ä¾èµ–ç›¸åŒçš„èƒŒæ™¯å˜é‡æ¥è·å–è¾“å…¥åºåˆ—ä¿¡æ¯ã€‚å½“ç¼–ç å™¨ä¸ºå¾ªç¯ç¥ç»ç½‘ç»œæ—¶ï¼ŒèƒŒæ™¯å˜é‡æ¥è‡ªå®ƒæœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ã€‚</p>\n<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡æ€è€ƒé‚£ä¸€èŠ‚æåˆ°çš„ç¿»è¯‘ä¾‹å­ï¼šè¾“å…¥ä¸ºè‹±è¯­åºåˆ—â€œTheyâ€â€œareâ€â€œwatchingâ€â€œ.â€ï¼Œè¾“å‡ºä¸ºæ³•è¯­åºåˆ—â€œIlsâ€â€œregardentâ€â€œ.â€ã€‚ä¸éš¾æƒ³åˆ°ï¼Œè§£ç å™¨åœ¨ç”Ÿæˆè¾“å‡ºåºåˆ—ä¸­çš„æ¯ä¸€ä¸ªè¯æ—¶å¯èƒ½åªéœ€åˆ©ç”¨è¾“å…¥åºåˆ—æŸä¸€éƒ¨åˆ†çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨è¾“å‡ºåºåˆ—çš„æ—¶é—´æ­¥1ï¼Œè§£ç å™¨å¯ä»¥ä¸»è¦ä¾èµ–â€œTheyâ€â€œareâ€çš„ä¿¡æ¯æ¥ç”Ÿæˆâ€œIlsâ€ï¼Œåœ¨æ—¶é—´æ­¥2åˆ™ä¸»è¦ä½¿ç”¨æ¥è‡ªâ€œwatchingâ€çš„ç¼–ç ä¿¡æ¯ç”Ÿæˆâ€œregardentâ€ï¼Œæœ€ååœ¨æ—¶é—´æ­¥3åˆ™ç›´æ¥æ˜ å°„å¥å·â€œ.â€ã€‚è¿™çœ‹ä¸Šå»å°±åƒæ˜¯åœ¨è§£ç å™¨çš„æ¯ä¸€æ—¶é—´æ­¥å¯¹è¾“å…¥åºåˆ—ä¸­ä¸åŒæ—¶é—´æ­¥çš„è¡¨å¾æˆ–ç¼–ç ä¿¡æ¯åˆ†é…ä¸åŒçš„æ³¨æ„åŠ›ä¸€æ ·ã€‚è¿™ä¹Ÿæ˜¯æ³¨æ„åŠ›æœºåˆ¶çš„ç”±æ¥ã€‚</p>\n<p>ä»ç„¶ä»¥å¾ªç¯ç¥ç»ç½‘ç»œä¸ºä¾‹ï¼Œæ³¨æ„åŠ›æœºåˆ¶é€šè¿‡å¯¹ç¼–ç å™¨æ‰€æœ‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€åšåŠ æƒå¹³å‡æ¥å¾—åˆ°èƒŒæ™¯å˜é‡ã€‚è§£ç å™¨åœ¨æ¯ä¸€æ—¶é—´æ­¥è°ƒæ•´è¿™äº›æƒé‡ï¼Œå³æ³¨æ„åŠ›æƒé‡ï¼Œä»è€Œèƒ½å¤Ÿåœ¨ä¸åŒæ—¶é—´æ­¥åˆ†åˆ«å…³æ³¨è¾“å…¥åºåˆ—ä¸­çš„ä¸åŒéƒ¨åˆ†å¹¶ç¼–ç è¿›ç›¸åº”æ—¶é—´æ­¥çš„èƒŒæ™¯å˜é‡ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†è®¨è®ºæ³¨æ„åŠ›æœºåˆ¶æ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p>\n<p>$$\\boldsymbol{s}_{tâ€™} &#x3D; g(\\boldsymbol{y}_{tâ€™-1}, \\boldsymbol{c}_{tâ€™}, \\boldsymbol{s}_{tâ€™-1}).$$</p>\n<p>è¿™é‡Œçš„å…³é”®æ˜¯å¦‚ä½•è®¡ç®—èƒŒæ™¯å˜é‡$\\boldsymbol{c}_{tâ€™}$å’Œå¦‚ä½•åˆ©ç”¨å®ƒæ¥æ›´æ–°éšè—çŠ¶æ€$\\boldsymbol{s}_{tâ€™}$ã€‚ä¸‹é¢å°†åˆ†åˆ«æè¿°è¿™ä¸¤ä¸ªå…³é”®ç‚¹ã€‚</p>\n<h3 id=\"è®¡ç®—èƒŒæ™¯å˜é‡\"><a href=\"#è®¡ç®—èƒŒæ™¯å˜é‡\" class=\"headerlink\" title=\"è®¡ç®—èƒŒæ™¯å˜é‡\"></a>è®¡ç®—èƒŒæ™¯å˜é‡</h3><p>æˆ‘ä»¬å…ˆæè¿°ç¬¬ä¸€ä¸ªå…³é”®ç‚¹ï¼Œå³è®¡ç®—èƒŒæ™¯å˜é‡ã€‚å›¾10.12æç»˜äº†æ³¨æ„åŠ›æœºåˆ¶å¦‚ä½•ä¸ºè§£ç å™¨åœ¨æ—¶é—´æ­¥2è®¡ç®—èƒŒæ™¯å˜é‡ã€‚é¦–å…ˆï¼Œå‡½æ•°$a$æ ¹æ®è§£ç å™¨åœ¨æ—¶é—´æ­¥1çš„éšè—çŠ¶æ€å’Œç¼–ç å™¨åœ¨å„ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€è®¡ç®—softmaxè¿ç®—çš„è¾“å…¥ã€‚softmaxè¿ç®—è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒå¹¶å¯¹ç¼–ç å™¨å„ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€åšåŠ æƒå¹³å‡ï¼Œä»è€Œå¾—åˆ°èƒŒæ™¯å˜é‡ã€‚</p>\n<div align=\"center\">\n<img width=\"500\" src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/10.11_attention.svg?raw=true\">\n</div>\n<div align=\"center\">å›¾10.12 ç¼–ç å™¨â€”è§£ç å™¨ä¸Šçš„æ³¨æ„åŠ›æœºåˆ¶</div>\n\n\n<p>å…·ä½“æ¥è¯´ï¼Œä»¤ç¼–ç å™¨åœ¨æ—¶é—´æ­¥$t$çš„éšè—çŠ¶æ€ä¸º$\\boldsymbol{h}_t$ï¼Œä¸”æ€»æ—¶é—´æ­¥æ•°ä¸º$T$ã€‚é‚£ä¹ˆè§£ç å™¨åœ¨æ—¶é—´æ­¥$tâ€™$çš„èƒŒæ™¯å˜é‡ä¸ºæ‰€æœ‰ç¼–ç å™¨éšè—çŠ¶æ€çš„åŠ æƒå¹³å‡ï¼š</p>\n<p>$$<br>\\boldsymbol{c}_{tâ€™} &#x3D; \\sum_{t&#x3D;1}^T \\alpha_{tâ€™t} \\boldsymbol{h}_t,<br>$$</p>\n<p>å…¶ä¸­ç»™å®š$tâ€™$æ—¶ï¼Œæƒé‡$\\alpha_{tâ€™ t}$åœ¨$t&#x3D;1,\\ldots,T$çš„å€¼æ˜¯ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒã€‚ä¸ºäº†å¾—åˆ°æ¦‚ç‡åˆ†å¸ƒï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨softmaxè¿ç®—:</p>\n<p>$$<br>\\alpha_{tâ€™ t} &#x3D; \\frac{\\exp(e_{tâ€™ t})}{ \\sum_{k&#x3D;1}^T \\exp(e_{tâ€™ k}) },\\quad t&#x3D;1,\\ldots,T.<br>$$</p>\n<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰å¦‚ä½•è®¡ç®—ä¸Šå¼ä¸­softmaxè¿ç®—çš„è¾“å…¥$e_{tâ€™ t}$ã€‚ç”±äº$e_{tâ€™ t}$åŒæ—¶å–å†³äºè§£ç å™¨çš„æ—¶é—´æ­¥$tâ€™$å’Œç¼–ç å™¨çš„æ—¶é—´æ­¥$t$ï¼Œæˆ‘ä»¬ä¸å¦¨ä»¥è§£ç å™¨åœ¨æ—¶é—´æ­¥$tâ€™-1$çš„éšè—çŠ¶æ€$\\boldsymbol{s}_{tâ€™ - 1}$ä¸ç¼–ç å™¨åœ¨æ—¶é—´æ­¥$t$çš„éšè—çŠ¶æ€$\\boldsymbol{h}_t$ä¸ºè¾“å…¥ï¼Œå¹¶é€šè¿‡å‡½æ•°$a$è®¡ç®—$e_{tâ€™ t}$ï¼š</p>\n<p>$$<br>e_{tâ€™ t} &#x3D; a(\\boldsymbol{s}_{tâ€™ - 1}, \\boldsymbol{h}_t).<br>$$</p>\n<p>è¿™é‡Œå‡½æ•°$a$æœ‰å¤šç§é€‰æ‹©ï¼Œå¦‚æœä¸¤ä¸ªè¾“å…¥å‘é‡é•¿åº¦ç›¸åŒï¼Œä¸€ä¸ªç®€å•çš„é€‰æ‹©æ˜¯è®¡ç®—å®ƒä»¬çš„å†…ç§¯$a(\\boldsymbol{s}, \\boldsymbol{h})&#x3D;\\boldsymbol{s}^\\top \\boldsymbol{h}$ã€‚è€Œæœ€æ—©æå‡ºæ³¨æ„åŠ›æœºåˆ¶çš„è®ºæ–‡åˆ™å°†è¾“å…¥è¿ç»“åé€šè¿‡å«å•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºå˜æ¢ ï¼š</p>\n<p>$$<br>a(\\boldsymbol{s}, \\boldsymbol{h}) &#x3D; \\boldsymbol{v}^\\top \\tanh(\\boldsymbol{W}_s \\boldsymbol{s} + \\boldsymbol{W}_h \\boldsymbol{h}),<br>$$</p>\n<p>å…¶ä¸­$\\boldsymbol{v}$ã€$\\boldsymbol{W}_s$ã€$\\boldsymbol{W}_h$éƒ½æ˜¯å¯ä»¥å­¦ä¹ çš„æ¨¡å‹å‚æ•°ã€‚</p>\n<h4 id=\"çŸ¢é‡åŒ–è®¡ç®—\"><a href=\"#çŸ¢é‡åŒ–è®¡ç®—\" class=\"headerlink\" title=\"çŸ¢é‡åŒ–è®¡ç®—\"></a>çŸ¢é‡åŒ–è®¡ç®—</h4><p>æˆ‘ä»¬è¿˜å¯ä»¥å¯¹æ³¨æ„åŠ›æœºåˆ¶é‡‡ç”¨æ›´é«˜æ•ˆçš„çŸ¢é‡åŒ–è®¡ç®—ã€‚å¹¿ä¹‰ä¸Šï¼Œæ³¨æ„åŠ›æœºåˆ¶çš„è¾“å…¥åŒ…æ‹¬æŸ¥è¯¢é¡¹ä»¥åŠä¸€ä¸€å¯¹åº”çš„é”®é¡¹å’Œå€¼é¡¹ï¼Œå…¶ä¸­å€¼é¡¹æ˜¯éœ€è¦åŠ æƒå¹³å‡çš„ä¸€ç»„é¡¹ã€‚åœ¨åŠ æƒå¹³å‡ä¸­ï¼Œå€¼é¡¹çš„æƒé‡æ¥è‡ªæŸ¥è¯¢é¡¹ä»¥åŠä¸è¯¥å€¼é¡¹å¯¹åº”çš„é”®é¡¹çš„è®¡ç®—ã€‚</p>\n<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢é¡¹ä¸ºè§£ç å™¨çš„éšè—çŠ¶æ€ï¼Œé”®é¡¹å’Œå€¼é¡¹å‡ä¸ºç¼–ç å™¨çš„éšè—çŠ¶æ€ã€‚<br>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå¸¸è§çš„ç®€å•æƒ…å½¢ï¼Œå³ç¼–ç å™¨å’Œè§£ç å™¨çš„éšè—å•å…ƒä¸ªæ•°å‡ä¸º$h$ï¼Œä¸”å‡½æ•°$a(\\boldsymbol{s}, \\boldsymbol{h})&#x3D;\\boldsymbol{s}^\\top \\boldsymbol{h}$ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›æ ¹æ®è§£ç å™¨å•ä¸ªéšè—çŠ¶æ€$\\boldsymbol{s}_{tâ€™ - 1} \\in \\mathbb{R}^{h}$å’Œç¼–ç å™¨æ‰€æœ‰éšè—çŠ¶æ€$\\boldsymbol{h}_t \\in \\mathbb{R}^{h}, t &#x3D; 1,\\ldots,T$æ¥è®¡ç®—èƒŒæ™¯å‘é‡$\\boldsymbol{c}_{tâ€™}\\in \\mathbb{R}^{h}$ã€‚<br>æˆ‘ä»¬å¯ä»¥å°†æŸ¥è¯¢é¡¹çŸ©é˜µ$\\boldsymbol{Q} \\in \\mathbb{R}^{1 \\times h}$è®¾ä¸º$\\boldsymbol{s}_{tâ€™ - 1}^\\top$ï¼Œå¹¶ä»¤é”®é¡¹çŸ©é˜µ$\\boldsymbol{K} \\in \\mathbb{R}^{T \\times h}$å’Œå€¼é¡¹çŸ©é˜µ$\\boldsymbol{V} \\in \\mathbb{R}^{T \\times h}$ç›¸åŒä¸”ç¬¬$t$è¡Œå‡ä¸º$\\boldsymbol{h}_t^\\top$ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦é€šè¿‡çŸ¢é‡åŒ–è®¡ç®—</p>\n<p>$$\\text{softmax}(\\boldsymbol{Q}\\boldsymbol{K}^\\top)\\boldsymbol{V}$$</p>\n<p>å³å¯ç®—å‡ºè½¬ç½®åçš„èƒŒæ™¯å‘é‡$\\boldsymbol{c}_{tâ€™}^\\top$ã€‚å½“æŸ¥è¯¢é¡¹çŸ©é˜µ$\\boldsymbol{Q}$çš„è¡Œæ•°ä¸º$n$æ—¶ï¼Œä¸Šå¼å°†å¾—åˆ°$n$è¡Œçš„è¾“å‡ºçŸ©é˜µã€‚è¾“å‡ºçŸ©é˜µä¸æŸ¥è¯¢é¡¹çŸ©é˜µåœ¨ç›¸åŒè¡Œä¸Šä¸€ä¸€å¯¹åº”ã€‚</p>\n<h3 id=\"æ›´æ–°éšè—çŠ¶æ€\"><a href=\"#æ›´æ–°éšè—çŠ¶æ€\" class=\"headerlink\" title=\"æ›´æ–°éšè—çŠ¶æ€\"></a>æ›´æ–°éšè—çŠ¶æ€</h3><p>ç°åœ¨æˆ‘ä»¬æè¿°ç¬¬äºŒä¸ªå…³é”®ç‚¹ï¼Œå³æ›´æ–°éšè—çŠ¶æ€ã€‚ä»¥é—¨æ§å¾ªç¯å•å…ƒä¸ºä¾‹ï¼Œåœ¨è§£ç å™¨ä¸­æˆ‘ä»¬å¯ä»¥å¯¹6.7èŠ‚ï¼ˆé—¨æ§å¾ªç¯å•å…ƒï¼ˆGRUï¼‰ï¼‰ä¸­é—¨æ§å¾ªç¯å•å…ƒçš„è®¾è®¡ç¨ä½œä¿®æ”¹ï¼Œä»è€Œå˜æ¢ä¸Šä¸€æ—¶é—´æ­¥$tâ€™-1$çš„è¾“å‡º$\\boldsymbol{y}_{tâ€™-1}$ã€éšè—çŠ¶æ€$\\boldsymbol{s}_{tâ€™ - 1}$å’Œå½“å‰æ—¶é—´æ­¥$tâ€™$çš„å«æ³¨æ„åŠ›æœºåˆ¶çš„èƒŒæ™¯å˜é‡$\\boldsymbol{c}_{tâ€™}$ ã€‚è§£ç å™¨åœ¨æ—¶é—´æ­¥$tâ€™$çš„éšè—çŠ¶æ€ä¸º</p>\n<p>$$\\boldsymbol{s}_{tâ€™} &#x3D; \\boldsymbol{z}_{tâ€™} \\odot \\boldsymbol{s}_{tâ€™-1}  + (1 - \\boldsymbol{z}_{tâ€™}) \\odot \\tilde{\\boldsymbol{s}}_{tâ€™},$$</p>\n<p>å…¶ä¸­çš„é‡ç½®é—¨ã€æ›´æ–°é—¨å’Œå€™é€‰éšè—çŠ¶æ€åˆ†åˆ«ä¸º</p>\n<p>$$<br>\\begin{aligned}<br>\\boldsymbol{r}_{tâ€™} &amp;&#x3D; \\sigma(\\boldsymbol{W}_{yr} \\boldsymbol{y}_{tâ€™-1} + \\boldsymbol{W}_{sr} \\boldsymbol{s}_{tâ€™ - 1} + \\boldsymbol{W}_{cr} \\boldsymbol{c}_{tâ€™} + \\boldsymbol{b}_r),\\\\<br>\\boldsymbol{z}_{tâ€™} &amp;&#x3D; \\sigma(\\boldsymbol{W}_{yz} \\boldsymbol{y}_{tâ€™-1} + \\boldsymbol{W}_{sz} \\boldsymbol{s}_{tâ€™ - 1} + \\boldsymbol{W}_{cz} \\boldsymbol{c}_{tâ€™} + \\boldsymbol{b}_z),\\\\<br>\\tilde{\\boldsymbol{s}}_{tâ€™} &amp;&#x3D; \\text{tanh}(\\boldsymbol{W}_{ys} \\boldsymbol{y}_{tâ€™-1} + \\boldsymbol{W}_{ss} (\\boldsymbol{s}_{tâ€™ - 1} \\odot \\boldsymbol{r}_{tâ€™}) + \\boldsymbol{W}_{cs} \\boldsymbol{c}_{tâ€™} + \\boldsymbol{b}_s),<br>\\end{aligned}<br>$$</p>\n<p>å…¶ä¸­å«ä¸‹æ ‡çš„$\\boldsymbol{W}$å’Œ$\\boldsymbol{b}$åˆ†åˆ«ä¸ºé—¨æ§å¾ªç¯å•å…ƒçš„æƒé‡å‚æ•°å’Œåå·®å‚æ•°ã€‚</p>\n<h3 id=\"å‘å±•\"><a href=\"#å‘å±•\" class=\"headerlink\" title=\"å‘å±•\"></a>å‘å±•</h3><p>æœ¬è´¨ä¸Šï¼Œæ³¨æ„åŠ›æœºåˆ¶èƒ½å¤Ÿä¸ºè¡¨å¾ä¸­è¾ƒæœ‰ä»·å€¼çš„éƒ¨åˆ†åˆ†é…è¾ƒå¤šçš„è®¡ç®—èµ„æºã€‚è¿™ä¸ªæœ‰è¶£çš„æƒ³æ³•è‡ªæå‡ºåå¾—åˆ°äº†å¿«é€Ÿå‘å±•ï¼Œç‰¹åˆ«æ˜¯å¯å‘äº†ä¾é æ³¨æ„åŠ›æœºåˆ¶æ¥ç¼–ç è¾“å…¥åºåˆ—å¹¶è§£ç å‡ºè¾“å‡ºåºåˆ—çš„å˜æ¢å™¨ï¼ˆTransformerï¼‰æ¨¡å‹çš„è®¾è®¡ ã€‚å˜æ¢å™¨æŠ›å¼ƒäº†å·ç§¯ç¥ç»ç½‘ç»œå’Œå¾ªç¯ç¥ç»ç½‘ç»œçš„æ¶æ„ã€‚å®ƒåœ¨è®¡ç®—æ•ˆç‡ä¸Šæ¯”åŸºäºå¾ªç¯ç¥ç»ç½‘ç»œçš„ç¼–ç å™¨â€”è§£ç å™¨æ¨¡å‹é€šå¸¸æ›´å…·æ˜æ˜¾ä¼˜åŠ¿ã€‚å«æ³¨æ„åŠ›æœºåˆ¶çš„å˜æ¢å™¨çš„ç¼–ç ç»“æ„åœ¨åæ¥çš„BERTé¢„è®­ç»ƒæ¨¡å‹ä¸­å¾—ä»¥åº”ç”¨å¹¶ä»¤åè€…å¤§æ”¾å¼‚å½©ï¼šå¾®è°ƒåçš„æ¨¡å‹åœ¨å¤šè¾¾11é¡¹è‡ªç„¶è¯­è¨€å¤„ç†ä»»åŠ¡ä¸­å–å¾—äº†å½“æ—¶æœ€å…ˆè¿›çš„ç»“æœ ã€‚ä¸ä¹…åï¼ŒåŒæ ·æ˜¯åŸºäºå˜æ¢å™¨è®¾è®¡çš„GPT-2æ¨¡å‹äºæ–°æ”¶é›†çš„è¯­æ–™æ•°æ®é›†é¢„è®­ç»ƒåï¼Œåœ¨7ä¸ªæœªå‚ä¸è®­ç»ƒçš„è¯­è¨€æ¨¡å‹æ•°æ®é›†ä¸Šå‡å–å¾—äº†å½“æ—¶æœ€å…ˆè¿›çš„ç»“æœ ã€‚é™¤äº†è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸï¼Œæ³¨æ„åŠ›æœºåˆ¶è¿˜è¢«å¹¿æ³›ç”¨äºå›¾åƒåˆ†ç±»ã€è‡ªåŠ¨å›¾åƒæè¿°ã€å”‡è¯­è§£è¯»ä»¥åŠè¯­éŸ³è¯†åˆ«ã€‚</p>\n<h1 id=\"ä»£ç å®ç°\"><a href=\"#ä»£ç å®ç°\" class=\"headerlink\" title=\"ä»£ç å®ç°\"></a>ä»£ç å®ç°</h1><h2 id=\"è¯»å–å’Œé¢„å¤„ç†æ•°æ®\"><a href=\"#è¯»å–å’Œé¢„å¤„ç†æ•°æ®\" class=\"headerlink\" title=\"è¯»å–å’Œé¢„å¤„ç†æ•°æ®\"></a>è¯»å–å’Œé¢„å¤„ç†æ•°æ®</h2><p>æˆ‘ä»¬å…ˆå®šä¹‰ä¸€äº›ç‰¹æ®Šç¬¦å·ã€‚å…¶ä¸­â€œ&lt;pad&gt;â€ï¼ˆpaddingï¼‰ç¬¦å·ç”¨æ¥æ·»åŠ åœ¨è¾ƒçŸ­åºåˆ—åï¼Œç›´åˆ°æ¯ä¸ªåºåˆ—ç­‰é•¿ï¼Œè€Œâ€œ&lt;bos&gt;â€å’Œâ€œ&lt;eos&gt;â€ç¬¦å·åˆ†åˆ«è¡¨ç¤ºåºåˆ—çš„å¼€å§‹å’Œç»“æŸã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> collections</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> io</span><br><span class=\"line\"><span class=\"keyword\">import</span> math</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch</span><br><span class=\"line\"><span class=\"keyword\">from</span> torch <span class=\"keyword\">import</span> nn</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.nn.functional <span class=\"keyword\">as</span> F</span><br><span class=\"line\"><span class=\"keyword\">import</span> torchtext.vocab <span class=\"keyword\">as</span> Vocab</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.utils.data <span class=\"keyword\">as</span> Data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"comment\"># sys.path.append(&quot;..&quot;) </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> d2lzh_pytorch <span class=\"keyword\">as</span> d2l</span><br><span class=\"line\"></span><br><span class=\"line\">PAD, BOS, EOS = <span class=\"string\">&#x27;&lt;pad&gt;&#x27;</span>, <span class=\"string\">&#x27;&lt;bos&gt;&#x27;</span>, <span class=\"string\">&#x27;&lt;eos&gt;&#x27;</span></span><br><span class=\"line\">os.environ[<span class=\"string\">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\">device = torch.device(<span class=\"string\">&#x27;cuda&#x27;</span> <span class=\"keyword\">if</span> torch.cuda.is_available() <span class=\"keyword\">else</span> <span class=\"string\">&#x27;cpu&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(torch.__version__, device)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-2.png?raw=true\" alt=\"alt text\"></p>\n<p>æ¥ç€å®šä¹‰ä¸¤ä¸ªè¾…åŠ©å‡½æ•°å¯¹åé¢è¯»å–çš„æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># å°†ä¸€ä¸ªåºåˆ—ä¸­æ‰€æœ‰çš„è¯è®°å½•åœ¨all_tokensä¸­ä»¥ä¾¿ä¹‹åæ„é€ è¯å…¸ï¼Œç„¶ååœ¨è¯¥åºåˆ—åé¢æ·»åŠ PADç›´åˆ°åºåˆ—</span></span><br><span class=\"line\"><span class=\"comment\"># é•¿åº¦å˜ä¸ºmax_seq_lenï¼Œç„¶åå°†åºåˆ—ä¿å­˜åœ¨all_seqsä¸­</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">process_one_seq</span>(<span class=\"params\">seq_tokens, all_tokens, all_seqs, max_seq_len</span>):</span><br><span class=\"line\">    all_tokens.extend(seq_tokens)</span><br><span class=\"line\">    seq_tokens += [EOS] + [PAD] * (max_seq_len - <span class=\"built_in\">len</span>(seq_tokens) - <span class=\"number\">1</span>)</span><br><span class=\"line\">    all_seqs.append(seq_tokens)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨æ‰€æœ‰çš„è¯æ¥æ„é€ è¯å…¸ã€‚å¹¶å°†æ‰€æœ‰åºåˆ—ä¸­çš„è¯å˜æ¢ä¸ºè¯ç´¢å¼•åæ„é€ Tensor</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">build_data</span>(<span class=\"params\">all_tokens, all_seqs</span>):</span><br><span class=\"line\">    vocab = Vocab.Vocab(collections.Counter(all_tokens),</span><br><span class=\"line\">                        specials=[PAD, BOS, EOS])</span><br><span class=\"line\">    indices = [[vocab.stoi[w] <span class=\"keyword\">for</span> w <span class=\"keyword\">in</span> seq] <span class=\"keyword\">for</span> seq <span class=\"keyword\">in</span> all_seqs]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> vocab, torch.tensor(indices)</span><br></pre></td></tr></table></figure>\n<p>ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ä¸€ä¸ªå¾ˆå°çš„æ³•è¯­â€”è‹±è¯­æ•°æ®é›†ã€‚åœ¨è¿™ä¸ªæ•°æ®é›†é‡Œï¼Œæ¯ä¸€è¡Œæ˜¯ä¸€å¯¹æ³•è¯­å¥å­å’Œå®ƒå¯¹åº”çš„è‹±è¯­å¥å­ï¼Œä¸­é—´ä½¿ç”¨<code>&#39;\\t&#39;</code>éš”å¼€ã€‚åœ¨è¯»å–æ•°æ®æ—¶ï¼Œæˆ‘ä»¬åœ¨å¥æœ«é™„ä¸Šâ€œ&lt;eos&gt;â€ç¬¦å·ï¼Œå¹¶å¯èƒ½é€šè¿‡æ·»åŠ â€œ&lt;pad&gt;â€ç¬¦å·ä½¿æ¯ä¸ªåºåˆ—çš„é•¿åº¦å‡ä¸º<code>max_seq_len</code>ã€‚æˆ‘ä»¬ä¸ºæ³•è¯­è¯å’Œè‹±è¯­è¯åˆ†åˆ«åˆ›å»ºè¯å…¸ã€‚æ³•è¯­è¯çš„ç´¢å¼•å’Œè‹±è¯­è¯çš„ç´¢å¼•ç›¸äº’ç‹¬ç«‹ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">read_data</span>(<span class=\"params\">max_seq_len</span>):</span><br><span class=\"line\">    <span class=\"comment\"># inå’Œoutåˆ†åˆ«æ˜¯inputå’Œoutputçš„ç¼©å†™</span></span><br><span class=\"line\">    in_tokens, out_tokens, in_seqs, out_seqs = [], [], [], []</span><br><span class=\"line\">    <span class=\"keyword\">with</span> io.<span class=\"built_in\">open</span>(<span class=\"string\">&#x27;fr-en-small.txt&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        lines = f.readlines()</span><br><span class=\"line\">    <span class=\"keyword\">for</span> line <span class=\"keyword\">in</span> lines:</span><br><span class=\"line\">        in_seq, out_seq = line.rstrip().split(<span class=\"string\">&#x27;\\t&#x27;</span>)</span><br><span class=\"line\">        in_seq_tokens, out_seq_tokens = in_seq.split(<span class=\"string\">&#x27; &#x27;</span>), out_seq.split(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">max</span>(<span class=\"built_in\">len</span>(in_seq_tokens), <span class=\"built_in\">len</span>(out_seq_tokens)) &gt; max_seq_len - <span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>  <span class=\"comment\"># å¦‚æœåŠ ä¸ŠEOSåé•¿äºmax_seq_lenï¼Œåˆ™å¿½ç•¥æ‰æ­¤æ ·æœ¬</span></span><br><span class=\"line\">        process_one_seq(in_seq_tokens, in_tokens, in_seqs, max_seq_len)</span><br><span class=\"line\">        process_one_seq(out_seq_tokens, out_tokens, out_seqs, max_seq_len)</span><br><span class=\"line\">    in_vocab, in_data = build_data(in_tokens, in_seqs)</span><br><span class=\"line\">    out_vocab, out_data = build_data(out_tokens, out_seqs)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> in_vocab, out_vocab, Data.TensorDataset(in_data, out_data)</span><br></pre></td></tr></table></figure>\n<p>å°†åºåˆ—çš„æœ€å¤§é•¿åº¦è®¾æˆ7ï¼Œç„¶åæŸ¥çœ‹è¯»å–åˆ°çš„ç¬¬ä¸€ä¸ªæ ·æœ¬ã€‚è¯¥æ ·æœ¬åˆ†åˆ«åŒ…å«æ³•è¯­è¯ç´¢å¼•åºåˆ—å’Œè‹±è¯­è¯ç´¢å¼•åºåˆ—ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">max_seq_len = <span class=\"number\">7</span></span><br><span class=\"line\">in_vocab, out_vocab, dataset = read_data(max_seq_len)</span><br><span class=\"line\">dataset[<span class=\"number\">0</span>]</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-3.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"å«æ³¨æ„åŠ›æœºåˆ¶çš„ç¼–ç å™¨â€”è§£ç å™¨\"><a href=\"#å«æ³¨æ„åŠ›æœºåˆ¶çš„ç¼–ç å™¨â€”è§£ç å™¨\" class=\"headerlink\" title=\"å«æ³¨æ„åŠ›æœºåˆ¶çš„ç¼–ç å™¨â€”è§£ç å™¨\"></a>å«æ³¨æ„åŠ›æœºåˆ¶çš„ç¼–ç å™¨â€”è§£ç å™¨</h2><p>æˆ‘ä»¬å°†ä½¿ç”¨å«æ³¨æ„åŠ›æœºåˆ¶çš„ç¼–ç å™¨â€”è§£ç å™¨æ¥å°†ä¸€æ®µç®€çŸ­çš„æ³•è¯­ç¿»è¯‘æˆè‹±è¯­ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»æ¨¡å‹çš„å®ç°ã€‚</p>\n<h3 id=\"ç¼–ç å™¨-1\"><a href=\"#ç¼–ç å™¨-1\" class=\"headerlink\" title=\"ç¼–ç å™¨\"></a>ç¼–ç å™¨</h3><p>åœ¨ç¼–ç å™¨ä¸­ï¼Œæˆ‘ä»¬å°†è¾“å…¥è¯­è¨€çš„è¯ç´¢å¼•é€šè¿‡è¯åµŒå…¥å±‚å¾—åˆ°è¯çš„è¡¨å¾ï¼Œç„¶åè¾“å…¥åˆ°ä¸€ä¸ªå¤šå±‚é—¨æ§å¾ªç¯å•å…ƒä¸­ã€‚PyTorchçš„<code>nn.GRU</code>å®ä¾‹åœ¨å‰å‘è®¡ç®—åä¹Ÿä¼šåˆ†åˆ«è¿”å›è¾“å‡ºå’Œæœ€ç»ˆæ—¶é—´æ­¥çš„å¤šå±‚éšè—çŠ¶æ€ã€‚å…¶ä¸­çš„è¾“å‡ºæŒ‡çš„æ˜¯æœ€åä¸€å±‚çš„éšè—å±‚åœ¨å„ä¸ªæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ï¼Œå¹¶ä¸æ¶‰åŠè¾“å‡ºå±‚è®¡ç®—ã€‚æ³¨æ„åŠ›æœºåˆ¶å°†è¿™äº›è¾“å‡ºä½œä¸ºé”®é¡¹å’Œå€¼é¡¹ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Encoder</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, vocab_size, embed_size, num_hiddens, num_layers,</span></span><br><span class=\"line\"><span class=\"params\">                 drop_prob=<span class=\"number\">0</span>, **kwargs</span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Encoder, self).__init__(**kwargs)</span><br><span class=\"line\">        self.embedding = nn.Embedding(vocab_size, embed_size)</span><br><span class=\"line\">        self.rnn = nn.GRU(embed_size, num_hiddens, num_layers, dropout=drop_prob)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, inputs, state</span>):</span><br><span class=\"line\">        <span class=\"comment\"># è¾“å…¥å½¢çŠ¶æ˜¯(æ‰¹é‡å¤§å°, æ—¶é—´æ­¥æ•°)ã€‚å°†è¾“å‡ºäº’æ¢æ ·æœ¬ç»´å’Œæ—¶é—´æ­¥ç»´</span></span><br><span class=\"line\">        embedding = self.embedding(inputs.long()).permute(<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">2</span>) <span class=\"comment\"># (seq_len, batch, input_size)</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.rnn(embedding, state)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">begin_state</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">None</span></span><br></pre></td></tr></table></figure>\n<p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªæ‰¹é‡å¤§å°ä¸º4ã€æ—¶é—´æ­¥æ•°ä¸º7çš„å°æ‰¹é‡åºåˆ—è¾“å…¥ã€‚è®¾é—¨æ§å¾ªç¯å•å…ƒçš„éšè—å±‚ä¸ªæ•°ä¸º2ï¼Œéšè—å•å…ƒä¸ªæ•°ä¸º16ã€‚ç¼–ç å™¨å¯¹è¯¥è¾“å…¥æ‰§è¡Œå‰å‘è®¡ç®—åè¿”å›çš„è¾“å‡ºå½¢çŠ¶ä¸º(æ—¶é—´æ­¥æ•°, æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)ã€‚é—¨æ§å¾ªç¯å•å…ƒåœ¨æœ€ç»ˆæ—¶é—´æ­¥çš„å¤šå±‚éšè—çŠ¶æ€çš„å½¢çŠ¶ä¸º(éšè—å±‚ä¸ªæ•°, æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)ã€‚å¯¹äºé—¨æ§å¾ªç¯å•å…ƒæ¥è¯´ï¼Œ<code>state</code>å°±æ˜¯ä¸€ä¸ªå…ƒç´ ï¼Œå³éšè—çŠ¶æ€ï¼›å¦‚æœä½¿ç”¨é•¿çŸ­æœŸè®°å¿†ï¼Œ<code>state</code>æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«ä¸¤ä¸ªå…ƒç´ å³éšè—çŠ¶æ€å’Œè®°å¿†ç»†èƒã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">encoder = Encoder(vocab_size=<span class=\"number\">10</span>, embed_size=<span class=\"number\">8</span>, num_hiddens=<span class=\"number\">16</span>, num_layers=<span class=\"number\">2</span>)</span><br><span class=\"line\">output, state = encoder(torch.zeros((<span class=\"number\">4</span>, <span class=\"number\">7</span>)), encoder.begin_state())</span><br><span class=\"line\">output.shape, state.shape <span class=\"comment\"># GRUçš„stateæ˜¯h, è€ŒLSTMçš„æ˜¯ä¸€ä¸ªå…ƒç»„(h, c)</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-4.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"æ³¨æ„åŠ›æœºåˆ¶-1\"><a href=\"#æ³¨æ„åŠ›æœºåˆ¶-1\" class=\"headerlink\" title=\"æ³¨æ„åŠ›æœºåˆ¶\"></a>æ³¨æ„åŠ›æœºåˆ¶</h3><p>æˆ‘ä»¬å°†å®ç°æ³¨æ„åŠ›æœºåˆ¶ä¸­å®šä¹‰çš„å‡½æ•°$a$ï¼šå°†è¾“å…¥è¿ç»“åé€šè¿‡å«å•éšè—å±‚çš„å¤šå±‚æ„ŸçŸ¥æœºå˜æ¢ã€‚å…¶ä¸­éšè—å±‚çš„è¾“å…¥æ˜¯è§£ç å™¨çš„éšè—çŠ¶æ€ä¸ç¼–ç å™¨åœ¨æ‰€æœ‰æ—¶é—´æ­¥ä¸Šéšè—çŠ¶æ€çš„ä¸€ä¸€è¿ç»“ï¼Œä¸”ä½¿ç”¨tanhå‡½æ•°ä½œä¸ºæ¿€æ´»å‡½æ•°ã€‚è¾“å‡ºå±‚çš„è¾“å‡ºä¸ªæ•°ä¸º1ã€‚ä¸¤ä¸ª<code>Linear</code>å®ä¾‹å‡ä¸ä½¿ç”¨åå·®ã€‚å…¶ä¸­å‡½æ•°$a$å®šä¹‰é‡Œå‘é‡$\\boldsymbol{v}$çš„é•¿åº¦æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œå³<code>attention_size</code>ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">attention_model</span>(<span class=\"params\">input_size, attention_size</span>):</span><br><span class=\"line\">    model = nn.Sequential(nn.Linear(input_size, attention_size, bias=<span class=\"literal\">False</span>),</span><br><span class=\"line\">                          nn.Tanh(),</span><br><span class=\"line\">                          nn.Linear(attention_size, <span class=\"number\">1</span>, bias=<span class=\"literal\">False</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> model</span><br></pre></td></tr></table></figure>\n<p>æ³¨æ„åŠ›æœºåˆ¶çš„è¾“å…¥åŒ…æ‹¬æŸ¥è¯¢é¡¹ã€é”®é¡¹å’Œå€¼é¡¹ã€‚è®¾ç¼–ç å™¨å’Œè§£ç å™¨çš„éšè—å•å…ƒä¸ªæ•°ç›¸åŒã€‚è¿™é‡Œçš„æŸ¥è¯¢é¡¹ä¸ºè§£ç å™¨åœ¨ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ï¼Œå½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)ï¼›é”®é¡¹å’Œå€¼é¡¹å‡ä¸ºç¼–ç å™¨åœ¨æ‰€æœ‰æ—¶é—´æ­¥çš„éšè—çŠ¶æ€ï¼Œå½¢çŠ¶ä¸º(æ—¶é—´æ­¥æ•°, æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)ã€‚æ³¨æ„åŠ›æœºåˆ¶è¿”å›å½“å‰æ—¶é—´æ­¥çš„èƒŒæ™¯å˜é‡ï¼Œå½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">attention_forward</span>(<span class=\"params\">model, enc_states, dec_state</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    enc_states: (æ—¶é—´æ­¥æ•°, æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)</span></span><br><span class=\"line\"><span class=\"string\">    dec_state: (æ‰¹é‡å¤§å°, éšè—å•å…ƒä¸ªæ•°)</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># å°†è§£ç å™¨éšè—çŠ¶æ€å¹¿æ’­åˆ°å’Œç¼–ç å™¨éšè—çŠ¶æ€å½¢çŠ¶ç›¸åŒåè¿›è¡Œè¿ç»“</span></span><br><span class=\"line\">    dec_states = dec_state.unsqueeze(dim=<span class=\"number\">0</span>).expand_as(enc_states)</span><br><span class=\"line\">    enc_and_dec_states = torch.cat((enc_states, dec_states), dim=<span class=\"number\">2</span>)</span><br><span class=\"line\">    e = model(enc_and_dec_states)  <span class=\"comment\"># å½¢çŠ¶ä¸º(æ—¶é—´æ­¥æ•°, æ‰¹é‡å¤§å°, 1)</span></span><br><span class=\"line\">    alpha = F.softmax(e, dim=<span class=\"number\">0</span>)  <span class=\"comment\"># åœ¨æ—¶é—´æ­¥ç»´åº¦åšsoftmaxè¿ç®—</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> (alpha * enc_states).<span class=\"built_in\">sum</span>(dim=<span class=\"number\">0</span>)  <span class=\"comment\"># è¿”å›èƒŒæ™¯å˜é‡</span></span><br></pre></td></tr></table></figure>\n<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç¼–ç å™¨çš„æ—¶é—´æ­¥æ•°ä¸º10ï¼Œæ‰¹é‡å¤§å°ä¸º4ï¼Œç¼–ç å™¨å’Œè§£ç å™¨çš„éšè—å•å…ƒä¸ªæ•°å‡ä¸º8ã€‚æ³¨æ„åŠ›æœºåˆ¶è¿”å›ä¸€ä¸ªå°æ‰¹é‡çš„èƒŒæ™¯å‘é‡ï¼Œæ¯ä¸ªèƒŒæ™¯å‘é‡çš„é•¿åº¦ç­‰äºç¼–ç å™¨çš„éšè—å•å…ƒä¸ªæ•°ã€‚å› æ­¤è¾“å‡ºçš„å½¢çŠ¶ä¸º(4, 8)ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">seq_len, batch_size, num_hiddens = <span class=\"number\">10</span>, <span class=\"number\">4</span>, <span class=\"number\">8</span></span><br><span class=\"line\">model = attention_model(<span class=\"number\">2</span>*num_hiddens, <span class=\"number\">10</span>) </span><br><span class=\"line\">enc_states = torch.zeros((seq_len, batch_size, num_hiddens))</span><br><span class=\"line\">dec_state = torch.zeros((batch_size, num_hiddens))</span><br><span class=\"line\">attention_forward(model, enc_states, dec_state).shape</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-5.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"å«æ³¨æ„åŠ›æœºåˆ¶çš„è§£ç å™¨\"><a href=\"#å«æ³¨æ„åŠ›æœºåˆ¶çš„è§£ç å™¨\" class=\"headerlink\" title=\"å«æ³¨æ„åŠ›æœºåˆ¶çš„è§£ç å™¨\"></a>å«æ³¨æ„åŠ›æœºåˆ¶çš„è§£ç å™¨</h3><p>æˆ‘ä»¬ç›´æ¥å°†ç¼–ç å™¨åœ¨æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ä½œä¸ºè§£ç å™¨çš„åˆå§‹éšè—çŠ¶æ€ã€‚è¿™è¦æ±‚ç¼–ç å™¨å’Œè§£ç å™¨çš„å¾ªç¯ç¥ç»ç½‘ç»œä½¿ç”¨ç›¸åŒçš„éšè—å±‚ä¸ªæ•°å’Œéšè—å•å…ƒä¸ªæ•°ã€‚</p>\n<p>åœ¨è§£ç å™¨çš„å‰å‘è®¡ç®—ä¸­ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡åˆšåˆšä»‹ç»çš„æ³¨æ„åŠ›æœºåˆ¶è®¡ç®—å¾—åˆ°å½“å‰æ—¶é—´æ­¥çš„èƒŒæ™¯å‘é‡ã€‚ç”±äºè§£ç å™¨çš„è¾“å…¥æ¥è‡ªè¾“å‡ºè¯­è¨€çš„è¯ç´¢å¼•ï¼Œæˆ‘ä»¬å°†è¾“å…¥é€šè¿‡è¯åµŒå…¥å±‚å¾—åˆ°è¡¨å¾ï¼Œç„¶åå’ŒèƒŒæ™¯å‘é‡åœ¨ç‰¹å¾ç»´è¿ç»“ã€‚æˆ‘ä»¬å°†è¿ç»“åçš„ç»“æœä¸ä¸Šä¸€æ—¶é—´æ­¥çš„éšè—çŠ¶æ€é€šè¿‡é—¨æ§å¾ªç¯å•å…ƒè®¡ç®—å‡ºå½“å‰æ—¶é—´æ­¥çš„è¾“å‡ºä¸éšè—çŠ¶æ€ã€‚æœ€åï¼Œæˆ‘ä»¬å°†è¾“å‡ºé€šè¿‡å…¨è¿æ¥å±‚å˜æ¢ä¸ºæœ‰å…³å„ä¸ªè¾“å‡ºè¯çš„é¢„æµ‹ï¼Œå½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°, è¾“å‡ºè¯å…¸å¤§å°)ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Decoder</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, vocab_size, embed_size, num_hiddens, num_layers,</span></span><br><span class=\"line\"><span class=\"params\">                 attention_size, drop_prob=<span class=\"number\">0</span></span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Decoder, self).__init__()</span><br><span class=\"line\">        self.embedding = nn.Embedding(vocab_size, embed_size)</span><br><span class=\"line\">        self.attention = attention_model(<span class=\"number\">2</span>*num_hiddens, attention_size)</span><br><span class=\"line\">        <span class=\"comment\"># GRUçš„è¾“å…¥åŒ…å«attentionè¾“å‡ºçš„cå’Œå®é™…è¾“å…¥, æ‰€ä»¥å°ºå¯¸æ˜¯ num_hiddens+embed_size</span></span><br><span class=\"line\">        self.rnn = nn.GRU(num_hiddens + embed_size, num_hiddens, </span><br><span class=\"line\">                          num_layers, dropout=drop_prob)</span><br><span class=\"line\">        self.out = nn.Linear(num_hiddens, vocab_size)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, cur_input, state, enc_states</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        cur_input shape: (batch, )</span></span><br><span class=\"line\"><span class=\"string\">        state shape: (num_layers, batch, num_hiddens)</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># ä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶è®¡ç®—èƒŒæ™¯å‘é‡</span></span><br><span class=\"line\">        c = attention_forward(self.attention, enc_states, state[-<span class=\"number\">1</span>])</span><br><span class=\"line\">        <span class=\"comment\"># å°†åµŒå…¥åçš„è¾“å…¥å’ŒèƒŒæ™¯å‘é‡åœ¨ç‰¹å¾ç»´è¿ç»“, (æ‰¹é‡å¤§å°, num_hiddens+embed_size)</span></span><br><span class=\"line\">        input_and_c = torch.cat((self.embedding(cur_input), c), dim=<span class=\"number\">1</span>) </span><br><span class=\"line\">        <span class=\"comment\"># ä¸ºè¾“å…¥å’ŒèƒŒæ™¯å‘é‡çš„è¿ç»“å¢åŠ æ—¶é—´æ­¥ç»´ï¼Œæ—¶é—´æ­¥ä¸ªæ•°ä¸º1</span></span><br><span class=\"line\">        output, state = self.rnn(input_and_c.unsqueeze(<span class=\"number\">0</span>), state)</span><br><span class=\"line\">        <span class=\"comment\"># ç§»é™¤æ—¶é—´æ­¥ç»´ï¼Œè¾“å‡ºå½¢çŠ¶ä¸º(æ‰¹é‡å¤§å°, è¾“å‡ºè¯å…¸å¤§å°)</span></span><br><span class=\"line\">        output = self.out(output).squeeze(dim=<span class=\"number\">0</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> output, state</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">begin_state</span>(<span class=\"params\">self, enc_state</span>):</span><br><span class=\"line\">        <span class=\"comment\"># ç›´æ¥å°†ç¼–ç å™¨æœ€ç»ˆæ—¶é—´æ­¥çš„éšè—çŠ¶æ€ä½œä¸ºè§£ç å™¨çš„åˆå§‹éšè—çŠ¶æ€</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> enc_state</span><br></pre></td></tr></table></figure>\n<h2 id=\"è®­ç»ƒæ¨¡å‹-1\"><a href=\"#è®­ç»ƒæ¨¡å‹-1\" class=\"headerlink\" title=\"è®­ç»ƒæ¨¡å‹\"></a>è®­ç»ƒæ¨¡å‹</h2><p>æˆ‘ä»¬å…ˆå®ç°<code>batch_loss</code>å‡½æ•°è®¡ç®—ä¸€ä¸ªå°æ‰¹é‡çš„æŸå¤±ã€‚è§£ç å™¨åœ¨æœ€åˆæ—¶é—´æ­¥çš„è¾“å…¥æ˜¯ç‰¹æ®Šå­—ç¬¦<code>BOS</code>ã€‚ä¹‹åï¼Œè§£ç å™¨åœ¨æŸæ—¶é—´æ­¥çš„è¾“å…¥ä¸ºæ ·æœ¬è¾“å‡ºåºåˆ—åœ¨ä¸Šä¸€æ—¶é—´æ­¥çš„è¯ï¼Œå³å¼ºåˆ¶æ•™å­¦ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œç”¨æ©ç å˜é‡é¿å…å¡«å……é¡¹å¯¹æŸå¤±å‡½æ•°è®¡ç®—çš„å½±å“ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">batch_loss</span>(<span class=\"params\">encoder, decoder, X, Y, loss</span>):</span><br><span class=\"line\">    batch_size = X.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\">    enc_state = encoder.begin_state()</span><br><span class=\"line\">    enc_outputs, enc_state = encoder(X, enc_state)</span><br><span class=\"line\">    <span class=\"comment\"># åˆå§‹åŒ–è§£ç å™¨çš„éšè—çŠ¶æ€</span></span><br><span class=\"line\">    dec_state = decoder.begin_state(enc_state)</span><br><span class=\"line\">    <span class=\"comment\"># è§£ç å™¨åœ¨æœ€åˆæ—¶é—´æ­¥çš„è¾“å…¥æ˜¯BOS</span></span><br><span class=\"line\">    dec_input = torch.tensor([out_vocab.stoi[BOS]] * batch_size)</span><br><span class=\"line\">    <span class=\"comment\"># æˆ‘ä»¬å°†ä½¿ç”¨æ©ç å˜é‡maskæ¥å¿½ç•¥æ‰æ ‡ç­¾ä¸ºå¡«å……é¡¹PADçš„æŸå¤±, åˆå§‹å…¨1</span></span><br><span class=\"line\">    mask, num_not_pad_tokens = torch.ones(batch_size,), <span class=\"number\">0</span></span><br><span class=\"line\">    l = torch.tensor([<span class=\"number\">0.0</span>])</span><br><span class=\"line\">    <span class=\"keyword\">for</span> y <span class=\"keyword\">in</span> Y.permute(<span class=\"number\">1</span>,<span class=\"number\">0</span>): <span class=\"comment\"># Y shape: (batch, seq_len)</span></span><br><span class=\"line\">        dec_output, dec_state = decoder(dec_input, dec_state, enc_outputs)</span><br><span class=\"line\">        l = l + (mask * loss(dec_output, y)).<span class=\"built_in\">sum</span>()</span><br><span class=\"line\">        dec_input = y  <span class=\"comment\"># ä½¿ç”¨å¼ºåˆ¶æ•™å­¦</span></span><br><span class=\"line\">        num_not_pad_tokens += mask.<span class=\"built_in\">sum</span>().item()</span><br><span class=\"line\">        <span class=\"comment\"># EOSåé¢å…¨æ˜¯PAD. ä¸‹é¢ä¸€è¡Œä¿è¯ä¸€æ—¦é‡åˆ°EOSæ¥ä¸‹æ¥çš„å¾ªç¯ä¸­maskå°±ä¸€ç›´æ˜¯0</span></span><br><span class=\"line\">        mask = mask * (y != out_vocab.stoi[EOS]).<span class=\"built_in\">float</span>()</span><br><span class=\"line\">    <span class=\"keyword\">return</span> l / num_not_pad_tokens</span><br></pre></td></tr></table></figure>\n<p>åœ¨è®­ç»ƒå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶è¿­ä»£ç¼–ç å™¨å’Œè§£ç å™¨çš„æ¨¡å‹å‚æ•°ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">train</span>(<span class=\"params\">encoder, decoder, dataset, lr, batch_size, num_epochs</span>):</span><br><span class=\"line\">    enc_optimizer = torch.optim.Adam(encoder.parameters(), lr=lr)</span><br><span class=\"line\">    dec_optimizer = torch.optim.Adam(decoder.parameters(), lr=lr)</span><br><span class=\"line\"></span><br><span class=\"line\">    loss = nn.CrossEntropyLoss(reduction=<span class=\"string\">&#x27;none&#x27;</span>)</span><br><span class=\"line\">    data_iter = Data.DataLoader(dataset, batch_size, shuffle=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> epoch <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(num_epochs):</span><br><span class=\"line\">        l_sum = <span class=\"number\">0.0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> X, Y <span class=\"keyword\">in</span> data_iter:</span><br><span class=\"line\">            enc_optimizer.zero_grad()</span><br><span class=\"line\">            dec_optimizer.zero_grad()</span><br><span class=\"line\">            l = batch_loss(encoder, decoder, X, Y, loss)</span><br><span class=\"line\">            l.backward()</span><br><span class=\"line\">            enc_optimizer.step()</span><br><span class=\"line\">            dec_optimizer.step()</span><br><span class=\"line\">            l_sum += l.item()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (epoch + <span class=\"number\">1</span>) % <span class=\"number\">10</span> == <span class=\"number\">0</span>:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;epoch %d, loss %.3f&quot;</span> % (epoch + <span class=\"number\">1</span>, l_sum / <span class=\"built_in\">len</span>(data_iter)))</span><br></pre></td></tr></table></figure>\n<p>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºæ¨¡å‹å®ä¾‹å¹¶è®¾ç½®è¶…å‚æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®­ç»ƒæ¨¡å‹äº†ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">embed_size, num_hiddens, num_layers = <span class=\"number\">64</span>, <span class=\"number\">64</span>, <span class=\"number\">2</span></span><br><span class=\"line\">attention_size, drop_prob, lr, batch_size, num_epochs = <span class=\"number\">10</span>, <span class=\"number\">0.5</span>, <span class=\"number\">0.01</span>, <span class=\"number\">2</span>, <span class=\"number\">50</span></span><br><span class=\"line\">encoder = Encoder(<span class=\"built_in\">len</span>(in_vocab), embed_size, num_hiddens, num_layers,</span><br><span class=\"line\">                  drop_prob)</span><br><span class=\"line\">decoder = Decoder(<span class=\"built_in\">len</span>(out_vocab), embed_size, num_hiddens, num_layers,</span><br><span class=\"line\">                  attention_size, drop_prob)</span><br><span class=\"line\">train(encoder, decoder, dataset, lr, batch_size, num_epochs)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-6.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"é¢„æµ‹ä¸å®šé•¿çš„åºåˆ—\"><a href=\"#é¢„æµ‹ä¸å®šé•¿çš„åºåˆ—\" class=\"headerlink\" title=\"é¢„æµ‹ä¸å®šé•¿çš„åºåˆ—\"></a>é¢„æµ‹ä¸å®šé•¿çš„åºåˆ—</h2><p>åœ¨æŸæœç´¢ä¸­æˆ‘ä»¬ä»‹ç»äº†3ç§æ–¹æ³•æ¥ç”Ÿæˆè§£ç å™¨åœ¨æ¯ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºã€‚è¿™é‡Œæˆ‘ä»¬å®ç°æœ€ç®€å•çš„è´ªå©ªæœç´¢ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">translate</span>(<span class=\"params\">encoder, decoder, input_seq, max_seq_len</span>):</span><br><span class=\"line\">    in_tokens = input_seq.split(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    in_tokens += [EOS] + [PAD] * (max_seq_len - <span class=\"built_in\">len</span>(in_tokens) - <span class=\"number\">1</span>)</span><br><span class=\"line\">    enc_input = torch.tensor([[in_vocab.stoi[tk] <span class=\"keyword\">for</span> tk <span class=\"keyword\">in</span> in_tokens]]) <span class=\"comment\"># batch=1</span></span><br><span class=\"line\">    enc_state = encoder.begin_state()</span><br><span class=\"line\">    enc_output, enc_state = encoder(enc_input, enc_state)</span><br><span class=\"line\">    dec_input = torch.tensor([out_vocab.stoi[BOS]])</span><br><span class=\"line\">    dec_state = decoder.begin_state(enc_state)</span><br><span class=\"line\">    output_tokens = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> _ <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(max_seq_len):</span><br><span class=\"line\">        dec_output, dec_state = decoder(dec_input, dec_state, enc_output)</span><br><span class=\"line\">        pred = dec_output.argmax(dim=<span class=\"number\">1</span>)</span><br><span class=\"line\">        pred_token = out_vocab.itos[<span class=\"built_in\">int</span>(pred.item())]</span><br><span class=\"line\">        <span class=\"keyword\">if</span> pred_token == EOS:  <span class=\"comment\"># å½“ä»»ä¸€æ—¶é—´æ­¥æœç´¢å‡ºEOSæ—¶ï¼Œè¾“å‡ºåºåˆ—å³å®Œæˆ</span></span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            output_tokens.append(pred_token)</span><br><span class=\"line\">            dec_input = pred</span><br><span class=\"line\">    <span class=\"keyword\">return</span> output_tokens</span><br></pre></td></tr></table></figure>\n<p>ç®€å•æµ‹è¯•ä¸€ä¸‹æ¨¡å‹ã€‚è¾“å…¥æ³•è¯­å¥å­â€œils regardent.â€ï¼Œç¿»è¯‘åçš„è‹±è¯­å¥å­åº”è¯¥æ˜¯â€œthey are watching.â€ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">input_seq = <span class=\"string\">&#x27;ils regardent .&#x27;</span></span><br><span class=\"line\">translate(encoder, decoder, input_seq, max_seq_len)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-7.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"è¯„ä»·ç¿»è¯‘ç»“æœ\"><a href=\"#è¯„ä»·ç¿»è¯‘ç»“æœ\" class=\"headerlink\" title=\"è¯„ä»·ç¿»è¯‘ç»“æœ\"></a>è¯„ä»·ç¿»è¯‘ç»“æœ</h2><p>è¯„ä»·æœºå™¨ç¿»è¯‘ç»“æœé€šå¸¸ä½¿ç”¨BLEUï¼ˆBilingual Evaluation Understudyï¼‰[1]ã€‚å¯¹äºæ¨¡å‹é¢„æµ‹åºåˆ—ä¸­ä»»æ„çš„å­åºåˆ—ï¼ŒBLEUè€ƒå¯Ÿè¿™ä¸ªå­åºåˆ—æ˜¯å¦å‡ºç°åœ¨æ ‡ç­¾åºåˆ—ä¸­ã€‚</p>\n<p>å…·ä½“æ¥è¯´ï¼Œè®¾è¯æ•°ä¸º$n$çš„å­åºåˆ—çš„ç²¾åº¦ä¸º$p_n$ã€‚å®ƒæ˜¯é¢„æµ‹åºåˆ—ä¸æ ‡ç­¾åºåˆ—åŒ¹é…è¯æ•°ä¸º$n$çš„å­åºåˆ—çš„æ•°é‡ä¸é¢„æµ‹åºåˆ—ä¸­è¯æ•°ä¸º$n$çš„å­åºåˆ—çš„æ•°é‡ä¹‹æ¯”ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ ‡ç­¾åºåˆ—ä¸º$A$ã€$B$ã€$C$ã€$D$ã€$E$ã€$F$ï¼Œé¢„æµ‹åºåˆ—ä¸º$A$ã€$B$ã€$B$ã€$C$ã€$D$ï¼Œé‚£ä¹ˆ$p_1 &#x3D; 4&#x2F;5, p_2 &#x3D; 3&#x2F;4, p_3 &#x3D; 1&#x2F;3, p_4 &#x3D; 0$ã€‚è®¾$len_{\\text{label}}$å’Œ$len_{\\text{pred}}$åˆ†åˆ«ä¸ºæ ‡ç­¾åºåˆ—å’Œé¢„æµ‹åºåˆ—çš„è¯æ•°ï¼Œé‚£ä¹ˆï¼ŒBLEUçš„å®šä¹‰ä¸º</p>\n<p>$$ \\exp\\left(\\min\\left(0, 1 - \\frac{len_{\\text{label}}}{len_{\\text{pred}}}\\right)\\right) \\prod_{n&#x3D;1}^k p_n^{1&#x2F;2^n},$$</p>\n<p>å…¶ä¸­$k$æ˜¯æˆ‘ä»¬å¸Œæœ›åŒ¹é…çš„å­åºåˆ—çš„æœ€å¤§è¯æ•°ã€‚å¯ä»¥çœ‹åˆ°å½“é¢„æµ‹åºåˆ—å’Œæ ‡ç­¾åºåˆ—å®Œå…¨ä¸€è‡´æ—¶ï¼ŒBLEUä¸º1ã€‚</p>\n<p>å› ä¸ºåŒ¹é…è¾ƒé•¿å­åºåˆ—æ¯”åŒ¹é…è¾ƒçŸ­å­åºåˆ—æ›´éš¾ï¼ŒBLEUå¯¹åŒ¹é…è¾ƒé•¿å­åºåˆ—çš„ç²¾åº¦èµ‹äºˆäº†æ›´å¤§æƒé‡ã€‚ä¾‹å¦‚ï¼Œå½“$p_n$å›ºå®šåœ¨0.5æ—¶ï¼Œéšç€$n$çš„å¢å¤§ï¼Œ$0.5^{1&#x2F;2} \\approx 0.7, 0.5^{1&#x2F;4} \\approx 0.84, 0.5^{1&#x2F;8} \\approx 0.92, 0.5^{1&#x2F;16} \\approx 0.96$ã€‚å¦å¤–ï¼Œæ¨¡å‹é¢„æµ‹è¾ƒçŸ­åºåˆ—å¾€å¾€ä¼šå¾—åˆ°è¾ƒé«˜$p_n$å€¼ã€‚å› æ­¤ï¼Œä¸Šå¼ä¸­è¿ä¹˜é¡¹å‰é¢çš„ç³»æ•°æ˜¯ä¸ºäº†æƒ©ç½šè¾ƒçŸ­çš„è¾“å‡ºè€Œè®¾çš„ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“$k&#x3D;2$æ—¶ï¼Œå‡è®¾æ ‡ç­¾åºåˆ—ä¸º$A$ã€$B$ã€$C$ã€$D$ã€$E$ã€$F$ï¼Œè€Œé¢„æµ‹åºåˆ—ä¸º$A$ã€$B$ã€‚è™½ç„¶$p_1 &#x3D; p_2 &#x3D; 1$ï¼Œä½†æƒ©ç½šç³»æ•°$\\exp(1-6&#x2F;2) \\approx 0.14$ï¼Œå› æ­¤BLEUä¹Ÿæ¥è¿‘0.14ã€‚</p>\n<p>ä¸‹é¢æ¥å®ç°BLEUçš„è®¡ç®—ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">bleu</span>(<span class=\"params\">pred_tokens, label_tokens, k</span>):</span><br><span class=\"line\">    len_pred, len_label = <span class=\"built_in\">len</span>(pred_tokens), <span class=\"built_in\">len</span>(label_tokens)</span><br><span class=\"line\">    score = math.exp(<span class=\"built_in\">min</span>(<span class=\"number\">0</span>, <span class=\"number\">1</span> - len_label / len_pred))</span><br><span class=\"line\">    <span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>, k + <span class=\"number\">1</span>):</span><br><span class=\"line\">        num_matches, label_subs = <span class=\"number\">0</span>, collections.defaultdict(<span class=\"built_in\">int</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(len_label - n + <span class=\"number\">1</span>):</span><br><span class=\"line\">            label_subs[<span class=\"string\">&#x27;&#x27;</span>.join(label_tokens[i: i + n])] += <span class=\"number\">1</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(len_pred - n + <span class=\"number\">1</span>):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> label_subs[<span class=\"string\">&#x27;&#x27;</span>.join(pred_tokens[i: i + n])] &gt; <span class=\"number\">0</span>:</span><br><span class=\"line\">                num_matches += <span class=\"number\">1</span></span><br><span class=\"line\">                label_subs[<span class=\"string\">&#x27;&#x27;</span>.join(pred_tokens[i: i + n])] -= <span class=\"number\">1</span></span><br><span class=\"line\">        score *= math.<span class=\"built_in\">pow</span>(num_matches / (len_pred - n + <span class=\"number\">1</span>), math.<span class=\"built_in\">pow</span>(<span class=\"number\">0.5</span>, n))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> score</span><br></pre></td></tr></table></figure>\n<p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€ä¸ªè¾…åŠ©æ‰“å°å‡½æ•°ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">score</span>(<span class=\"params\">input_seq, label_seq, k</span>):</span><br><span class=\"line\">    pred_tokens = translate(encoder, decoder, input_seq, max_seq_len)</span><br><span class=\"line\">    label_tokens = label_seq.split(<span class=\"string\">&#x27; &#x27;</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;bleu %.3f, predict: %s&#x27;</span> % (bleu(pred_tokens, label_tokens, k),</span><br><span class=\"line\">                                      <span class=\"string\">&#x27; &#x27;</span>.join(pred_tokens)))</span><br></pre></td></tr></table></figure>\n<p>é¢„æµ‹æ­£ç¡®åˆ™åˆ†æ•°ä¸º1ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">score(<span class=\"string\">&#x27;ils regardent .&#x27;</span>, <span class=\"string\">&#x27;they are watching .&#x27;</span>, k=<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-8.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">score(<span class=\"string\">&#x27;ils sont canadienne .&#x27;</span>, <span class=\"string\">&#x27;they are canadian .&#x27;</span>, k=<span class=\"number\">2</span>)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13-9.png?raw=true\" alt=\"alt text\"></p>\n","categories":["Deep Learning"]},{"title":"åŸºäºtransformerå’Œpytorchçš„ä¸­æ—¥æœºå™¨ç¿»è¯‘æ¨¡å‹","url":"/2024/06/24/lab14/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"èƒŒæ™¯çŸ¥è¯†\"><a href=\"#èƒŒæ™¯çŸ¥è¯†\" class=\"headerlink\" title=\"èƒŒæ™¯çŸ¥è¯†\"></a>èƒŒæ™¯çŸ¥è¯†</h1><h2 id=\"æ³¨æ„åŠ›æœºåˆ¶\"><a href=\"#æ³¨æ„åŠ›æœºåˆ¶\" class=\"headerlink\" title=\"æ³¨æ„åŠ›æœºåˆ¶\"></a>æ³¨æ„åŠ›æœºåˆ¶</h2><p>æœ¬ç¯‡ç« å°†ä»attentionå¼€å§‹ï¼Œé€æ­¥å¯¹Transformerç»“æ„æ‰€æ¶‰åŠçš„çŸ¥è¯†è¿›è¡Œæ·±å…¥è®²è§£ï¼Œå¸Œæœ›èƒ½ç»™è¯»è€…ä»¥å½¢è±¡ç”ŸåŠ¨çš„æè¿°ã€‚</p>\n<p>é—®é¢˜ï¼šAttentionå‡ºç°çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ<br>æ½œåœ¨çš„ç­”æ¡ˆï¼šåŸºäºå¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ä¸€ç±»çš„seq2seqæ¨¡å‹ï¼Œåœ¨å¤„ç†é•¿æ–‡æœ¬æ—¶é‡åˆ°äº†æŒ‘æˆ˜ï¼Œè€Œå¯¹é•¿æ–‡æœ¬ä¸­ä¸åŒä½ç½®çš„ä¿¡æ¯è¿›è¡Œattentionæœ‰åŠ©äºæå‡RNNçš„æ¨¡å‹æ•ˆæœã€‚</p>\n<p>äºæ˜¯å­¦ä¹ çš„é—®é¢˜å°±æ‹†è§£ä¸ºï¼š1. ä»€ä¹ˆæ˜¯seq2seqæ¨¡å‹ï¼Ÿ2. åŸºäºRNNçš„seq2seqæ¨¡å‹å¦‚ä½•å¤„ç†æ–‡æœ¬&#x2F;é•¿æ–‡æœ¬åºåˆ—ï¼Ÿ3. seq2seqæ¨¡å‹å¤„ç†é•¿æ–‡æœ¬åºåˆ—æ—¶é‡åˆ°äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ4.åŸºäºRNNçš„seq2seqæ¨¡å‹å¦‚ä½•ç»“åˆattentionæ¥æ”¹å–„æ¨¡å‹æ•ˆæœï¼Ÿ</p>\n<span id=\"more\"></span>\n<h3 id=\"seq2seqæ¡†æ¶\"><a href=\"#seq2seqæ¡†æ¶\" class=\"headerlink\" title=\"seq2seqæ¡†æ¶\"></a>seq2seqæ¡†æ¶</h3><p>seq2seqæ˜¯ä¸€ç§å¸¸è§çš„NLPæ¨¡å‹ç»“æ„ï¼Œå…¨ç§°æ˜¯ï¼šsequence to sequenceï¼Œç¿»è¯‘ä¸ºâ€œåºåˆ—åˆ°åºåˆ—â€ã€‚é¡¾åæ€ä¹‰ï¼šä»ä¸€ä¸ªæ–‡æœ¬åºåˆ—å¾—åˆ°ä¸€ä¸ªæ–°çš„æ–‡æœ¬åºåˆ—ã€‚å…¸å‹çš„ä»»åŠ¡æœ‰ï¼šæœºå™¨ç¿»è¯‘ä»»åŠ¡ï¼Œæ–‡æœ¬æ‘˜è¦ä»»åŠ¡ã€‚è°·æ­Œç¿»è¯‘åœ¨2016å¹´æœ«å¼€å§‹ä½¿ç”¨seq2seqæ¨¡å‹ï¼Œå¹¶å‘è¡¨äº†2ç¯‡å¼€åˆ›æ€§çš„è®ºæ–‡ï¼š<a href=\"https://papers.nips.cc/paper/5346-sequence-to-sequence-learning-with-neural-networks.pdf\">Sutskeverç­‰2014å¹´å‘è¡¨çš„Sequence to Sequence Learning with Neural Networks</a>å’Œ<a href=\"http://emnlp2014.org/papers/pdf/EMNLP2014179.pdf\">Choç­‰2014å¹´å‘è¡¨çš„Learning Phrase Representations using RNN Encoderâ€“Decoder<br>for Statistical Machine Translation</a>ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯»åŸæ–‡è¿›è¡Œå­¦ä¹ ã€‚</p>\n<p>æ— è®ºè¯»è€…æ˜¯å¦è¯»è¿‡ä¸Šè¿°ä¸¤ç¯‡è°·æ­Œçš„æ–‡ç« ï¼ŒNLPåˆå­¦è€…æƒ³è¦å……åˆ†ç†è§£å¹¶å®ç°seq2seqæ¨¡å‹å¾ˆä¸å®¹æ˜“ã€‚å› ä¸ºï¼Œæˆ‘ä»¬éœ€è¦æ‹†è§£ä¸€ç³»åˆ—ç›¸å…³çš„NLPæ¦‚å¿µï¼Œè€Œè¿™äº›NLPæ¦‚å¿µåˆæ˜¯æ˜¯å±‚å±‚é€’è¿›çš„ï¼Œæ‰€ä»¥æƒ³è¦æ¸…æ™°çš„å¯¹seq2seqæ¨¡å‹æœ‰ä¸€ä¸ªæ¸…æ™°çš„è®¤è¯†å¹¶ä¸å®¹æ˜“ã€‚ä½†æ˜¯ï¼Œå¦‚æœèƒ½å¤ŸæŠŠè¿™äº›å¤æ‚ç”Ÿæ¶©çš„NLPæ¦‚å¿µå¯è§†åŒ–ï¼Œç†è§£èµ·æ¥å…¶å®å°±æ›´ç®€å•äº†ã€‚å› æ­¤ï¼Œæœ¬æ–‡å¸Œæœ›é€šè¿‡ä¸€ç³»åˆ—å›¾ç‰‡ã€åŠ¨æ€å›¾å¸®åŠ©NLPåˆå­¦è€…å­¦ä¹ seq2seqä»¥åŠattentionç›¸å…³çš„æ¦‚å¿µå’ŒçŸ¥è¯†ã€‚</p>\n<p>é¦–å…ˆçœ‹seq2seqå¹²äº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿseq2seqæ¨¡å‹çš„è¾“å…¥å¯ä»¥æ˜¯ä¸€ä¸ªï¼ˆå•è¯ã€å­—æ¯æˆ–è€…å›¾åƒç‰¹å¾ï¼‰åºåˆ—ï¼Œè¾“å‡ºæ˜¯å¦å¤–ä¸€ä¸ªï¼ˆå•è¯ã€å­—æ¯æˆ–è€…å›¾åƒç‰¹å¾ï¼‰åºåˆ—ã€‚ä¸€ä¸ªè®­ç»ƒå¥½çš„seq2seqæ¨¡å‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆæ³¨é‡Šï¼šå°†é¼ æ ‡æ”¾åœ¨å›¾ä¸Šï¼Œå›¾å°±ä¼šåŠ¨èµ·æ¥ï¼‰ï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-seq2seq.gif?raw=true\" alt=\"seq2seq\">åŠ¨æ€å›¾ï¼šseq2seq</p>\n<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä»¥NLPä¸­çš„æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸ºä¾‹ï¼Œåºåˆ—æŒ‡çš„æ˜¯ä¸€è¿ä¸²çš„å•è¯ï¼Œè¾“å‡ºä¹Ÿæ˜¯ä¸€è¿ä¸²å•è¯ã€‚<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-2-translation.gif?raw=true\" alt=\"translation\">åŠ¨æ€å›¾ï¼štranslation</p>\n<h3 id=\"seq2seqç»†èŠ‚\"><a href=\"#seq2seqç»†èŠ‚\" class=\"headerlink\" title=\"seq2seqç»†èŠ‚\"></a>seq2seqç»†èŠ‚</h3><p>å°†ä¸Šå›¾ä¸­è“è‰²çš„seq2seqæ¨¡å‹è¿›è¡Œæ‹†è§£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šseq2seqæ¨¡å‹ç”±ç¼–ç å™¨ï¼ˆEncoderï¼‰å’Œè§£ç å™¨ï¼ˆDecoderï¼‰ç»„æˆã€‚ç»¿è‰²çš„ç¼–ç å™¨ä¼šå¤„ç†è¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ å¹¶è·å¾—è¾“å…¥ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šè¢«è½¬æ¢æˆä¸ºä¸€ä¸ªé»„è‰²çš„å‘é‡ï¼ˆç§°ä¸ºcontextå‘é‡ï¼‰ã€‚å½“æˆ‘ä»¬å¤„ç†å®Œæ•´ä¸ªè¾“å…¥åºåˆ—åï¼Œç¼–ç å™¨æŠŠ contextå‘é‡ å‘é€ç»™ç´«è‰²çš„è§£ç å™¨ï¼Œè§£ç å™¨é€šè¿‡contextå‘é‡ä¸­çš„ä¿¡æ¯ï¼Œé€ä¸ªå…ƒç´ è¾“å‡ºæ–°çš„åºåˆ—ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-3-encoder-decoder.gif?raw=true\" alt=\"encoder-decode\">åŠ¨æ€å›¾ï¼šseq2seqä¸­çš„encoder-decoder</p>\n<p>ç”±äºseq2seqæ¨¡å‹å¯ä»¥ç”¨æ¥è§£å†³æœºå™¨ç¿»è¯‘ä»»åŠ¡ï¼Œå› æ­¤æœºå™¨ç¿»è¯‘è¢«ä»»åŠ¡seq2seqæ¨¡å‹è§£å†³è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“ä½œseq2seqæ¨¡å‹çš„ä¸€ä¸ªå…·ä½“ä¾‹å­æ¥å­¦ä¹ ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-3-mt.gif?raw=true\" alt=\"encoder-decoder\">åŠ¨æ€å›¾ï¼šseq2seqä¸­çš„encoder-decoderï¼Œæœºå™¨ç¿»è¯‘çš„ä¾‹å­</p>\n<p>æ·±å…¥å­¦ä¹ æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸­çš„seq2seqæ¨¡å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚seq2seqæ¨¡å‹ä¸­çš„ç¼–ç å™¨å’Œè§£ç å™¨ä¸€èˆ¬é‡‡ç”¨çš„æ˜¯å¾ªç¯ç¥ç»ç½‘ç»œRNNï¼ˆTransformeræ¨¡å‹è¿˜æ²¡å‡ºç°çš„è¿‡å»æ—¶ä»£ï¼‰ã€‚ç¼–ç å™¨å°†è¾“å…¥çš„æ³•è¯­å•è¯åºåˆ—ç¼–ç æˆcontextå‘é‡ï¼ˆåœ¨ç»¿è‰²encoderå’Œç´«è‰²decoderä¸­é—´å‡ºç°ï¼‰ï¼Œç„¶åè§£ç å™¨æ ¹æ®contextå‘é‡è§£ç å‡ºè‹±è¯­å•è¯åºåˆ—ã€‚*</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-4-context-example.png?raw=true\" alt=\"contextå‘é‡å¯¹åº”å›¾é‡Œä¸­é—´ä¸€ä¸ªæµ®ç‚¹æ•°å‘é‡ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯è§†åŒ–è¿™äº›å‘é‡ï¼Œä½¿ç”¨æ›´æ˜äº®çš„è‰²å½©æ¥è¡¨ç¤ºæ›´é«˜çš„å€¼ï¼Œå¦‚ä¸Šå›¾å³è¾¹æ‰€ç¤º\"></p>\n<p>å›¾ï¼šcontextå‘é‡å¯¹åº”ä¸Šå›¾ä¸­é—´æµ®ç‚¹æ•°å‘é‡ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šå¯è§†åŒ–è¿™äº›æ•°å­—å‘é‡ï¼Œä½¿ç”¨æ›´æ˜äº®çš„è‰²å½©æ¥è¡¨ç¤ºæ›´é«˜çš„å€¼ï¼Œå¦‚ä¸Šå›¾å³è¾¹æ‰€ç¤º</p>\n<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹é»„è‰²çš„contextå‘é‡æ˜¯ä»€ä¹ˆï¼Ÿæœ¬è´¨ä¸Šæ˜¯ä¸€ç»„æµ®ç‚¹æ•°ã€‚è€Œè¿™ä¸ªcontextçš„æ•°ç»„é•¿åº¦æ˜¯åŸºäºç¼–ç å™¨RNNçš„éšè—å±‚ç¥ç»å…ƒæ•°é‡çš„ã€‚ä¸Šå›¾å±•ç¤ºäº†é•¿åº¦ä¸º4çš„contextå‘é‡ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­ï¼Œcontextå‘é‡çš„é•¿åº¦æ˜¯è‡ªå®šä¹‰çš„ï¼Œæ¯”å¦‚å¯èƒ½æ˜¯256ï¼Œ512æˆ–è€…1024ã€‚</p>\n<p>é‚£ä¹ˆRNNæ˜¯å¦‚ä½•å…·ä½“åœ°å¤„ç†è¾“å…¥åºåˆ—çš„å‘¢ï¼Ÿ</p>\n<ol>\n<li><p>å‡è®¾åºåˆ—è¾“å…¥æ˜¯ä¸€ä¸ªå¥å­ï¼Œè¿™ä¸ªå¥å­å¯ä»¥ç”±$n$ä¸ªè¯è¡¨ç¤ºï¼š$sentence &#x3D; {w_1, w_2,â€¦,w_n}$ã€‚</p>\n</li>\n<li><p>RNNé¦–å…ˆå°†å¥å­ä¸­çš„æ¯ä¸€ä¸ªè¯æ˜ å°„æˆä¸ºä¸€ä¸ªå‘é‡å¾—åˆ°ä¸€ä¸ªå‘é‡åºåˆ—ï¼š$X &#x3D; {x_1, x_2,â€¦,x_n}$ï¼Œæ¯ä¸ªå•è¯æ˜ å°„å¾—åˆ°çš„å‘é‡é€šå¸¸åˆå«åšï¼šword embeddingã€‚</p>\n</li>\n<li><p>ç„¶ååœ¨å¤„ç†ç¬¬$t \\in [1,n]$ä¸ªæ—¶é—´æ­¥çš„åºåˆ—è¾“å…¥$x_t$æ—¶ï¼ŒRNNç½‘ç»œçš„è¾“å…¥å’Œè¾“å‡ºå¯ä»¥è¡¨ç¤ºä¸ºï¼š$h_{t} &#x3D; RNN(x_t, h_{t-1})$</p>\n<ul>\n<li>è¾“å…¥ï¼šRNNåœ¨æ—¶é—´æ­¥$t$çš„è¾“å…¥ä¹‹ä¸€ä¸ºå•è¯$w_t$ç»è¿‡æ˜ å°„å¾—åˆ°çš„å‘é‡$x_t$ã€‚</li>\n<li>è¾“å…¥ï¼šRNNå¦ä¸€ä¸ªè¾“å…¥ä¸ºä¸Šä¸€ä¸ªæ—¶é—´æ­¥$t-1$å¾—åˆ°çš„hidden stateå‘é‡$h_{t-1}$ï¼ŒåŒæ ·æ˜¯ä¸€ä¸ªå‘é‡ã€‚</li>\n<li>è¾“å‡ºï¼šRNNåœ¨æ—¶é—´æ­¥$t$çš„è¾“å‡ºä¸º$h_t$ hidden stateå‘é‡ã€‚</li>\n</ul>\n</li>\n</ol>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-5-word-vector.png?raw=true\" alt=\"æˆ‘ä»¬åœ¨å¤„ç†å•è¯ä¹‹å‰ï¼Œéœ€è¦æŠŠä»–ä»¬è½¬æ¢ä¸ºå‘é‡ã€‚è¿™ä¸ªè½¬æ¢æ˜¯ä½¿ç”¨ word embedding ç®—æ³•æ¥å®Œæˆçš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„è®­ç»ƒå¥½çš„ embeddingsï¼Œæˆ–è€…åœ¨æˆ‘ä»¬çš„æ•°æ®é›†ä¸Šè®­ç»ƒè‡ªå·±çš„ embeddingã€‚é€šå¸¸ embedding å‘é‡å¤§å°æ˜¯ 200 æˆ–è€… 300ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿™é‡Œå±•ç¤ºçš„å‘é‡é•¿åº¦æ˜¯4\"> å›¾ï¼šword embeddingä¾‹å­ã€‚æˆ‘ä»¬åœ¨å¤„ç†å•è¯ä¹‹å‰ï¼Œéœ€è¦å°†å•è¯æ˜ å°„æˆä¸ºå‘é‡ï¼Œé€šå¸¸ä½¿ç”¨ word embedding ç®—æ³•æ¥å®Œæˆã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æå‰è®­ç»ƒå¥½çš„ word embeddingsï¼Œæˆ–è€…åœ¨è‡ªæœ‰çš„æ•°æ®é›†ä¸Šè®­ç»ƒword embeddingã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œä¸Šå›¾å±•ç¤ºçš„word embeddingç»´åº¦æ˜¯4ã€‚ä¸Šå›¾å·¦è¾¹æ¯ä¸ªå•è¯ç»è¿‡word embeddingç®—æ³•ä¹‹åå¾—åˆ°ä¸­é—´ä¸€ä¸ªå¯¹åº”çš„4ç»´çš„å‘é‡ã€‚</p>\n<p>è®©æˆ‘ä»¬æ¥è¿›ä¸€æ­¥å¯è§†åŒ–ä¸€ä¸‹åŸºäºRNNçš„seq2seqæ¨¡å‹ä¸­çš„ç¼–ç å™¨åœ¨ç¬¬1ä¸ªæ—¶é—´æ­¥æ˜¯å¦‚ä½•å·¥ä½œï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-6-rnn.gif?raw=true\" alt=\"rnn\"> åŠ¨æ€å›¾ï¼šå¦‚å›¾æ‰€ç¤ºï¼ŒRNNåœ¨ç¬¬2ä¸ªæ—¶é—´æ­¥ï¼Œé‡‡ç”¨ç¬¬1ä¸ªæ—¶é—´æ­¥å¾—åˆ°hidden state#10ï¼ˆéšè—å±‚çŠ¶æ€ï¼‰å’Œç¬¬2ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥å‘é‡input#1ï¼Œæ¥å¾—åˆ°æ–°çš„è¾“å‡ºhidden state#1ã€‚</p>\n<p>çœ‹ä¸‹é¢çš„åŠ¨æ€å›¾ï¼Œè®©æˆ‘ä»¬è¯¦ç»†è§‚å¯Ÿä¸€ä¸‹ç¼–ç å™¨å¦‚ä½•åœ¨æ¯ä¸ªæ—¶é—´æ­¥å¾—åˆ°hidden sateï¼Œå¹¶å°†æœ€ç»ˆçš„hidden stateä¼ è¾“ç»™è§£ç å™¨ï¼Œè§£ç å™¨æ ¹æ®ç¼–ç å™¨æ‰€ç»™äºˆçš„æœ€åä¸€ä¸ªhidden stateä¿¡æ¯è§£ç å¤„è¾“å‡ºåºåˆ—ã€‚æ³¨æ„ï¼Œæœ€åä¸€ä¸ª hidden stateå®é™…ä¸Šæ˜¯æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„contextå‘é‡ã€‚<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-6-seq2seq.gif?raw=true\"> åŠ¨æ€å›¾ï¼šç¼–ç å™¨é€æ­¥å¾—åˆ°hidden stateå¹¶ä¼ è¾“æœ€åä¸€ä¸ªhidden stateç»™è§£ç å™¨ã€‚</p>\n<p>æ¥ç€ï¼Œç»“åˆç¼–ç å™¨å¤„ç†è¾“å…¥åºåˆ—ï¼Œä¸€èµ·æ¥çœ‹ä¸‹è§£ç å™¨å¦‚ä½•ä¸€æ­¥æ­¥å¾—åˆ°è¾“å‡ºåºåˆ—çš„lã€‚ä¸ç¼–ç å™¨ç±»ä¼¼ï¼Œè§£ç å™¨åœ¨æ¯ä¸ªæ—¶é—´æ­¥ä¹Ÿä¼šå¾—åˆ° hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ï¼Œè€Œä¸”ä¹Ÿéœ€è¦æŠŠ hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ä»ä¸€ä¸ªæ—¶é—´æ­¥ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-6-seq2seq-decoder.gif?raw=true\"> åŠ¨æ€å›¾ï¼šç¼–ç å™¨é¦–å…ˆæŒ‰ç…§æ—¶é—´æ­¥ä¾æ¬¡ç¼–ç æ¯ä¸ªæ³•è¯­å•è¯ï¼Œæœ€ç»ˆå°†æœ€åä¸€ä¸ªhidden stateä¹Ÿå°±æ˜¯contextå‘é‡ä¼ é€’ç»™è§£ç å™¨ï¼Œè§£ç å™¨æ ¹æ®contextå‘é‡é€æ­¥è§£ç å¾—åˆ°è‹±æ–‡è¾“å‡ºã€‚</p>\n<p>ç›®å‰ä¸ºæ­¢ï¼Œå¸Œæœ›ä½ å·²ç»æ˜ç™½äº†æœ¬æ–‡å¼€å¤´æå‡ºçš„å‰ä¸¤ä¸ªé—®é¢˜ï¼š1. ä»€ä¹ˆæ˜¯seq2seqæ¨¡å‹ï¼Ÿ2. seq2seqæ¨¡å‹å¦‚ä½•å¤„ç†æ–‡æœ¬&#x2F;é•¿æ–‡æœ¬åºåˆ—ï¼Ÿé‚£ä¹ˆè¯·æ€è€ƒç¬¬3ã€4ä¸ªé—®é¢˜ï¼š3. seq2seqæ¨¡å‹å¤„ç†æ–‡æœ¬åºåˆ—ï¼ˆç‰¹åˆ«æ˜¯é•¿æ–‡æœ¬åºåˆ—ï¼‰æ—¶ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿ4.åŸºäºRNNçš„seq2seqæ¨¡å‹å¦‚ä½•ç»“åˆattentionæ¥è§£å†³é—®é¢˜3å¹¶æå‡æ¨¡å‹æ•ˆæœï¼Ÿ</p>\n<h3 id=\"Attention\"><a href=\"#Attention\" class=\"headerlink\" title=\"Attention\"></a>Attention</h3><p>åŸºäºRNNçš„seq2seqæ¨¡å‹ç¼–ç å™¨æ‰€æœ‰ä¿¡æ¯éƒ½ç¼–ç åˆ°äº†ä¸€ä¸ªcontextå‘é‡ä¸­ï¼Œä¾¿æ˜¯è¿™ç±»æ¨¡å‹çš„ç“¶é¢ˆã€‚ä¸€æ–¹é¢å•ä¸ªå‘é‡å¾ˆéš¾åŒ…å«æ‰€æœ‰æ–‡æœ¬åºåˆ—çš„ä¿¡æ¯ï¼Œå¦ä¸€æ–¹é¢RNNé€’å½’åœ°ç¼–ç æ–‡æœ¬åºåˆ—ä½¿å¾—æ¨¡å‹åœ¨å¤„ç†é•¿æ–‡æœ¬æ—¶é¢ä¸´éå¸¸å¤§çš„æŒ‘æˆ˜ï¼ˆæ¯”å¦‚RNNå¤„ç†åˆ°ç¬¬500ä¸ªå•è¯çš„æ—¶å€™ï¼Œå¾ˆéš¾å†åŒ…å«1-499ä¸ªå•è¯ä¸­çš„æ‰€æœ‰ä¿¡æ¯äº†ï¼‰ã€‚</p>\n<p>é¢å¯¹ä»¥ä¸Šé—®é¢˜ï¼ŒBahdanauç­‰2014å‘å¸ƒçš„<a href=\"https://arxiv.org/abs/1409.0473\">Neural Machine Translation by Jointly Learning to Align and Translate</a> å’Œ Luongç­‰2015å¹´å‘å¸ƒçš„<a href=\"https://arxiv.org/abs/1508.04025\">Effective Approaches to Attention-based Neural Machine Translation\n</a>ä¸¤ç¯‡è®ºæ–‡ä¸­ï¼Œæå‡ºäº†ä¸€ç§å«åšæ³¨æ„åŠ›<strong>attetion</strong>çš„æŠ€æœ¯ã€‚é€šè¿‡attentionæŠ€æœ¯ï¼Œseq2seqæ¨¡å‹æå¤§åœ°æé«˜äº†æœºå™¨ç¿»è¯‘çš„è´¨é‡ã€‚å½’å…¶åŸå› æ˜¯ï¼šattentionæ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿å¾—seq2seqæ¨¡å‹å¯ä»¥æœ‰åŒºåˆ†åº¦ã€æœ‰é‡ç‚¹åœ°å…³æ³¨è¾“å…¥åºåˆ—ã€‚</p>\n<p>ä¸‹å›¾ä¾æ—§æ˜¯æœºå™¨ç¿»è¯‘çš„ä¾‹å­ï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-7-attetion.png?raw=true\" alt=\"åœ¨ç¬¬7ä¸ªæ—¶é—´æ­¥ï¼Œæ³¨æ„åŠ›æœºåˆ¶ä½¿å¾—è§£ç å™¨åœ¨äº§ç”Ÿè‹±è¯­ç¿»è¯‘ä¹‹å‰ï¼Œå¯ä»¥å°†æ³¨æ„åŠ›é›†ä¸­åœ¨ &quot;student&quot; è¿™ä¸ªè¯ï¼ˆåœ¨æ³•è¯­é‡Œï¼Œæ˜¯ &quot;student&quot; çš„æ„æ€ï¼‰ã€‚è¿™ç§ä»è¾“å…¥åºåˆ—æ”¾å¤§ç›¸å…³ä¿¡å·çš„èƒ½åŠ›ï¼Œä½¿å¾—æ³¨æ„åŠ›æ¨¡å‹ï¼Œæ¯”æ²¡æœ‰æ³¨æ„åŠ›çš„æ¨¡å‹ï¼Œäº§ç”Ÿæ›´å¥½çš„ç»“æœã€‚\"> å›¾ï¼šåœ¨ç¬¬ 7 ä¸ªæ—¶é—´æ­¥ï¼Œæ³¨æ„åŠ›æœºåˆ¶ä½¿å¾—è§£ç å™¨åœ¨äº§ç”Ÿè‹±è¯­ç¿»è¯‘studentè‹±æ–‡ç¿»è¯‘ä¹‹å‰ï¼Œå¯ä»¥å°†æ³¨æ„åŠ›é›†ä¸­åœ¨æ³•è¯­è¾“å…¥åºåˆ—çš„ï¼šÃ©tudiantã€‚è¿™ç§æœ‰åŒºåˆ†åº¦å¾—attentionåˆ°è¾“å…¥åºåˆ—çš„é‡è¦ä¿¡æ¯ï¼Œä½¿å¾—æ¨¡å‹æœ‰æ›´å¥½çš„æ•ˆæœã€‚</p>\n<p>è®©æˆ‘ä»¬ç»§ç»­æ¥ç†è§£å¸¦æœ‰æ³¨æ„åŠ›çš„seq2seqæ¨¡å‹ï¼šä¸€ä¸ªæ³¨æ„åŠ›æ¨¡å‹ä¸ç»å…¸çš„seq2seqæ¨¡å‹ä¸»è¦æœ‰2ç‚¹ä¸åŒï¼š</p>\n<ul>\n<li><p>A. é¦–å…ˆï¼Œç¼–ç å™¨ä¼šæŠŠæ›´å¤šçš„æ•°æ®ä¼ é€’ç»™è§£ç å™¨ã€‚ç¼–ç å™¨æŠŠæ‰€æœ‰æ—¶é—´æ­¥çš„ hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ä¼ é€’ç»™è§£ç å™¨ï¼Œè€Œä¸æ˜¯åªä¼ é€’æœ€åä¸€ä¸ª hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ï¼Œå¦‚ä¸‹é¢çš„åŠ¨æ€å›¾æ‰€ç¤º:<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-6-mt-1.gif?raw=true\"> åŠ¨æ€å›¾: æ›´å¤šçš„ä¿¡æ¯ä¼ é€’ç»™decoder</p>\n</li>\n<li><p>B. æ³¨æ„åŠ›æ¨¡å‹çš„è§£ç å™¨åœ¨äº§ç”Ÿè¾“å‡ºä¹‹å‰ï¼Œåšäº†ä¸€ä¸ªé¢å¤–çš„attentionå¤„ç†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…·ä½“ä¸ºï¼š</p>\n<ul>\n<li><ol>\n<li>ç”±äºç¼–ç å™¨ä¸­æ¯ä¸ª hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰éƒ½å¯¹åº”åˆ°è¾“å…¥å¥å­ä¸­ä¸€ä¸ªå•è¯ï¼Œé‚£ä¹ˆè§£ç å™¨è¦æŸ¥çœ‹æ‰€æœ‰æ¥æ”¶åˆ°çš„ç¼–ç å™¨çš„ hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ã€‚</li>\n</ol>\n</li>\n<li><ol start=\"2\">\n<li>ç»™æ¯ä¸ª hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰è®¡ç®—å‡ºä¸€ä¸ªåˆ†æ•°ï¼ˆæˆ‘ä»¬å…ˆå¿½ç•¥è¿™ä¸ªåˆ†æ•°çš„è®¡ç®—è¿‡ç¨‹ï¼‰ã€‚</li>\n</ol>\n</li>\n<li><ol start=\"3\">\n<li>æ‰€æœ‰hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰çš„åˆ†æ•°ç»è¿‡softmaxè¿›è¡Œå½’ä¸€åŒ–ã€‚</li>\n</ol>\n</li>\n<li><ol start=\"4\">\n<li>å°†æ¯ä¸ª hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ä¹˜ä»¥æ‰€å¯¹åº”çš„åˆ†æ•°ï¼Œä»è€Œèƒ½å¤Ÿè®©é«˜åˆ†å¯¹åº”çš„  hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ä¼šè¢«æ”¾å¤§ï¼Œè€Œä½åˆ†å¯¹åº”çš„  hidden stateï¼ˆéšè—å±‚çŠ¶æ€ï¼‰ä¼šè¢«ç¼©å°ã€‚</li>\n</ol>\n</li>\n<li><ol start=\"5\">\n<li>å°†æ‰€æœ‰hidden stateæ ¹æ®å¯¹åº”åˆ†æ•°è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œå¾—åˆ°å¯¹åº”æ—¶é—´æ­¥çš„contextå‘é‡ã€‚<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-7-attention-dec.gif?raw=true\"> åŠ¨æ€å›¾ï¼šåœ¨ç¬¬4ä¸ªæ—¶é—´æ­¥ï¼Œç¼–ç å™¨ç»“åˆattentionå¾—åˆ°contextå‘é‡çš„5ä¸ªæ­¥éª¤ã€‚</li>\n</ol>\n</li>\n</ul>\n</li>\n</ul>\n<p>æ‰€ä»¥ï¼Œattentionå¯ä»¥ç®€å•ç†è§£ä¸ºï¼šä¸€ç§æœ‰æ•ˆçš„åŠ æƒæ±‚å’ŒæŠ€æœ¯ï¼Œå…¶è‰ºæœ¯åœ¨äºå¦‚ä½•è·å¾—æƒé‡ã€‚</p>\n<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æŠŠæ‰€æœ‰å†…å®¹éƒ½èåˆåˆ°ä¸‹é¢çš„å›¾ä¸­ï¼Œæ¥çœ‹çœ‹ç»“åˆæ³¨æ„åŠ›çš„seq2seqæ¨¡å‹è§£ç å™¨å…¨æµç¨‹ï¼ŒåŠ¨æ€å›¾å±•ç¤ºçš„æ˜¯ç¬¬4ä¸ªæ—¶é—´æ­¥ï¼š</p>\n<ol>\n<li>æ³¨æ„åŠ›æ¨¡å‹çš„è§£ç å™¨ RNN çš„è¾“å…¥åŒ…æ‹¬ï¼šä¸€ä¸ªword embedding å‘é‡ï¼Œå’Œä¸€ä¸ªåˆå§‹åŒ–å¥½çš„è§£ç å™¨ hidden stateï¼Œå›¾ä¸­æ˜¯$h_{init}$ã€‚</li>\n<li>RNN å¤„ç†ä¸Šè¿°çš„ 2 ä¸ªè¾“å…¥ï¼Œäº§ç”Ÿä¸€ä¸ªè¾“å‡ºå’Œä¸€ä¸ªæ–°çš„ hidden stateï¼Œå›¾ä¸­ä¸ºh4ã€‚</li>\n<li>æ³¨æ„åŠ›çš„æ­¥éª¤ï¼šæˆ‘ä»¬ä½¿ç”¨ç¼–ç å™¨çš„æ‰€æœ‰ hidden stateå‘é‡å’Œ h4 å‘é‡æ¥è®¡ç®—è¿™ä¸ªæ—¶é—´æ­¥çš„contextå‘é‡ï¼ˆC4ï¼‰ã€‚</li>\n<li>æˆ‘ä»¬æŠŠ h4 å’Œ C4 æ‹¼æ¥èµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªæ©™è‰²å‘é‡ã€‚</li>\n<li>æˆ‘ä»¬æŠŠè¿™ä¸ªæ©™è‰²å‘é‡è¾“å…¥ä¸€ä¸ªå‰é¦ˆç¥ç»ç½‘ç»œï¼ˆè¿™ä¸ªç½‘ç»œæ˜¯å’Œæ•´ä¸ªæ¨¡å‹ä¸€èµ·è®­ç»ƒçš„ï¼‰ã€‚</li>\n<li>æ ¹æ®å‰é¦ˆç¥ç»ç½‘ç»œçš„è¾“å‡ºå‘é‡å¾—åˆ°è¾“å‡ºå•è¯ï¼šå‡è®¾è¾“å‡ºåºåˆ—å¯èƒ½çš„å•è¯æœ‰Nä¸ªï¼Œé‚£ä¹ˆè¿™ä¸ªå‰é¦ˆç¥ç»ç½‘ç»œçš„è¾“å‡ºå‘é‡é€šå¸¸æ˜¯Nç»´çš„ï¼Œæ¯ä¸ªç»´åº¦çš„ä¸‹æ ‡å¯¹åº”ä¸€ä¸ªè¾“å‡ºå•è¯ï¼Œæ¯ä¸ªç»´åº¦çš„æ•°å€¼å¯¹åº”çš„æ˜¯è¯¥å•è¯çš„è¾“å‡ºæ¦‚ç‡ã€‚</li>\n<li>åœ¨ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥é‡å¤1-6æ­¥éª¤ã€‚<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-7-attention-pro.gif?raw=true\"> åŠ¨æ€å›¾ï¼šè§£ç å™¨ç»“åˆattentionå…¨è¿‡ç¨‹</li>\n</ol>\n<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¸Œæœ›ä½ å·²ç»çŸ¥é“æœ¬æ–‡å¼€å¤´æå‡ºçš„3ã€4é—®é¢˜çš„ç­”æ¡ˆå•¦ï¼š3ã€seq2seqå¤„ç†é•¿æ–‡æœ¬åºåˆ—çš„æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ4ã€seq2seqæ˜¯å¦‚ä½•ç»“åˆattentionæ¥è§£å†³é—®é¢˜3ä¸­çš„æŒ‘æˆ˜çš„ï¼Ÿ</p>\n<p>æœ€åï¼Œæˆ‘ä»¬å¯è§†åŒ–ä¸€ä¸‹æ³¨æ„åŠ›æœºåˆ¶ï¼Œçœ‹çœ‹åœ¨è§£ç å™¨åœ¨æ¯ä¸ªæ—¶é—´æ­¥å…³æ³¨äº†è¾“å…¥åºåˆ—çš„å“ªäº›éƒ¨åˆ†ï¼š<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-7-attention.gif?raw=true\"> åŠ¨æ€å›¾ï¼šè§£ç æ­¥éª¤æ—¶å€™attentionå…³æ³¨çš„è¯</p>\n<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ³¨æ„åŠ›æ¨¡å‹ä¸æ˜¯æ— æ„è¯†åœ°æŠŠè¾“å‡ºçš„ç¬¬ä¸€ä¸ªå•è¯å¯¹åº”åˆ°è¾“å…¥çš„ç¬¬ä¸€ä¸ªå•è¯ï¼Œå®ƒæ˜¯åœ¨è®­ç»ƒé˜¶æ®µå­¦ä¹ åˆ°å¦‚ä½•å¯¹ä¸¤ç§è¯­è¨€çš„å•è¯è¿›è¡Œå¯¹åº”ï¼ˆåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ˜¯æ³•è¯­å’Œè‹±è¯­ï¼‰ã€‚</p>\n<p>ä¸‹å›¾è¿˜å±•ç¤ºäº†æ³¨æ„åŠ›æœºåˆ¶çš„å‡†ç¡®ç¨‹åº¦ï¼ˆå›¾ç‰‡æ¥è‡ªäºä¸Šé¢æåˆ°çš„è®ºæ–‡ï¼‰ï¼š<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/1-8-attention-vis.png?raw=true\" alt=\"ä½ å¯ä»¥çœ‹åˆ°æ¨¡å‹åœ¨è¾“å‡º &quot;European Economic Area&quot; æ—¶ï¼Œæ³¨æ„åŠ›åˆ†å¸ƒæƒ…å†µã€‚åœ¨æ³•è¯­ä¸­ï¼Œè¿™äº›å•è¯çš„é¡ºåºï¼Œç›¸å¯¹äºè‹±è¯­ï¼Œæ˜¯é¢ å€’çš„ï¼ˆ&quot;europÃ©enne Ã©conomique zone&quot;ï¼‰ã€‚è€Œå…¶ä»–è¯çš„é¡ºåºæ˜¯ç±»ä¼¼çš„ã€‚\"> å›¾ï¼šå¯ä»¥çœ‹åˆ°æ¨¡å‹åœ¨è¾“å‡º â€œEuropean Economic Areaâ€ æ—¶ï¼Œæ³¨æ„åŠ›åˆ†å¸ƒæƒ…å†µã€‚åœ¨æ³•è¯­ä¸­ï¼Œè¿™äº›å•è¯çš„é¡ºåºï¼Œç›¸å¯¹äºè‹±è¯­ï¼Œæ˜¯é¢ å€’çš„ï¼ˆâ€europÃ©enne Ã©conomique zoneâ€ï¼‰ã€‚è€Œå…¶ä»–è¯çš„é¡ºåºæ˜¯ç±»ä¼¼çš„ã€‚</p>\n<h2 id=\"transformer\"><a href=\"#transformer\" class=\"headerlink\" title=\"transformer\"></a>transformer</h2><p>æˆ‘ä»¬çŸ¥æ™“äº†attentionä¸ºå¾ªç¯ç¥ç»ç½‘ç»œå¸¦æ¥çš„ä¼˜ç‚¹ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§ç¥ç»ç½‘ç»œç»“æ„ç›´æ¥åŸºäºattentionæ„é€ ï¼Œå¹¶ä¸”ä¸å†ä¾èµ–RNNã€LSTMæˆ–è€…CNNç½‘ç»œç»“æ„äº†å‘¢ï¼Ÿç­”æ¡ˆä¾¿æ˜¯ï¼šTransformerã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬å°èŠ‚å¯¹Transformeræ‰€æ¶‰åŠçš„ç»†èŠ‚è¿›è¡Œæ·±å…¥æ¢è®¨ã€‚</p>\n<p>Transformeræ¨¡å‹åœ¨2017å¹´è¢«googleæå‡ºï¼Œç›´æ¥åŸºäºSelf-Attentionç»“æ„ï¼Œå–ä»£äº†ä¹‹å‰NLPä»»åŠ¡ä¸­å¸¸ç”¨çš„RNNç¥ç»ç½‘ç»œç»“æ„ï¼Œå¹¶åœ¨WMT2014 Englishto-Germanå’ŒWMT2014 English-to-Frenchä¸¤ä¸ªæœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸Šéƒ½å–å¾—äº†å½“æ—¶çš„SOTAã€‚</p>\n<p>ä¸RNNè¿™ç±»ç¥ç»ç½‘ç»œç»“æ„ç›¸æ¯”ï¼ŒTransformerä¸€ä¸ªå·¨å¤§çš„ä¼˜ç‚¹æ˜¯ï¼š<strong>æ¨¡å‹åœ¨å¤„ç†åºåˆ—è¾“å…¥æ—¶ï¼Œå¯ä»¥å¯¹æ•´ä¸ªåºåˆ—è¾“å…¥è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œä¸éœ€è¦æŒ‰ç…§æ—¶é—´æ­¥å¾ªç¯é€’å½’å¤„ç†è¾“å…¥åºåˆ—ã€‚</strong>ã€‚</p>\n<p>ä¸‹å›¾å…ˆä¾¿æ˜¯Transformeræ•´ä½“ç»“æ„å›¾ï¼Œä¸seq2seqæ¨¡å‹ç±»ä¼¼ï¼ŒTransformeræ¨¡å‹ç»“æ„ä¸­çš„å·¦åŠéƒ¨åˆ†ä¸ºç¼–ç å™¨ï¼ˆencoderï¼‰ï¼Œå³åŠéƒ¨åˆ†ä¸ºè§£ç å™¨ï¼ˆdecoderï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥æ‹†è§£ Transformerã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-transformer.png?raw=true\" alt=\"transformer\"><br>å›¾ï¼štransformeræ¨¡å‹ç»“æ„</p>\n<h3 id=\"Transformerå®è§‚ç»“æ„\"><a href=\"#Transformerå®è§‚ç»“æ„\" class=\"headerlink\" title=\"Transformerå®è§‚ç»“æ„\"></a>Transformerå®è§‚ç»“æ„</h3><p>Transformeræœ€å¼€å§‹æå‡ºæ¥è§£å†³æœºå™¨ç¿»è¯‘ä»»åŠ¡ï¼Œå› æ­¤å¯ä»¥çœ‹ä½œæ˜¯seq2seqæ¨¡å‹çš„ä¸€ç§ã€‚æœ¬å°èŠ‚å…ˆæŠ›å¼€Transformeræ¨¡å‹ä¸­ç»“æ„å…·ä½“ç»†èŠ‚ï¼Œå…ˆä»seq2seqçš„è§’åº¦å¯¹Transformerè¿›è¡Œå®è§‚ç»“æ„çš„å­¦ä¹ ã€‚ä»¥æœºå™¨ç¿»è¯‘ä»»åŠ¡ä¸ºä¾‹ï¼Œå…ˆå°†Transformerè¿™ç§ç‰¹æ®Šçš„seqseqæ¨¡å‹çœ‹ä½œä¸€ä¸ªé»‘ç›’ï¼Œé»‘ç›’çš„è¾“å…¥æ˜¯æ³•è¯­æ–‡æœ¬åºåˆ—ï¼Œè¾“å‡ºæ˜¯è‹±è¯­æ–‡æœ¬åºåˆ—ï¼ˆå¯¹æ¯”seq2seqæ¡†æ¶çŸ¥è¯†æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒTransformerå®è§‚ç»“æ„å±äºseq2seqèŒƒç•´ï¼Œåªæ˜¯å°†ä¹‹å‰seq2seqä¸­çš„ç¼–ç å™¨å’Œè§£ç å™¨ï¼Œä»RNNæ¨¡å‹æ›¿æ¢æˆäº†Transformeræ¨¡å‹ï¼‰ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-input-output.png?raw=true\" alt=\"input-output\"><br>å›¾ï¼šTransformeré»‘ç›’è¾“å…¥å’Œè¾“å‡º</p>\n<p>å°†ä¸Šå›¾ä¸­çš„ä¸­é—´éƒ¨åˆ†â€œTHE TRANSFORMERâ€æ‹†å¼€æˆseq2seqæ ‡å‡†ç»“æ„ï¼Œå¾—åˆ°ä¸‹å›¾ï¼šå·¦è¾¹æ˜¯ç¼–ç éƒ¨åˆ†encodersï¼Œå³è¾¹æ˜¯è§£ç å™¨éƒ¨åˆ†decodersã€‚<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-encoder-decoder.png?raw=true\" alt=\"encoder-decoder\"><br>å›¾ï¼šencoder-decoder</p>\n<p>ä¸‹é¢ï¼Œå†å°†ä¸Šå›¾ä¸­çš„ç¼–ç å™¨å’Œè§£ç å™¨ç»†èŠ‚ç»˜å‡ºï¼Œå¾—åˆ°ä¸‹å›¾ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç¼–ç éƒ¨åˆ†ï¼ˆencodersï¼‰ç”±å¤šå±‚ç¼–ç å™¨(Encoder)ç»„æˆï¼ˆTransformerè®ºæ–‡ä¸­ä½¿ç”¨çš„æ˜¯6å±‚ç¼–ç å™¨ï¼Œè¿™é‡Œçš„å±‚æ•°6å¹¶ä¸æ˜¯å›ºå®šçš„ï¼Œä½ ä¹Ÿå¯ä»¥æ ¹æ®å®éªŒæ•ˆæœæ¥ä¿®æ”¹å±‚æ•°ï¼‰ã€‚åŒç†ï¼Œè§£ç éƒ¨åˆ†ï¼ˆdecodersï¼‰ä¹Ÿæ˜¯ç”±å¤šå±‚çš„è§£ç å™¨(Decoder)ç»„æˆï¼ˆè®ºæ–‡é‡Œä¹Ÿä½¿ç”¨äº†6å±‚è§£ç å™¨ï¼‰ã€‚æ¯å±‚ç¼–ç å™¨ç½‘ç»œç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œæ¯å±‚è§£ç å™¨ç½‘ç»œç»“æ„ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚ä¸åŒå±‚ç¼–ç å™¨å’Œè§£ç å™¨ç½‘ç»œç»“æ„ä¸å…±äº«å‚æ•°ã€‚<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-2-encoder-detail.png?raw=true\" alt=\"ç¿»è¯‘ä¾‹å­\"></p>\n<p>å›¾ï¼š6å±‚ç¼–ç å’Œ6å±‚è§£ç å™¨</p>\n<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å•å±‚encoderï¼Œå•å±‚encoderä¸»è¦ç”±ä»¥ä¸‹ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>\n<ul>\n<li>Self-Attention Layer</li>\n<li>Feed Forward Neural Networkï¼ˆå‰é¦ˆç¥ç»ç½‘ç»œï¼Œç¼©å†™ä¸º FFNNï¼‰</li>\n</ul>\n<p>ç¼–ç å™¨çš„è¾“å…¥æ–‡æœ¬åºåˆ—$w_1, w_2,â€¦,w_n$æœ€å¼€å§‹éœ€è¦ç»è¿‡embeddingè½¬æ¢ï¼Œå¾—åˆ°æ¯ä¸ªå•è¯çš„å‘é‡è¡¨ç¤º$x_1, x_2,â€¦,x_n$ï¼Œå…¶ä¸­$x_i \\in \\mathbb{R}^{d}$æ˜¯ç»´åº¦ä¸º$d$çš„å‘é‡ï¼Œç„¶åæ‰€æœ‰å‘é‡ç»è¿‡ä¸€ä¸ªSelf-Attentionç¥ç»ç½‘ç»œå±‚è¿›è¡Œå˜æ¢å’Œä¿¡æ¯äº¤äº’å¾—åˆ°$h_1, h_2,â€¦h_n$ï¼Œå…¶ä¸­$h_i \\in \\mathbb{R}^{d}$æ˜¯ç»´åº¦ä¸º$d$çš„å‘é‡ã€‚self-attentionå±‚å¤„ç†ä¸€ä¸ªè¯å‘é‡çš„æ—¶å€™ï¼Œä¸ä»…ä¼šä½¿ç”¨è¿™ä¸ªè¯æœ¬èº«çš„ä¿¡æ¯ï¼Œä¹Ÿä¼šä½¿ç”¨å¥å­ä¸­å…¶ä»–è¯çš„ä¿¡æ¯ï¼ˆä½ å¯ä»¥ç±»æ¯”ä¸ºï¼šå½“æˆ‘ä»¬ç¿»è¯‘ä¸€ä¸ªè¯çš„æ—¶å€™ï¼Œä¸ä»…ä¼šåªå…³æ³¨å½“å‰çš„è¯ï¼Œä¹Ÿä¼šå…³æ³¨è¿™ä¸ªè¯çš„ä¸Šä¸‹æ–‡çš„å…¶ä»–è¯çš„ä¿¡æ¯ï¼‰ã€‚Self-Attentionå±‚çš„è¾“å‡ºä¼šç»è¿‡å‰é¦ˆç¥ç»ç½‘ç»œå¾—åˆ°æ–°çš„$x_1, x_2,..,x_n$ï¼Œä¾æ—§æ˜¯$n$ä¸ªç»´åº¦ä¸º$d$çš„å‘é‡ã€‚è¿™äº›å‘é‡å°†è¢«é€å…¥ä¸‹ä¸€å±‚encoderï¼Œç»§ç»­ç›¸åŒçš„æ“ä½œã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-encoder.png?raw=true\" alt=\"encoder\"></p>\n<p>å›¾ï¼šå•å±‚encoder</p>\n<p>ä¸ç¼–ç å™¨å¯¹åº”ï¼Œå¦‚ä¸‹å›¾ï¼Œè§£ç å™¨åœ¨ç¼–ç å™¨çš„self-attentionå’ŒFFNNä¸­é—´æ’å…¥äº†ä¸€ä¸ªEncoder-Decoder Attentionå±‚ï¼Œè¿™ä¸ªå±‚å¸®åŠ©è§£ç å™¨èšç„¦äºè¾“å…¥åºåˆ—æœ€ç›¸å…³çš„éƒ¨åˆ†ï¼ˆç±»ä¼¼äºseq2seqæ¨¡å‹ä¸­çš„ Attentionï¼‰ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-decoder.webp?raw=true\" alt=\"decoder\"></p>\n<p>å›¾ï¼šå•å±‚decoder</p>\n<p>æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬åŸºæœ¬äº†è§£äº†Transformerç”±ç¼–ç éƒ¨åˆ†å’Œè§£ç éƒ¨åˆ†ç»„æˆï¼Œè€Œç¼–ç éƒ¨åˆ†å’Œè§£ç éƒ¨åˆ†åˆç”±å¤šä¸ªç½‘ç»œç»“æ„ç›¸åŒçš„ç¼–ç å±‚å’Œè§£ç å±‚ç»„æˆã€‚æ¯ä¸ªç¼–ç å±‚ç”±self-attentionå’ŒFFNNç»„æˆï¼Œæ¯ä¸ªè§£ç å±‚ç”±self-attentionã€FFNå’Œencoder-decoder attentionç»„æˆã€‚</p>\n<p>ä»¥ä¸Šä¾¿æ˜¯Transformerçš„å®è§‚ç»“æ„å•¦ï¼Œä¸‹é¢æˆ‘ä»¬å¼€å§‹çœ‹å®è§‚ç»“æ„ä¸­çš„æ¨¡å‹ç»†èŠ‚ã€‚</p>\n<h3 id=\"Transformerç»“æ„ç»†èŠ‚\"><a href=\"#Transformerç»“æ„ç»†èŠ‚\" class=\"headerlink\" title=\"Transformerç»“æ„ç»†èŠ‚\"></a>Transformerç»“æ„ç»†èŠ‚</h3><p>äº†è§£äº†Transformerçš„å®è§‚ç»“æ„ä¹‹åã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹Transformerå¦‚ä½•å°†è¾“å…¥æ–‡æœ¬åºåˆ—è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºï¼Œåˆå¦‚ä½•é€å±‚å¤„ç†è¿™äº›å‘é‡è¡¨ç¤ºå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºã€‚</p>\n<h4 id=\"è¾“å…¥å¤„ç†\"><a href=\"#è¾“å…¥å¤„ç†\" class=\"headerlink\" title=\"è¾“å…¥å¤„ç†\"></a>è¾“å…¥å¤„ç†</h4><h5 id=\"è¯å‘é‡\"><a href=\"#è¯å‘é‡\" class=\"headerlink\" title=\"è¯å‘é‡\"></a>è¯å‘é‡</h5><p>å’Œå¸¸è§çš„NLP ä»»åŠ¡ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆä¼šä½¿ç”¨è¯åµŒå…¥ç®—æ³•ï¼ˆembedding algorithmï¼‰ï¼Œå°†è¾“å…¥æ–‡æœ¬åºåˆ—çš„æ¯ä¸ªè¯è½¬æ¢ä¸ºä¸€ä¸ªè¯å‘é‡ã€‚å®é™…åº”ç”¨ä¸­çš„å‘é‡ä¸€èˆ¬æ˜¯ 256 æˆ–è€… 512 ç»´ã€‚ä½†ä¸ºäº†ç®€åŒ–èµ·è§ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨4ç»´çš„è¯å‘é‡æ¥è¿›è¡Œè®²è§£ã€‚</p>\n<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡è®¾æˆ‘ä»¬çš„è¾“å…¥æ–‡æœ¬æ˜¯åºåˆ—åŒ…å«äº†3ä¸ªè¯ï¼Œé‚£ä¹ˆæ¯ä¸ªè¯å¯ä»¥é€šè¿‡è¯åµŒå…¥ç®—æ³•å¾—åˆ°ä¸€ä¸ª4ç»´å‘é‡ï¼Œäºæ˜¯æ•´ä¸ªè¾“å…¥è¢«è½¬åŒ–æˆä¸ºä¸€ä¸ªå‘é‡åºåˆ—ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šåŒæ—¶ç»™æ¨¡å‹è¾“å…¥å¤šä¸ªå¥å­ï¼Œå¦‚æœæ¯ä¸ªå¥å­çš„é•¿åº¦ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„é•¿åº¦ï¼Œä½œä¸ºè¾“å…¥æ–‡æœ¬åºåˆ—çš„æœ€å¤§é•¿åº¦ï¼šå¦‚æœä¸€ä¸ªå¥å­è¾¾ä¸åˆ°è¿™ä¸ªé•¿åº¦ï¼Œé‚£ä¹ˆå°±å¡«å……å…ˆå¡«å……ä¸€ä¸ªç‰¹æ®Šçš„â€œpaddingâ€è¯ï¼›å¦‚æœå¥å­è¶…å‡ºè¿™ä¸ªé•¿åº¦ï¼Œåˆ™åšæˆªæ–­ã€‚æœ€å¤§åºåˆ—é•¿åº¦æ˜¯ä¸€ä¸ªè¶…å‚æ•°ï¼Œé€šå¸¸å¸Œæœ›è¶Šå¤§è¶Šå¥½ï¼Œä½†æ˜¯æ›´é•¿çš„åºåˆ—å¾€å¾€ä¼šå ç”¨æ›´å¤§çš„è®­ç»ƒæ˜¾å­˜&#x2F;å†…å­˜ï¼Œå› æ­¤éœ€è¦åœ¨æ¨¡å‹è®­ç»ƒæ—¶å€™è§†æƒ…å†µè¿›è¡Œå†³å®šã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-x.png?raw=true\" alt=\" ä¸ªè¯å‘é‡\"><br>å›¾ï¼š3ä¸ªè¯å’Œå¯¹åº”çš„è¯å‘é‡</p>\n<p>è¾“å…¥åºåˆ—æ¯ä¸ªå•è¯è¢«è½¬æ¢æˆè¯å‘é‡è¡¨ç¤ºè¿˜å°†åŠ ä¸Šä½ç½®å‘é‡æ¥å¾—åˆ°è¯¥è¯çš„æœ€ç»ˆå‘é‡è¡¨ç¤ºã€‚</p>\n<h5 id=\"ä½ç½®å‘é‡\"><a href=\"#ä½ç½®å‘é‡\" class=\"headerlink\" title=\"ä½ç½®å‘é‡\"></a>ä½ç½®å‘é‡</h5><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒTransformeræ¨¡å‹å¯¹æ¯ä¸ªè¾“å…¥çš„è¯å‘é‡éƒ½åŠ ä¸Šäº†ä¸€ä¸ªä½ç½®å‘é‡ã€‚è¿™äº›å‘é‡æœ‰åŠ©äºç¡®å®šæ¯ä¸ªå•è¯çš„ä½ç½®ç‰¹å¾ï¼Œæˆ–è€…å¥å­ä¸­ä¸åŒå•è¯ä¹‹é—´çš„è·ç¦»ç‰¹å¾ã€‚è¯å‘é‡åŠ ä¸Šä½ç½®å‘é‡èƒŒåçš„ç›´è§‰æ˜¯ï¼šå°†è¿™äº›è¡¨ç¤ºä½ç½®çš„å‘é‡æ·»åŠ åˆ°è¯å‘é‡ä¸­ï¼Œå¾—åˆ°çš„æ–°å‘é‡ï¼Œå¯ä»¥ä¸ºæ¨¡å‹æä¾›æ›´å¤šæœ‰æ„ä¹‰çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯çš„ä½ç½®ï¼Œè¯ä¹‹é—´çš„è·ç¦»ç­‰ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-position.png?raw=true\" alt=\"ä½ç½®ç¼–ç \"><br>å›¾ï¼šä½ç½®ç¼–ç å‘é‡</p>\n<p>ä¾æ—§å‡è®¾è¯å‘é‡å’Œä½ç½®å‘é‡çš„ç»´åº¦æ˜¯4ï¼Œæˆ‘ä»¬åœ¨ä¸‹å›¾ä¸­å±•ç¤ºä¸€ç§å¯èƒ½çš„ä½ç½®å‘é‡+è¯å‘é‡ï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-position2.png?raw=true\" alt=\"ä½ç½®ç¼–ç \"><br>å›¾ï¼šä½ç½®ç¼–ç å‘é‡</p>\n<p>é‚£ä¹ˆå¸¦æœ‰ä½ç½®ç¼–ç ä¿¡æ¯çš„å‘é‡åˆ°åº•éµå¾ªä»€ä¹ˆæ¨¡å¼ï¼ŸåŸå§‹è®ºæ–‡ä¸­ç»™å‡ºçš„è®¾è®¡è¡¨è¾¾å¼ä¸ºï¼š<br>$$<br>PE_{(pos,2i)} &#x3D; sin(pos &#x2F; 10000^{2i&#x2F;d_{\\text{model}}}) \\                                                                       PE_{(pos,2i+1)} &#x3D; cos(pos &#x2F; 10000^{2i&#x2F;d_{\\text{model}}})<br>$$<br>ä¸Šé¢è¡¨è¾¾å¼ä¸­çš„$pos$ä»£è¡¨è¯çš„ä½ç½®ï¼Œ$d_{model}$ä»£è¡¨ä½ç½®å‘é‡çš„ç»´åº¦ï¼Œ$i \\in [0, d_{model})$ä»£è¡¨ä½ç½®$d_{model}$ç»´ä½ç½®å‘é‡ç¬¬$i$ç»´ã€‚äºæ˜¯æ ¹æ®ä¸Šè¿°å…¬å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç¬¬$pos$ä½ç½®çš„$d_{model}$ç»´ä½ç½®å‘é‡ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬ç”»å‡ºäº†ä¸€ç§ä½ç½®å‘é‡åœ¨ç¬¬4ã€5ã€6ã€7ç»´åº¦ã€ä¸åŒä½ç½®çš„çš„æ•°å€¼å¤§å°ã€‚æ¨ªåæ ‡è¡¨ç¤ºä½ç½®ä¸‹æ ‡ï¼Œçºµåæ ‡è¡¨ç¤ºæ•°å€¼å¤§å°ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-2-pos-embedding.png?raw=true\" alt=\"ä½ç½®ç¼–ç å›¾ç¤º\"><br>å›¾ï¼šä½ç½®ç¼–ç åœ¨0-100ä½ç½®ï¼Œåœ¨4ã€5ã€6ã€7ç»´çš„æ•°å€¼å›¾ç¤º</p>\n<p>å½“ç„¶ï¼Œä¸Šè¿°å…¬å¼ä¸æ˜¯å”¯ä¸€ç”Ÿæˆä½ç½®ç¼–ç å‘é‡çš„æ–¹æ³•ã€‚ä½†è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼šå¯ä»¥æ‰©å±•åˆ°æœªçŸ¥çš„åºåˆ—é•¿åº¦ã€‚ä¾‹å¦‚ï¼šå½“æˆ‘ä»¬çš„æ¨¡å‹éœ€è¦ç¿»è¯‘ä¸€ä¸ªå¥å­ï¼Œè€Œè¿™ä¸ªå¥å­çš„é•¿åº¦å¤§äºè®­ç»ƒé›†ä¸­æ‰€æœ‰å¥å­çš„é•¿åº¦ï¼Œè¿™æ—¶ï¼Œè¿™ç§ä½ç½®ç¼–ç çš„æ–¹æ³•ä¹Ÿå¯ä»¥ç”Ÿæˆä¸€æ ·é•¿çš„ä½ç½®ç¼–ç å‘é‡ã€‚</p>\n<h4 id=\"ç¼–ç å™¨encoder\"><a href=\"#ç¼–ç å™¨encoder\" class=\"headerlink\" title=\"ç¼–ç å™¨encoder\"></a>ç¼–ç å™¨encoder</h4><p>ç¼–ç éƒ¨åˆ†çš„è¾“å…¥æ–‡æœ¬åºåˆ—ç»è¿‡è¾“å…¥å¤„ç†ä¹‹åå¾—åˆ°äº†ä¸€ä¸ªå‘é‡åºåˆ—ï¼Œè¿™ä¸ªå‘é‡åºåˆ—å°†è¢«é€å…¥ç¬¬1å±‚ç¼–ç å™¨ï¼Œç¬¬1å±‚ç¼–ç å™¨è¾“å‡ºçš„åŒæ ·æ˜¯ä¸€ä¸ªå‘é‡åºåˆ—ï¼Œå†æ¥ç€é€å…¥ä¸‹ä¸€å±‚ç¼–ç å™¨ï¼šç¬¬1å±‚ç¼–ç å™¨çš„è¾“å…¥æ˜¯èåˆä½ç½®å‘é‡çš„è¯å‘é‡ï¼Œ<em>æ›´ä¸Šå±‚ç¼–ç å™¨çš„è¾“å…¥åˆ™æ˜¯ä¸Šä¸€å±‚ç¼–ç å™¨çš„è¾“å‡º</em>ã€‚</p>\n<p>ä¸‹å›¾å±•ç¤ºäº†å‘é‡åºåˆ—åœ¨å•å±‚encoderä¸­çš„æµåŠ¨ï¼šèåˆä½ç½®ä¿¡æ¯çš„è¯å‘é‡è¿›å…¥self-attentionå±‚ï¼Œself-attentionçš„è¾“å‡ºæ¯ä¸ªä½ç½®çš„å‘é‡å†è¾“å…¥FFNç¥ç»ç½‘ç»œå¾—åˆ°æ¯ä¸ªä½ç½®çš„æ–°å‘é‡ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-x-encoder.png?raw=true\" alt=\"è¾“å…¥encoder\"><br>å›¾ï¼šå•å±‚encoderçš„åºåˆ—å‘é‡æµåŠ¨</p>\n<p>ä¸‹é¢å†çœ‹ä¸€ä¸ª2ä¸ªå•è¯çš„ä¾‹å­ï¼š<br><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-multi-encoder.webp?raw=true\" alt=\"ä¸€å±‚ä¼ ä¸€å±‚\"><br>å›¾ï¼š2ä¸ªå•è¯çš„ä¾‹å­ï¼š$x_1, x_2 \\to z_1, z_2 \\to r_1, r_2$</p>\n<h4 id=\"Self-Attentionå±‚\"><a href=\"#Self-Attentionå±‚\" class=\"headerlink\" title=\"Self-Attentionå±‚\"></a>Self-Attentionå±‚</h4><p>ä¸‹é¢æ¥åˆ†æä¸€ä¸‹ä¸Šå›¾ä¸­Self-Attentionå±‚çš„å…·ä½“æœºåˆ¶ã€‚</p>\n<h5 id=\"Self-Attentionæ¦‚è§ˆ\"><a href=\"#Self-Attentionæ¦‚è§ˆ\" class=\"headerlink\" title=\"Self-Attentionæ¦‚è§ˆ\"></a>Self-Attentionæ¦‚è§ˆ</h5><p>å‡è®¾æˆ‘ä»¬æƒ³è¦ç¿»è¯‘çš„å¥å­æ˜¯ï¼š<br>$$<br>The \\space\\space animal \\space\\space didnâ€™t \\space\\space cross \\space\\space the \\space\\space street \\space\\space because \\space\\space it \\space\\space was \\space\\space too \\space\\space tired<br>$$<br>è¿™ä¸ªå¥å­ä¸­çš„ <em>it</em> æ˜¯ä¸€ä¸ªæŒ‡ä»£è¯ï¼Œé‚£ä¹ˆ <em>it</em> æŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®ƒæ˜¯æŒ‡ <em>animal</em> è¿˜æ˜¯<em>street</em>ï¼Ÿè¿™ä¸ªé—®é¢˜å¯¹äººæ¥è¯´ï¼Œæ˜¯å¾ˆç®€å•çš„ï¼Œä½†æ˜¯å¯¹æ¨¡å‹æ¥è¯´å¹¶ä¸æ˜¯é‚£ä¹ˆå®¹æ˜“ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ¨¡å‹å¼•å…¥äº†<em>Self Attention</em>æœºåˆ¶ä¹‹åï¼Œä¾¿èƒ½å¤Ÿè®©æ¨¡å‹æŠŠitå’Œanimalå…³è”èµ·æ¥äº†ã€‚åŒæ ·çš„ï¼Œå½“æ¨¡å‹å¤„ç†å¥å­ä¸­å…¶ä»–è¯æ—¶ï¼Œ<em>Self Attentio</em>næœºåˆ¶ä¹Ÿå¯ä»¥ä½¿å¾—æ¨¡å‹ä¸ä»…ä»…å…³æ³¨å½“å‰ä½ç½®çš„è¯ï¼Œè¿˜ä¼šå…³æ³¨å¥å­ä¸­å…¶ä»–ä½ç½®çš„ç›¸å…³çš„è¯ï¼Œè¿›è€Œå¯ä»¥æ›´å¥½åœ°ç†è§£å½“å‰ä½ç½®çš„è¯ã€‚</p>\n<p>ä¸RNNå¯¹æ¯”ä¸€ä¸‹ï¼šRNN åœ¨å¤„ç†åºåˆ—ä¸­çš„ä¸€ä¸ªè¯æ—¶ï¼Œä¼šè€ƒè™‘å¥å­å‰é¢çš„è¯ä¼ è¿‡æ¥çš„<em>hidden state</em>ï¼Œè€Œ<em>hidden state</em>å°±åŒ…å«äº†å‰é¢çš„è¯çš„ä¿¡æ¯ï¼›è€Œ<em>Self Attention</em>æœºåˆ¶å€¼å¾—æ˜¯ï¼Œå½“å‰è¯ä¼šç›´æ¥å…³æ³¨åˆ°è‡ªå·±å¥å­ä¸­å‰åç›¸å…³çš„æ‰€æœ‰è¯è¯­ï¼Œå¦‚ä¸‹å›¾ <em>it</em> çš„ä¾‹å­ï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-attention-word.png?raw=true\" alt=\"ä¸€ä¸ªè¯å’Œå…¶ä»–è¯çš„attention\"></p>\n<p>å›¾ï¼šä¸€ä¸ªè¯å’Œå…¶ä»–è¯çš„attention</p>\n<p>ä¸Šå›¾æ‰€ç¤ºçš„<em>it</em>æ˜¯ä¸€ä¸ªçœŸå®çš„ä¾‹å­ï¼Œæ˜¯å½“Transformeråœ¨ç¬¬5å±‚ç¼–ç å™¨ç¼–ç â€œitâ€æ—¶çš„çŠ¶æ€ï¼Œå¯è§†åŒ–ä¹‹åæ˜¾ç¤º<em>it</em>æœ‰ä¸€éƒ¨åˆ†æ³¨æ„åŠ›é›†ä¸­åœ¨äº†â€œThe animalâ€ä¸Šï¼Œå¹¶ä¸”æŠŠè¿™ä¸¤ä¸ªè¯çš„ä¿¡æ¯èåˆåˆ°äº†â€itâ€ä¸­ã€‚</p>\n<h5 id=\"Self-Attentionç»†èŠ‚\"><a href=\"#Self-Attentionç»†èŠ‚\" class=\"headerlink\" title=\"Self-Attentionç»†èŠ‚\"></a>Self-Attentionç»†èŠ‚</h5><p>å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£ä¸€ä¸‹ï¼šä»€ä¹ˆæ˜¯â€œself-attentionè‡ªæ³¨æ„åŠ›æœºåˆ¶â€ï¼Ÿå‡è®¾ä¸€å¥è¯åŒ…å«ä¸¤ä¸ªå•è¯ï¼šThinking Machinesã€‚è‡ªæ³¨æ„åŠ›çš„ä¸€ç§ç†è§£æ˜¯ï¼šThinking-Thinkingï¼ŒThinking-Machinesï¼ŒMachines-Thinkingï¼ŒMachines-Machinesï¼Œå…±$2^2$ç§ä¸¤ä¸¤attentionã€‚é‚£ä¹ˆå…·ä½“å¦‚ä½•è®¡ç®—å‘¢ï¼Ÿå‡è®¾Thinkingã€Machinesè¿™ä¸¤ä¸ªå•è¯ç»è¿‡è¯å‘é‡ç®—æ³•å¾—åˆ°å‘é‡æ˜¯$X_1, X_2$â€‹ï¼š<br>$$<br>\\begin{array}{l}<br>1: q_1 &#x3D; X_1 W^Q, q_2 &#x3D; X_2 W^Q; k_1 &#x3D; X_1 W^K, k_2 &#x3D; X_2 W^K\\\\<br>v_1 &#x3D; X_1 W^V, v_2 &#x3D; X_2 W^V, W^Q, W^K, W^K \\in \\mathbb{R}^{d_x \\times d_k}\\\\<br>2-3: score_{11} &#x3D; \\frac{q_1 \\cdot q_1}{\\sqrt{d_k}} , score_{12} &#x3D; \\frac{q_1 \\cdot q_2}{\\sqrt{d_k}} ;\\<br>score_{21} &#x3D; \\frac{q_2 \\cdot q_1}{\\sqrt{d_k}}, score_{22} &#x3D; \\frac{q_2 \\cdot q_2}{\\sqrt{d_k}}; \\\\<br>4: score_{11} &#x3D; \\frac{e^{score_{11}}}{e^{score_{11}} + e^{score_{12}}},score_{12} &#x3D; \\frac{e^{score_{12}}}{e^{score_{11}} + e^{score_{12}}}; \\\\<br>score_{21} &#x3D; \\frac{e^{score_{21}}}{e^{score_{21}} + e^{score_{22}}},score_{22} &#x3D; \\frac{e^{score_{22}}}{e^{score_{21}} + e^{score_{22}}} \\\\<br>5-6: z_1 &#x3D; v_1 \\times score_{11} + v_2 \\times score_{12}; \\\\<br>z_2 &#x3D; v_1 \\times score_{21} + v_2 \\times score_{22}<br>\\end{array}<br>$$<br>ä¸‹é¢ï¼Œæˆ‘ä»¬å°†ä¸Šè¯‰self-attentionè®¡ç®—çš„6ä¸ªæ­¥éª¤è¿›è¡Œå¯è§†åŒ–ã€‚</p>\n<p>ç¬¬1æ­¥ï¼šå¯¹è¾“å…¥ç¼–ç å™¨çš„è¯å‘é‡è¿›è¡Œçº¿æ€§å˜æ¢å¾—åˆ°ï¼šQueryå‘é‡: $q_1, q_2$ï¼ŒKeyå‘é‡: $k_1, k_2$ï¼ŒValueå‘é‡: $v_1, v_2$ã€‚è¿™3ä¸ªå‘é‡æ˜¯è¯å‘é‡åˆ†åˆ«å’Œ3ä¸ªå‚æ•°çŸ©é˜µç›¸ä¹˜å¾—åˆ°çš„ï¼Œè€Œè¿™ä¸ªçŸ©é˜µä¹Ÿæ˜¯æ˜¯æ¨¡å‹è¦å­¦ä¹ çš„å‚æ•°ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-qkv.png?raw=true\" alt=\"Q,K,V\">å›¾ï¼šè®¡ç®—Queryå‘é‡ï¼š$q_1, q_2$ï¼ŒKeyå‘é‡: $k_1, k_2$ï¼ŒValueå‘é‡: $v_1, v_2$ã€‚</p>\n<p>Query å‘é‡ï¼ŒKey å‘é‡ï¼ŒValue å‘é‡æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿ</p>\n<p>å…¶å®å®ƒä»¬å°±æ˜¯ 3 ä¸ªå‘é‡ï¼Œç»™å®ƒä»¬åŠ ä¸Šä¸€ä¸ªåç§°ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ Self-Attention çš„è®¡ç®—è¿‡ç¨‹å’Œé€»è¾‘ã€‚attentionè®¡ç®—çš„é€»è¾‘å¸¸å¸¸å¯ä»¥æè¿°ä¸ºï¼š<strong>queryå’Œkeyè®¡ç®—ç›¸å…³æˆ–è€…å«attentionå¾—åˆ†ï¼Œç„¶åæ ¹æ®attentionå¾—åˆ†å¯¹valueè¿›è¡ŒåŠ æƒæ±‚å’Œã€‚</strong></p>\n<p>ç¬¬2æ­¥ï¼šè®¡ç®—Attention Scoreï¼ˆæ³¨æ„åŠ›åˆ†æ•°ï¼‰ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨è®¡ç®—ç¬¬ä¸€ä¸ªè¯<em>Thinking</em> çš„Attention Scoreï¼ˆæ³¨æ„åŠ›åˆ†æ•°ï¼‰ï¼Œéœ€è¦æ ¹æ®<em>Thinking</em> å¯¹åº”çš„è¯å‘é‡ï¼Œå¯¹å¥å­ä¸­çš„å…¶ä»–è¯å‘é‡éƒ½è®¡ç®—ä¸€ä¸ªåˆ†æ•°ã€‚è¿™äº›åˆ†æ•°å†³å®šäº†æˆ‘ä»¬åœ¨ç¼–ç <em>Thinking</em>è¿™ä¸ªè¯æ—¶ï¼Œéœ€è¦å¯¹å¥å­ä¸­å…¶ä»–ä½ç½®çš„è¯å‘é‡çš„æƒé‡ã€‚</p>\n<p>Attention scoreæ˜¯æ ¹æ®â€<em>Thinking</em>â€œ å¯¹åº”çš„ Query å‘é‡å’Œå…¶ä»–ä½ç½®çš„æ¯ä¸ªè¯çš„ Key å‘é‡è¿›è¡Œç‚¹ç§¯å¾—åˆ°çš„ã€‚Thinkingçš„ç¬¬ä¸€ä¸ªAttention Scoreå°±æ˜¯$q_1$å’Œ$k_1$çš„å†…ç§¯ï¼Œç¬¬äºŒä¸ªåˆ†æ•°å°±æ˜¯$q_1$å’Œ$k_2$çš„ç‚¹ç§¯ã€‚è¿™ä¸ªè®¡ç®—è¿‡ç¨‹åœ¨ä¸‹å›¾ä¸­è¿›è¡Œäº†å±•ç¤ºï¼Œä¸‹å›¾é‡Œçš„å…·ä½“å¾—åˆ†æ•°æ®æ˜¯ä¸ºäº†è¡¨è¾¾æ–¹ä¾¿è€Œè‡ªå®šä¹‰çš„ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-think.png?raw=true\" alt=\"Thinkingè®¡ç®—\"><br>å›¾ï¼šThinkingçš„Attention Scoreè®¡ç®—</p>\n<p>ç¬¬3æ­¥ï¼šæŠŠæ¯ä¸ªåˆ†æ•°é™¤ä»¥ $\\sqrt{d_k}$ï¼Œ$d_{k}$æ˜¯Keyå‘é‡çš„ç»´åº¦ã€‚ä½ ä¹Ÿå¯ä»¥é™¤ä»¥å…¶ä»–æ•°ï¼Œé™¤ä»¥ä¸€ä¸ªæ•°æ˜¯ä¸ºäº†åœ¨åå‘ä¼ æ’­æ—¶ï¼Œæ±‚æ¢¯åº¦æ—¶æ›´åŠ ç¨³å®šã€‚</p>\n<p>ç¬¬4æ­¥ï¼šæ¥ç€æŠŠè¿™äº›åˆ†æ•°ç»è¿‡ä¸€ä¸ªSoftmaxå‡½æ•°ï¼ŒSoftmaxå¯ä»¥å°†åˆ†æ•°å½’ä¸€åŒ–ï¼Œè¿™æ ·ä½¿å¾—åˆ†æ•°éƒ½æ˜¯æ­£æ•°å¹¶ä¸”åŠ èµ·æ¥ç­‰äº1ï¼Œ å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br>è¿™äº›åˆ†æ•°å†³å®šäº†Thinkingè¯å‘é‡ï¼Œå¯¹å…¶ä»–æ‰€æœ‰ä½ç½®çš„è¯å‘é‡åˆ†åˆ«æœ‰å¤šå°‘çš„æ³¨æ„åŠ›ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-think2.png?raw=true\" alt=\"Thinkingè®¡ç®—\"><br>å›¾ï¼šThinkingçš„Attention Scoreè®¡ç®—</p>\n<p>ç¬¬5æ­¥ï¼šå¾—åˆ°æ¯ä¸ªè¯å‘é‡çš„åˆ†æ•°åï¼Œå°†åˆ†æ•°åˆ†åˆ«ä¸å¯¹åº”çš„Valueå‘é‡ç›¸ä¹˜ã€‚è¿™ç§åšæ³•èƒŒåçš„ç›´è§‰ç†è§£å°±æ˜¯ï¼šå¯¹äºåˆ†æ•°é«˜çš„ä½ç½®ï¼Œç›¸ä¹˜åçš„å€¼å°±è¶Šå¤§ï¼Œæˆ‘ä»¬æŠŠæ›´å¤šçš„æ³¨æ„åŠ›æ”¾åˆ°äº†å®ƒä»¬èº«ä¸Šï¼›å¯¹äºåˆ†æ•°ä½çš„ä½ç½®ï¼Œç›¸ä¹˜åçš„å€¼å°±è¶Šå°ï¼Œè¿™äº›ä½ç½®çš„è¯å¯èƒ½æ˜¯ç›¸å…³æ€§ä¸å¤§çš„ã€‚</p>\n<p>ç¬¬6æ­¥ï¼šæŠŠç¬¬5æ­¥å¾—åˆ°çš„Valueå‘é‡ç›¸åŠ ï¼Œå°±å¾—åˆ°äº†Self Attentionåœ¨å½“å‰ä½ç½®ï¼ˆè¿™é‡Œçš„ä¾‹å­æ˜¯ç¬¬1ä¸ªä½ç½®ï¼‰å¯¹åº”çš„è¾“å‡ºã€‚</p>\n<p>æœ€åï¼Œåœ¨ä¸‹å›¾å±•ç¤ºäº† å¯¹ç¬¬ä¸€ä¸ªä½ç½®è¯å‘é‡è®¡ç®—Self Attention çš„å…¨è¿‡ç¨‹ã€‚æœ€ç»ˆå¾—åˆ°çš„å½“å‰ä½ç½®ï¼ˆè¿™é‡Œçš„ä¾‹å­æ˜¯ç¬¬ä¸€ä¸ªä½ç½®ï¼‰è¯å‘é‡ä¼šç»§ç»­è¾“å…¥åˆ°å‰é¦ˆç¥ç»ç½‘ç»œã€‚æ³¨æ„ï¼šä¸Šé¢çš„6ä¸ªæ­¥éª¤æ¯æ¬¡åªèƒ½è®¡ç®—ä¸€ä¸ªä½ç½®çš„è¾“å‡ºå‘é‡ï¼Œåœ¨å®é™…çš„ä»£ç å®ç°ä¸­ï¼ŒSelf Attentionçš„è®¡ç®—è¿‡ç¨‹æ˜¯ä½¿ç”¨çŸ©é˜µå¿«é€Ÿè®¡ç®—çš„ï¼Œä¸€æ¬¡å°±å¾—åˆ°æ‰€æœ‰ä½ç½®çš„è¾“å‡ºå‘é‡ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-sum.png?raw=true\" alt=\"Thinkè®¡ç®—\"><br>å›¾ï¼šThinkingç»è¿‡attentionä¹‹åçš„å‘é‡è¡¨ç¤º$z_1$</p>\n<h5 id=\"Self-AttentionçŸ©é˜µè®¡ç®—\"><a href=\"#Self-AttentionçŸ©é˜µè®¡ç®—\" class=\"headerlink\" title=\"Self-AttentionçŸ©é˜µè®¡ç®—\"></a>Self-AttentionçŸ©é˜µè®¡ç®—</h5><p>å°†self-attentionè®¡ç®—6ä¸ªæ­¥éª¤ä¸­çš„å‘é‡æ”¾ä¸€èµ·ï¼Œæ¯”å¦‚$X&#x3D;[x_1;x_2]$â€‹ï¼Œä¾¿å¯ä»¥è¿›è¡ŒçŸ©é˜µè®¡ç®—å•¦ã€‚ä¸‹é¢ï¼Œä¾æ—§æŒ‰æ­¥éª¤å±•ç¤ºself-attentionçš„çŸ©é˜µè®¡ç®—æ–¹æ³•ã€‚<br>$$<br>\\begin{aligned}<br>&amp;X &#x3D; [X_1;X_2] \\\\<br>&amp;Q &#x3D; X W^Q, K &#x3D; X W^K, V&#x3D;X W^V \\\\<br>&amp;Z &#x3D; softmax(\\frac{QK^T}{\\sqrt{d_k}}) V<br>\\end{aligned}<br>$$<br>ç¬¬1æ­¥ï¼šè®¡ç®— Queryï¼ŒKeyï¼ŒValue çš„çŸ©é˜µã€‚é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠæ‰€æœ‰è¯å‘é‡æ”¾åˆ°ä¸€ä¸ªçŸ©é˜µXä¸­ï¼Œç„¶ååˆ†åˆ«å’Œ3ä¸ªæƒé‡çŸ©é˜µ$W^Q, W^K W^V$ ç›¸ä¹˜ï¼Œå¾—åˆ° Qï¼ŒKï¼ŒV çŸ©é˜µã€‚çŸ©é˜µXä¸­çš„æ¯ä¸€è¡Œï¼Œè¡¨ç¤ºå¥å­ä¸­çš„æ¯ä¸€ä¸ªè¯çš„è¯å‘é‡ã€‚Qï¼ŒKï¼ŒV çŸ©é˜µä¸­çš„æ¯ä¸€è¡Œè¡¨ç¤º Queryå‘é‡ï¼ŒKeyå‘é‡ï¼ŒValue å‘é‡ï¼Œå‘é‡ç»´åº¦æ˜¯$d_k$ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-qkv-multi.png?raw=true\">å›¾ï¼šQKVçŸ©é˜µä¹˜æ³•</p>\n<p>ç¬¬2æ­¥ï¼šç”±äºæˆ‘ä»¬ä½¿ç”¨äº†çŸ©é˜µæ¥è®¡ç®—ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ç¬¬ 2 æ­¥åˆ°ç¬¬ 6 æ­¥å‹ç¼©ä¸ºä¸€æ­¥ï¼Œç›´æ¥å¾—åˆ° Self Attention çš„è¾“å‡ºã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-attention-output.webp?raw=true\" alt=\"è¾“å‡º\"><br>å›¾ï¼šå¾—åˆ°è¾“å‡º$Z$</p>\n<h5 id=\"å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶\"><a href=\"#å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶\" class=\"headerlink\" title=\"å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶\"></a>å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</h5><p>Transformer çš„è®ºæ–‡é€šè¿‡å¢åŠ å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼ˆä¸€ç»„æ³¨æ„åŠ›ç§°ä¸ºä¸€ä¸ª attention headï¼‰ï¼Œè¿›ä¸€æ­¥å®Œå–„äº†Self-Attentionã€‚è¿™ç§æœºåˆ¶ä»å¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢å¢å¼ºäº†attentionå±‚çš„èƒ½åŠ›ï¼š</p>\n<ul>\n<li><strong>å®ƒæ‰©å±•äº†æ¨¡å‹å…³æ³¨ä¸åŒä½ç½®çš„èƒ½åŠ›</strong>ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªä½ç½®çš„è¾“å‡º$z_1$â€‹åŒ…å«äº†å¥å­ä¸­å…¶ä»–æ¯ä¸ªä½ç½®çš„å¾ˆå°ä¸€éƒ¨åˆ†ä¿¡æ¯ï¼Œä½†$z_1$â€‹ä»…ä»…æ˜¯å•ä¸ªå‘é‡ï¼Œæ‰€ä»¥å¯èƒ½ä»…ç”±ç¬¬1ä¸ªä½ç½®çš„ä¿¡æ¯ä¸»å¯¼äº†ã€‚è€Œå½“æˆ‘ä»¬ç¿»è¯‘å¥å­ï¼š<code>The  animal  didn&#39;t  cross  the  street  because  it  was  too  tired</code>æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…å¸Œæœ›æ¨¡å‹å…³æ³¨åˆ°â€itâ€æœ¬èº«ï¼Œè¿˜å¸Œæœ›æ¨¡å‹å…³æ³¨åˆ°â€Theâ€å’Œâ€œanimalâ€ï¼Œç”šè‡³å…³æ³¨åˆ°â€tiredâ€ã€‚è¿™æ—¶ï¼Œå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¼šæœ‰å¸®åŠ©ã€‚</li>\n<li><strong>å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶èµ‹äºˆattentionå±‚å¤šä¸ªâ€œå­è¡¨ç¤ºç©ºé—´â€</strong>ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¼šæœ‰å¤šç»„$W^Q, W^K W^V$â€‹ çš„æƒé‡çŸ©é˜µï¼ˆåœ¨ Transformer çš„è®ºæ–‡ä¸­ï¼Œä½¿ç”¨äº† 8 ç»„æ³¨æ„åŠ›),ï¼Œå› æ­¤å¯ä»¥å°†$X$â€‹å˜æ¢åˆ°æ›´å¤šç§å­ç©ºé—´è¿›è¡Œè¡¨ç¤ºã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¹Ÿä½¿ç”¨8ç»„æ³¨æ„åŠ›å¤´ï¼ˆattention headsï¼‰ï¼‰ã€‚æ¯ä¸€ç»„æ³¨æ„åŠ›çš„æƒé‡çŸ©é˜µéƒ½æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œä½†ç»è¿‡è®­ç»ƒä¹‹åï¼Œæ¯ä¸€ç»„æ³¨æ„åŠ›çš„æƒé‡$W^Q, W^K W^V$â€‹ å¯ä»¥æŠŠè¾“å…¥çš„å‘é‡æ˜ å°„åˆ°ä¸€ä¸ªå¯¹åº”çš„â€å­è¡¨ç¤ºç©ºé—´â€œã€‚</li>\n</ul>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-multi-head.png?raw=true\" alt=\"å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶\"><br>å›¾ï¼šå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶</p>\n<p>åœ¨å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ä¸­ï¼Œæˆ‘ä»¬ä¸ºæ¯ç»„æ³¨æ„åŠ›è®¾å®šå•ç‹¬çš„ WQ, WK, WV å‚æ•°çŸ©é˜µã€‚å°†è¾“å…¥Xå’Œæ¯ç»„æ³¨æ„åŠ›çš„WQ, WK, WV ç›¸ä¹˜ï¼Œå¾—åˆ°8ç»„ Q, K, V çŸ©é˜µã€‚</p>\n<p>æ¥ç€ï¼Œæˆ‘ä»¬æŠŠæ¯ç»„ K, Q, V è®¡ç®—å¾—åˆ°æ¯ç»„çš„ Z çŸ©é˜µï¼Œå°±å¾—åˆ°8ä¸ªZçŸ©é˜µã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-8z.webp?raw=true\" alt=\"8 ä¸ª Z çŸ©é˜µ\"><br>å›¾ï¼š8 ä¸ª Z çŸ©é˜µ</p>\n<p>ç”±äºå‰é¦ˆç¥ç»ç½‘ç»œå±‚æ¥æ”¶çš„æ˜¯ 1 ä¸ªçŸ©é˜µï¼ˆå…¶ä¸­æ¯è¡Œçš„å‘é‡è¡¨ç¤ºä¸€ä¸ªè¯ï¼‰ï¼Œè€Œä¸æ˜¯ 8 ä¸ªçŸ©é˜µï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æŠŠ8ä¸ªå­çŸ©é˜µæ‹¼æ¥èµ·æ¥å¾—åˆ°ä¸€ä¸ªå¤§çš„çŸ©é˜µï¼Œç„¶åå’Œå¦ä¸€ä¸ªæƒé‡çŸ©é˜µ$W^O$ç›¸ä¹˜åšä¸€æ¬¡å˜æ¢ï¼Œæ˜ å°„åˆ°å‰é¦ˆç¥ç»ç½‘ç»œå±‚æ‰€éœ€è¦çš„ç»´åº¦ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-to1.webp?raw=true\" alt=\"æ•´åˆçŸ©é˜µ\"><br>å›¾ï¼šæ‹¼æ¥8ä¸ªå­çŸ©é˜µå¹¶è¿›è¡Œæ˜ å°„å˜æ¢</p>\n<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š</p>\n<ol>\n<li>æŠŠ8ä¸ªçŸ©é˜µ {Z0,Z1â€¦,Z7} æ‹¼æ¥èµ·æ¥</li>\n<li>æŠŠæ‹¼æ¥åçš„çŸ©é˜µå’ŒWOæƒé‡çŸ©é˜µç›¸ä¹˜</li>\n<li>å¾—åˆ°æœ€ç»ˆçš„çŸ©é˜µZï¼Œè¿™ä¸ªçŸ©é˜µåŒ…å«äº†æ‰€æœ‰ attention headsï¼ˆæ³¨æ„åŠ›å¤´ï¼‰ çš„ä¿¡æ¯ã€‚è¿™ä¸ªçŸ©é˜µä¼šè¾“å…¥åˆ°FFNN (Feed Forward Neural Network)å±‚ã€‚</li>\n</ol>\n<p>ä»¥ä¸Šå°±æ˜¯å¤šå¤´æ³¨æ„åŠ›çš„å…¨éƒ¨å†…å®¹ã€‚æœ€åå°†æ‰€æœ‰å†…å®¹æ”¾åˆ°ä¸€å¼ å›¾ä¸­ï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-put-together.webp?raw=true\" alt=\"æ”¾åœ¨ä¸€èµ·\"><br>å›¾ï¼šå¤šå¤´æ³¨æ„åŠ›æœºåˆ¶çš„çŸ©é˜µè¿ç®—</p>\n<p>å­¦ä¹ äº†å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶ï¼Œè®©æˆ‘ä»¬å†æ¥çœ‹ä¸‹å½“æˆ‘ä»¬å‰é¢æåˆ°çš„itä¾‹å­ï¼Œä¸åŒçš„attention heads ï¼ˆæ³¨æ„åŠ›å¤´ï¼‰å¯¹åº”çš„â€œitâ€attentionäº†å“ªäº›å†…å®¹ã€‚ä¸‹å›¾ä¸­çš„ç»¿è‰²å’Œæ©™è‰²çº¿æ¡åˆ†åˆ«è¡¨ç¤º2ç»„ä¸åŒçš„attentin headsï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-it-attention.webp?raw=true\" alt=\"`it`çš„attention\"><br>å›¾ï¼š<code>it</code>çš„attention</p>\n<p>å½“æˆ‘ä»¬ç¼–ç å•è¯â€itâ€æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ª attention head ï¼ˆæ©™è‰²æ³¨æ„åŠ›å¤´ï¼‰æœ€å…³æ³¨çš„æ˜¯â€the animalâ€ï¼Œå¦å¤–ä¸€ä¸ªç»¿è‰² attention head å…³æ³¨çš„æ˜¯â€tiredâ€ã€‚å› æ­¤åœ¨æŸç§æ„ä¹‰ä¸Šï¼Œâ€itâ€åœ¨æ¨¡å‹ä¸­çš„è¡¨ç¤ºï¼Œèåˆäº†â€animalâ€å’Œâ€tireâ€çš„éƒ¨åˆ†è¡¨è¾¾ã€‚</p>\n<h5 id=\"æ®‹å·®è¿æ¥\"><a href=\"#æ®‹å·®è¿æ¥\" class=\"headerlink\" title=\"æ®‹å·®è¿æ¥\"></a>æ®‹å·®è¿æ¥</h5><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®¡ç®—å¾—åˆ°äº†self-attentionçš„è¾“å‡ºå‘é‡ã€‚è€Œå•å±‚encoderé‡Œåç»­è¿˜æœ‰ä¸¤ä¸ªé‡è¦çš„æ“ä½œï¼šæ®‹å·®é“¾æ¥ã€æ ‡å‡†åŒ–ã€‚</p>\n<p>ç¼–ç å™¨çš„æ¯ä¸ªå­å±‚ï¼ˆSelf Attention å±‚å’Œ FFNNï¼‰éƒ½æœ‰ä¸€ä¸ªæ®‹å·®è¿æ¥å’Œå±‚æ ‡å‡†åŒ–ï¼ˆlayer-normalizationï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-resnet.png?raw=true\" alt=\"æ®‹å·®è¿æ¥\"><br>å›¾ï¼šæ®‹å·®è¿æ¥</p>\n<p>å°† Self-Attention å±‚çš„å±‚æ ‡å‡†åŒ–ï¼ˆlayer-normalizationï¼‰å’Œæ¶‰åŠçš„å‘é‡è®¡ç®—ç»†èŠ‚éƒ½è¿›è¡Œå¯è§†åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-lyn.png?raw=true\" alt=\"æ ‡å‡†åŒ–\"><br>å›¾ï¼šæ ‡å‡†åŒ–ç»†èŠ‚</p>\n<p>ç¼–ç å™¨å’Œå’Œè§£ç å™¨çš„å­å±‚é‡Œé¢éƒ½æœ‰å±‚æ ‡å‡†åŒ–ï¼ˆlayer-normalizationï¼‰ã€‚å‡è®¾ä¸€ä¸ª Transformer æ˜¯ç”± 2 å±‚ç¼–ç å™¨å’Œä¸¤å±‚è§£ç å™¨ç»„æˆçš„ï¼Œå°†å…¨éƒ¨å†…éƒ¨ç»†èŠ‚å±•ç¤ºèµ·æ¥å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-2layer.png?raw=true\" alt=\"2å±‚ç¤ºæ„å›¾\"><br>å›¾ï¼š2å±‚Transformerç¤ºæ„å›¾</p>\n<h4 id=\"è§£ç å™¨\"><a href=\"#è§£ç å™¨\" class=\"headerlink\" title=\"è§£ç å™¨\"></a>è§£ç å™¨</h4><p>ç°åœ¨æˆ‘ä»¬å·²ç»ä»‹ç»äº†ç¼–ç å™¨ä¸­çš„å¤§éƒ¨åˆ†æ¦‚å¿µï¼Œæˆ‘ä»¬ä¹ŸåŸºæœ¬çŸ¥é“äº†ç¼–ç å™¨çš„åŸç†ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹ä¸‹ï¼Œ ç¼–ç å™¨å’Œè§£ç å™¨æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚</p>\n<p>ç¼–ç å™¨ä¸€èˆ¬æœ‰å¤šå±‚ï¼Œç¬¬ä¸€ä¸ªç¼–ç å™¨çš„è¾“å…¥æ˜¯ä¸€ä¸ªåºåˆ—æ–‡æœ¬ï¼Œæœ€åä¸€ä¸ªç¼–ç å™¨è¾“å‡ºæ˜¯ä¸€ç»„åºåˆ—å‘é‡ï¼Œè¿™ç»„åºåˆ—å‘é‡ä¼šä½œä¸ºè§£ç å™¨çš„Kã€Vè¾“å…¥ï¼Œå…¶ä¸­K&#x3D;V&#x3D;è§£ç å™¨è¾“å‡ºçš„åºåˆ—å‘é‡è¡¨ç¤ºã€‚è¿™äº›æ³¨æ„åŠ›å‘é‡å°†ä¼šè¾“å…¥åˆ°æ¯ä¸ªè§£ç å™¨çš„Encoder-Decoder Attentionå±‚ï¼Œè¿™æœ‰åŠ©äºè§£ç å™¨æŠŠæ³¨æ„åŠ›é›†ä¸­åˆ°è¾“å…¥åºåˆ—çš„åˆé€‚ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/transformer_decoding_1.gif?raw=true\"></p>\n<p>è§£ç ï¼ˆdecoding ï¼‰é˜¶æ®µçš„æ¯ä¸€ä¸ªæ—¶é—´æ­¥éƒ½è¾“å‡ºä¸€ä¸ªç¿»è¯‘åçš„å•è¯ï¼ˆè¿™é‡Œçš„ä¾‹å­æ˜¯è‹±è¯­ç¿»è¯‘ï¼‰ï¼Œè§£ç å™¨å½“å‰æ—¶é—´æ­¥çš„è¾“å‡ºåˆé‡æ–°ä½œä¸ºè¾“å…¥Qå’Œç¼–ç å™¨çš„è¾“å‡ºKã€Vå…±åŒä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥è§£ç å™¨çš„è¾“å…¥ã€‚ç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°è¾“å‡ºä¸€ä¸ªç»“æŸç¬¦ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-decoder.gif?raw=true\" alt=\"decoderåŠ¨æ€å›¾\"><br>åŠ¨æ€å›¾ï¼šdecoderåŠ¨æ€å›¾</p>\n<p>è§£ç å™¨ä¸­çš„ Self Attention å±‚ï¼Œå’Œç¼–ç å™¨ä¸­çš„ Self Attention å±‚çš„åŒºåˆ«ï¼š</p>\n<ol>\n<li>åœ¨è§£ç å™¨é‡Œï¼ŒSelf Attention å±‚åªå…è®¸å…³æ³¨åˆ°è¾“å‡ºåºåˆ—ä¸­æ—©äºå½“å‰ä½ç½®ä¹‹å‰çš„å•è¯ã€‚å…·ä½“åšæ³•æ˜¯ï¼šåœ¨ Self Attention åˆ†æ•°ç»è¿‡ Softmax å±‚ä¹‹å‰ï¼Œå±è”½å½“å‰ä½ç½®ä¹‹åçš„é‚£äº›ä½ç½®ï¼ˆå°†attention scoreè®¾ç½®æˆ-infï¼‰ã€‚</li>\n<li>è§£ç å™¨ Attentionå±‚æ˜¯ä½¿ç”¨å‰ä¸€å±‚çš„è¾“å‡ºæ¥æ„é€ Query çŸ©é˜µï¼Œè€ŒKeyçŸ©é˜µå’Œ ValueçŸ©é˜µæ¥è‡ªäºç¼–ç å™¨æœ€ç»ˆçš„è¾“å‡ºã€‚</li>\n</ol>\n<h4 id=\"çº¿æ€§å±‚å’Œsoftmax\"><a href=\"#çº¿æ€§å±‚å’Œsoftmax\" class=\"headerlink\" title=\"çº¿æ€§å±‚å’Œsoftmax\"></a>çº¿æ€§å±‚å’Œsoftmax</h4><p>Decoder æœ€ç»ˆçš„è¾“å‡ºæ˜¯ä¸€ä¸ªå‘é‡ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯æµ®ç‚¹æ•°ã€‚æˆ‘ä»¬æ€ä¹ˆæŠŠè¿™ä¸ªå‘é‡è½¬æ¢ä¸ºå•è¯å‘¢ï¼Ÿè¿™æ˜¯çº¿æ€§å±‚å’Œsoftmaxå®Œæˆçš„ã€‚</p>\n<p>çº¿æ€§å±‚å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å…¨è¿æ¥ç¥ç»ç½‘ç»œï¼Œå¯ä»¥æŠŠè§£ç å™¨è¾“å‡ºçš„å‘é‡ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªæ›´å¤§çš„å‘é‡ï¼Œè¿™ä¸ªå‘é‡ç§°ä¸º logits å‘é‡ï¼šå‡è®¾æˆ‘ä»¬çš„æ¨¡å‹æœ‰ 10000 ä¸ªè‹±è¯­å•è¯ï¼ˆæ¨¡å‹çš„è¾“å‡ºè¯æ±‡è¡¨ï¼‰ï¼Œæ­¤ logits å‘é‡ä¾¿ä¼šæœ‰ 10000 ä¸ªæ•°å­—ï¼Œæ¯ä¸ªæ•°è¡¨ç¤ºä¸€ä¸ªå•è¯çš„åˆ†æ•°ã€‚</p>\n<p>ç„¶åï¼ŒSoftmax å±‚ä¼šæŠŠè¿™äº›åˆ†æ•°è½¬æ¢ä¸ºæ¦‚ç‡ï¼ˆæŠŠæ‰€æœ‰çš„åˆ†æ•°è½¬æ¢ä¸ºæ­£æ•°ï¼Œå¹¶ä¸”åŠ èµ·æ¥ç­‰äº 1ï¼‰ã€‚ç„¶åé€‰æ‹©æœ€é«˜æ¦‚ç‡çš„é‚£ä¸ªæ•°å­—å¯¹åº”çš„è¯ï¼Œå°±æ˜¯è¿™ä¸ªæ—¶é—´æ­¥çš„è¾“å‡ºå•è¯ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-linear.png?raw=true\" alt=\"çº¿æ€§å±‚\"><br>å›¾ï¼šçº¿æ€§å±‚</p>\n<h4 id=\"æŸå¤±å‡½æ•°\"><a href=\"#æŸå¤±å‡½æ•°\" class=\"headerlink\" title=\"æŸå¤±å‡½æ•°\"></a>æŸå¤±å‡½æ•°</h4><p>Transformerè®­ç»ƒçš„æ—¶å€™ï¼Œéœ€è¦å°†è§£ç å™¨çš„è¾“å‡ºå’Œlabelä¸€åŒé€å…¥æŸå¤±å‡½æ•°ï¼Œä»¥è·å¾—lossï¼Œæœ€ç»ˆæ¨¡å‹æ ¹æ®lossè¿›è¡Œæ–¹å‘ä¼ æ’­ã€‚è¿™ä¸€å°èŠ‚ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜è®­ç»ƒè¿‡ç¨‹çš„lossè®¡ç®—ï¼šæŠŠâ€œmerciâ€ç¿»è¯‘ä¸ºâ€œthanksâ€ã€‚</p>\n<p>æˆ‘ä»¬å¸Œæœ›æ¨¡å‹è§£ç å™¨æœ€ç»ˆè¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒï¼Œä¼šæŒ‡å‘å•è¯ â€thanksâ€œï¼ˆåœ¨â€œthanksâ€è¿™ä¸ªè¯çš„æ¦‚ç‡æœ€é«˜ï¼‰ã€‚ä½†æ˜¯ï¼Œä¸€å¼€å§‹æ¨¡å‹è¿˜æ²¡è®­ç»ƒå¥½ï¼Œå®ƒè¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒå¯èƒ½å’Œæˆ‘ä»¬å¸Œæœ›çš„æ¦‚ç‡åˆ†å¸ƒç›¸å·®ç”šè¿œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ­£ç¡®çš„æ¦‚ç‡åˆ†å¸ƒåº”è¯¥æ˜¯â€œthanksâ€å•è¯çš„æ¦‚ç‡æœ€å¤§ã€‚ä½†æ˜¯ï¼Œç”±äºæ¨¡å‹çš„å‚æ•°éƒ½æ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œæ‰€ç¤ºä¸€å¼€å§‹æ¨¡å‹é¢„æµ‹æ‰€æœ‰è¯çš„æ¦‚ç‡å‡ ä¹éƒ½æ˜¯éšæœºçš„ã€‚</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-loss.webp?raw=true\" alt=\"æ¦‚ç‡åˆ†å¸ƒ\"><br>å›¾ï¼šæ¦‚ç‡åˆ†å¸ƒ</p>\n<p>åªè¦Transformerè§£ç å™¨é¢„æµ‹äº†ç»„æ¦‚ç‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè¿™ç»„æ¦‚ç‡å’Œæ­£ç¡®çš„è¾“å‡ºæ¦‚ç‡åšå¯¹æ¯”ï¼Œç„¶åä½¿ç”¨åå‘ä¼ æ’­æ¥è°ƒæ•´æ¨¡å‹çš„æƒé‡ï¼Œä½¿å¾—è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒæ›´åŠ æ¥è¿‘æ•´æ•°è¾“å‡ºã€‚</p>\n<p>é‚£æˆ‘ä»¬è¦æ€ä¹ˆæ¯”è¾ƒä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒå‘¢ï¼Ÿï¼šæˆ‘ä»¬å¯ä»¥ç®€å•çš„ç”¨ä¸¤ç»„æ¦‚ç‡å‘é‡çš„çš„ç©ºé—´è·ç¦»ä½œä¸ºlossï¼ˆå‘é‡ç›¸å‡ï¼Œç„¶åæ±‚å¹³æ–¹å’Œï¼Œå†å¼€æ–¹ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨äº¤å‰ç†µ(cross-entropy)]å’ŒKL æ•£åº¦(Kullbackâ€“Leibler divergence)ã€‚è¯»è€…å¯ä»¥è¿›ä¸€æ­¥æ£€ç´¢é˜…è¯»ç›¸å…³çŸ¥è¯†ï¼ŒæŸå¤±å‡½æ•°çš„çŸ¥è¯†ä¸åœ¨æœ¬å°èŠ‚å±•å¼€ã€‚</p>\n<p>ç”±äºä¸Šé¢ä»…æœ‰ä¸€ä¸ªå•è¯çš„ä¾‹å­å¤ªç®€å•äº†ï¼Œæˆ‘ä»¬å¯ä»¥å†çœ‹ä¸€ä¸ªå¤æ‚ä¸€ç‚¹çš„å¥å­ã€‚å¥å­è¾“å…¥æ˜¯ï¼šâ€œje suis Ã©tudiantâ€ ï¼Œè¾“å‡ºæ˜¯ï¼šâ€œi am a studentâ€ã€‚è¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬çš„transformeræ¨¡å‹è§£ç å™¨è¦å¤šæ¬¡è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒå‘é‡ï¼š</p>\n<ul>\n<li>æ¯æ¬¡è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒéƒ½æ˜¯ä¸€ä¸ªå‘é‡ï¼Œé•¿åº¦æ˜¯ vocab_sizeï¼ˆå‰é¢çº¦å®šæœ€å¤§vocab sizeï¼Œä¹Ÿå°±æ˜¯å‘é‡é•¿åº¦æ˜¯ 6ï¼Œä½†å®é™…ä¸­çš„vocab sizeæ›´å¯èƒ½æ˜¯ 30000 æˆ–è€… 50000ï¼‰</li>\n<li>ç¬¬1æ¬¡è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒä¸­ï¼Œæœ€é«˜æ¦‚ç‡å¯¹åº”çš„å•è¯æ˜¯ â€œiâ€</li>\n<li>ç¬¬2æ¬¡è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒä¸­ï¼Œæœ€é«˜æ¦‚ç‡å¯¹åº”çš„å•è¯æ˜¯ â€œamâ€</li>\n<li>ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°ç¬¬ 5 ä¸ªæ¦‚ç‡åˆ†å¸ƒä¸­ï¼Œæœ€é«˜æ¦‚ç‡å¯¹åº”çš„å•è¯æ˜¯ â€œ&lt;eos&gt;â€ï¼Œè¡¨ç¤ºæ²¡æœ‰ä¸‹ä¸€ä¸ªå•è¯äº†</li>\n</ul>\n<p>äºæ˜¯æˆ‘ä»¬ç›®æ ‡çš„æ¦‚ç‡åˆ†å¸ƒé•¿ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-target.png?raw=true\" alt=\"æ¦‚ç‡åˆ†å¸ƒ\"><br>å›¾ï¼šç›®æ ‡æ¦‚ç‡åˆ†å¸ƒ</p>\n<p>æˆ‘ä»¬ç”¨ä¾‹å­ä¸­çš„å¥å­è®­ç»ƒæ¨¡å‹ï¼Œå¸Œæœ›äº§ç”Ÿå›¾ä¸­æ‰€ç¤ºçš„æ¦‚ç‡åˆ†å¸ƒ<br>æˆ‘ä»¬çš„æ¨¡å‹åœ¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æ•°æ®é›†ä¸Šï¼Œç»è¿‡è¶³å¤Ÿé•¿æ—¶é—´çš„è®­ç»ƒåï¼Œå¸Œæœ›è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p><img src=\"https://github.com/datawhalechina/learn-nlp-with-transformers/blob/main/docs/%E7%AF%87%E7%AB%A02-Transformer%E7%9B%B8%E5%85%B3%E5%8E%9F%E7%90%86/pictures/2-trained.webp?raw=true\" alt=\"è®­ç»ƒåæ¦‚ç‡åˆ†å¸ƒ\"><br>å›¾ï¼šæ¨¡å‹è®­ç»ƒåè¾“å‡ºçš„å¤šä¸ªæ¦‚ç‡åˆ†å¸ƒ</p>\n<p>æˆ‘ä»¬å¸Œæœ›æ¨¡å‹ç»è¿‡è®­ç»ƒä¹‹åå¯ä»¥è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒä¹Ÿå°±å¯¹åº”äº†æ­£ç¡®çš„ç¿»è¯‘ã€‚å½“ç„¶ï¼Œå¦‚æœä½ è¦ç¿»è¯‘çš„å¥å­æ˜¯è®­ç»ƒé›†ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œé‚£è¾“å‡ºçš„ç»“æœå¹¶ä¸èƒ½è¯´æ˜ä»€ä¹ˆã€‚æˆ‘ä»¬å¸Œæœ›æ¨¡å‹åœ¨æ²¡è§è¿‡çš„å¥å­ä¸Šä¹Ÿèƒ½å¤Ÿå‡†ç¡®ç¿»è¯‘ã€‚</p>\n<p>é¢å¤–æä¸€ä¸‹greedy decodingå’Œbeam searchçš„æ¦‚å¿µï¼š</p>\n<ul>\n<li>Greedy decodingï¼šç”±äºæ¨¡å‹æ¯ä¸ªæ—¶é—´æ­¥åªäº§ç”Ÿä¸€ä¸ªè¾“å‡ºï¼Œæˆ‘ä»¬è¿™æ ·çœ‹å¾…ï¼šæ¨¡å‹æ˜¯ä»æ¦‚ç‡åˆ†å¸ƒä¸­é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„è¯ï¼Œå¹¶ä¸”ä¸¢å¼ƒå…¶ä»–è¯ã€‚è¿™ç§æ–¹æ³•å«åšè´ªå©ªè§£ç ï¼ˆgreedy decodingï¼‰ã€‚</li>\n<li>Beam searchï¼šæ¯ä¸ªæ—¶é—´æ­¥ä¿ç•™kä¸ªæœ€é«˜æ¦‚ç‡çš„è¾“å‡ºè¯ï¼Œç„¶ååœ¨ä¸‹ä¸€ä¸ªæ—¶é—´æ­¥ï¼Œæ ¹æ®ä¸Šä¸€ä¸ªæ—¶é—´æ­¥ä¿ç•™çš„kä¸ªè¯æ¥ç¡®å®šå½“å‰åº”è¯¥ä¿ç•™å“ªkä¸ªè¯ã€‚å‡è®¾k&#x3D;2ï¼Œç¬¬ä¸€ä¸ªä½ç½®æ¦‚ç‡æœ€é«˜çš„ä¸¤ä¸ªè¾“å‡ºçš„è¯æ˜¯â€Iâ€œå’Œâ€aâ€œï¼Œè¿™ä¸¤ä¸ªè¯éƒ½ä¿ç•™ï¼Œç„¶åæ ¹æ®ç¬¬ä¸€ä¸ªè¯è®¡ç®—ç¬¬2ä¸ªä½ç½®çš„è¯çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå†å–å‡ºç¬¬2ä¸ªä½ç½®ä¸Š2ä¸ªæ¦‚ç‡æœ€é«˜çš„è¯ã€‚å¯¹äºç¬¬3ä¸ªä½ç½®å’Œç¬¬4ä¸ªä½ç½®ï¼Œæˆ‘ä»¬ä¹Ÿé‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚è¿™ç§æ–¹æ³•ç§°ä¸ºé›†æŸæœç´¢(beam search)ã€‚</li>\n</ul>\n<h1 id=\"ä»£ç å®ç°\"><a href=\"#ä»£ç å®ç°\" class=\"headerlink\" title=\"ä»£ç å®ç°\"></a>ä»£ç å®ç°</h1><h2 id=\"å…·ä½“é…ç½®\"><a href=\"#å…·ä½“é…ç½®\" class=\"headerlink\" title=\"å…·ä½“é…ç½®\"></a>å…·ä½“é…ç½®</h2><p>æˆ‘ä»äº‘æœåŠ¡å™¨å¹³å°ç§ŸGPUæ¥å®Œæˆæ¨¡å‹è®­ç»ƒï¼Œä»¥ä¸‹æ˜¯è®¾å¤‡å‹å·å’ŒCUDAç‰ˆæœ¬<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab13.png?raw=true\" alt=\"alt text\"><br>å¤–éƒ¨åº“ç‰ˆæœ¬å¦‚ä¸‹:</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"å¯¼å…¥æ‰€éœ€åŒ…\"><a href=\"#å¯¼å…¥æ‰€éœ€åŒ…\" class=\"headerlink\" title=\"å¯¼å…¥æ‰€éœ€åŒ…\"></a>å¯¼å…¥æ‰€éœ€åŒ…</h2><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> math</span><br><span class=\"line\"><span class=\"keyword\">import</span> torchtext</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.nn <span class=\"keyword\">as</span> nn</span><br><span class=\"line\"><span class=\"keyword\">from</span> torch <span class=\"keyword\">import</span> Tensor</span><br><span class=\"line\"><span class=\"keyword\">from</span> torch.nn.utils.rnn <span class=\"keyword\">import</span> pad_sequence </span><br><span class=\"line\"><span class=\"keyword\">from</span> torch.utils.data <span class=\"keyword\">import</span> DataLoader</span><br><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> Counter</span><br><span class=\"line\"><span class=\"keyword\">from</span> torchtext.vocab <span class=\"keyword\">import</span> Vocab</span><br><span class=\"line\"><span class=\"keyword\">from</span> torch.nn <span class=\"keyword\">import</span> TransformerEncoder, TransformerDecoder, TransformerEncoderLayer, TransformerDecoderLayer</span><br><span class=\"line\"><span class=\"keyword\">import</span> io</span><br><span class=\"line\"><span class=\"keyword\">import</span> time </span><br><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> pickle</span><br><span class=\"line\"><span class=\"keyword\">import</span> tqdm</span><br><span class=\"line\"><span class=\"keyword\">import</span> sentencepiece <span class=\"keyword\">as</span> spm</span><br><span class=\"line\">torch.manual_seed(<span class=\"number\">0</span>)</span><br><span class=\"line\">device = torch.device(<span class=\"string\">&#x27;cuda&#x27;</span> <span class=\"keyword\">if</span> torch.cuda.is_available() <span class=\"keyword\">else</span> <span class=\"string\">&#x27;cpu&#x27;</span>)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(torch.cuda.get_device_name(<span class=\"number\">0</span>)) </span><br><span class=\"line\"><span class=\"comment\">## å¦‚æœä½ æœ‰GPUï¼Œè¯·åœ¨ä½ è‡ªå·±çš„ç”µè„‘ä¸Šå°è¯•è¿è¡Œè¿™ä¸€å¥—ä»£ç </span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14-3.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"è·å–å¹¶è¡Œæ•°æ®é›†\"><a href=\"#è·å–å¹¶è¡Œæ•°æ®é›†\" class=\"headerlink\" title=\"è·å–å¹¶è¡Œæ•°æ®é›†\"></a>è·å–å¹¶è¡Œæ•°æ®é›†</h2><p>åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä» JParaCrawl ä¸‹è½½çš„<a href=\"http://www.kecl.ntt.co.jp/icl/lirg/jparacrawl\">æ—¥è‹±å¹¶è¡Œæ•°æ®é›†</a>äºŒæ¬¡åŠ å·¥åå¾—åˆ°çš„æ•°æ®é›†ï¼Œç”±æŸä½ä¸çŸ¥åçš„è‘£è€å¸ˆåŠ å·¥åå˜ä¸ºä¸­æ—¥å¹¶è¡Œæ•°æ®é›†,ä¸‹é¢å‘½åå’Œen(English)æœ‰å…³çš„å®é™…ä¸ºcn(Chinese)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">df = pd.read_csv(<span class=\"string\">&#x27;./zh-ja/zh-ja.bicleaner05.txt&#x27;</span></span><br><span class=\"line\">, sep=<span class=\"string\">&#x27;\\\\t&#x27;</span>, engine=<span class=\"string\">&#x27;python&#x27;</span>, header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">trainen = df[<span class=\"number\">2</span>].values.tolist()<span class=\"comment\">#[:10000]</span></span><br><span class=\"line\">trainja = df[<span class=\"number\">3</span>].values.tolist()<span class=\"comment\">#[:10000]</span></span><br><span class=\"line\"><span class=\"comment\"># trainen.pop(5972)</span></span><br><span class=\"line\"><span class=\"comment\"># trainja.pop(5972)</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(traincn[<span class=\"number\">500</span>])</span><br><span class=\"line\"><span class=\"built_in\">print</span>(trainja[<span class=\"number\">500</span>])</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14-1.png?raw=true\" alt=\"alt text\"><br>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸åŒçš„å¹¶è¡Œæ•°æ®é›†æ¥éµå¾ªæœ¬æ–‡ï¼Œåªéœ€ç¡®ä¿æˆ‘ä»¬å¯ä»¥å°†æ•°æ®å¤„ç†æˆä¸¤ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¦‚ä¸Šæ‰€ç¤ºï¼ŒåŒ…å«æ—¥è¯­å’Œè‹±è¯­å¥å­ã€‚</p>\n<h2 id=\"å‡†å¤‡åˆ†è¯å™¨\"><a href=\"#å‡†å¤‡åˆ†è¯å™¨\" class=\"headerlink\" title=\"å‡†å¤‡åˆ†è¯å™¨\"></a>å‡†å¤‡åˆ†è¯å™¨</h2><p>ä¸è‹±è¯­æˆ–å…¶ä»–å­—æ¯è¯­è¨€ä¸åŒï¼Œæ±‰è¯­å’Œæ—¥è¯­å¥å­ä¸åŒ…å«ç©ºæ ¼æ¥åˆ†éš”å•è¯ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨JParaCrawlæä¾›çš„åˆ†è¯å™¨ï¼Œè¯¥åˆ†è¯å™¨æ˜¯ä½¿ç”¨SentencePieceåˆ›å»ºçš„æ¥åˆ‡åˆ†æ±‰è¯­å’Œæ—¥è¯­å¥å­</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">en_tokenizer = spm.SentencePieceProcessor(model_file=<span class=\"string\">&#x27;enja_spm_models/spm.en.nopretok.model&#x27;</span>)</span><br><span class=\"line\">ja_tokenizer = spm.SentencePieceProcessor(model_file=<span class=\"string\">&#x27;enja_spm_models/spm.ja.nopretok.model&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p>ä½¿ç”¨å®ƒä»¬æ¥åˆ‡åˆ†å¥å­</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">en_tokenizer.encode(<span class=\"string\">&quot;All residents aged 20 to 59 years who live in Japan must enroll in public pension system.&quot;</span>)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14-2.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">ja_tokenizer.encode(<span class=\"string\">&quot;å¹´é‡‘ æ—¥æœ¬ã«ä½ã‚“ã§ã„ã‚‹20æ­³~60æ­³ã®å…¨ã¦ã®äººã¯ã€å…¬çš„å¹´é‡‘åˆ¶åº¦ã«åŠ å…¥ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚&quot;</span>)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14-4.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"æ„å»º-TorchText-Vocab-å¯¹è±¡å¹¶å°†å¥å­è½¬æ¢ä¸º-Torch-å¼ é‡\"><a href=\"#æ„å»º-TorchText-Vocab-å¯¹è±¡å¹¶å°†å¥å­è½¬æ¢ä¸º-Torch-å¼ é‡\" class=\"headerlink\" title=\"æ„å»º TorchText Vocab å¯¹è±¡å¹¶å°†å¥å­è½¬æ¢ä¸º Torch å¼ é‡\"></a>æ„å»º TorchText Vocab å¯¹è±¡å¹¶å°†å¥å­è½¬æ¢ä¸º Torch å¼ é‡</h2><p>ä½¿ç”¨åˆ†è¯å™¨å’ŒåŸå§‹å¥å­ï¼Œæˆ‘ä»¬æ„å»ºä» TorchText å¯¼å…¥çš„ Vocab å¯¹è±¡ã€‚æ­¤è¿‡ç¨‹å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæˆ–å‡ åˆ†é’Ÿï¼Œå…·ä½“å–å†³äºæˆ‘ä»¬çš„æ•°æ®é›†å¤§å°å’Œè®¡ç®—èƒ½åŠ›ã€‚ä¸åŒçš„åˆ†è¯å™¨ä¹Ÿä¼šå½±å“æ„å»ºè¯æ±‡æ‰€éœ€çš„æ—¶é—´ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">build_vocab</span>(<span class=\"params\">sentences, tokenizer</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    æ„å»ºè¯æ±‡è¡¨å‡½æ•°</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - sentences (list): å¥å­åˆ—è¡¨ï¼Œæ¯ä¸ªå¥å­æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class=\"line\"><span class=\"string\">    - tokenizer (SentencePieceProcessor): åˆ†è¯å™¨å¯¹è±¡ï¼Œç”¨äºå¯¹å¥å­è¿›è¡Œåˆ†è¯å’Œç¼–ç </span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - Vocab: æ„å»ºå¥½çš„è¯æ±‡è¡¨å¯¹è±¡</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    counter = Counter()  <span class=\"comment\"># åˆ›å»ºè®¡æ•°å™¨ï¼Œç”¨äºç»Ÿè®¡è¯é¢‘</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> sentence <span class=\"keyword\">in</span> sentences:</span><br><span class=\"line\">        <span class=\"comment\"># ä½¿ç”¨ tokenizer å¯¹æ¯ä¸ªå¥å­è¿›è¡Œç¼–ç ï¼Œå¹¶ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ç»“æœ</span></span><br><span class=\"line\">        encoded_tokens = tokenizer.encode(sentence, out_type=<span class=\"built_in\">str</span>)</span><br><span class=\"line\">        <span class=\"comment\"># æ›´æ–°è®¡æ•°å™¨ï¼Œç»Ÿè®¡æ¯ä¸ªå­è¯çš„å‡ºç°æ¬¡æ•°</span></span><br><span class=\"line\">        counter.update(encoded_tokens)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># åˆ›å»ºè¯æ±‡è¡¨å¯¹è±¡ï¼Œä¼ å…¥è®¡æ•°å™¨å’Œç‰¹æ®Šæ ‡è®°</span></span><br><span class=\"line\">    vocab = Vocab(counter, specials=[<span class=\"string\">&#x27;&lt;unk&gt;&#x27;</span>, <span class=\"string\">&#x27;&lt;pad&gt;&#x27;</span>, <span class=\"string\">&#x27;&lt;bos&gt;&#x27;</span>, <span class=\"string\">&#x27;&lt;eos&gt;&#x27;</span>])</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> vocab</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ build_vocab å‡½æ•°æ„å»ºæ—¥æ–‡å’Œè‹±æ–‡çš„è¯æ±‡è¡¨</span></span><br><span class=\"line\">ja_vocab = build_vocab(trainja, ja_tokenizer)  <span class=\"comment\"># æ„å»ºæ—¥æ–‡è¯æ±‡è¡¨</span></span><br><span class=\"line\">en_vocab = build_vocab(trainen, en_tokenizer)  <span class=\"comment\"># æ„å»ºè‹±æ–‡è¯æ±‡è¡¨</span></span><br></pre></td></tr></table></figure>\n<p>åœ¨æœ‰äº†è¯æ±‡è¡¨å¯¹è±¡ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯æ±‡è¡¨å’Œåˆ†è¯å™¨å¯¹è±¡æ¥æ„å»ºè®­ç»ƒæ•°æ®çš„å¼ é‡ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">data_process</span>(<span class=\"params\">ja, en</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    æ•°æ®å¤„ç†å‡½æ•°ï¼Œå°†æ—¥æ–‡å’Œè‹±æ–‡å¥å­è½¬æ¢ä¸ºå¼ é‡å½¢å¼</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - ja (list): æ—¥æ–‡å¥å­åˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"string\">    - en (list): è‹±æ–‡å¥å­åˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - list: åŒ…å«æ—¥æ–‡å’Œè‹±æ–‡å¥å­å¼ é‡å¯¹çš„åˆ—è¡¨</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    data = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (raw_ja, raw_en) <span class=\"keyword\">in</span> <span class=\"built_in\">zip</span>(ja, en):</span><br><span class=\"line\">        <span class=\"comment\"># ä½¿ç”¨ ja_vocab å°†æ—¥æ–‡å¥å­è½¬æ¢ä¸ºå¼ é‡å½¢å¼</span></span><br><span class=\"line\">        ja_tensor_ = torch.tensor([ja_vocab[token] <span class=\"keyword\">for</span> token <span class=\"keyword\">in</span> ja_tokenizer.encode(raw_ja.rstrip(<span class=\"string\">&quot;\\n&quot;</span>), out_type=<span class=\"built_in\">str</span>)],</span><br><span class=\"line\">                                  dtype=torch.long)</span><br><span class=\"line\">        <span class=\"comment\"># ä½¿ç”¨ en_vocab å°†è‹±æ–‡å¥å­è½¬æ¢ä¸ºå¼ é‡å½¢å¼</span></span><br><span class=\"line\">        en_tensor_ = torch.tensor([en_vocab[token] <span class=\"keyword\">for</span> token <span class=\"keyword\">in</span> en_tokenizer.encode(raw_en.rstrip(<span class=\"string\">&quot;\\n&quot;</span>), out_type=<span class=\"built_in\">str</span>)],</span><br><span class=\"line\">                                  dtype=torch.long)</span><br><span class=\"line\">        <span class=\"comment\"># å°†å¤„ç†åçš„æ—¥æ–‡å’Œè‹±æ–‡å¥å­å¼ é‡å¯¹æ·»åŠ åˆ° data åˆ—è¡¨ä¸­</span></span><br><span class=\"line\">        data.append((ja_tensor_, en_tensor_))</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> data</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨ data_process å‡½æ•°å°†è®­ç»ƒæ•°æ®é›† trainja å’Œ trainen è½¬æ¢ä¸ºå¼ é‡å½¢å¼çš„è®­ç»ƒæ•°æ®</span></span><br><span class=\"line\">train_data = data_process(trainja, trainen)</span><br></pre></td></tr></table></figure>\n<h2 id=\"åˆ›å»ºè¦åœ¨è®­ç»ƒæœŸé—´è¿­ä»£çš„-DataLoader-å¯¹è±¡\"><a href=\"#åˆ›å»ºè¦åœ¨è®­ç»ƒæœŸé—´è¿­ä»£çš„-DataLoader-å¯¹è±¡\" class=\"headerlink\" title=\"åˆ›å»ºè¦åœ¨è®­ç»ƒæœŸé—´è¿­ä»£çš„ DataLoader å¯¹è±¡\"></a>åˆ›å»ºè¦åœ¨è®­ç»ƒæœŸé—´è¿­ä»£çš„ DataLoader å¯¹è±¡</h2><p>åœ¨è¿™é‡Œï¼Œæˆ‘å°†BATCH_SIZEè®¾ç½®ä¸º 16 ä»¥é˜²æ­¢â€œcuda out of memoryâ€ï¼Œä½†è¿™å–å†³äºå„ç§å› ç´ ï¼Œä¾‹å¦‚æ‚¨çš„æœºå™¨å†…å­˜å®¹é‡ã€æ•°æ®å¤§å°ç­‰ï¼Œå› æ­¤è¯·æ ¹æ®éœ€è¦éšæ„æ›´æ”¹æ‰¹å¤„ç†å¤§å°ï¼ˆæ³¨æ„ï¼šPyTorch çš„æ•™ç¨‹ä½¿ç”¨ Multi30k å¾·è¯­-è‹±è¯­æ•°æ®é›†å°†æ‰¹å¤„ç†å¤§å°è®¾ç½®ä¸º 128ã€‚</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"code\"><pre><span class=\"line\">PAD_IDX = ja_vocab[&#x27;&lt;pad&gt;&#x27;]  # å¡«å……æ ‡è®°çš„ç´¢å¼•</span><br><span class=\"line\">BOS_IDX = ja_vocab[&#x27;&lt;bos&gt;&#x27;]  # å¥å­å¼€å§‹æ ‡è®°çš„ç´¢å¼•</span><br><span class=\"line\">EOS_IDX = ja_vocab[&#x27;&lt;eos&gt;&#x27;]  # å¥å­ç»“æŸæ ‡è®°çš„ç´¢å¼•</span><br><span class=\"line\"></span><br><span class=\"line\">def generate_batch(data_batch):</span><br><span class=\"line\">    &quot;&quot;&quot;</span><br><span class=\"line\">    ç”Ÿæˆæ‰¹é‡æ•°æ®å‡½æ•°</span><br><span class=\"line\"></span><br><span class=\"line\">    Args:</span><br><span class=\"line\">    - data_batch (list): åŒ…å«æ—¥æ–‡å’Œè‹±æ–‡å¥å­å¼ é‡å¯¹çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ ä¸º (ja_item, en_item)</span><br><span class=\"line\"></span><br><span class=\"line\">    Returns:</span><br><span class=\"line\">    - ja_batch (Tensor): æ—¥æ–‡å¥å­æ‰¹é‡å¼ é‡ï¼Œå½¢çŠ¶ä¸º (max_seq_len_ja, BATCH_SIZE)</span><br><span class=\"line\">    - en_batch (Tensor): è‹±æ–‡å¥å­æ‰¹é‡å¼ é‡ï¼Œå½¢çŠ¶ä¸º (max_seq_len_en, BATCH_SIZE)</span><br><span class=\"line\">    &quot;&quot;&quot;</span><br><span class=\"line\">    ja_batch, en_batch = [], []  # åˆå§‹åŒ–æ—¥æ–‡å’Œè‹±æ–‡æ‰¹é‡å¼ é‡åˆ—è¡¨</span><br><span class=\"line\">    for (ja_item, en_item) in data_batch:</span><br><span class=\"line\">        # åœ¨æ—¥æ–‡å¥å­çš„å¼€å¤´å’Œç»“å°¾æ·»åŠ  &lt;bos&gt; å’Œ &lt;eos&gt; æ ‡è®°</span><br><span class=\"line\">        ja_batch.append(torch.cat([torch.tensor([BOS_IDX]), ja_item, torch.tensor([EOS_IDX])], dim=0))</span><br><span class=\"line\">        # åœ¨è‹±æ–‡å¥å­çš„å¼€å¤´å’Œç»“å°¾æ·»åŠ  &lt;bos&gt; å’Œ &lt;eos&gt; æ ‡è®°</span><br><span class=\"line\">        en_batch.append(torch.cat([torch.tensor([BOS_IDX]), en_item, torch.tensor([EOS_IDX])], dim=0))</span><br><span class=\"line\">    </span><br><span class=\"line\">    # å¯¹æ—¥æ–‡å’Œè‹±æ–‡å¥å­æ‰¹é‡è¿›è¡Œå¡«å……ï¼Œä½¿å®ƒä»¬çš„é•¿åº¦ä¸€è‡´</span><br><span class=\"line\">    ja_batch = pad_sequence(ja_batch, padding_value=PAD_IDX)</span><br><span class=\"line\">    en_batch = pad_sequence(en_batch, padding_value=PAD_IDX)</span><br><span class=\"line\">    </span><br><span class=\"line\">    return ja_batch, en_batch</span><br><span class=\"line\"></span><br><span class=\"line\"># ä½¿ç”¨ DataLoader åŠ è½½è®­ç»ƒæ•°æ®é›† train_dataï¼Œå¹¶ç”Ÿæˆæ‰¹é‡æ•°æ®</span><br><span class=\"line\">train_iter = DataLoader(train_data, batch_size=BATCH_SIZE,</span><br><span class=\"line\">                        shuffle=True, collate_fn=generate_batch)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Seq2seq-Transformer\"><a href=\"#Seq2seq-Transformer\" class=\"headerlink\" title=\"Seq2seq Transformer\"></a>Seq2seq Transformer</h2><p>æ¥ä¸‹æ¥çš„å‡ ä¸ªä»£ç å’Œæ–‡æœ¬è¯´æ˜ï¼ˆç”¨æ–œä½“ä¹¦å†™ï¼‰å–è‡ª<a href=\"https://pytorch.org/tutorials/beginner/translation_transformer.html\">åŸå§‹çš„ PyTorch æ•™ç¨‹</a>. é™¤äº†BATCH_SIZEä¹‹å¤–ï¼Œæˆ‘æ²¡æœ‰åšä»»ä½•æ›´æ”¹ï¼Œde_vocabwhich è¿™ä¸ªè¯è¢«æ”¹æˆäº†ja_vocabã€‚</p>\n<p>Transformer æ˜¯ â€œAttention is all you needâ€ è®ºæ–‡ä¸­ä»‹ç»çš„ Seq2Seq æ¨¡å‹ï¼Œç”¨äºè§£å†³æœºå™¨ç¿»è¯‘ä»»åŠ¡ã€‚Transformer æ¨¡å‹ç”±ç¼–ç å™¨å’Œè§£ç å™¨å—ç»„æˆï¼Œæ¯ä¸ªå—åŒ…å«å›ºå®šæ•°é‡çš„å±‚ã€‚</p>\n<p>ç¼–ç å™¨é€šè¿‡ä¸€ç³»åˆ—å¤šå¤´æ³¨æ„åŠ›å’Œå‰é¦ˆç½‘ç»œå±‚ä¼ æ’­è¾“å…¥åºåˆ—æ¥å¤„ç†è¾“å…¥åºåˆ—ã€‚ç¼–ç å™¨çš„è¾“å‡ºç§°ä¸ºå†…å­˜ï¼Œä¸ç›®æ ‡å¼ é‡ä¸€èµ·é¦ˆé€åˆ°è§£ç å™¨ã€‚ç¼–ç å™¨å’Œè§£ç å™¨ä½¿ç”¨æ•™å¸ˆå¼ºåˆ¶æŠ€æœ¯ä»¥ç«¯åˆ°ç«¯çš„æ–¹å¼è¿›è¡Œè®­ç»ƒã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> torch.nn <span class=\"keyword\">import</span> TransformerEncoder, TransformerDecoder, TransformerEncoderLayer, TransformerDecoderLayer</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Seq2SeqTransformer</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, num_encoder_layers: <span class=\"built_in\">int</span>, num_decoder_layers: <span class=\"built_in\">int</span>,</span></span><br><span class=\"line\"><span class=\"params\">                 emb_size: <span class=\"built_in\">int</span>, src_vocab_size: <span class=\"built_in\">int</span>, tgt_vocab_size: <span class=\"built_in\">int</span>,</span></span><br><span class=\"line\"><span class=\"params\">                 dim_feedforward:<span class=\"built_in\">int</span> = <span class=\"number\">512</span>, dropout:<span class=\"built_in\">float</span> = <span class=\"number\">0.1</span></span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(Seq2SeqTransformer, self).__init__()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Transformerç¼–ç å™¨å±‚</span></span><br><span class=\"line\">        encoder_layer = TransformerEncoderLayer(d_model=emb_size, nhead=NHEAD,</span><br><span class=\"line\">                                                dim_feedforward=dim_feedforward)</span><br><span class=\"line\">        self.transformer_encoder = TransformerEncoder(encoder_layer, num_layers=num_encoder_layers)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Transformerè§£ç å™¨å±‚</span></span><br><span class=\"line\">        decoder_layer = TransformerDecoderLayer(d_model=emb_size, nhead=NHEAD,</span><br><span class=\"line\">                                                dim_feedforward=dim_feedforward)</span><br><span class=\"line\">        self.transformer_decoder = TransformerDecoder(decoder_layer, num_layers=num_decoder_layers)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># çº¿æ€§å±‚ï¼Œç”¨äºç”Ÿæˆæœ€ç»ˆçš„ç›®æ ‡è¯æ±‡è¡¨è¾“å‡º</span></span><br><span class=\"line\">        self.generator = nn.Linear(emb_size, tgt_vocab_size)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„è¯åµŒå…¥å±‚</span></span><br><span class=\"line\">        self.src_tok_emb = TokenEmbedding(src_vocab_size, emb_size)  <span class=\"comment\"># TokenEmbeddingæ˜¯è‡ªå®šä¹‰çš„è¯åµŒå…¥ç±»</span></span><br><span class=\"line\">        self.tgt_tok_emb = TokenEmbedding(tgt_vocab_size, emb_size)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># ä½ç½®ç¼–ç å±‚</span></span><br><span class=\"line\">        self.positional_encoding = PositionalEncoding(emb_size, dropout=dropout)  <span class=\"comment\"># PositionalEncodingæ˜¯è‡ªå®šä¹‰çš„ä½ç½®ç¼–ç ç±»</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, src: Tensor, trg: Tensor, src_mask: Tensor,</span></span><br><span class=\"line\"><span class=\"params\">                tgt_mask: Tensor, src_padding_mask: Tensor,</span></span><br><span class=\"line\"><span class=\"params\">                tgt_padding_mask: Tensor, memory_key_padding_mask: Tensor</span>):</span><br><span class=\"line\">        <span class=\"comment\"># å¯¹æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€è¿›è¡Œä½ç½®ç¼–ç </span></span><br><span class=\"line\">        src_emb = self.positional_encoding(self.src_tok_emb(src))</span><br><span class=\"line\">        tgt_emb = self.positional_encoding(self.tgt_tok_emb(trg))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># ç¼–ç é˜¶æ®µï¼šé€šè¿‡Transformerç¼–ç å™¨å¾—åˆ°è®°å¿†(memory)</span></span><br><span class=\"line\">        memory = self.transformer_encoder(src_emb, src_mask, src_padding_mask)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># è§£ç é˜¶æ®µï¼šé€šè¿‡Transformerè§£ç å™¨ç”Ÿæˆç›®æ ‡è¯­è¨€çš„è¾“å‡º</span></span><br><span class=\"line\">        outs = self.transformer_decoder(tgt_emb, memory, tgt_mask, <span class=\"literal\">None</span>,</span><br><span class=\"line\">                                        tgt_padding_mask, memory_key_padding_mask)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\"># ä½¿ç”¨çº¿æ€§å±‚ç”Ÿæˆæœ€ç»ˆçš„ç›®æ ‡è¯æ±‡è¡¨è¾“å‡º</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.generator(outs)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">encode</span>(<span class=\"params\">self, src: Tensor, src_mask: Tensor</span>):</span><br><span class=\"line\">        <span class=\"comment\"># ç¼–ç é˜¶æ®µï¼šä»…ä½¿ç”¨Transformerç¼–ç å™¨å¯¹æºè¯­è¨€è¿›è¡Œç¼–ç ï¼Œä¸æ¶‰åŠè§£ç </span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.transformer_encoder(self.positional_encoding(</span><br><span class=\"line\">                            self.src_tok_emb(src)), src_mask)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">decode</span>(<span class=\"params\">self, tgt: Tensor, memory: Tensor, tgt_mask: Tensor</span>):</span><br><span class=\"line\">        <span class=\"comment\"># è§£ç é˜¶æ®µï¼šä½¿ç”¨Transformerè§£ç å™¨ç”Ÿæˆç›®æ ‡è¯­è¨€çš„è¾“å‡º</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.transformer_decoder(self.positional_encoding(</span><br><span class=\"line\">                          self.tgt_tok_emb(tgt)), memory,</span><br><span class=\"line\">                          tgt_mask)</span><br></pre></td></tr></table></figure>\n<p>æ–‡æœ¬æ ‡è®°é€šè¿‡ä½¿ç”¨æ ‡è®°åµŒå…¥æ¥è¡¨ç¤ºã€‚ä½ç½®ç¼–ç è¢«æ·»åŠ åˆ°æ ‡è®°åµŒå…¥ä¸­ï¼Œä»¥å¼•å…¥è¯åºçš„æ¦‚å¿µã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">PositionalEncoding</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, emb_size: <span class=\"built_in\">int</span>, dropout, maxlen: <span class=\"built_in\">int</span> = <span class=\"number\">5000</span></span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(PositionalEncoding, self).__init__()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># è®¡ç®—ä½ç½®ç¼–ç çŸ©é˜µ</span></span><br><span class=\"line\">        den = torch.exp(- torch.arange(<span class=\"number\">0</span>, emb_size, <span class=\"number\">2</span>) * math.log(<span class=\"number\">10000</span>) / emb_size)  <span class=\"comment\"># è®¡ç®—åˆ†æ¯</span></span><br><span class=\"line\">        pos = torch.arange(<span class=\"number\">0</span>, maxlen).reshape(maxlen, <span class=\"number\">1</span>)  <span class=\"comment\"># ç”Ÿæˆä½ç½®ç¼–ç çš„ä½ç½®ç´¢å¼•</span></span><br><span class=\"line\">        pos_embedding = torch.zeros((maxlen, emb_size))  <span class=\"comment\"># åˆå§‹åŒ–ä½ç½®ç¼–ç çŸ©é˜µ</span></span><br><span class=\"line\">        pos_embedding[:, <span class=\"number\">0</span>::<span class=\"number\">2</span>] = torch.sin(pos * den)  <span class=\"comment\"># å¥‡æ•°ç»´åº¦ä¸Šä½¿ç”¨sinå‡½æ•°è®¡ç®—ä½ç½®ç¼–ç </span></span><br><span class=\"line\">        pos_embedding[:, <span class=\"number\">1</span>::<span class=\"number\">2</span>] = torch.cos(pos * den)  <span class=\"comment\"># å¶æ•°ç»´åº¦ä¸Šä½¿ç”¨coså‡½æ•°è®¡ç®—ä½ç½®ç¼–ç </span></span><br><span class=\"line\">        pos_embedding = pos_embedding.unsqueeze(-<span class=\"number\">2</span>)  <span class=\"comment\"># åœ¨å€’æ•°ç¬¬äºŒç»´åº¦ä¸Šæ·»åŠ ä¸€ä¸ªç»´åº¦</span></span><br><span class=\"line\"></span><br><span class=\"line\">        self.dropout = nn.Dropout(dropout)  <span class=\"comment\"># åˆå§‹åŒ–Dropoutå±‚</span></span><br><span class=\"line\">        self.register_buffer(<span class=\"string\">&#x27;pos_embedding&#x27;</span>, pos_embedding)  <span class=\"comment\"># æ³¨å†Œä½ç½®ç¼–ç çŸ©é˜µä¸ºæ¨¡å‹å‚æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, token_embedding: Tensor</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        å‰å‘ä¼ æ’­å‡½æ•°</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">        - token_embedding (Tensor): è¾“å…¥çš„è¯åµŒå…¥å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len, batch_size, emb_size)ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        Returns:</span></span><br><span class=\"line\"><span class=\"string\">        - Tensor: æ·»åŠ äº†ä½ç½®ç¼–ç åçš„å¼ é‡ï¼Œå½¢çŠ¶ä¸è¾“å…¥ç›¸åŒã€‚</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># æ·»åŠ ä½ç½®ç¼–ç åˆ°è¯åµŒå…¥å¼ é‡ä¸Šï¼Œå¹¶åº”ç”¨Dropout</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.dropout(token_embedding +</span><br><span class=\"line\">                            self.pos_embedding[:token_embedding.size(<span class=\"number\">0</span>), :])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TokenEmbedding</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, vocab_size: <span class=\"built_in\">int</span>, emb_size</span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(TokenEmbedding, self).__init__()</span><br><span class=\"line\">        self.embedding = nn.Embedding(vocab_size, emb_size)  <span class=\"comment\"># å®šä¹‰è¯åµŒå…¥å±‚</span></span><br><span class=\"line\">        self.emb_size = emb_size  <span class=\"comment\"># è®°å½•è¯åµŒå…¥ç»´åº¦å¤§å°</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, tokens: Tensor</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        å‰å‘ä¼ æ’­å‡½æ•°</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">        - tokens (Tensor): è¾“å…¥çš„è¯ç´¢å¼•å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len, batch_size)ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        Returns:</span></span><br><span class=\"line\"><span class=\"string\">        - Tensor: å¯¹åº”çš„è¯åµŒå…¥å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len, batch_size, emb_size)ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># å°†è¯ç´¢å¼•è½¬æ¢ä¸ºè¯åµŒå…¥å¼ é‡ï¼Œå¹¶ä¹˜ä»¥ sqrt(emb_size) è¿›è¡Œç¼©æ”¾</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> self.embedding(tokens.long()) * math.sqrt(self.emb_size)</span><br></pre></td></tr></table></figure>\n<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåç»­å•è¯æ©ç æ¥é˜»æ­¢ç›®æ ‡å•è¯å…³æ³¨å…¶åç»­å•è¯ã€‚æˆ‘ä»¬è¿˜åˆ›å»ºæ©ç ï¼Œç”¨äºå±è”½æºå’Œç›®æ ‡å¡«å……ä»¤ç‰Œ</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generate_square_subsequent_mask</span>(<span class=\"params\">sz</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    ç”Ÿæˆä¸€ä¸ªä¸‹ä¸‰è§’å½¢çš„maskçŸ©é˜µï¼Œç”¨äºTransformerè§£ç å™¨ä¸­å±è”½æœªæ¥ä¿¡æ¯ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - sz (int): çŸ©é˜µçš„å¤§å°ï¼Œå³åºåˆ—é•¿åº¦ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - torch.Tensor: ç”Ÿæˆçš„maskçŸ©é˜µï¼Œå½¢çŠ¶ä¸º (sz, sz)ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    mask = (torch.triu(torch.ones((sz, sz), device=device)) == <span class=\"number\">1</span>).transpose(<span class=\"number\">0</span>, <span class=\"number\">1</span>)  <span class=\"comment\"># ç”Ÿæˆä¸‹ä¸‰è§’å½¢çŸ©é˜µ</span></span><br><span class=\"line\">    mask = mask.<span class=\"built_in\">float</span>().masked_fill(mask == <span class=\"number\">0</span>, <span class=\"built_in\">float</span>(<span class=\"string\">&#x27;-inf&#x27;</span>)).masked_fill(mask == <span class=\"number\">1</span>, <span class=\"built_in\">float</span>(<span class=\"number\">0.0</span>))  <span class=\"comment\"># å°†éé›¶ä½ç½®æ›¿æ¢ä¸º-infï¼Œé›¶ä½ç½®æ›¿æ¢ä¸º0.0</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> mask</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_mask</span>(<span class=\"params\">src, tgt</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    åˆ›å»ºç”¨äºTransformeræ¨¡å‹çš„æ©ç å¼ é‡ï¼ŒåŒ…æ‹¬æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€çš„å¡«å……æ©ç ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - src (torch.Tensor): æºè¯­è¨€å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len_src, batch_size)ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - tgt (torch.Tensor): ç›®æ ‡è¯­è¨€å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len_tgt, batch_size)ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - Tuple[torch.Tensor]: åŒ…å«å››ä¸ªæ©ç å¼ é‡çš„å…ƒç»„ï¼š</span></span><br><span class=\"line\"><span class=\"string\">      - src_mask (torch.Tensor): æºè¯­è¨€æ©ç å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len_src, seq_len_src)ã€‚</span></span><br><span class=\"line\"><span class=\"string\">      - tgt_mask (torch.Tensor): ç›®æ ‡è¯­è¨€è§£ç å™¨æ©ç å¼ é‡ï¼Œå½¢çŠ¶ä¸º (seq_len_tgt, seq_len_tgt)ã€‚</span></span><br><span class=\"line\"><span class=\"string\">      - src_padding_mask (torch.Tensor): æºè¯­è¨€å¡«å……æ©ç å¼ é‡ï¼Œå½¢çŠ¶ä¸º (batch_size, seq_len_src)ã€‚</span></span><br><span class=\"line\"><span class=\"string\">      - tgt_padding_mask (torch.Tensor): ç›®æ ‡è¯­è¨€å¡«å……æ©ç å¼ é‡ï¼Œå½¢çŠ¶ä¸º (batch_size, seq_len_tgt)ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    src_seq_len = src.shape[<span class=\"number\">0</span>]  <span class=\"comment\"># è·å–æºè¯­è¨€åºåˆ—é•¿åº¦</span></span><br><span class=\"line\">    tgt_seq_len = tgt.shape[<span class=\"number\">0</span>]  <span class=\"comment\"># è·å–ç›®æ ‡è¯­è¨€åºåˆ—é•¿åº¦</span></span><br><span class=\"line\"></span><br><span class=\"line\">    tgt_mask = generate_square_subsequent_mask(tgt_seq_len)  <span class=\"comment\"># ç”Ÿæˆç›®æ ‡è¯­è¨€è§£ç å™¨æ©ç å¼ é‡</span></span><br><span class=\"line\">    src_mask = torch.zeros((src_seq_len, src_seq_len), device=device).<span class=\"built_in\">type</span>(torch.<span class=\"built_in\">bool</span>)  <span class=\"comment\"># åˆ›å»ºæºè¯­è¨€æ©ç å¼ é‡ï¼Œå…¨ä¸ºFalse</span></span><br><span class=\"line\"></span><br><span class=\"line\">    src_padding_mask = (src == PAD_IDX).transpose(<span class=\"number\">0</span>, <span class=\"number\">1</span>)  <span class=\"comment\"># åˆ›å»ºæºè¯­è¨€å¡«å……æ©ç å¼ é‡ï¼ŒTrueè¡¨ç¤ºå¡«å……ä½ç½®</span></span><br><span class=\"line\">    tgt_padding_mask = (tgt == PAD_IDX).transpose(<span class=\"number\">0</span>, <span class=\"number\">1</span>)  <span class=\"comment\"># åˆ›å»ºç›®æ ‡è¯­è¨€å¡«å……æ©ç å¼ é‡ï¼ŒTrueè¡¨ç¤ºå¡«å……ä½ç½®</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> src_mask, tgt_mask, src_padding_mask, tgt_padding_mask</span><br></pre></td></tr></table></figure>\n<p>å½“ä½ ä½¿ç”¨è‡ªå·±çš„GPUçš„æ—¶å€™ï¼ŒNUM_ENCODER_LAYERS å’Œ NUM_DECODER_LAYERS è®¾ç½®ä¸º3æˆ–è€…æ›´é«˜ï¼ŒNHEADè®¾ç½®8ï¼ŒEMB_SIZEè®¾ç½®ä¸º512ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">SRC_VOCAB_SIZE = <span class=\"built_in\">len</span>(ja_vocab)  <span class=\"comment\"># æºè¯­è¨€è¯æ±‡è¡¨å¤§å°</span></span><br><span class=\"line\">TGT_VOCAB_SIZE = <span class=\"built_in\">len</span>(en_vocab)  <span class=\"comment\"># ç›®æ ‡è¯­è¨€è¯æ±‡è¡¨å¤§å°</span></span><br><span class=\"line\">EMB_SIZE = <span class=\"number\">512</span>  <span class=\"comment\"># è¯åµŒå…¥ç»´åº¦å¤§å°</span></span><br><span class=\"line\">NHEAD = <span class=\"number\">8</span>  <span class=\"comment\"># æ³¨æ„åŠ›å¤´æ•°</span></span><br><span class=\"line\">FFN_HID_DIM = <span class=\"number\">512</span>  <span class=\"comment\"># FeedForwardå±‚éšè—å•å…ƒæ•°</span></span><br><span class=\"line\">BATCH_SIZE = <span class=\"number\">16</span>  <span class=\"comment\"># æ‰¹é‡å¤§å°</span></span><br><span class=\"line\">NUM_ENCODER_LAYERS = <span class=\"number\">3</span>  <span class=\"comment\"># ç¼–ç å™¨å±‚æ•°</span></span><br><span class=\"line\">NUM_DECODER_LAYERS = <span class=\"number\">3</span>  <span class=\"comment\"># è§£ç å™¨å±‚æ•°</span></span><br><span class=\"line\">NUM_EPOCHS = <span class=\"number\">16</span>  <span class=\"comment\"># è®­ç»ƒè½®æ•°</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ–Transformeræ¨¡å‹</span></span><br><span class=\"line\">transformer = Seq2SeqTransformer(NUM_ENCODER_LAYERS, NUM_DECODER_LAYERS,</span><br><span class=\"line\">                                 EMB_SIZE, SRC_VOCAB_SIZE, TGT_VOCAB_SIZE,</span><br><span class=\"line\">                                 FFN_HID_DIM)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨Xavieråˆå§‹åŒ–æ‰€æœ‰æ¨¡å‹å‚æ•°</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> p <span class=\"keyword\">in</span> transformer.parameters():</span><br><span class=\"line\">    <span class=\"keyword\">if</span> p.dim() &gt; <span class=\"number\">1</span>:</span><br><span class=\"line\">        nn.init.xavier_uniform_(p)</span><br><span class=\"line\"></span><br><span class=\"line\">transformer = transformer.to(device)  <span class=\"comment\"># å°†æ¨¡å‹ç§»åŠ¨åˆ°GPUä¸Šï¼ˆå¦‚æœå¯ç”¨ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">loss_fn = torch.nn.CrossEntropyLoss(ignore_index=PAD_IDX)  <span class=\"comment\"># å®šä¹‰äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œå¿½ç•¥å¡«å……ä½ç½®</span></span><br><span class=\"line\"></span><br><span class=\"line\">optimizer = torch.optim.Adam(</span><br><span class=\"line\">    transformer.parameters(), lr=<span class=\"number\">0.0001</span>, betas=(<span class=\"number\">0.9</span>, <span class=\"number\">0.98</span>), eps=<span class=\"number\">1e-9</span></span><br><span class=\"line\">)  <span class=\"comment\"># å®šä¹‰Adamä¼˜åŒ–å™¨</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">train_epoch</span>(<span class=\"params\">model, train_iter, optimizer</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    è®­ç»ƒæ¨¡å‹ä¸€ä¸ªepochï¼Œå¹¶è¿”å›å¹³å‡æŸå¤±å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - model (Seq2SeqTransformer): Transformeræ¨¡å‹å®ä¾‹ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - train_iter (DataLoader): è®­ç»ƒæ•°æ®è¿­ä»£å™¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - optimizer (torch.optim.Adam): æ¨¡å‹ä¼˜åŒ–å™¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - float: å¹³å‡è®­ç»ƒæŸå¤±ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    model.train()  <span class=\"comment\"># è®¾ç½®æ¨¡å‹ä¸ºè®­ç»ƒæ¨¡å¼</span></span><br><span class=\"line\">    losses = <span class=\"number\">0</span>  <span class=\"comment\"># åˆå§‹åŒ–æŸå¤±å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> idx, (src, tgt) <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(train_iter):</span><br><span class=\"line\">        src = src.to(device)  <span class=\"comment\"># å°†æºè¯­è¨€æ•°æ®ç§»åˆ°GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰</span></span><br><span class=\"line\">        tgt = tgt.to(device)  <span class=\"comment\"># å°†ç›®æ ‡è¯­è¨€æ•°æ®ç§»åˆ°GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">        tgt_input = tgt[:-<span class=\"number\">1</span>, :]  <span class=\"comment\"># è·å–ç›®æ ‡è¯­è¨€è¾“å…¥åºåˆ—ï¼ˆä¸åŒ…æ‹¬æœ«å°¾çš„EOSï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">        src_mask, tgt_mask, src_padding_mask, tgt_padding_mask = create_mask(src, tgt_input)  <span class=\"comment\"># åˆ›å»ºæ©ç å¼ é‡</span></span><br><span class=\"line\"></span><br><span class=\"line\">        logits = model(src, tgt_input, src_mask, tgt_mask,</span><br><span class=\"line\">                       src_padding_mask, tgt_padding_mask, src_padding_mask)  <span class=\"comment\"># å‰å‘ä¼ æ’­è®¡ç®—logits</span></span><br><span class=\"line\"></span><br><span class=\"line\">        optimizer.zero_grad()  <span class=\"comment\"># æ¢¯åº¦æ¸…é›¶</span></span><br><span class=\"line\"></span><br><span class=\"line\">        tgt_out = tgt[<span class=\"number\">1</span>:, :]  <span class=\"comment\"># è·å–ç›®æ ‡è¯­è¨€è¾“å‡ºåºåˆ—ï¼ˆä¸åŒ…æ‹¬å¼€å¤´çš„BOSï¼‰</span></span><br><span class=\"line\">        loss = loss_fn(logits.reshape(-<span class=\"number\">1</span>, logits.shape[-<span class=\"number\">1</span>]), tgt_out.reshape(-<span class=\"number\">1</span>))  <span class=\"comment\"># è®¡ç®—æŸå¤±</span></span><br><span class=\"line\">        loss.backward()  <span class=\"comment\"># åå‘ä¼ æ’­</span></span><br><span class=\"line\"></span><br><span class=\"line\">        optimizer.step()  <span class=\"comment\"># æ›´æ–°æ¨¡å‹å‚æ•°</span></span><br><span class=\"line\">        losses += loss.item()  <span class=\"comment\"># ç´¯åŠ æŸå¤±å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> losses / <span class=\"built_in\">len</span>(train_iter)  <span class=\"comment\"># è¿”å›å¹³å‡æŸå¤±</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">evaluate</span>(<span class=\"params\">model, val_iter</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    è¯„ä¼°æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„æ€§èƒ½ï¼Œå¹¶è¿”å›å¹³å‡æŸå¤±å€¼ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - model (Seq2SeqTransformer): Transformeræ¨¡å‹å®ä¾‹ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - val_iter (DataLoader): éªŒè¯æ•°æ®è¿­ä»£å™¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - float: å¹³å‡éªŒè¯æŸå¤±ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    model.<span class=\"built_in\">eval</span>()  <span class=\"comment\"># è®¾ç½®æ¨¡å‹ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class=\"line\">    losses = <span class=\"number\">0</span>  <span class=\"comment\"># åˆå§‹åŒ–æŸå¤±å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> idx, (src, tgt) <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(valid_iter):</span><br><span class=\"line\">        src = src.to(device)  <span class=\"comment\"># å°†æºè¯­è¨€æ•°æ®ç§»åˆ°GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰</span></span><br><span class=\"line\">        tgt = tgt.to(device)  <span class=\"comment\"># å°†ç›®æ ‡è¯­è¨€æ•°æ®ç§»åˆ°GPUï¼ˆå¦‚æœå¯ç”¨ï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">        tgt_input = tgt[:-<span class=\"number\">1</span>, :]  <span class=\"comment\"># è·å–ç›®æ ‡è¯­è¨€è¾“å…¥åºåˆ—ï¼ˆä¸åŒ…æ‹¬æœ«å°¾çš„EOSï¼‰</span></span><br><span class=\"line\"></span><br><span class=\"line\">        src_mask, tgt_mask, src_padding_mask, tgt_padding_mask = create_mask(src, tgt_input)  <span class=\"comment\"># åˆ›å»ºæ©ç å¼ é‡</span></span><br><span class=\"line\"></span><br><span class=\"line\">        logits = model(src, tgt_input, src_mask, tgt_mask,</span><br><span class=\"line\">                       src_padding_mask, tgt_padding_mask, src_padding_mask)  <span class=\"comment\"># å‰å‘ä¼ æ’­è®¡ç®—logits</span></span><br><span class=\"line\"></span><br><span class=\"line\">        tgt_out = tgt[<span class=\"number\">1</span>:, :]  <span class=\"comment\"># è·å–ç›®æ ‡è¯­è¨€è¾“å‡ºåºåˆ—ï¼ˆä¸åŒ…æ‹¬å¼€å¤´çš„BOSï¼‰</span></span><br><span class=\"line\">        loss = loss_fn(logits.reshape(-<span class=\"number\">1</span>, logits.shape[-<span class=\"number\">1</span>]), tgt_out.reshape(-<span class=\"number\">1</span>))  <span class=\"comment\"># è®¡ç®—æŸå¤±</span></span><br><span class=\"line\">        losses += loss.item()  <span class=\"comment\"># ç´¯åŠ æŸå¤±å€¼</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> losses / <span class=\"built_in\">len</span>(val_iter)  <span class=\"comment\"># è¿”å›å¹³å‡æŸå¤±</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"å¼€å§‹è®­ç»ƒ\"><a href=\"#å¼€å§‹è®­ç»ƒ\" class=\"headerlink\" title=\"å¼€å§‹è®­ç»ƒ\"></a>å¼€å§‹è®­ç»ƒ</h2><p>æœ€åï¼Œåœ¨å‡†å¤‡äº†å¿…è¦çš„ç±»å’Œå‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬å‡†å¤‡è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ã€‚è¿™æ˜¯ä¸è¨€è€Œå–»çš„ï¼Œä½†å®Œæˆè®­ç»ƒæ‰€éœ€çš„æ—¶é—´å¯èƒ½ä¼šæœ‰å¾ˆå¤§å·®å¼‚ï¼Œå…·ä½“å–å†³äºå¾ˆå¤šå› ç´ ï¼Œä¾‹å¦‚è®¡ç®—èƒ½åŠ›ã€å‚æ•°å’Œæ•°æ®é›†çš„å¤§å°ã€‚</p>\n<p>å½“æˆ‘ä½¿ç”¨ JParaCrawl çš„å®Œæ•´å¥å­åˆ—è¡¨ï¼ˆæ¯ç§è¯­è¨€å¤§çº¦æœ‰ 590 ä¸‡ä¸ªå¥å­ï¼‰è®­ç»ƒæ¨¡å‹æ—¶ï¼Œä½¿ç”¨å•ä¸ª NVIDIA GeForce RTX 4090 GPU æ¯16ä¸ª epoch å¤§çº¦éœ€è¦ 55åˆ†é’Ÿã€‚</p>\n<p>ä»£ç å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span> epoch <span class=\"keyword\">in</span> tqdm.tqdm(<span class=\"built_in\">range</span>(<span class=\"number\">1</span>, NUM_EPOCHS+<span class=\"number\">1</span>)):</span><br><span class=\"line\">    start_time = time.time()  <span class=\"comment\"># è®°å½•å½“å‰epochå¼€å§‹æ—¶é—´</span></span><br><span class=\"line\">    train_loss = train_epoch(transformer, train_iter, optimizer)  <span class=\"comment\"># è®­ç»ƒä¸€ä¸ªepoch</span></span><br><span class=\"line\">    end_time = time.time()  <span class=\"comment\"># è®°å½•å½“å‰epochç»“æŸæ—¶é—´</span></span><br><span class=\"line\">    <span class=\"comment\"># æ‰“å°è®­ç»ƒä¿¡æ¯ï¼šå½“å‰epochæ•°ã€è®­ç»ƒæŸå¤±ã€å½“å‰epochæ‰€ç”¨æ—¶é—´</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>((<span class=\"string\">f&quot;Epoch: <span class=\"subst\">&#123;epoch&#125;</span>, Train loss: <span class=\"subst\">&#123;train_loss:<span class=\"number\">.3</span>f&#125;</span>, &quot;</span></span><br><span class=\"line\">           <span class=\"string\">f&quot;Epoch time = <span class=\"subst\">&#123;(end_time - start_time):<span class=\"number\">.3</span>f&#125;</span>s&quot;</span>))</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14-5.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"å°è¯•ä½¿ç”¨ç»è¿‡è®­ç»ƒçš„æ¨¡å‹ç¿»è¯‘æ—¥è¯­å¥å­\"><a href=\"#å°è¯•ä½¿ç”¨ç»è¿‡è®­ç»ƒçš„æ¨¡å‹ç¿»è¯‘æ—¥è¯­å¥å­\" class=\"headerlink\" title=\"å°è¯•ä½¿ç”¨ç»è¿‡è®­ç»ƒçš„æ¨¡å‹ç¿»è¯‘æ—¥è¯­å¥å­\"></a>å°è¯•ä½¿ç”¨ç»è¿‡è®­ç»ƒçš„æ¨¡å‹ç¿»è¯‘æ—¥è¯­å¥å­</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºç¿»è¯‘æ–°å¥å­çš„å‡½æ•°ï¼ŒåŒ…æ‹¬è·å–æ—¥è¯­å¥å­ã€æ ‡è®°åŒ–ã€è½¬æ¢ä¸ºå¼ é‡ã€æ¨ç†ç­‰æ­¥éª¤ï¼Œç„¶åå°†ç»“æœè§£ç å›å¥å­ï¼Œä½†è¿™æ¬¡æ˜¯ä¸­æ–‡ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">greedy_decode</span>(<span class=\"params\">model, src, src_mask, max_len, start_symbol</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    ä½¿ç”¨è´ªå©ªè§£ç ç­–ç•¥ç”Ÿæˆç¿»è¯‘ç»“æœã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - model (Seq2SeqTransformer): Transformeræ¨¡å‹å®ä¾‹ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - src (Tensor): è¾“å…¥æºè¯­è¨€åºåˆ—å¼ é‡ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - src_mask (Tensor): è¾“å…¥æºè¯­è¨€æ©ç å¼ é‡ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - max_len (int): ç”Ÿæˆçš„æœ€å¤§é•¿åº¦ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - start_symbol (int): ç›®æ ‡è¯­è¨€èµ·å§‹ç¬¦å·ç´¢å¼•ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - ys (Tensor): ç”Ÿæˆçš„ç›®æ ‡è¯­è¨€åºåˆ—å¼ é‡ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    src = src.to(device)</span><br><span class=\"line\">    src_mask = src_mask.to(device)</span><br><span class=\"line\">    memory = model.encode(src, src_mask)  <span class=\"comment\"># ç¼–ç æºè¯­è¨€åºåˆ—</span></span><br><span class=\"line\">    ys = torch.ones(<span class=\"number\">1</span>, <span class=\"number\">1</span>).fill_(start_symbol).<span class=\"built_in\">type</span>(torch.long).to(device)  <span class=\"comment\"># åˆå§‹åŒ–ç›®æ ‡è¯­è¨€åºåˆ—èµ·å§‹ç¬¦å·</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(max_len-<span class=\"number\">1</span>):</span><br><span class=\"line\">        memory = memory.to(device)</span><br><span class=\"line\">        memory_mask = torch.zeros(ys.shape[<span class=\"number\">0</span>], memory.shape[<span class=\"number\">0</span>]).to(device).<span class=\"built_in\">type</span>(torch.<span class=\"built_in\">bool</span>)</span><br><span class=\"line\">        tgt_mask = (generate_square_subsequent_mask(ys.size(<span class=\"number\">0</span>))</span><br><span class=\"line\">                    .<span class=\"built_in\">type</span>(torch.<span class=\"built_in\">bool</span>)).to(device)</span><br><span class=\"line\">        out = model.decode(ys, memory, tgt_mask)  <span class=\"comment\"># è§£ç ç”Ÿæˆä¸‹ä¸€ä¸ªç›®æ ‡è¯­è¨€å•è¯æ¦‚ç‡åˆ†å¸ƒ</span></span><br><span class=\"line\">        out = out.transpose(<span class=\"number\">0</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">        prob = model.generator(out[:, -<span class=\"number\">1</span>])  <span class=\"comment\"># ç”Ÿæˆä¸‹ä¸€ä¸ªç›®æ ‡è¯­è¨€å•è¯çš„æ¦‚ç‡åˆ†å¸ƒ</span></span><br><span class=\"line\">        _, next_word = torch.<span class=\"built_in\">max</span>(prob, dim=<span class=\"number\">1</span>)  <span class=\"comment\"># è·å–æ¦‚ç‡æœ€å¤§çš„å•è¯ç´¢å¼•</span></span><br><span class=\"line\">        next_word = next_word.item()  <span class=\"comment\"># è·å–å•è¯ç´¢å¼•å€¼</span></span><br><span class=\"line\">        ys = torch.cat([ys,</span><br><span class=\"line\">                        torch.ones(<span class=\"number\">1</span>, <span class=\"number\">1</span>).type_as(src.data).fill_(next_word)], dim=<span class=\"number\">0</span>)  <span class=\"comment\"># å°†é¢„æµ‹çš„å•è¯æ·»åŠ åˆ°ç›®æ ‡è¯­è¨€åºåˆ—ä¸­</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> next_word == EOS_IDX:</span><br><span class=\"line\">            <span class=\"keyword\">break</span>  <span class=\"comment\"># å¦‚æœé¢„æµ‹çš„å•è¯ä¸ºç»“æŸç¬¦å·ï¼Œåˆ™åœæ­¢ç”Ÿæˆ</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> ys</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">translate</span>(<span class=\"params\">model, src, src_vocab, tgt_vocab, src_tokenizer</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    å¯¹æºè¯­è¨€æ–‡æœ¬è¿›è¡Œç¿»è¯‘ï¼Œå¹¶è¿”å›ç¿»è¯‘ç»“æœã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">    - model (Seq2SeqTransformer): Transformeræ¨¡å‹å®ä¾‹ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - src (str): æºè¯­è¨€æ–‡æœ¬ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - src_vocab (Vocab): æºè¯­è¨€è¯æ±‡è¡¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - tgt_vocab (Vocab): ç›®æ ‡è¯­è¨€è¯æ±‡è¡¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    - src_tokenizer (spm.SentencePieceProcessor): æºè¯­è¨€åˆ†è¯å™¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">    - str: ç¿»è¯‘åçš„ç›®æ ‡è¯­è¨€æ–‡æœ¬ã€‚</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    model.<span class=\"built_in\">eval</span>()  <span class=\"comment\"># è®¾ç½®æ¨¡å‹ä¸ºè¯„ä¼°æ¨¡å¼</span></span><br><span class=\"line\">    tokens = [BOS_IDX] + [src_vocab.stoi[tok] <span class=\"keyword\">for</span> tok <span class=\"keyword\">in</span> src_tokenizer.encode(src, out_type=<span class=\"built_in\">str</span>)] + [EOS_IDX]  <span class=\"comment\"># å°†æºè¯­è¨€æ–‡æœ¬ç¼–ç ä¸ºç´¢å¼•åºåˆ—</span></span><br><span class=\"line\">    num_tokens = <span class=\"built_in\">len</span>(tokens)</span><br><span class=\"line\">    src = torch.LongTensor(tokens).reshape(num_tokens, <span class=\"number\">1</span>)  <span class=\"comment\"># å°†ç´¢å¼•åºåˆ—è½¬æ¢ä¸ºTensorï¼Œå¹¶reshapeä¸º(num_tokens, 1)</span></span><br><span class=\"line\">    src_mask = (torch.zeros(num_tokens, num_tokens)).<span class=\"built_in\">type</span>(torch.<span class=\"built_in\">bool</span>)  <span class=\"comment\"># ç”Ÿæˆæºè¯­è¨€æ©ç å¼ é‡</span></span><br><span class=\"line\">    tgt_tokens = greedy_decode(model, src, src_mask, max_len=num_tokens + <span class=\"number\">5</span>, start_symbol=BOS_IDX).flatten()  <span class=\"comment\"># ä½¿ç”¨è´ªå©ªè§£ç ç”Ÿæˆç›®æ ‡è¯­è¨€ç´¢å¼•åºåˆ—</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&quot; &quot;</span>.join([tgt_vocab.itos[tok] <span class=\"keyword\">for</span> tok <span class=\"keyword\">in</span> tgt_tokens]).replace(<span class=\"string\">&quot;&lt;bos&gt;&quot;</span>, <span class=\"string\">&quot;&quot;</span>).replace(<span class=\"string\">&quot;&lt;eos&gt;&quot;</span>, <span class=\"string\">&quot;&quot;</span>)  <span class=\"comment\"># å°†ç”Ÿæˆçš„ç›®æ ‡è¯­è¨€ç´¢å¼•åºåˆ—è½¬æ¢ä¸ºæ–‡æœ¬å¹¶è¿”å›</span></span><br></pre></td></tr></table></figure>\n<p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ translate å‡½æ•°å¹¶ä¼ é€’æ‰€éœ€çš„å‚æ•°ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(translate(transformer, <span class=\"string\">&quot;ãƒ©ã‚¤ãƒˆã‚¬ã‚¤ãƒ‰ãƒ¯ã‚¤ãƒ¤ãƒ¼ãŠã‚ˆã³ãƒ©ã‚¤ãƒˆã‚¬ã‚¤ãƒ‰ãƒ¯ã‚¤ãƒ¤ãƒ¼ï¼›&quot;</span>, ja_vocab, en_vocab, ja_tokenizer))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(traincn.pop(<span class=\"number\">5</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(trainja.pop(<span class=\"number\">5</span>))</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14-6.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"ä¿å­˜-Vocab-å¯¹è±¡å’Œè®­ç»ƒçš„æ¨¡å‹\"><a href=\"#ä¿å­˜-Vocab-å¯¹è±¡å’Œè®­ç»ƒçš„æ¨¡å‹\" class=\"headerlink\" title=\"ä¿å­˜ Vocab å¯¹è±¡å’Œè®­ç»ƒçš„æ¨¡å‹\"></a>ä¿å­˜ Vocab å¯¹è±¡å’Œè®­ç»ƒçš„æ¨¡å‹</h2><p>æœ€åï¼Œåœ¨è®­ç»ƒå®Œæˆåï¼Œæˆ‘ä»¬å°†é¦–å…ˆä½¿ç”¨ Pickle ä¿å­˜ Vocab å¯¹è±¡ï¼ˆen_vocab å’Œ ja_vocabï¼‰ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pickle</span><br><span class=\"line\"><span class=\"comment\"># open a file, where you want to store the data</span></span><br><span class=\"line\">file = <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;en_vocab.pkl&#x27;</span>, <span class=\"string\">&#x27;wb&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\"># dump information to that file</span></span><br><span class=\"line\">pickle.dump(en_vocab, file)</span><br><span class=\"line\">file.close()</span><br><span class=\"line\">file = <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;ja_vocab.pkl&#x27;</span>, <span class=\"string\">&#x27;wb&#x27;</span>)</span><br><span class=\"line\">pickle.dump(ja_vocab, file)</span><br><span class=\"line\">file.close()</span><br></pre></td></tr></table></figure>\n<p>æœ€åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ PyTorch save å’Œ load å‡½æ•°ä¿å­˜æ¨¡å‹ä»¥ä¾›ä»¥åä½¿ç”¨ã€‚é€šå¸¸ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä¿å­˜æ¨¡å‹ï¼Œå…·ä½“å–å†³äºæˆ‘ä»¬ä»¥åè¦ä½¿ç”¨å®ƒä»¬çš„å†…å®¹ã€‚ç¬¬ä¸€ä¸ªä»…ç”¨äºæ¨ç†ï¼Œæˆ‘ä»¬å¯ä»¥ç¨ååŠ è½½æ¨¡å‹å¹¶ä½¿ç”¨å®ƒä»æ—¥è¯­ç¿»è¯‘æˆè‹±è¯­ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># save model for inference</span></span><br><span class=\"line\">torch.save(transformer.state_dict(), <span class=\"string\">&#x27;inference_model&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p>ç¬¬äºŒä¸ªæ—¢å¯ä»¥ç”¨äºæ¨ç†ï¼Œä¹Ÿå¯ä»¥ç”¨äºæˆ‘ä»¬ç¨åæƒ³è¦åŠ è½½æ¨¡å‹å¹¶æƒ³è¦æ¢å¤è®­ç»ƒæ—¶ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># save model + checkpoint to resume training later</span></span><br><span class=\"line\">torch.save(&#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;epoch&#x27;</span>: NUM_EPOCHS,</span><br><span class=\"line\">  <span class=\"string\">&#x27;model_state_dict&#x27;</span>: transformer.state_dict(),</span><br><span class=\"line\">  <span class=\"string\">&#x27;optimizer_state_dict&#x27;</span>: optimizer.state_dict(),</span><br><span class=\"line\">  <span class=\"string\">&#x27;loss&#x27;</span>: train_loss,</span><br><span class=\"line\">  &#125;, <span class=\"string\">&#x27;model_checkpoint.tar&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"åŠ è½½æ¨ç†æ¨¡å‹\"><a href=\"#åŠ è½½æ¨ç†æ¨¡å‹\" class=\"headerlink\" title=\"åŠ è½½æ¨ç†æ¨¡å‹\"></a>åŠ è½½æ¨ç†æ¨¡å‹</h2><p>æˆ‘ä»¬è½½å…¥å·²ç»ä¿å­˜çš„æ¨¡å‹ï¼Œè®©å®ƒç¿»è¯‘æ—¥è¯­å¥å­</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;en_vocab.pkl&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">    en_vocab = pickle.load(file)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">&#x27;ja_vocab.pkl&#x27;</span>, <span class=\"string\">&#x27;rb&#x27;</span>) <span class=\"keyword\">as</span> file:</span><br><span class=\"line\">    ja_vocab = pickle.load(file)</span><br><span class=\"line\">transformer.load_state_dict(torch.load(<span class=\"string\">&#x27;inference_model&#x27;</span>))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(translate(transformer, </span><br><span class=\"line\"><span class=\"string\">&quot;ãƒ©ã‚¤ãƒˆã‚¬ã‚¤ãƒ‰ãƒ¯ã‚¤ãƒ¤ãƒ¼ãŠã‚ˆã³ãƒ©ã‚¤ã‚¬ã‚¤ãƒ‰ãƒ¯ã‚¤ãƒ¤ãƒ¼ï¼›&quot;</span>, </span><br><span class=\"line\">ja_vocab, en_vocab, ja_tokenizer))</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/lab14-7.png?raw=true\" alt=\"alt text\"></p>\n","categories":["Deep Learning"]},{"title":"åŸºäºå‰é¦ˆç¥ç»ç½‘ç»œçš„å§“æ°åˆ†ç±»","url":"/2024/06/08/lab4/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"æ„ŸçŸ¥æœº\"><a href=\"#æ„ŸçŸ¥æœº\" class=\"headerlink\" title=\"æ„ŸçŸ¥æœº\"></a>æ„ŸçŸ¥æœº</h1><h2 id=\"ç®€ä»‹\"><a href=\"#ç®€ä»‹\" class=\"headerlink\" title=\"ç®€ä»‹\"></a>ç®€ä»‹</h2><p>æ„ŸçŸ¥æœºï¼ˆè‹±è¯­ï¼šPerceptronï¼‰æ˜¯Frank Rosenblattåœ¨1957å¹´å°±èŒäºåº·å¥ˆå°”èˆªç©ºå®éªŒå®¤ï¼ˆCornell Aeronautical Laboratoryï¼‰æ—¶æ‰€å‘æ˜çš„ä¸€ç§äººå·¥ç¥ç»ç½‘ç»œã€‚å®ƒå¯ä»¥è¢«è§†ä¸ºä¸€ç§æœ€ç®€å•å½¢å¼çš„å‰é¦ˆç¥ç»ç½‘ç»œï¼Œæ˜¯ä¸€ç§äºŒå…ƒçº¿æ€§åˆ†ç±»å™¨ã€‚</p>\n<p>Frank Rosenblattç»™å‡ºäº†ç›¸åº”çš„æ„ŸçŸ¥æœºå­¦ä¹ ç®—æ³•ï¼Œå¸¸ç”¨çš„æœ‰æ„ŸçŸ¥æœºå­¦ä¹ ã€æœ€å°äºŒä¹˜æ³•å’Œæ¢¯åº¦ä¸‹é™æ³•ã€‚è­¬å¦‚ï¼Œæ„ŸçŸ¥æœºåˆ©ç”¨æ¢¯åº¦ä¸‹é™æ³•å¯¹æŸå¤±å‡½æ•°è¿›è¡Œæå°åŒ–ï¼Œæ±‚å‡ºå¯å°†è®­ç»ƒæ•°æ®è¿›è¡Œçº¿æ€§åˆ’åˆ†çš„åˆ†ç¦»è¶…å¹³é¢ï¼Œä»è€Œæ±‚å¾—æ„ŸçŸ¥æœºæ¨¡å‹ã€‚<span id=\"more\"></span></p>\n<p>æ„ŸçŸ¥æœºæ˜¯ç”Ÿç‰©ç¥ç»ç»†èƒçš„ç®€å•æŠ½è±¡ã€‚ç¥ç»ç»†èƒç»“æ„å¤§è‡´å¯åˆ†ä¸ºï¼šæ ‘çªã€çªè§¦ã€ç»†èƒä½“åŠè½´çªã€‚å•ä¸ªç¥ç»ç»†èƒå¯è¢«è§†ä¸ºä¸€ç§åªæœ‰ä¸¤ç§çŠ¶æ€çš„æœºå™¨â€”â€”æ¿€æ´»æ—¶ä¸ºâ€˜æ˜¯â€™ï¼Œè€Œæœªæ¿€æ´»æ—¶ä¸ºâ€˜å¦â€™ã€‚ç¥ç»ç»†èƒçš„çŠ¶æ€å–å†³äºä»å…¶å®ƒçš„ç¥ç»ç»†èƒæ”¶åˆ°çš„è¾“å…¥ä¿¡å·é‡ï¼ŒåŠçªè§¦çš„å¼ºåº¦ï¼ˆæŠ‘åˆ¶æˆ–åŠ å¼ºï¼‰ã€‚å½“ä¿¡å·é‡æ€»å’Œè¶…è¿‡äº†æŸä¸ªé˜ˆå€¼æ—¶ï¼Œç»†èƒä½“å°±ä¼šæ¿€æ´»ï¼Œäº§ç”Ÿç”µè„‰å†²ã€‚ç”µè„‰å†²æ²¿ç€è½´çªå¹¶é€šè¿‡çªè§¦ä¼ é€’åˆ°å…¶å®ƒç¥ç»å…ƒã€‚ä¸ºäº†æ¨¡æ‹Ÿç¥ç»ç»†èƒè¡Œä¸ºï¼Œä¸ä¹‹å¯¹åº”çš„æ„ŸçŸ¥æœºåŸºç¡€æ¦‚å¿µè¢«æå‡ºï¼Œå¦‚æƒé‡ï¼ˆçªè§¦ï¼‰ã€åç½®ï¼ˆé˜ˆå€¼ï¼‰åŠæ¿€æ´»å‡½æ•°ï¼ˆç»†èƒä½“ï¼‰ã€‚</p>\n<p>åœ¨äººå·¥ç¥ç»ç½‘ç»œé¢†åŸŸä¸­ï¼Œæ„ŸçŸ¥æœºä¹Ÿè¢«æŒ‡ä¸ºå•å±‚çš„äººå·¥ç¥ç»ç½‘ç»œï¼Œä»¥åŒºåˆ«äºè¾ƒå¤æ‚çš„å¤šå±‚æ„ŸçŸ¥æœºï¼ˆMultilayer Perceptronï¼‰ã€‚ä½œä¸ºä¸€ç§çº¿æ€§åˆ†ç±»å™¨ï¼Œï¼ˆå•å±‚ï¼‰æ„ŸçŸ¥æœºå¯è¯´æ˜¯æœ€ç®€å•çš„å‰å‘äººå·¥ç¥ç»ç½‘ç»œå½¢å¼ã€‚å°½ç®¡ç»“æ„ç®€å•ï¼Œæ„ŸçŸ¥æœºèƒ½å¤Ÿå­¦ä¹ å¹¶è§£å†³ç›¸å½“å¤æ‚çš„é—®é¢˜ã€‚æ„ŸçŸ¥æœºä¸»è¦çš„æœ¬è´¨ç¼ºé™·æ˜¯å®ƒä¸èƒ½å¤„ç†çº¿æ€§ä¸å¯åˆ†é—®é¢˜ã€‚</p>\n<h2 id=\"å•å±‚æ„ŸçŸ¥æœº\"><a href=\"#å•å±‚æ„ŸçŸ¥æœº\" class=\"headerlink\" title=\"å•å±‚æ„ŸçŸ¥æœº\"></a>å•å±‚æ„ŸçŸ¥æœº</h2><h3 id=\"æ¨¡å‹ç»“æ„\"><a href=\"#æ¨¡å‹ç»“æ„\" class=\"headerlink\" title=\"æ¨¡å‹ç»“æ„\"></a>æ¨¡å‹ç»“æ„</h3><p>å•å±‚æ„ŸçŸ¥æœºçš„æ¨¡å‹å¯ä»¥ç®€å•è¡¨ç¤ºä¸ºï¼š<br>$$ f(x) &#x3D; sign(w*x+b) $$<br>å¯¹äºå…·æœ‰ $n$ ä¸ªè¾“å…¥ $x_{i}$ ä»¥åŠå¯¹åº”è¿æ¥æƒé‡ç³»æ•°ä¸º $w_j$ çš„æ„ŸçŸ¥æœºï¼Œé¦–å…ˆé€šè¿‡çº¿æ€§åŠ æƒå¾—åˆ°è¾“å…¥æ•°æ®çš„ç´¯åŠ ç»“æœ $z$ï¼š$z&#x3D;w_1 x_1+w_2 x_2+ â€¦ +b$ã€‚è¿™é‡Œ $x_1,x_2,â€¦,x_n$ ä¸ºæ„ŸçŸ¥æœºçš„è¾“å…¥ï¼Œ$w_1,w_2,â€¦,w_n$ä¸ºç½‘ç»œçš„æƒé‡ç³»æ•°ï¼Œ$b$ ä¸ºåç½®é¡¹ï¼ˆ$bias$ï¼‰ã€‚ç„¶åå°† $z$ ä½œä¸ºæ¿€æ´»å‡½æ•° $\\varPhi(\\cdot)$ çš„è¾“å…¥ï¼Œè¿™é‡Œæ¿€æ´»å‡½æ•° $\\varPhi(\\cdot)$ä¸º $sign$ å‡½æ•°ï¼Œå…¶è¡¨è¾¾å¼ä¸ºï¼š</p>\n<p>$$<br>sign(x) &#x3D;<br>\\begin{cases}<br>+1 \\qquad &amp; x \\geq 0 \\\\<br>-1 \\qquad &amp; x \\lt 0<br>\\end{cases}<br>$$<br> $\\varPhi(\\cdot)$ä¼šå°† $z$ ä¸æŸä¸€é˜ˆå€¼ï¼ˆæ­¤ä¾‹ä¸­ï¼Œé˜ˆå€¼ä¸º$0$ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå¤§äºç­‰äºè¯¥é˜ˆå€¼åˆ™æ„ŸçŸ¥å™¨è¾“å‡ºä¸º $1$ï¼Œå¦åˆ™è¾“å‡ºä¸º $-1$ã€‚é€šè¿‡è¿™æ ·çš„æ“ä½œï¼Œè¾“å…¥æ•°æ®è¢«åˆ†ç±»ä¸º $1$ æˆ– $-1$ è¿™ä¸¤ä¸ªä¸åŒç±»åˆ«ã€‚<br> å…¶ç»“æ„ä¸º<img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"å•å±‚æ„ŸçŸ¥æœºå­˜åœ¨çš„é—®é¢˜\"><a href=\"#å•å±‚æ„ŸçŸ¥æœºå­˜åœ¨çš„é—®é¢˜\" class=\"headerlink\" title=\"å•å±‚æ„ŸçŸ¥æœºå­˜åœ¨çš„é—®é¢˜\"></a>å•å±‚æ„ŸçŸ¥æœºå­˜åœ¨çš„é—®é¢˜</h3><p><img src=\"http://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-1.png?raw=true\" alt=\"alt text\"><br>å•å±‚æ„ŸçŸ¥æœºå¯è¢«ç”¨æ¥åŒºåˆ†çº¿æ€§å¯åˆ†æ•°æ®ã€‚åœ¨å›¾ä¸­ï¼Œé€»è¾‘ä¸(AND)ã€é€»è¾‘ä¸é(NAND)å’Œé€»è¾‘æˆ–(OR)ä¸ºçº¿æ€§å¯åˆ†å‡½æ•°ï¼Œæ‰€ä»¥å¯åˆ©ç”¨å•å±‚æ„ŸçŸ¥æœºæ¥æ¨¡æ‹Ÿè¿™äº›é€»è¾‘å‡½æ•°ã€‚ä½†æ˜¯ï¼Œç”±äºé€»è¾‘å¼‚æˆ–ï¼ˆXORï¼‰æ˜¯éçº¿æ€§å¯åˆ†çš„é€»è¾‘å‡½æ•°ï¼Œå› æ­¤å•å±‚æ„ŸçŸ¥æœºæ— æ³•æ¨¡æ‹Ÿé€»è¾‘å¼‚æˆ–å‡½æ•°çš„åŠŸèƒ½ã€‚</p>\n<h2 id=\"å¤šå±‚æ„ŸçŸ¥æœº\"><a href=\"#å¤šå±‚æ„ŸçŸ¥æœº\" class=\"headerlink\" title=\"å¤šå±‚æ„ŸçŸ¥æœº\"></a>å¤šå±‚æ„ŸçŸ¥æœº</h2><h3 id=\"å¤šå±‚æ„ŸçŸ¥æœºçš„ç»“æ„\"><a href=\"#å¤šå±‚æ„ŸçŸ¥æœºçš„ç»“æ„\" class=\"headerlink\" title=\"å¤šå±‚æ„ŸçŸ¥æœºçš„ç»“æ„\"></a>å¤šå±‚æ„ŸçŸ¥æœºçš„ç»“æ„</h3><p>ç”±äºæ— æ³•æ¨¡æ‹Ÿè¯¸å¦‚å¼‚æˆ–ä»¥åŠå…¶ä»–å¤æ‚å‡½æ•°çš„åŠŸèƒ½ï¼Œä½¿å¾—å•å±‚æ„ŸçŸ¥æœºçš„åº”ç”¨è¾ƒä¸ºå•ä¸€ã€‚ä¸€ä¸ªç®€å•çš„æƒ³æ³•æ˜¯ï¼Œå¦‚æœèƒ½åœ¨æ„ŸçŸ¥æœºæ¨¡å‹ä¸­å¢åŠ è‹¥å¹²éšè—å±‚ï¼Œå¢å¼ºç¥ç»ç½‘ç»œçš„éçº¿æ€§è¡¨è¾¾èƒ½åŠ›ï¼Œå°±ä¼šè®©ç¥ç»ç½‘ç»œå…·æœ‰æ›´å¼ºæ‹Ÿåˆèƒ½åŠ›ã€‚å› æ­¤ï¼Œç”±å¤šä¸ªéšè—å±‚æ„æˆçš„å¤šå±‚æ„ŸçŸ¥æœºè¢«æå‡ºã€‚</p>\n<p>å¤šå±‚æ„ŸçŸ¥æœºç”±è¾“å…¥å±‚ã€è¾“å‡ºå±‚å’Œè‡³å°‘ä¸€å±‚çš„éšè—å±‚æ„æˆã€‚ç½‘ç»œä¸­å„ä¸ªéšè—å±‚ä¸­ç¥ç»å…ƒå¯æ¥æ”¶ç›¸é‚»å‰åºéšè—å±‚ä¸­æ‰€æœ‰ç¥ç»å…ƒä¼ é€’è€Œæ¥çš„ä¿¡æ¯ï¼Œç»è¿‡åŠ å·¥å¤„ç†åå°†ä¿¡æ¯è¾“å‡ºç»™ç›¸é‚»åç»­éšè—å±‚ä¸­æ‰€æœ‰ç¥ç»å…ƒã€‚<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-2.png?raw=true\" alt=\"alt text\"><br>åœ¨å¤šå±‚æ„ŸçŸ¥æœºä¸­ï¼Œç›¸é‚»å±‚æ‰€åŒ…å«çš„ç¥ç»å…ƒä¹‹é—´é€šå¸¸ä½¿ç”¨â€œå…¨è¿æ¥â€æ–¹å¼è¿›è¡Œè¿æ¥ã€‚æ‰€è°“â€œå…¨è¿æ¥â€æ˜¯æŒ‡ä¸¤ä¸ªç›¸é‚»å±‚ä¹‹é—´çš„ç¥ç»å…ƒç›¸äº’æˆå¯¹è¿æ¥ï¼Œä½†åŒä¸€å±‚å†…ç¥ç»å…ƒä¹‹é—´æ²¡æœ‰è¿æ¥ã€‚å¤šå±‚æ„ŸçŸ¥æœºå¯ä»¥æ¨¡æ‹Ÿå¤æ‚éçº¿æ€§å‡½æ•°åŠŸèƒ½ï¼Œæ‰€æ¨¡æ‹Ÿå‡½æ•°çš„å¤æ‚æ€§å–å†³äºç½‘ç»œéšè—å±‚æ•°ç›®å’Œå„å±‚ä¸­ç¥ç»å…ƒæ•°ç›®ã€‚</p>\n<h3 id=\"éšè—å±‚\"><a href=\"#éšè—å±‚\" class=\"headerlink\" title=\"éšè—å±‚\"></a>éšè—å±‚</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ç½‘ç»œä¸­åŠ å…¥ä¸€ä¸ªæˆ–å¤šä¸ªéšè—å±‚æ¥å…‹æœçº¿æ€§æ¨¡å‹çš„é™åˆ¶ï¼Œ ä½¿å…¶èƒ½å¤„ç†æ›´æ™®éçš„å‡½æ•°å…³ç³»ç±»å‹ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†è®¸å¤šå…¨è¿æ¥å±‚å †å åœ¨ä¸€èµ·ã€‚ æ¯ä¸€å±‚éƒ½è¾“å‡ºåˆ°ä¸Šé¢çš„å±‚ï¼Œç›´åˆ°ç”Ÿæˆæœ€åçš„è¾“å‡ºã€‚ æˆ‘ä»¬å¯ä»¥æŠŠå‰L-1å±‚çœ‹ä½œè¡¨ç¤ºï¼ŒæŠŠæœ€åä¸€å±‚çœ‹ä½œçº¿æ€§é¢„æµ‹å™¨ã€‚ è¿™ç§æ¶æ„é€šå¸¸ç§°ä¸ºå¤šå±‚æ„ŸçŸ¥æœºï¼ˆmultilayer perceptronï¼‰ï¼Œé€šå¸¸ç¼©å†™ä¸ºMLPã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬ä»¥å›¾çš„æ–¹å¼æè¿°äº†å¤šå±‚æ„ŸçŸ¥æœº<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-4.png?raw=true\" alt=\"alt text\"><br>è¿™ä¸ªå¤šå±‚æ„ŸçŸ¥æœºæœ‰4ä¸ªè¾“å…¥ï¼Œ3ä¸ªè¾“å‡ºï¼Œå…¶éšè—å±‚åŒ…å«5ä¸ªéšè—å•å…ƒã€‚è¾“å…¥å±‚ä¸æ¶‰åŠä»»ä½•è®¡ç®—ï¼Œå› æ­¤ä½¿ç”¨æ­¤ç½‘ç»œäº§ç”Ÿè¾“å‡ºåªéœ€è¦å®ç°éšè—å±‚å’Œè¾“å‡ºå±‚çš„è®¡ç®—ã€‚å› æ­¤ï¼Œè¿™ä¸ªå¤šå±‚æ„ŸçŸ¥æœºä¸­çš„å±‚æ•°ä¸º2ã€‚æ³¨æ„ï¼Œè¿™ä¸¤ä¸ªå±‚éƒ½æ˜¯å…¨è¿æ¥çš„ã€‚æ¯ä¸ªè¾“å…¥éƒ½ä¼šå½±å“éšè—å±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒï¼Œè€Œéšè—å±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒåˆä¼šå½±å“è¾“å‡ºå±‚ä¸­çš„æ¯ä¸ªç¥ç»å…ƒã€‚</p>\n<h3 id=\"æ¿€æ´»å‡½æ•°\"><a href=\"#æ¿€æ´»å‡½æ•°\" class=\"headerlink\" title=\"æ¿€æ´»å‡½æ•°\"></a>æ¿€æ´»å‡½æ•°</h3><h4 id=\"RELUå‡½æ•°\"><a href=\"#RELUå‡½æ•°\" class=\"headerlink\" title=\"RELUå‡½æ•°\"></a>RELUå‡½æ•°</h4><p>å‡½æ•°å®šä¹‰ï¼š</p>\n<p>$$f(x)&#x3D;\\begin{cases} \\begin{matrix} 0 &amp; x&lt;0 \\end{matrix} \\\\ \\begin{matrix} x &amp; x\\ge 0 \\end{matrix} \\end{cases}$$</p>\n<p>å¯¼æ•°ï¼š</p>\n<p>$${ f }^{ â€˜ }(x)&#x3D;\\begin{cases} \\begin{matrix} 0 &amp; x&lt;0 \\end{matrix} \\\\ \\begin{matrix} 1 &amp; x\\ge 0 \\end{matrix} \\end{cases}$$<br>å‡½æ•°å›¾å¦‚å›¾æ‰€ç¤ºï¼š<img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-7.png?raw=true\"><br>å¯¼å‡½æ•°å›¾å¦‚å›¾æ‰€ç¤ºï¼š<img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-10.png?raw=true\" alt=\"alt text\"></p>\n<h4 id=\"sigmoid\"><a href=\"#sigmoid\" class=\"headerlink\" title=\"sigmoid\"></a>sigmoid</h4><p>å‡½æ•°å®šä¹‰ï¼š</p>\n<p>$${ f }(x)&#x3D;\\sigma (x)&#x3D;\\frac { 1 }{ 1+{ e }^{ -x } } $$</p>\n<p>å¯¼æ•°ï¼š</p>\n<p>$${ f }^{ â€˜ }(x)&#x3D;f(x)(1-f(x))$$<br>å‡½æ•°å›¾å½¢å¦‚å›¾æ‰€ç¤ºï¼š<img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-5.png?raw=true\" alt=\"alt text\"></p>\n<p>å¯¼å‡½æ•°å›¾å¦‚å›¾æ‰€ç¤ºï¼š<img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-11.png?raw=true\" alt=\"alt text\"><br>ä¼˜ç‚¹ï¼š</p>\n<ol>\n<li>$sigmoid$ å‡½æ•°çš„è¾“å‡ºæ˜ å°„åœ¨ $(0,1)$ ä¹‹é—´ï¼Œå•è°ƒè¿ç»­ï¼Œè¾“å‡ºèŒƒå›´æœ‰é™ï¼Œä¼˜åŒ–ç¨³å®šï¼Œå¯ä»¥ç”¨ä½œè¾“å‡ºå±‚ï¼›</li>\n<li>æ±‚å¯¼å®¹æ˜“ï¼›</li>\n</ol>\n<p>ç¼ºç‚¹ï¼š</p>\n<ol>\n<li>ç”±äºå…¶è½¯é¥±å’Œæ€§ï¼Œä¸€æ—¦è½å…¥é¥±å’ŒåŒºæ¢¯åº¦å°±ä¼šæ¥è¿‘äº0ï¼Œæ ¹æ®åå‘ä¼ æ’­çš„é“¾å¼æ³•åˆ™ï¼Œå®¹æ˜“äº§ç”Ÿæ¢¯åº¦æ¶ˆå¤±ï¼Œå¯¼è‡´è®­ç»ƒå‡ºç°é—®é¢˜ï¼›</li>\n<li>Sigmoidå‡½æ•°çš„è¾“å‡ºæ’å¤§äº0ã€‚éé›¶ä¸­å¿ƒåŒ–çš„è¾“å‡ºä¼šä½¿å¾—å…¶åä¸€å±‚çš„ç¥ç»å…ƒçš„è¾“å…¥å‘ç”Ÿåç½®åç§»ï¼ˆBias Shiftï¼‰ï¼Œå¹¶è¿›ä¸€æ­¥ä½¿å¾—æ¢¯åº¦ä¸‹é™çš„æ”¶æ•›é€Ÿåº¦å˜æ…¢ï¼›</li>\n<li>è®¡ç®—æ—¶ï¼Œç”±äºå…·æœ‰å¹‚è¿ç®—ï¼Œè®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œè¿ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚</li>\n</ol>\n<h4 id=\"tanh\"><a href=\"#tanh\" class=\"headerlink\" title=\"tanh\"></a>tanh</h4><p>å‡½æ•°å®šä¹‰ï¼š</p>\n<p>$${ f }(x)&#x3D;tanh(x)&#x3D;\\frac { { e }^{ x }-{ e }^{ -x } }{ { e }^{ x }+{ e }^{ -x } }$$</p>\n<p>å¯¼æ•°ï¼š</p>\n<p>$${ f }^{ â€˜ }(x)&#x3D;1-f(x)^{ 2 }$$<br>å‡½æ•°å›¾å½¢å¦‚å›¾æ‰€ç¤ºï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-6.png?raw=true\" alt=\"alt text\"><br>å¯¼å‡½æ•°å›¾å¦‚å›¾æ‰€ç¤ºï¼š<img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-12.png?raw=true\" alt=\"alt text\"><br>ä¼˜ç‚¹ï¼š</p>\n<ol>\n<li>$tanh$ æ¯” $sigmoid$ å‡½æ•°æ”¶æ•›é€Ÿåº¦æ›´å¿«ï¼›</li>\n<li>ç›¸æ¯” $sigmoid$ å‡½æ•°ï¼Œ$tanh$ æ˜¯ä»¥ $0$ ä¸ºä¸­å¿ƒçš„ï¼›</li>\n</ol>\n<p>ç¼ºç‚¹ï¼š</p>\n<ol>\n<li>ä¸ $sigmoid$ å‡½æ•°ç›¸åŒï¼Œç”±äºé¥±å’Œæ€§å®¹æ˜“äº§ç”Ÿçš„æ¢¯åº¦æ¶ˆå¤±ï¼›</li>\n<li>ä¸ $sigmoid$ å‡½æ•°ç›¸åŒï¼Œç”±äºå…·æœ‰å¹‚è¿ç®—ï¼Œè®¡ç®—å¤æ‚åº¦è¾ƒé«˜ï¼Œè¿ç®—é€Ÿåº¦è¾ƒæ…¢ã€‚</li>\n</ol>\n<h3 id=\"æŸå¤±å‡½æ•°\"><a href=\"#æŸå¤±å‡½æ•°\" class=\"headerlink\" title=\"æŸå¤±å‡½æ•°\"></a>æŸå¤±å‡½æ•°</h3><h4 id=\"å‡æ–¹å·®æŸå¤±ï¼ˆMean-Square-Errorï¼ŒMSEï¼‰\"><a href=\"#å‡æ–¹å·®æŸå¤±ï¼ˆMean-Square-Errorï¼ŒMSEï¼‰\" class=\"headerlink\" title=\"å‡æ–¹å·®æŸå¤±ï¼ˆMean Square Errorï¼ŒMSEï¼‰\"></a>å‡æ–¹å·®æŸå¤±ï¼ˆMean Square Errorï¼ŒMSEï¼‰</h4><p>å‡æ–¹è¯¯å·®æŸå¤±åˆç§°ä¸ºäºŒæ¬¡æŸå¤±ã€L2æŸå¤±ï¼Œå¸¸ç”¨äºå›å½’é¢„æµ‹ä»»åŠ¡ä¸­ã€‚å‡æ–¹è¯¯å·®å‡½æ•°é€šè¿‡è®¡ç®—é¢„æµ‹å€¼å’Œå®é™…å€¼ä¹‹é—´è·ç¦»ï¼ˆå³è¯¯å·®ï¼‰çš„å¹³æ–¹æ¥è¡¡é‡æ¨¡å‹ä¼˜åŠ£ã€‚å³é¢„æµ‹å€¼å’ŒçœŸå®å€¼è¶Šæ¥è¿‘ï¼Œä¸¤è€…çš„å‡æ–¹å·®å°±è¶Šå°ã€‚</p>\n<h5 id=\"è®¡ç®—æ–¹å¼\"><a href=\"#è®¡ç®—æ–¹å¼\" class=\"headerlink\" title=\"è®¡ç®—æ–¹å¼\"></a>è®¡ç®—æ–¹å¼</h5><p>å‡è®¾æœ‰ $n$ ä¸ªè®­ç»ƒæ•°æ® $x_i$ï¼Œæ¯ä¸ªè®­ç»ƒæ•°æ® $x_i$ çš„çœŸå®è¾“å‡ºä¸º $y_i$ï¼Œæ¨¡å‹å¯¹ $x_i$ çš„é¢„æµ‹å€¼ä¸º $\\hat{y}_i$ã€‚è¯¥æ¨¡å‹åœ¨ $n$ ä¸ªè®­ç»ƒæ•°æ®ä¸‹æ‰€äº§ç”Ÿçš„å‡æ–¹è¯¯å·®æŸå¤±å¯å®šä¹‰å¦‚ä¸‹ï¼š </p>\n<p>$$<br>MSE&#x3D;\\frac{1}{n}\\sum_{i&#x3D;1}^n{\\left( y_i-\\hat{y}_i \\right) ^2}<br>$$<br>å‡è®¾çœŸå®ç›®æ ‡å€¼ä¸º100ï¼Œé¢„æµ‹å€¼åœ¨-10000åˆ°10000ä¹‹é—´ï¼Œæˆ‘ä»¬ç»˜åˆ¶MSEå‡½æ•°æ›²çº¿å¦‚å›¾æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ï¼Œå½“é¢„æµ‹å€¼è¶Šæ¥è¿‘100æ—¶ï¼ŒMSEæŸå¤±å€¼è¶Šå°ã€‚MSEæŸå¤±çš„èŒƒå›´ä¸º0åˆ°$\\infty$ ã€‚<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master//photo/image-13.png?raw=true\" alt=\"alt text\"></p>\n<h4 id=\"äº¤å‰ç†µæŸå¤±ï¼ˆcross-entropy-loss-ï¼‰\"><a href=\"#äº¤å‰ç†µæŸå¤±ï¼ˆcross-entropy-loss-ï¼‰\" class=\"headerlink\" title=\"äº¤å‰ç†µæŸå¤±ï¼ˆcross-entropy loss ï¼‰\"></a>äº¤å‰ç†µæŸå¤±ï¼ˆcross-entropy loss ï¼‰</h4><p>åœ¨ç‰©ç†å­¦ä¸­ï¼Œâ€œç†µâ€è¢«ç”¨æ¥è¡¨ç¤ºçƒ­åŠ›å­¦ç³»ç»Ÿæ‰€å‘ˆç°çš„æ— åºç¨‹åº¦ã€‚é¦™å†œå°†è¿™ä¸€æ¦‚å¿µå¼•å…¥ä¿¡æ¯è®ºé¢†åŸŸï¼Œæå‡ºäº†â€œä¿¡æ¯ç†µâ€æ¦‚å¿µï¼Œé€šè¿‡å¯¹æ•°å‡½æ•°æ¥æµ‹é‡ä¿¡æ¯çš„ä¸ç¡®å®šæ€§ã€‚</p>\n<p>äº¤å‰ç†µï¼ˆcross entropyï¼‰æ˜¯ä¿¡æ¯è®ºä¸­çš„é‡è¦æ¦‚å¿µï¼Œä¸»è¦ç”¨æ¥åº¦é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒé—´çš„å·®å¼‚ã€‚å‡å®š $p$ å’Œ $q$ æ˜¯æ•°æ® $x$ çš„ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œé€šè¿‡ $q$ æ¥è¡¨ç¤º $p$ çš„äº¤å‰ç†µå¯å¦‚ä¸‹è®¡ç®—ï¼š</p>\n<p>$$<br>H\\left( p,q \\right) &#x3D;-\\sum_x{p\\left( x \\right) \\log q\\left( x \\right)}<br>$$</p>\n<p>äº¤å‰ç†µåˆ»ç”»äº†ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è·ç¦»ï¼Œæ—¨åœ¨æç»˜é€šè¿‡æ¦‚ç‡åˆ†å¸ƒ $q$ æ¥è¡¨è¾¾æ¦‚ç‡åˆ†å¸ƒ $p$ çš„å›°éš¾ç¨‹åº¦ã€‚æ ¹æ®å…¬å¼ä¸éš¾ç†è§£ï¼Œäº¤å‰ç†µè¶Šå°ï¼Œä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒ $p$ å’Œ $q$ è¶Šæ¥è¿‘ã€‚</p>\n<p>è¿™é‡Œä»ç„¶ä»¥ä¸‰ç±»åˆ†ç±»é—®é¢˜ä¸ºä¾‹ï¼Œå‡è®¾æ•°æ® $x$ å±äºç±»åˆ« $1$ã€‚è®°æ•°æ®xçš„ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ä¸º $y$ï¼Œæ˜¾ç„¶ $y&#x3D;(1,0,0)$ä»£è¡¨æ•°æ® $x$ çš„å®é™…ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ã€‚è®° $\\hat{y}<br>$ ä»£è¡¨æ¨¡å‹é¢„æµ‹æ‰€å¾—ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ã€‚</p>\n<p>é‚£ä¹ˆå¯¹äºæ•°æ® $x$ è€Œè¨€ï¼Œå…¶å®é™…ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ $y$ å’Œæ¨¡å‹é¢„æµ‹ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ $\\hat{y}$ çš„äº¤å‰ç†µæŸå¤±å‡½æ•°å®šä¹‰ä¸ºï¼š</p>\n<p>$$<br>cross\\ entropy&#x3D;-y\\times \\log \\left( \\hat{y} \\right)<br>$$</p>\n<p>å¾ˆæ˜¾ç„¶ï¼Œä¸€ä¸ªè‰¯å¥½çš„ç¥ç»ç½‘ç»œè¦å°½é‡ä¿è¯å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥æ•°æ®ï¼Œç¥ç»ç½‘ç»œæ‰€é¢„æµ‹ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ä¸å®é™…ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ä¹‹é—´çš„å·®è·è¶Šå°è¶Šå¥½ï¼Œå³äº¤å‰ç†µè¶Šå°è¶Šå¥½ã€‚äºæ˜¯ï¼Œå¯å°†äº¤å‰ç†µä½œä¸ºæŸå¤±å‡½æ•°æ¥è®­ç»ƒç¥ç»ç½‘ç»œã€‚</p>\n<p><img src=\"https://github.com/PaddlePaddle/awesome-DeepLearning/raw/master/docs/images/deep_learning/loss_functions/CrossEntropy.png\">ä¸‰ç±»åˆ†ç±»é—®é¢˜ä¸­è¾“å…¥xçš„äº¤å‰ç†µæŸå¤±ç¤ºæ„å›¾ï¼ˆx å±äºç¬¬ä¸€ç±»ï¼‰</p>\n<p>ä¸Šå›¾ç»™å‡ºäº†ä¸€ä¸ªä¸‰ä¸ªç±»åˆ«åˆ†ç±»çš„ä¾‹å­ã€‚ç”±äºè¾“å…¥æ•°æ® $x$ å±äºç±»åˆ« $1$ï¼Œå› æ­¤å…¶å®é™…ç±»åˆ«æ¦‚ç‡åˆ†å¸ƒå€¼ä¸º $y&#x3D;(y_1,y_2,y_3)&#x3D;(1,0,0)$ã€‚ç»è¿‡ç¥ç»ç½‘ç»œçš„å˜æ¢ï¼Œå¾—åˆ°äº†è¾“å…¥æ•°æ® $x$ ç›¸å¯¹äºä¸‰ä¸ªç±»åˆ«çš„é¢„æµ‹ä¸­é—´å€¼ $(z1,z2,z3)$ã€‚ç„¶åï¼Œç»è¿‡ $Softmax$ å‡½æ•°æ˜ å°„ï¼Œå¾—åˆ°ç¥ç»ç½‘ç»œæ‰€é¢„æµ‹çš„è¾“å…¥æ•°æ® $x$ çš„ç±»åˆ«åˆ†å¸ƒæ¦‚ç‡ $\\hat{y}&#x3D;\\left( \\hat{y}_1,\\hat{y}_2,\\hat{y}_3 \\right)$ã€‚æ ¹æ®å‰é¢çš„ä»‹ç»ï¼Œ$\\hat{y}_1$ã€$\\hat{y}_2$ å’Œ $\\hat{y}_3$ ä¸º $(0,1)$ èŒƒå›´ä¹‹é—´çš„ä¸€ä¸ªæ¦‚ç‡å€¼ã€‚ç”±äºæ ·æœ¬ $x$ å±äºç¬¬ä¸€ä¸ªç±»åˆ«ï¼Œå› æ­¤å¸Œæœ›ç¥ç»ç½‘ç»œæ‰€é¢„æµ‹å¾—åˆ°çš„ $\\hat{y}_1$å–å€¼è¦è¿œè¿œå¤§äº $\\hat{y}_2$ å’Œ $\\hat{y}_3$ çš„å–å€¼ã€‚ä¸ºäº†å¾—åˆ°è¿™æ ·çš„ç¥ç»ç½‘ç»œï¼Œåœ¨è®­ç»ƒä¸­å¯åˆ©ç”¨å¦‚ä¸‹äº¤å‰ç†µæŸå¤±å‡½æ•°æ¥å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œä¼˜åŒ–ï¼š<br>$$<br>cross\\ entropy&#x3D;-\\left( y_1\\times \\log \\left( \\hat{y}_1 \\right) +y_2\\times \\log \\left( \\hat{y}_2 \\right) +y_3\\times \\log \\left( \\hat{y}_3 \\right) \\right)<br>$$</p>\n<p>åœ¨ä¸Šå¼ä¸­ï¼Œ$y_2$ å’Œ $y_3$ å‡ä¸º $0$ã€$y_1$ ä¸º $1$ï¼Œå› æ­¤äº¤å‰ç†µæŸå¤±å‡½æ•°ç®€åŒ–ä¸ºï¼š<br>$$<br>-y_1\\times \\log \\left( \\hat{y}_1 \\right) &#x3D;-\\log \\left( \\hat{y}_1 \\right)<br>$$</p>\n<p>åœ¨ç¥ç»ç½‘ç»œè®­ç»ƒä¸­ï¼Œè¦å°†è¾“å…¥æ•°æ®å®é™…çš„ç±»åˆ«æ¦‚ç‡åˆ†å¸ƒä¸æ¨¡å‹é¢„æµ‹çš„ç±»åˆ«æ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„è¯¯å·®ï¼ˆå³æŸå¤±ï¼‰ä»è¾“å‡ºç«¯å‘è¾“å…¥ç«¯ä¼ é€’ï¼Œä»¥ä¾¿æ¥ä¼˜åŒ–æ¨¡å‹å‚æ•°ã€‚ä¸‹é¢ç®€å•ä»‹ç»æ ¹æ®äº¤å‰ç†µè®¡ç®—å¾—åˆ°çš„è¯¯å·®ä» $\\hat{y}_1$ ä¼ é€’ç»™ $z_1$ å’Œ $z_2$ï¼ˆ$z_3$ çš„æ¨å¯¼ä¸ $z_2$ ç›¸åŒï¼‰çš„æƒ…å†µã€‚</p>\n<p>$$<br>\\frac{\\partial \\hat{y}_1}{\\partial z_1}&#x3D;\\frac{\\partial \\left( \\frac{e^{z_1}}{\\sum_k{e^{z_k}}} \\right)}{\\partial z_1}&#x3D;\\frac{\\left( e^{z_1} \\right) ^{â€˜}\\times \\sum_k{e^{z_k}-e^{z_1}\\times e^{z_1}}}{\\left( \\sum_k{e^{z_k}} \\right) ^2}&#x3D;\\frac{e^{z_1}}{\\sum_k{e^{z_k}}}-\\frac{e^{z_1}}{\\sum_k{e^{z_k}}}\\times \\frac{e^{z_1}}{\\sum_k{e^{z_k}}}&#x3D;\\hat{y}_1\\left( 1-\\hat{y}_1 \\right)<br>$$</p>\n<p>ç”±äºäº¤å‰ç†µæŸå¤±å‡½æ•° $-\\log \\left( \\hat{y}_1 \\right)$ å¯¹ $\\hat{y}_1$ æ±‚å¯¼çš„ç»“æœä¸º $-\\frac{1}{\\hat{y}_1}$ï¼Œ$\\hat{y}_1\\left( 1-\\hat{y}_1 \\right)$ ä¸ $-\\frac{1}{\\hat{y}_1}$ ç›¸ä¹˜ä¸º $\\hat{y}_1-1$ã€‚è¿™è¯´æ˜ä¸€æ—¦å¾—åˆ°æ¨¡å‹é¢„æµ‹è¾“å‡º $\\hat{y}_1$ï¼Œå°†è¯¥è¾“å‡ºå‡å»1å°±æ˜¯äº¤å‰æŸå¤±å‡½æ•°ç›¸å¯¹äº $z_1$ çš„åå¯¼ç»“æœã€‚</p>\n<p>$$<br>\\frac{\\partial \\hat{y}_1}{\\partial z_2}&#x3D;\\frac{\\partial \\left( \\frac{e^{z_1}}{\\sum_k{e^{z_k}}} \\right)}{\\partial z_2}&#x3D;\\frac{0\\times \\sum_k{e^{z_k}-e^{z_1}\\times e^{z_2}}}{\\left( \\sum_k{e^{z_k}} \\right) ^2}&#x3D;-\\frac{e^{z_1}}{\\sum_k{e^{z_k}}}\\times \\frac{e^{z_2}}{\\sum_k{e^{z_k}}}&#x3D;-\\hat{y}_1\\hat{y}_2<br>$$</p>\n<p>åŒç†ï¼Œäº¤å‰ç†µæŸå¤±å‡½æ•°å¯¼æ•°ä¸º $-\\frac{1}{\\hat{y}_1}$ï¼Œ$-\\hat{y}_1\\hat{y}_2$ ä¸ $-\\frac{1}{\\hat{y}_1}$ ç›¸ä¹˜ç»“æœä¸º $\\hat{y}_2$ã€‚è¿™æ„å‘³å¯¹äºé™¤ç¬¬ä¸€ä¸ªè¾“å‡ºèŠ‚ç‚¹ä»¥å¤–çš„èŠ‚ç‚¹è¿›è¡Œåå¯¼ï¼Œåœ¨å¾—åˆ°æ¨¡å‹é¢„æµ‹è¾“å‡ºåï¼Œåªè¦å°†å…¶ä¿å­˜ï¼Œå°±æ˜¯äº¤å‰æŸå¤±å‡½æ•°ç›¸å¯¹äºå…¶ä»–èŠ‚ç‚¹çš„åå¯¼ç»“æœã€‚åœ¨ $z_1$ã€$z_2$ å’Œ $z_3$å¾—åˆ°åå¯¼ç»“æœåï¼Œå†é€šè¿‡é“¾å¼æ³•åˆ™ï¼ˆåç»­ä»‹ç»ï¼‰å°†æŸå¤±è¯¯å·®ç»§ç»­å¾€è¾“å…¥ç«¯ä¼ é€’å³å¯ã€‚</p>\n<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå‡è®¾æ‰€é¢„æµ‹ä¸­é—´å€¼ $(z_1,z_2,z_3)$ ç»è¿‡ $Softmax$ æ˜ å°„åæ‰€å¾—ç»“æœä¸º $(0.34,0.46,0.20)$ã€‚ç”±äºå·²çŸ¥è¾“å…¥æ•°æ® $x$ å±äºç¬¬ä¸€ç±»ï¼Œæ˜¾ç„¶è¿™ä¸ªè¾“å‡ºä¸ç†æƒ³è€Œéœ€è¦å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œä¼˜åŒ–ã€‚å¦‚æœé€‰æ‹©äº¤å‰ç†µæŸå¤±å‡½æ•°æ¥ä¼˜åŒ–æ¨¡å‹ï¼Œåˆ™ $(z_1,z_2,z_3)$ è¿™ä¸€å±‚çš„åå¯¼å€¼ä¸º $(0.34-1,0.46,0.20)&#x3D; (-0.66,0.46,0.20)$ã€‚</p>\n<p>å¯ä»¥çœ‹å‡ºï¼Œ$Softmax$ å’Œäº¤å‰ç†µæŸå¤±å‡½æ•°ç›¸äº’ç»“åˆï¼Œä¸ºåå¯¼è®¡ç®—å¸¦æ¥äº†æå¤§ä¾¿åˆ©ã€‚åå¯¼è®¡ç®—ä½¿å¾—æŸå¤±è¯¯å·®ä»è¾“å‡ºç«¯å‘è¾“å…¥ç«¯ä¼ é€’ï¼Œæ¥å¯¹æ¨¡å‹å‚æ•°è¿›è¡Œä¼˜åŒ–ã€‚åœ¨è¿™é‡Œï¼Œäº¤å‰ç†µä¸$Softmax$ å‡½æ•°ç»“åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤ä¹Ÿå« $Softmax$ æŸå¤±ï¼ˆSoftmax with cross-entropy lossï¼‰ã€‚</p>\n<h1 id=\"åŸºäºå¤šå±‚æ„ŸçŸ¥æœºçš„å§“æ°åˆ†ç±»ç½‘ç»œ\"><a href=\"#åŸºäºå¤šå±‚æ„ŸçŸ¥æœºçš„å§“æ°åˆ†ç±»ç½‘ç»œ\" class=\"headerlink\" title=\"åŸºäºå¤šå±‚æ„ŸçŸ¥æœºçš„å§“æ°åˆ†ç±»ç½‘ç»œ\"></a>åŸºäºå¤šå±‚æ„ŸçŸ¥æœºçš„å§“æ°åˆ†ç±»ç½‘ç»œ</h1><p>æˆ‘ä»¬å°†MLPåº”ç”¨äºå°†å§“æ°åˆ†ç±»åˆ°å…¶åŸç±å›½çš„ä»»åŠ¡ã€‚ä»å…¬å¼€è§‚å¯Ÿåˆ°çš„æ•°æ®æ¨æ–­äººå£ç»Ÿè®¡ä¿¡æ¯(å¦‚å›½ç±)å…·æœ‰ä»äº§å“æ¨èåˆ°ç¡®ä¿ä¸åŒäººå£ç»Ÿè®¡ç”¨æˆ·è·å¾—å…¬å¹³ç»“æœçš„åº”ç”¨ã€‚äººå£ç»Ÿè®¡å’Œå…¶ä»–è‡ªæˆ‘è¯†åˆ«ä¿¡æ¯ç»Ÿç§°ä¸ºâ€œå—ä¿æŠ¤å±æ€§â€ã€‚â€œåœ¨å»ºæ¨¡å’Œäº§å“ä¸­ä½¿ç”¨è¿™äº›å±æ€§æ—¶ï¼Œå¿…é¡»å°å¿ƒã€‚â€æˆ‘ä»¬é¦–å…ˆå¯¹æ¯ä¸ªå§“æ°çš„å­—ç¬¦è¿›è¡Œæ‹†åˆ†ï¼Œå¹¶åƒå¯¹å¾…â€œç¤ºä¾‹:å°†é¤é¦†è¯„è®ºçš„æƒ…ç»ªåˆ†ç±»â€ä¸­çš„å•è¯ä¸€æ ·å¯¹å¾…å®ƒä»¬ã€‚é™¤äº†æ•°æ®ä¸Šçš„å·®å¼‚ï¼Œå­—ç¬¦å±‚æ¨¡å‹åœ¨ç»“æ„å’Œå®ç°ä¸Šä¸åŸºäºå•è¯çš„æ¨¡å‹åŸºæœ¬ç›¸ä¼¼.æˆ‘ä»¬å°†é€šè¿‡æè¿°å§“æ°åˆ†ç±»å™¨æ¨¡å‹åŠå…¶è®¾è®¡èƒŒåçš„æ€æƒ³è¿‡ç¨‹æ¥ç»§ç»­ã€‚</p>\n<h2 id=\"The-Surname-Dataset\"><a href=\"#The-Surname-Dataset\" class=\"headerlink\" title=\"The Surname Dataset\"></a>The Surname Dataset</h2><p>å§“æ°æ•°æ®é›†ï¼Œå®ƒæ”¶é›†äº†æ¥è‡ª18ä¸ªä¸åŒå›½å®¶çš„10,000ä¸ªå§“æ°ï¼Œè¿™äº›å§“æ°æ˜¯ä½œè€…ä»äº’è”ç½‘ä¸Šä¸åŒçš„å§“åæ¥æºæ”¶é›†çš„ã€‚è¯¥æ•°æ®é›†å°†åœ¨æœ¬è¯¾ç¨‹å®éªŒçš„å‡ ä¸ªç¤ºä¾‹ä¸­é‡ç”¨ï¼Œå¹¶å…·æœ‰ä¸€äº›ä½¿å…¶æœ‰è¶£çš„å±æ€§ã€‚ç¬¬ä¸€ä¸ªæ€§è´¨æ˜¯å®ƒæ˜¯ç›¸å½“ä¸å¹³è¡¡çš„ã€‚æ’åå‰ä¸‰çš„è¯¾ç¨‹å æ•°æ®çš„60%ä»¥ä¸Š:27%æ˜¯è‹±è¯­ï¼Œ21%æ˜¯ä¿„è¯­ï¼Œ14%æ˜¯é˜¿æ‹‰ä¼¯è¯­ã€‚å‰©ä¸‹çš„15ä¸ªæ°‘æ—çš„é¢‘ç‡ä¹Ÿåœ¨ä¸‹é™â€”â€”è¿™ä¹Ÿæ˜¯è¯­è¨€ç‰¹æœ‰çš„ç‰¹æ€§ã€‚ç¬¬äºŒä¸ªç‰¹ç‚¹æ˜¯ï¼Œåœ¨å›½ç±å’Œå§“æ°æ­£å­—æ³•(æ‹¼å†™)ä¹‹é—´æœ‰ä¸€ç§æœ‰æ•ˆå’Œç›´è§‚çš„å…³ç³»ã€‚æœ‰äº›æ‹¼å†™å˜ä½“ä¸åŸç±å›½è”ç³»éå¸¸ç´§å¯†(æ¯”å¦‚â€œO â€˜Neillâ€ã€â€œAntonopoulosâ€ã€â€œNagasawaâ€æˆ–â€œZhuâ€)ã€‚</p>\n<p>ä¸ºäº†åˆ›å»ºæœ€ç»ˆçš„æ•°æ®é›†ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªæ¯”è¯¾ç¨‹è¡¥å……ææ–™ä¸­åŒ…å«çš„ç‰ˆæœ¬å¤„ç†æ›´å°‘çš„ç‰ˆæœ¬å¼€å§‹ï¼Œå¹¶æ‰§è¡Œäº†å‡ ä¸ªæ•°æ®é›†ä¿®æ”¹æ“ä½œã€‚ç¬¬ä¸€ä¸ªç›®çš„æ˜¯å‡å°‘è¿™ç§ä¸å¹³è¡¡â€”â€”åŸå§‹æ•°æ®é›†ä¸­70%ä»¥ä¸Šæ˜¯ä¿„æ–‡ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºæŠ½æ ·åå·®æˆ–ä¿„æ–‡å§“æ°çš„å¢å¤šã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬é€šè¿‡é€‰æ‹©æ ‡è®°ä¸ºä¿„è¯­çš„å§“æ°çš„éšæœºå­é›†å¯¹è¿™ä¸ªè¿‡åº¦ä»£è¡¨çš„ç±»è¿›è¡Œå­æ ·æœ¬ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ ¹æ®å›½ç±å¯¹æ•°æ®é›†è¿›è¡Œåˆ†ç»„ï¼Œå¹¶å°†æ•°æ®é›†åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:70%åˆ°è®­ç»ƒæ•°æ®é›†ï¼Œ15%åˆ°éªŒè¯æ•°æ®é›†ï¼Œæœ€å15%åˆ°æµ‹è¯•æ•°æ®é›†ï¼Œä»¥ä¾¿è·¨è¿™äº›éƒ¨åˆ†çš„ç±»æ ‡ç­¾åˆ†å¸ƒå…·æœ‰å¯æ¯”æ€§ã€‚</p>\n<p>SurnameDatasetçš„å®ç°ä¸â€œExample: classification of Sentiment of Restaurant Reviewsâ€ä¸­çš„ReviewDatasetå‡ ä¹ç›¸åŒï¼Œåªæ˜¯åœ¨getitemæ–¹æ³•çš„å®ç°æ–¹å¼ä¸Šç•¥æœ‰ä¸åŒã€‚å›æƒ³ä¸€ä¸‹ï¼Œæœ¬è¯¾ç¨‹ä¸­å‘ˆç°çš„æ•°æ®é›†ç±»ç»§æ‰¿è‡ªPyTorchçš„æ•°æ®é›†ç±»ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸¤ä¸ªå‡½æ•°:<code>__getitem</code>æ–¹æ³•ï¼Œå®ƒåœ¨ç»™å®šç´¢å¼•æ—¶è¿”å›ä¸€ä¸ªæ•°æ®ç‚¹;ä»¥åŠlenæ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›æ•°æ®é›†çš„é•¿åº¦ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SurnameDataset</span>(<span class=\"title class_ inherited__\">Dataset</span>):</span><br><span class=\"line\">    <span class=\"comment\"># Implementation is nearly identical to Section 3.5</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__getitem__</span>(<span class=\"params\">self, index</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;PyTorch æ•°æ®é›†çš„ä¸»è¦å…¥å£æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">            index (int): æ•°æ®ç‚¹çš„ç´¢å¼• </span></span><br><span class=\"line\"><span class=\"string\">        Returns:</span></span><br><span class=\"line\"><span class=\"string\">            ä¸€ä¸ªåŒ…å«æ•°æ®ç‚¹çš„å­—å…¸:</span></span><br><span class=\"line\"><span class=\"string\">                ç‰¹å¾ (x_surname)</span></span><br><span class=\"line\"><span class=\"string\">                æ ‡ç­¾ (y_nationality)</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        row = self._target_df.iloc[index]</span><br><span class=\"line\"></span><br><span class=\"line\">        surname_vector = self._vectorizer.vectorize(row.surname)</span><br><span class=\"line\"></span><br><span class=\"line\">        nationality_index = self._vectorizer.nationality_vocab.lookup_token(row.nationality)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;x_surname&#x27;</span>: surname_vector,</span><br><span class=\"line\">                <span class=\"string\">&#x27;y_nationality&#x27;</span>: nationality_index&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Vocabulary-Vectorizer-and-DataLoader\"><a href=\"#Vocabulary-Vectorizer-and-DataLoader\" class=\"headerlink\" title=\"Vocabulary, Vectorizer, and DataLoader\"></a>Vocabulary, Vectorizer, and DataLoader</h2><p>ä¸ºäº†ä½¿ç”¨å­—ç¬¦å¯¹å§“æ°è¿›è¡Œåˆ†ç±»ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯æ±‡è¡¨ã€å‘é‡åŒ–å™¨å’ŒDataLoaderå°†å§“æ°å­—ç¬¦ä¸²è½¬æ¢ä¸ºå‘é‡åŒ–çš„minibatchesã€‚è¿™äº›æ•°æ®ç»“æ„ä¸â€œExample: Classifying Sentiment of Restaurant Reviewsâ€ä¸­ä½¿ç”¨çš„æ•°æ®ç»“æ„ç›¸åŒï¼Œå®ƒä»¬ä¸¾ä¾‹è¯´æ˜äº†ä¸€ç§å¤šæ€æ€§ï¼Œè¿™ç§å¤šæ€æ€§å°†å§“æ°çš„å­—ç¬¦æ ‡è®°ä¸Yelpè¯„è®ºçš„å•è¯æ ‡è®°ç›¸åŒå¯¹å¾…ã€‚æ•°æ®ä¸æ˜¯é€šè¿‡å°†å­—ä»¤ç‰Œæ˜ å°„åˆ°æ•´æ•°æ¥å‘é‡åŒ–çš„ï¼Œè€Œæ˜¯é€šè¿‡å°†å­—ç¬¦æ˜ å°„åˆ°æ•´æ•°æ¥å‘é‡åŒ–çš„ã€‚</p>\n<h3 id=\"THE-VOCABULARY-CLASS\"><a href=\"#THE-VOCABULARY-CLASS\" class=\"headerlink\" title=\"THE VOCABULARY CLASS\"></a>THE VOCABULARY CLASS</h3><p>æœ¬ä¾‹ä¸­ä½¿ç”¨çš„è¯æ±‡ç±»ä¸â€œexample: Classifying Sentiment of Restaurant Reviewsâ€ä¸­çš„è¯æ±‡å®Œå…¨ç›¸åŒï¼Œè¯¥è¯æ±‡ç±»å°†Yelpè¯„è®ºä¸­çš„å•è¯æ˜ å°„åˆ°å¯¹åº”çš„æ•´æ•°ã€‚ç®€è¦æ¦‚è¿°ä¸€ä¸‹ï¼Œè¯æ±‡è¡¨æ˜¯ä¸¤ä¸ªPythonå­—å…¸çš„åè°ƒï¼Œè¿™ä¸¤ä¸ªå­—å…¸åœ¨ä»¤ç‰Œ(åœ¨æœ¬ä¾‹ä¸­æ˜¯å­—ç¬¦)å’Œæ•´æ•°ä¹‹é—´å½¢æˆä¸€ä¸ªåŒå°„;ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€ä¸ªå­—å…¸å°†å­—ç¬¦æ˜ å°„åˆ°æ•´æ•°ç´¢å¼•ï¼Œç¬¬äºŒä¸ªå­—å…¸å°†æ•´æ•°ç´¢å¼•æ˜ å°„åˆ°å­—ç¬¦ã€‚add_tokenæ–¹æ³•ç”¨äºå‘è¯æ±‡è¡¨ä¸­æ·»åŠ æ–°çš„ä»¤ç‰Œï¼Œlookup_tokenæ–¹æ³•ç”¨äºæ£€ç´¢ç´¢å¼•ï¼Œlookup_indexæ–¹æ³•ç”¨äºæ£€ç´¢ç»™å®šç´¢å¼•çš„ä»¤ç‰Œ(åœ¨æ¨æ–­é˜¶æ®µå¾ˆæœ‰ç”¨)ã€‚ä¸Yelpè¯„è®ºçš„è¯æ±‡è¡¨ä¸åŒï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯one-hotè¯æ±‡è¡¨ï¼Œä¸è®¡ç®—å­—ç¬¦å‡ºç°çš„é¢‘ç‡ï¼Œåªå¯¹é¢‘ç¹å‡ºç°çš„æ¡ç›®è¿›è¡Œé™åˆ¶ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºæ•°æ®é›†å¾ˆå°ï¼Œè€Œä¸”å¤§å¤šæ•°å­—ç¬¦è¶³å¤Ÿé¢‘ç¹ã€‚</p>\n<h3 id=\"THE-SURNAMEVECTORIZER\"><a href=\"#THE-SURNAMEVECTORIZER\" class=\"headerlink\" title=\"THE SURNAMEVECTORIZER\"></a>THE SURNAMEVECTORIZER</h3><p>è™½ç„¶è¯æ±‡è¡¨å°†å•ä¸ªä»¤ç‰Œ(å­—ç¬¦)è½¬æ¢ä¸ºæ•´æ•°ï¼Œä½†SurnameVectorizerè´Ÿè´£åº”ç”¨è¯æ±‡è¡¨å¹¶å°†å§“æ°è½¬æ¢ä¸ºå‘é‡ã€‚å®ä¾‹åŒ–å’Œä½¿ç”¨éå¸¸ç±»ä¼¼äºâ€œç¤ºä¾‹:å¯¹é¤é¦†è¯„è®ºçš„æƒ…ç»ªè¿›è¡Œåˆ†ç±»â€ä¸­çš„ReviewVectorizerï¼Œä½†æœ‰ä¸€ä¸ªå…³é”®åŒºåˆ«:å­—ç¬¦ä¸²æ²¡æœ‰åœ¨ç©ºæ ¼ä¸Šåˆ†å‰²ã€‚å§“æ°æ˜¯å­—ç¬¦çš„åºåˆ—ï¼Œæ¯ä¸ªå­—ç¬¦åœ¨æˆ‘ä»¬çš„è¯æ±‡è¡¨ä¸­æ˜¯ä¸€ä¸ªå•ç‹¬çš„æ ‡è®°ã€‚ç„¶è€Œï¼Œåœ¨â€œå·ç§¯ç¥ç»ç½‘ç»œâ€å‡ºç°ä¹‹å‰ï¼Œæˆ‘ä»¬å°†å¿½ç•¥åºåˆ—ä¿¡æ¯ï¼Œé€šè¿‡è¿­ä»£å­—ç¬¦ä¸²è¾“å…¥ä¸­çš„æ¯ä¸ªå­—ç¬¦æ¥åˆ›å»ºè¾“å…¥çš„æ”¶ç¼©one-hotå‘é‡è¡¨ç¤ºã€‚æˆ‘ä»¬ä¸ºä»¥å‰æœªé‡åˆ°çš„å­—ç¬¦æŒ‡å®šä¸€ä¸ªç‰¹æ®Šçš„ä»¤ç‰Œï¼Œå³UNKã€‚ç”±äºæˆ‘ä»¬ä»…ä»è®­ç»ƒæ•°æ®å®ä¾‹åŒ–è¯æ±‡è¡¨ï¼Œè€Œä¸”éªŒè¯æˆ–æµ‹è¯•æ•°æ®ä¸­å¯èƒ½æœ‰æƒŸä¸€çš„å­—ç¬¦ï¼Œæ‰€ä»¥åœ¨å­—ç¬¦è¯æ±‡è¡¨ä¸­ä»ç„¶ä½¿ç”¨UNKç¬¦å·ã€‚</p>\n<p>è™½ç„¶æˆ‘ä»¬åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ä½¿ç”¨äº†æ”¶ç¼©çš„one-hotï¼Œä½†æ˜¯åœ¨åé¢çš„å®éªŒä¸­ï¼Œå°†äº†è§£å…¶ä»–å‘é‡åŒ–æ–¹æ³•ï¼Œå®ƒä»¬æ˜¯one-hotç¼–ç çš„æ›¿ä»£æ–¹æ³•ï¼Œæœ‰æ—¶ç”šè‡³æ›´å¥½ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨â€œç¤ºä¾‹:ä½¿ç”¨CNNå¯¹å§“æ°è¿›è¡Œåˆ†ç±»â€ä¸­ï¼Œå°†çœ‹åˆ°ä¸€ä¸ªçƒ­é—¨çŸ©é˜µï¼Œå…¶ä¸­æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯çŸ©é˜µä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œå¹¶å…·æœ‰è‡ªå·±çš„çƒ­é—¨å‘é‡ã€‚ç„¶åï¼Œåœ¨å®éªŒ5ä¸­ï¼Œå°†å­¦ä¹ åµŒå…¥å±‚ï¼Œè¿”å›æ•´æ•°å‘é‡çš„å‘é‡åŒ–ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬åˆ›å»ºå¯†é›†å‘é‡çŸ©é˜µã€‚çœ‹ä¸€ä¸‹ç¤ºä¾‹4-6ä¸­SurnameVectorizerçš„ä»£ç ã€‚</p>\n<p>Example 4-6. Implementing SurnameVectorizer</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SurnameVectorizer</span>(<span class=\"title class_ inherited__\">object</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;åè°ƒè¯æ±‡è¡¨å¹¶å°†å®ƒä»¬åº”ç”¨åˆ°ä½¿ç”¨çš„å‘é‡åŒ–å™¨&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, surname_vocab, nationality_vocab, max_surname_length</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            surname_vocab (Vocabulary): å°†å­—ç¬¦æ˜ å°„åˆ°æ•´æ•°çš„è¯æ±‡è¡¨</span></span><br><span class=\"line\"><span class=\"string\">            nationality_vocab (Vocabulary): å°†å›½ç±æ˜ å°„åˆ°æ•´æ•°çš„è¯æ±‡è¡¨</span></span><br><span class=\"line\"><span class=\"string\">            max_surname_length (int): æœ€é•¿å§“æ°çš„é•¿åº¦</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        self.surname_vocab = surname_vocab</span><br><span class=\"line\">        self.nationality_vocab = nationality_vocab</span><br><span class=\"line\">        self._max_surname_length = max_surname_length</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">vectorize</span>(<span class=\"params\">self, surname</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            surname (str): å§“æ°</span></span><br><span class=\"line\"><span class=\"string\">        è¿”å›:</span></span><br><span class=\"line\"><span class=\"string\">            one_hot_matrix (np.ndarray): ä¸€ä¸ªone-hotå‘é‡çš„çŸ©é˜µ</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        one_hot_matrix_size = (<span class=\"built_in\">len</span>(self.surname_vocab), self._max_surname_length)</span><br><span class=\"line\">        one_hot_matrix = np.zeros(one_hot_matrix_size, dtype=np.float32)</span><br><span class=\"line\">                               </span><br><span class=\"line\">        <span class=\"keyword\">for</span> position_index, character <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(surname):</span><br><span class=\"line\">            character_index = self.surname_vocab.lookup_token(character)</span><br><span class=\"line\">            one_hot_matrix[character_index][position_index] = <span class=\"number\">1</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> one_hot_matrix</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">    @classmethod</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">from_dataframe</span>(<span class=\"params\">cls, surname_df</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;ä»æ•°æ®é›†DataFrameå®ä¾‹åŒ–å‘é‡åŒ–å™¨</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            surname_df (pandas.DataFrame): å§“æ°æ•°æ®é›†</span></span><br><span class=\"line\"><span class=\"string\">        è¿”å›:</span></span><br><span class=\"line\"><span class=\"string\">            SurnameVectorizerçš„å®ä¾‹</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        surname_vocab = Vocabulary(unk_token=<span class=\"string\">&quot;@&quot;</span>)</span><br><span class=\"line\">        nationality_vocab = Vocabulary(add_unk=<span class=\"literal\">False</span>)</span><br><span class=\"line\">        max_surname_length = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">for</span> index, row <span class=\"keyword\">in</span> surname_df.iterrows():</span><br><span class=\"line\">            max_surname_length = <span class=\"built_in\">max</span>(max_surname_length, <span class=\"built_in\">len</span>(row.surname))</span><br><span class=\"line\">            <span class=\"keyword\">for</span> letter <span class=\"keyword\">in</span> row.surname:</span><br><span class=\"line\">                surname_vocab.add_token(letter)</span><br><span class=\"line\">            nationality_vocab.add_token(row.nationality)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> cls(surname_vocab, nationality_vocab, max_surname_length)</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"The-Surname-Classifier-Model\"><a href=\"#The-Surname-Classifier-Model\" class=\"headerlink\" title=\"The Surname Classifier Model\"></a>The Surname Classifier Model</h2><p>SurnameClassifieræ˜¯æœ¬å®éªŒå‰é¢ä»‹ç»çš„MLPçš„å®ç°(ç¤ºä¾‹4-7)ã€‚ç¬¬ä¸€ä¸ªçº¿æ€§å±‚å°†è¾“å…¥å‘é‡æ˜ å°„åˆ°ä¸­é—´å‘é‡ï¼Œå¹¶å¯¹è¯¥å‘é‡åº”ç”¨éçº¿æ€§ã€‚ç¬¬äºŒçº¿æ€§å±‚å°†ä¸­é—´å‘é‡æ˜ å°„åˆ°é¢„æµ‹å‘é‡ã€‚</p>\n<p>åœ¨æœ€åä¸€æ­¥ä¸­ï¼Œå¯é€‰åœ°åº”ç”¨softmaxæ“ä½œï¼Œä»¥ç¡®ä¿è¾“å‡ºå’Œä¸º1;è¿™å°±æ˜¯æ‰€è°“çš„â€œæ¦‚ç‡â€ã€‚å®ƒæ˜¯å¯é€‰çš„åŸå› ä¸æˆ‘ä»¬ä½¿ç”¨çš„æŸå¤±å‡½æ•°çš„æ•°å­¦å…¬å¼æœ‰å…³â€”â€”äº¤å‰ç†µæŸå¤±ã€‚æˆ‘ä»¬ç ”ç©¶äº†â€œæŸå¤±å‡½æ•°â€ä¸­çš„äº¤å‰ç†µæŸå¤±ã€‚å›æƒ³ä¸€ä¸‹ï¼Œäº¤å‰ç†µæŸå¤±å¯¹äºå¤šç±»åˆ†ç±»æ˜¯æœ€ç†æƒ³çš„ï¼Œä½†æ˜¯åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è½¯æœ€å¤§å€¼çš„è®¡ç®—ä¸ä»…æµªè´¹è€Œä¸”åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¹¶ä¸ç¨³å®šã€‚</p>\n<p>Example 4-7. The SurnameClassifier as an MLP</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> torch.nn <span class=\"keyword\">as</span> nn</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.nn.functional <span class=\"keyword\">as</span> F</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SurnameClassifier</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, initial_num_channels, num_classes, num_channels</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        åˆ›å»ºä¸€ä¸ªå§“æ°åˆ†ç±»å™¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            initial_num_channels (int): è¾“å…¥ç‰¹å¾å‘é‡çš„å¤§å°</span></span><br><span class=\"line\"><span class=\"string\">            num_classes (int): è¾“å‡ºé¢„æµ‹å‘é‡çš„å¤§å°</span></span><br><span class=\"line\"><span class=\"string\">            num_channels (int): ç½‘ç»œä¸­è¦å§‹ç»ˆä½¿ç”¨çš„æ’å®šé€šé“å¤§å°</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(SurnameClassifier, self).__init__()</span><br><span class=\"line\">        </span><br><span class=\"line\">        self.convnet = nn.Sequential(</span><br><span class=\"line\">            nn.Conv1d(in_channels=initial_num_channels, </span><br><span class=\"line\">                      out_channels=num_channels, kernel_size=<span class=\"number\">3</span>),</span><br><span class=\"line\">            nn.ELU(),</span><br><span class=\"line\">            nn.Conv1d(in_channels=num_channels, out_channels=num_channels, </span><br><span class=\"line\">                      kernel_size=<span class=\"number\">3</span>, stride=<span class=\"number\">2</span>),</span><br><span class=\"line\">            nn.ELU(),</span><br><span class=\"line\">            nn.Conv1d(in_channels=num_channels, out_channels=num_channels, </span><br><span class=\"line\">                      kernel_size=<span class=\"number\">3</span>, stride=<span class=\"number\">2</span>),</span><br><span class=\"line\">            nn.ELU(),</span><br><span class=\"line\">            nn.Conv1d(in_channels=num_channels, out_channels=num_channels, </span><br><span class=\"line\">                      kernel_size=<span class=\"number\">3</span>),</span><br><span class=\"line\">            nn.ELU()</span><br><span class=\"line\">        )</span><br><span class=\"line\">        self.fc = nn.Linear(num_channels, num_classes)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, x_surname, apply_softmax=<span class=\"literal\">False</span></span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;åˆ†ç±»å™¨çš„å‰å‘ä¼ æ’­</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            x_surname (torch.Tensor): è¾“å…¥æ•°æ®å¼ é‡ã€‚</span></span><br><span class=\"line\"><span class=\"string\">                x_surname.shape åº”ä¸º (batch, initial_num_channels, max_surname_length)</span></span><br><span class=\"line\"><span class=\"string\">            apply_softmax (bool): softmax æ¿€æ´»çš„æ ‡å¿—</span></span><br><span class=\"line\"><span class=\"string\">                å¦‚æœä¸äº¤å‰ç†µæŸå¤±ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™åº”ä¸º False</span></span><br><span class=\"line\"><span class=\"string\">        è¿”å›:</span></span><br><span class=\"line\"><span class=\"string\">            ç»“æœå¼ é‡ã€‚tensor.shape åº”ä¸º (batch, num_classes)</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        features = self.convnet(x_surname).squeeze(dim=<span class=\"number\">2</span>)</span><br><span class=\"line\">       </span><br><span class=\"line\">        prediction_vector = self.fc(features)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> apply_softmax:</span><br><span class=\"line\">            prediction_vector = F.softmax(prediction_vector, dim=<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> prediction_vector</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"The-Training-Routine\"><a href=\"#The-Training-Routine\" class=\"headerlink\" title=\"The Training Routine\"></a>The Training Routine</h2><p>è™½ç„¶æˆ‘ä»¬ä½¿ç”¨äº†ä¸åŒçš„æ¨¡å‹ã€æ•°æ®é›†å’ŒæŸå¤±å‡½æ•°ï¼Œä½†æ˜¯è®­ç»ƒä¾‹ç¨‹æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œåœ¨ä¾‹4-8ä¸­ï¼Œæˆ‘ä»¬åªå±•ç¤ºäº†argsä»¥åŠæœ¬ä¾‹ä¸­çš„è®­ç»ƒä¾‹ç¨‹ä¸â€œç¤ºä¾‹:é¤å…è¯„è®ºæƒ…ç»ªåˆ†ç±»â€ä¸­çš„ç¤ºä¾‹ä¹‹é—´çš„ä¸»è¦åŒºåˆ«ã€‚</p>\n<p>Example 4-8. The args for classifying surnames with an MLP</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">args = Namespace(</span><br><span class=\"line\">    <span class=\"comment\"># æ•°æ®å’Œè·¯å¾„ä¿¡æ¯</span></span><br><span class=\"line\">    surname_csv=<span class=\"string\">&quot;data/surnames/surnames_with_splits.csv&quot;</span>,</span><br><span class=\"line\">    vectorizer_file=<span class=\"string\">&quot;vectorizer.json&quot;</span>,</span><br><span class=\"line\">    model_state_file=<span class=\"string\">&quot;model.pth&quot;</span>,</span><br><span class=\"line\">    save_dir=<span class=\"string\">&quot;model_storage/ch4/cnn&quot;</span>,</span><br><span class=\"line\">    <span class=\"comment\"># æ¨¡å‹è¶…å‚æ•°</span></span><br><span class=\"line\">    hidden_dim=<span class=\"number\">100</span>,</span><br><span class=\"line\">    num_channels=<span class=\"number\">256</span>,</span><br><span class=\"line\">    <span class=\"comment\"># è®­ç»ƒè¶…å‚æ•°</span></span><br><span class=\"line\">    seed=<span class=\"number\">1337</span>,</span><br><span class=\"line\">    learning_rate=<span class=\"number\">0.001</span>,</span><br><span class=\"line\">    batch_size=<span class=\"number\">128</span>,</span><br><span class=\"line\">    num_epochs=<span class=\"number\">100</span>,</span><br><span class=\"line\">    early_stopping_criteria=<span class=\"number\">5</span>,</span><br><span class=\"line\">    dropout_p=<span class=\"number\">0.1</span>,</span><br><span class=\"line\">    <span class=\"comment\"># è¿è¡Œæ—¶é€‰é¡¹</span></span><br><span class=\"line\">    cuda=<span class=\"literal\">False</span>,</span><br><span class=\"line\">    reload_from_files=<span class=\"literal\">False</span>,</span><br><span class=\"line\">    expand_filepaths_to_save_dir=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    catch_keyboard_interrupt=<span class=\"literal\">True</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>è®­ç»ƒä¸­æœ€æ˜¾è‘—çš„å·®å¼‚ä¸æ¨¡å‹ä¸­è¾“å‡ºçš„ç§ç±»å’Œä½¿ç”¨çš„æŸå¤±å‡½æ•°æœ‰å…³ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªå¤šç±»é¢„æµ‹å‘é‡ï¼Œå¯ä»¥è½¬æ¢ä¸ºæ¦‚ç‡ã€‚æ­£å¦‚åœ¨æ¨¡å‹æè¿°ä¸­æ‰€æè¿°çš„ï¼Œè¿™ç§è¾“å‡ºçš„æŸå¤±ç±»å‹ä»…é™äºCrossEntropyLosså’ŒNLLLossã€‚ç”±äºå®ƒçš„ç®€åŒ–ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†CrossEntropyLossã€‚</p>\n<p>åœ¨ä¾‹4-9ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†æ•°æ®é›†ã€æ¨¡å‹ã€æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨çš„å®ä¾‹åŒ–ã€‚è¿™äº›å®ä¾‹åº”è¯¥çœ‹èµ·æ¥ä¸â€œç¤ºä¾‹:å°†é¤é¦†è¯„è®ºçš„æƒ…ç»ªåˆ†ç±»â€ä¸­çš„å®ä¾‹å‡ ä¹ç›¸åŒã€‚äº‹å®ä¸Šï¼Œåœ¨æœ¬è¯¾ç¨‹åé¢çš„å®éªŒä¸­ï¼Œè¿™ç§æ¨¡å¼å°†å¯¹æ¯ä¸ªç¤ºä¾‹è¿›è¡Œé‡å¤ã€‚</p>\n<p>Example 4-9. Instantiating the dataset, model, loss, and optimizer</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">dataset = SurnameDataset.load_dataset_and_make_vectorizer(args.surname_csv)</span><br><span class=\"line\">vectorizer = dataset.get_vectorizer()</span><br><span class=\"line\"></span><br><span class=\"line\">classifier = SurnameClassifier(input_dim=<span class=\"built_in\">len</span>(vectorizer.surname_vocab),</span><br><span class=\"line\">                               hidden_dim=args.hidden_dim,</span><br><span class=\"line\">                               output_dim=<span class=\"built_in\">len</span>(vectorizer.nationality_vocab))</span><br><span class=\"line\"></span><br><span class=\"line\">classifier = classifier.to(args.device)    </span><br><span class=\"line\"></span><br><span class=\"line\">loss_func = nn.CrossEntropyLoss(dataset.class_weights)</span><br><span class=\"line\">optimizer = optim.Adam(classifier.parameters(), lr=args.learning_rate)</span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"THE-TRAINING-LOOP\"><a href=\"#THE-TRAINING-LOOP\" class=\"headerlink\" title=\"THE TRAINING LOOP\"></a>THE TRAINING LOOP</h3><p>ä¸â€œExample: Classifying Sentiment of Restaurant Reviewsâ€ä¸­çš„è®­ç»ƒå¾ªç¯ç›¸æ¯”ï¼Œæœ¬ä¾‹çš„è®­ç»ƒå¾ªç¯é™¤äº†å˜é‡åä»¥å¤–å‡ ä¹æ˜¯ç›¸åŒçš„ã€‚å…·ä½“æ¥è¯´ï¼Œç¤ºä¾‹4-10æ˜¾ç¤ºäº†ä½¿ç”¨ä¸åŒçš„keyä»batch_dictä¸­è·å–æ•°æ®ã€‚é™¤äº†å¤–è§‚ä¸Šçš„å·®å¼‚ï¼Œè®­ç»ƒå¾ªç¯çš„åŠŸèƒ½ä¿æŒä¸å˜ã€‚åˆ©ç”¨è®­ç»ƒæ•°æ®ï¼Œè®¡ç®—æ¨¡å‹è¾“å‡ºã€æŸå¤±å’Œæ¢¯åº¦ã€‚ç„¶åï¼Œä½¿ç”¨æ¢¯åº¦æ¥æ›´æ–°æ¨¡å‹ã€‚</p>\n<p>Example 4-10. A snippet of the training loop</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># the training routine is these 5 steps:</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># --------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\"># step 1. zero the gradients</span></span><br><span class=\"line\">optimizer.zero_grad()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># step 2. compute the output</span></span><br><span class=\"line\">y_pred = classifier(batch_dict[<span class=\"string\">&#x27;x_surname&#x27;</span>])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># step 3. compute the loss</span></span><br><span class=\"line\">loss = loss_func(y_pred, batch_dict[<span class=\"string\">&#x27;y_nationality&#x27;</span>])</span><br><span class=\"line\">loss_batch = loss.to(<span class=\"string\">&quot;cpu&quot;</span>).item()</span><br><span class=\"line\">running_loss += (loss_batch - running_loss) / (batch_index + <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># step 4. use loss to produce gradients</span></span><br><span class=\"line\">loss.backward()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># step 5. use optimizer to take gradient step</span></span><br><span class=\"line\">optimizer.step()</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"Model-Evaluation-and-Prediction\"><a href=\"#Model-Evaluation-and-Prediction\" class=\"headerlink\" title=\"Model Evaluation and Prediction\"></a>Model Evaluation and Prediction</h2><p>è¦ç†è§£æ¨¡å‹çš„æ€§èƒ½ï¼Œåº”è¯¥ä½¿ç”¨å®šé‡å’Œå®šæ€§æ–¹æ³•åˆ†ææ¨¡å‹ã€‚å®šé‡æµ‹é‡å‡ºçš„æµ‹è¯•æ•°æ®çš„è¯¯å·®ï¼Œå†³å®šäº†åˆ†ç±»å™¨èƒ½å¦æ¨å¹¿åˆ°ä¸å¯è§çš„ä¾‹å­ã€‚å®šæ€§åœ°è¯´ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹åˆ†ç±»å™¨çš„top-ké¢„æµ‹æ¥ä¸ºä¸€ä¸ªæ–°ç¤ºä¾‹å¼€å‘æ¨¡å‹æ‰€äº†è§£çš„å†…å®¹çš„ç›´è§‰ã€‚</p>\n<h3 id=\"EVALUATING-ON-THE-TEST-DATASET\"><a href=\"#EVALUATING-ON-THE-TEST-DATASET\" class=\"headerlink\" title=\"EVALUATING ON THE TEST DATASET\"></a>EVALUATING ON THE TEST DATASET</h3><p>è¯„ä»·SurnameClassifieræµ‹è¯•æ•°æ®,æˆ‘ä»¬æ‰§è¡Œç›¸åŒçš„å¸¸è§„çš„routineæ–‡æœ¬åˆ†ç±»çš„ä¾‹å­â€œé¤é¦†è¯„è®ºçš„ä¾‹å­:åˆ†ç±»æƒ…ç»ªâ€:æˆ‘ä»¬å°†æ•°æ®é›†è®¾ç½®ä¸ºéå†æµ‹è¯•æ•°æ®,è°ƒç”¨<code>classifier.eval()</code>æ–¹æ³•,å¹¶éå†æµ‹è¯•æ•°æ®ä»¥åŒæ ·çš„æ–¹å¼ä¸å…¶ä»–æ•°æ®ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè°ƒç”¨<code>classifier.eval()</code>å¯ä»¥é˜²æ­¢PyTorchåœ¨ä½¿ç”¨æµ‹è¯•&#x2F;è¯„ä¼°æ•°æ®æ—¶æ›´æ–°æ¨¡å‹å‚æ•°ã€‚</p>\n<p>è¯¥æ¨¡å‹å¯¹æµ‹è¯•æ•°æ®çš„å‡†ç¡®æ€§è¾¾åˆ°50%å·¦å³ã€‚å¦‚æœåœ¨é™„å¸¦çš„notebookä¸­è¿è¡Œè®­ç»ƒä¾‹ç¨‹ï¼Œä¼šæ³¨æ„åˆ°åœ¨è®­ç»ƒæ•°æ®ä¸Šçš„æ€§èƒ½æ›´é«˜ã€‚è¿™æ˜¯å› ä¸ºæ¨¡å‹æ€»æ˜¯æ›´é€‚åˆå®ƒæ‰€è®­ç»ƒçš„æ•°æ®ï¼Œæ‰€ä»¥è®­ç»ƒæ•°æ®çš„æ€§èƒ½å¹¶ä¸ä»£è¡¨æ–°æ•°æ®çš„æ€§èƒ½ã€‚å¦‚æœéµå¾ªä»£ç ï¼Œä½ å¯ä»¥å°è¯•éšè—ç»´åº¦çš„ä¸åŒå¤§å°ï¼Œåº”è¯¥æ³¨æ„åˆ°æ€§èƒ½çš„æé«˜ã€‚ç„¶è€Œï¼Œè¿™ç§å¢é•¿ä¸ä¼šå¾ˆå¤§(å°¤å…¶æ˜¯ä¸â€œç”¨CNNå¯¹å§“æ°è¿›è¡Œåˆ†ç±»çš„ä¾‹å­â€ä¸­çš„æ¨¡å‹ç›¸æ¯”)ã€‚å…¶ä¸»è¦åŸå› æ˜¯æ”¶ç¼©çš„onehotå‘é‡åŒ–æ–¹æ³•æ˜¯ä¸€ç§å¼±è¡¨ç¤ºã€‚è™½ç„¶å®ƒç¡®å®ç®€æ´åœ°å°†æ¯ä¸ªå§“æ°è¡¨ç¤ºä¸ºå•ä¸ªå‘é‡ï¼Œä½†å®ƒä¸¢å¼ƒäº†å­—ç¬¦ä¹‹é—´çš„é¡ºåºä¿¡æ¯ï¼Œè¿™å¯¹äºè¯†åˆ«èµ·æºéå¸¸é‡è¦ã€‚</p>\n<h3 id=\"CLASSIFYING-A-NEW-SURNAME\"><a href=\"#CLASSIFYING-A-NEW-SURNAME\" class=\"headerlink\" title=\"CLASSIFYING A NEW SURNAME\"></a>CLASSIFYING A NEW SURNAME</h3><p>ç¤ºä¾‹4-11æ˜¾ç¤ºäº†åˆ†ç±»æ–°å§“æ°çš„ä»£ç ã€‚ç»™å®šä¸€ä¸ªå§“æ°ä½œä¸ºå­—ç¬¦ä¸²ï¼Œè¯¥å‡½æ•°å°†é¦–å…ˆåº”ç”¨å‘é‡åŒ–è¿‡ç¨‹ï¼Œç„¶åè·å¾—æ¨¡å‹é¢„æµ‹ã€‚æ³¨æ„ï¼Œæˆ‘ä»¬åŒ…å«äº†apply_softmaxæ ‡å¿—ï¼Œæ‰€ä»¥ç»“æœåŒ…å«æ¦‚ç‡ã€‚æ¨¡å‹é¢„æµ‹ï¼Œåœ¨å¤šé¡¹å¼çš„æƒ…å†µä¸‹ï¼Œæ˜¯ç±»æ¦‚ç‡çš„åˆ—è¡¨ã€‚æˆ‘ä»¬ä½¿ç”¨PyTorchå¼ é‡æœ€å¤§å‡½æ•°æ¥å¾—åˆ°ç”±æœ€é«˜é¢„æµ‹æ¦‚ç‡è¡¨ç¤ºçš„æœ€ä¼˜ç±»ã€‚</p>\n<p>Example 4-11. A function for performing nationality prediction</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">predict_nationality</span>(<span class=\"params\">surname, classifier, vectorizer</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;é¢„æµ‹å§“æ°çš„å›½ç±</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        surname (str): è¦åˆ†ç±»çš„å§“æ°</span></span><br><span class=\"line\"><span class=\"string\">        classifier (SurnameClassifer): åˆ†ç±»å™¨çš„å®ä¾‹</span></span><br><span class=\"line\"><span class=\"string\">        vectorizer (SurnameVectorizer): ç›¸åº”çš„å‘é‡åŒ–å™¨</span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">        dict: åŒ…å«æœ€å¯èƒ½çš„å›½ç±åŠå…¶æ¦‚ç‡çš„å­—å…¸</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># å‘é‡åŒ–å§“æ°</span></span><br><span class=\"line\">    vectorized_surname = vectorizer.vectorize(surname)</span><br><span class=\"line\">    <span class=\"comment\"># å°†å‘é‡åŒ–çš„å§“æ°è½¬æ¢ä¸ºPyTorchå¼ é‡ï¼Œå¹¶æ·»åŠ æ‰¹æ¬¡ç»´åº¦</span></span><br><span class=\"line\">    vectorized_surname = torch.tensor(vectorized_surname).unsqueeze(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"comment\"># ä½¿ç”¨åˆ†ç±»å™¨è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å¯¹è¾“å‡ºè¿›è¡Œsoftmaxå¤„ç†</span></span><br><span class=\"line\">    result = classifier(vectorized_surname, apply_softmax=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># è·å–æ¦‚ç‡æœ€é«˜çš„å›½ç±åŠå…¶å¯¹åº”çš„ç´¢å¼•</span></span><br><span class=\"line\">    probability_values, indices = result.<span class=\"built_in\">max</span>(dim=<span class=\"number\">1</span>)</span><br><span class=\"line\">    index = indices.item()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># é€šè¿‡ç´¢å¼•æŸ¥æ‰¾é¢„æµ‹çš„å›½ç±ï¼Œå¹¶è·å–å…¶æ¦‚ç‡å€¼</span></span><br><span class=\"line\">    predicted_nationality = vectorizer.nationality_vocab.lookup_index(index)</span><br><span class=\"line\">    probability_value = probability_values.item()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›é¢„æµ‹ç»“æœçš„å­—å…¸</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;nationality&#x27;</span>: predicted_nationality, <span class=\"string\">&#x27;probability&#x27;</span>: probability_value&#125;</span><br></pre></td></tr></table></figure>\n<p>ç¤ºä¾‹ï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-15.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"RETRIEVING-THE-TOP-K-PREDICTIONS-FOR-A-NEW-SURNAME\"><a href=\"#RETRIEVING-THE-TOP-K-PREDICTIONS-FOR-A-NEW-SURNAME\" class=\"headerlink\" title=\"RETRIEVING THE TOP-K PREDICTIONS FOR A NEW SURNAME\"></a>RETRIEVING THE TOP-K PREDICTIONS FOR A NEW SURNAME</h3><p>ä¸ä»…è¦çœ‹æœ€å¥½çš„é¢„æµ‹ï¼Œè¿˜è¦çœ‹æ›´å¤šçš„é¢„æµ‹ã€‚ä¾‹å¦‚ï¼ŒNLPä¸­çš„æ ‡å‡†å®è·µæ˜¯é‡‡ç”¨k-besté¢„æµ‹å¹¶ä½¿ç”¨å¦ä¸€ä¸ªæ¨¡å‹å¯¹å®ƒä»¬é‡æ–°æ’åºã€‚PyTorchæä¾›äº†ä¸€ä¸ªtorch.topkå‡½æ•°ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥è·å¾—è¿™äº›é¢„æµ‹ï¼Œå¦‚ç¤ºä¾‹4-12æ‰€ç¤ºã€‚</p>\n<p>Example 4-12. Predicting the top-k nationalities</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">predict_topk_nationality</span>(<span class=\"params\">surname, classifier, vectorizer, k=<span class=\"number\">5</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;é¢„æµ‹å§“æ°çš„å‰Kä¸ªå¯èƒ½çš„å›½ç±</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        surname (str): è¦åˆ†ç±»çš„å§“æ°</span></span><br><span class=\"line\"><span class=\"string\">        classifier (SurnameClassifer): åˆ†ç±»å™¨çš„å®ä¾‹</span></span><br><span class=\"line\"><span class=\"string\">        vectorizer (SurnameVectorizer): ç›¸åº”çš„å‘é‡åŒ–å™¨</span></span><br><span class=\"line\"><span class=\"string\">        k (int): è¦è¿”å›çš„å‰Kä¸ªå›½ç±æ•°é‡</span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">        list: å­—å…¸çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå­—å…¸åŒ…å«ä¸€ä¸ªå›½ç±å’Œå…¶å¯¹åº”çš„æ¦‚ç‡</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># å‘é‡åŒ–å§“æ°</span></span><br><span class=\"line\">    vectorized_surname = vectorizer.vectorize(surname)</span><br><span class=\"line\">    vectorized_surname = torch.tensor(vectorized_surname).unsqueeze(dim=<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"comment\"># ä½¿ç”¨åˆ†ç±»å™¨è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å¯¹è¾“å‡ºè¿›è¡Œsoftmaxå¤„ç†ï¼Œè·å–å‰Kä¸ªå›½ç±åŠå…¶æ¦‚ç‡</span></span><br><span class=\"line\">    prediction_vector = classifier(vectorized_surname, apply_softmax=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    probability_values, indices = torch.topk(prediction_vector, k=k)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># è·å–é¢„æµ‹ç»“æœä¸­æ¦‚ç‡æœ€é«˜çš„Kä¸ªå›½ç±åŠå…¶æ¦‚ç‡å€¼</span></span><br><span class=\"line\">    probability_values = probability_values[<span class=\"number\">0</span>].detach().numpy()</span><br><span class=\"line\">    indices = indices[<span class=\"number\">0</span>].detach().numpy()</span><br><span class=\"line\">    </span><br><span class=\"line\">    results = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> kth_index <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k):</span><br><span class=\"line\">        <span class=\"comment\"># é€šè¿‡ç´¢å¼•æŸ¥æ‰¾å›½ç±ï¼Œå¹¶è·å–å…¶å¯¹åº”çš„æ¦‚ç‡å€¼ï¼Œå°†ç»“æœå­˜å‚¨ä¸ºå­—å…¸åˆ—è¡¨</span></span><br><span class=\"line\">        nationality = vectorizer.nationality_vocab.lookup_index(indices[kth_index])</span><br><span class=\"line\">        probability_value = probability_values[kth_index]</span><br><span class=\"line\">        results.append(&#123;<span class=\"string\">&#x27;nationality&#x27;</span>: nationality, </span><br><span class=\"line\">                        <span class=\"string\">&#x27;probability&#x27;</span>: probability_value&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> results</span><br></pre></td></tr></table></figure>\n<p>ç¤ºä¾‹ï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-16.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"Regularizing-MLPs-Weight-Regularization-and-Structural-Regularization-or-Dropout\"><a href=\"#Regularizing-MLPs-Weight-Regularization-and-Structural-Regularization-or-Dropout\" class=\"headerlink\" title=\"Regularizing MLPs: Weight Regularization and Structural Regularization (or Dropout)\"></a>Regularizing MLPs: Weight Regularization and Structural Regularization (or Dropout)</h2><p>åœ¨å®éªŒ3ä¸­ï¼Œæˆ‘ä»¬è§£é‡Šäº†æ­£åˆ™åŒ–æ˜¯å¦‚ä½•è§£å†³è¿‡æ‹Ÿåˆé—®é¢˜çš„ï¼Œå¹¶ç ”ç©¶äº†ä¸¤ç§é‡è¦çš„æƒé‡æ­£åˆ™åŒ–ç±»å‹â€”â€”L1å’ŒL2ã€‚è¿™äº›æƒå€¼æ­£åˆ™åŒ–æ–¹æ³•ä¹Ÿé€‚ç”¨äºMLPså’Œå·ç§¯ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬å°†åœ¨æœ¬å®éªŒåé¢ä»‹ç»ã€‚é™¤æƒå€¼æ­£åˆ™åŒ–å¤–ï¼Œå¯¹äºæ·±åº¦æ¨¡å‹(å³ä¾‹å¦‚æœ¬å®éªŒè®¨è®ºçš„å‰é¦ˆç½‘ç»œï¼Œä¸€ç§ç§°ä¸ºdropoutçš„ç»“æ„æ­£åˆ™åŒ–æ–¹æ³•å˜å¾—éå¸¸é‡è¦ã€‚</p>\n<h3 id=\"DROPOUT\"><a href=\"#DROPOUT\" class=\"headerlink\" title=\"DROPOUT\"></a>DROPOUT</h3><p>ç®€å•åœ°è¯´ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œdropoutæœ‰ä¸€å®šæ¦‚ç‡ä½¿å±äºä¸¤ä¸ªç›¸é‚»å±‚çš„å•å…ƒä¹‹é—´çš„è¿æ¥å‡å¼±ã€‚è¿™æœ‰ä»€ä¹ˆç”¨å‘¢?æˆ‘ä»¬ä»æ–¯è’‚èŠ¬â€¢æ¢…é‡Œè’‚(Stephen Merity)çš„ä¸€æ®µç›´è§‚(ä¸”å¹½é»˜)çš„è§£é‡Šå¼€å§‹ï¼šâ€œDropoutï¼Œç®€å•åœ°è¯´ï¼Œæ˜¯æŒ‡å¦‚æœä½ èƒ½åœ¨å–é†‰çš„æ—¶å€™åå¤å­¦ä¹ å¦‚ä½•åšä¸€ä»¶äº‹ï¼Œé‚£ä¹ˆä½ åº”è¯¥èƒ½å¤Ÿåœ¨æ¸…é†’çš„æ—¶å€™åšå¾—æ›´å¥½ã€‚è¿™ä¸€è§è§£äº§ç”Ÿäº†è®¸å¤šæœ€å…ˆè¿›çš„ç»“æœå’Œä¸€ä¸ªæ–°å…´çš„é¢†åŸŸã€‚â€</p>\n<p>ç¥ç»ç½‘ç»œâ€”â€”å°¤å…¶æ˜¯å…·æœ‰å¤§é‡åˆ†å±‚çš„æ·±å±‚ç½‘ç»œâ€”â€”å¯ä»¥åœ¨å•å…ƒä¹‹é—´åˆ›å»ºæœ‰è¶£çš„ç›¸äº’é€‚åº”ã€‚â€œCoadaptationâ€æ˜¯ç¥ç»ç§‘å­¦ä¸­çš„ä¸€ä¸ªæœ¯è¯­ï¼Œä½†åœ¨è¿™é‡Œå®ƒåªæ˜¯æŒ‡ä¸€ç§æƒ…å†µï¼Œå³ä¸¤ä¸ªå•å…ƒä¹‹é—´çš„è”ç³»å˜å¾—è¿‡äºç´§å¯†ï¼Œè€Œç‰ºç‰²äº†å…¶ä»–å•å…ƒä¹‹é—´çš„è”ç³»ã€‚è¿™é€šå¸¸ä¼šå¯¼è‡´æ¨¡å‹ä¸æ•°æ®è¿‡æ‹Ÿåˆã€‚é€šè¿‡æ¦‚ç‡åœ°ä¸¢å¼ƒå•å…ƒä¹‹é—´çš„è¿æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿æ²¡æœ‰ä¸€ä¸ªå•å…ƒæ€»æ˜¯ä¾èµ–äºå¦ä¸€ä¸ªå•å…ƒï¼Œä»è€Œäº§ç”Ÿå¥å£®çš„æ¨¡å‹ã€‚dropoutä¸ä¼šå‘æ¨¡å‹ä¸­æ·»åŠ é¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯éœ€è¦ä¸€ä¸ªè¶…å‚æ•°â€”â€”â€œdrop probabilityâ€ã€‚drop probabilityï¼Œå®ƒæ˜¯å•ä½ä¹‹é—´çš„è¿æ¥dropçš„æ¦‚ç‡ã€‚é€šå¸¸å°†ä¸‹é™æ¦‚ç‡è®¾ç½®ä¸º0.5ã€‚ä¾‹4-13ç»™å‡ºäº†ä¸€ä¸ªå¸¦dropoutçš„MLPçš„é‡æ–°å®ç°ã€‚</p>\n<p>Example 4-13. MLP with dropout</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> torch.nn <span class=\"keyword\">as</span> nn</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.nn.functional <span class=\"keyword\">as</span> F</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MultilayerPerceptron</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, input_dim, hidden_dim, output_dim</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">            input_dim (int): the size of the input vectors</span></span><br><span class=\"line\"><span class=\"string\">            hidden_dim (int): the output size of the first Linear layer</span></span><br><span class=\"line\"><span class=\"string\">            output_dim (int): the output size of the second Linear layer</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(MultilayerPerceptron, self).__init__()</span><br><span class=\"line\">        self.fc1 = nn.Linear(input_dim, hidden_dim)</span><br><span class=\"line\">        self.fc2 = nn.Linear(hidden_dim, output_dim)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, x_in, apply_softmax=<span class=\"literal\">False</span></span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;The forward pass of the MLP</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">        Args:</span></span><br><span class=\"line\"><span class=\"string\">            x_in (torch.Tensor): an input data tensor.</span></span><br><span class=\"line\"><span class=\"string\">                x_in.shape should be (batch, input_dim)</span></span><br><span class=\"line\"><span class=\"string\">            apply_softmax (bool): a flag for the softmax activation</span></span><br><span class=\"line\"><span class=\"string\">                should be false if used with the Cross Entropy losses</span></span><br><span class=\"line\"><span class=\"string\">        Returns:</span></span><br><span class=\"line\"><span class=\"string\">            the resulting tensor. tensor.shape should be (batch, output_dim)</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        intermediate = F.relu(self.fc1(x_in))</span><br><span class=\"line\">        output = self.fc2(F.dropout(intermediate, p=<span class=\"number\">0.5</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> apply_softmax:</span><br><span class=\"line\">            output = F.softmax(output, dim=<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> output</span><br></pre></td></tr></table></figure>\n<p>è¯·æ³¨æ„ï¼Œdropoutåªé€‚ç”¨äºè®­ç»ƒæœŸé—´ï¼Œä¸é€‚ç”¨äºè¯„ä¼°æœŸé—´ã€‚ä½œä¸ºç»ƒä¹ ï¼Œå¯ä»¥å°è¯•å¸¦æœ‰dropoutçš„SurnameClassifieræ¨¡å‹ï¼Œçœ‹çœ‹å®ƒå¦‚ä½•æ›´æ”¹ç»“æœã€‚</p>\n<h1 id=\"å·ç§¯ç¥ç»ç½‘ç»œ\"><a href=\"#å·ç§¯ç¥ç»ç½‘ç»œ\" class=\"headerlink\" title=\"å·ç§¯ç¥ç»ç½‘ç»œ\"></a>å·ç§¯ç¥ç»ç½‘ç»œ</h1><p>åœ¨æœ¬å®éªŒçš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥ç ”ç©¶äº†MLPsã€ç”±ä¸€ç³»åˆ—çº¿æ€§å±‚å’Œéçº¿æ€§å‡½æ•°æ„å»ºçš„ç¥ç»ç½‘ç»œã€‚mlpä¸æ˜¯åˆ©ç”¨é¡ºåºæ¨¡å¼çš„æœ€ä½³å·¥å…·ã€‚ä¾‹å¦‚ï¼Œåœ¨å§“æ°æ•°æ®é›†ä¸­ï¼Œå§“æ°å¯ä»¥æœ‰(ä¸åŒé•¿åº¦çš„)æ®µï¼Œè¿™äº›æ®µå¯ä»¥æ˜¾ç¤ºå‡ºç›¸å½“å¤šå…³äºå…¶èµ·æºå›½å®¶çš„ä¿¡æ¯(å¦‚â€œOâ€™Neillâ€ä¸­çš„â€œOâ€ã€â€œAntonopoulosâ€ä¸­çš„â€œopoulosâ€ã€â€œNagasawaâ€ä¸­çš„â€œsawaâ€æˆ–â€œZhuâ€ä¸­çš„â€œZhâ€)ã€‚è¿™äº›æ®µçš„é•¿åº¦å¯ä»¥æ˜¯å¯å˜çš„ï¼ŒæŒ‘æˆ˜æ˜¯åœ¨ä¸æ˜¾å¼ç¼–ç çš„æƒ…å†µä¸‹æ•è·å®ƒä»¬ã€‚</p>\n<p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å·ç§¯ç¥ç»ç½‘ç»œ(CNN)ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸é€‚åˆæ£€æµ‹ç©ºé—´å­ç»“æ„(å¹¶å› æ­¤åˆ›å»ºæœ‰æ„ä¹‰çš„ç©ºé—´å­ç»“æ„)çš„ç¥ç»ç½‘ç»œã€‚CNNsé€šè¿‡ä½¿ç”¨å°‘é‡çš„æƒé‡æ¥æ‰«æè¾“å…¥æ•°æ®å¼ é‡æ¥å®ç°è¿™ä¸€ç‚¹ã€‚é€šè¿‡è¿™ç§æ‰«æï¼Œå®ƒä»¬äº§ç”Ÿè¡¨ç¤ºå­ç»“æ„æ£€æµ‹(æˆ–ä¸æ£€æµ‹)çš„è¾“å‡ºå¼ é‡ã€‚</p>\n<p>åœ¨æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæè¿°CNNçš„å·¥ä½œæ–¹å¼ï¼Œä»¥åŠåœ¨è®¾è®¡CNNæ—¶åº”è¯¥è€ƒè™‘çš„é—®é¢˜ã€‚æˆ‘ä»¬æ·±å…¥ç ”ç©¶CNNè¶…å‚æ•°ï¼Œç›®çš„æ˜¯æä¾›ç›´è§‚çš„è¡Œä¸ºå’Œè¿™äº›è¶…å‚æ•°å¯¹è¾“å‡ºçš„å½±å“ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªç®€å•çš„ä¾‹å­é€æ­¥è¯´æ˜CNNsçš„æœºåˆ¶ã€‚åœ¨â€œç¤ºä¾‹:ä½¿ç”¨CNNå¯¹å§“æ°è¿›è¡Œåˆ†ç±»â€ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥ç ”ç©¶ä¸€ä¸ªæ›´å¹¿æ³›çš„ç¤ºä¾‹ã€‚</p>\n<h2 id=\"ç®€ä»‹-1\"><a href=\"#ç®€ä»‹-1\" class=\"headerlink\" title=\"ç®€ä»‹\"></a>ç®€ä»‹</h2><p>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆè‹±è¯­ï¼šconvolutional neural networkï¼Œç¼©å†™ï¼šCNNï¼‰æ˜¯ä¸€ç§å‰é¦ˆç¥ç»ç½‘ç»œï¼Œå®ƒçš„äººå·¥ç¥ç»å…ƒå¯ä»¥å“åº”ä¸€éƒ¨åˆ†è¦†ç›–èŒƒå›´å†…çš„å‘¨å›´å•å…ƒï¼Œå¯¹äºå¤§å‹å›¾åƒå¤„ç†æœ‰å‡ºè‰²è¡¨ç°ã€‚</p>\n<p>CNNsçš„åç§°å’ŒåŸºæœ¬åŠŸèƒ½æºäºç»å…¸çš„æ•°å­¦è¿ç®—å·ç§¯ã€‚å·ç§¯å·²ç»åº”ç”¨äºå„ç§å·¥ç¨‹å­¦ç§‘ï¼ŒåŒ…æ‹¬æ•°å­—ä¿¡å·å¤„ç†å’Œè®¡ç®—æœºå›¾å½¢å­¦ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå·ç§¯ä½¿ç”¨ç¨‹åºå‘˜æŒ‡å®šçš„å‚æ•°ã€‚è¿™äº›å‚æ•°è¢«æŒ‡å®šæ¥åŒ¹é…ä¸€äº›åŠŸèƒ½è®¾è®¡ï¼Œå¦‚çªå‡ºè¾¹ç¼˜æˆ–æŠ‘åˆ¶é«˜é¢‘å£°éŸ³ã€‚äº‹å®ä¸Šï¼Œè®¸å¤šPhotoshopæ»¤é•œéƒ½æ˜¯åº”ç”¨äºå›¾åƒçš„å›ºå®šå·ç§¯è¿ç®—ã€‚ç„¶è€Œï¼Œåœ¨æ·±åº¦å­¦ä¹ å’Œæœ¬å®éªŒä¸­ï¼Œæˆ‘ä»¬ä»æ•°æ®ä¸­å­¦ä¹ å·ç§¯æ»¤æ³¢å™¨çš„å‚æ•°ï¼Œå› æ­¤å®ƒå¯¹äºè§£å†³å½“å‰çš„ä»»åŠ¡æ˜¯æœ€ä¼˜çš„ã€‚</p>\n<p>å·ç§¯ç¥ç»ç½‘ç»œç”±ä¸€ä¸ªæˆ–å¤šä¸ªå·ç§¯å±‚å’Œé¡¶ç«¯çš„å…¨è¿é€šå±‚ï¼ˆå¯¹åº”ç»å…¸çš„ç¥ç»ç½‘ç»œï¼‰ç»„æˆï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬å…³è”æƒé‡å’Œæ± åŒ–å±‚ï¼ˆpooling layerï¼‰ã€‚è¿™ä¸€ç»“æ„ä½¿å¾—å·ç§¯ç¥ç»ç½‘ç»œèƒ½å¤Ÿåˆ©ç”¨è¾“å…¥æ•°æ®çš„äºŒç»´ç»“æ„ã€‚ä¸å…¶ä»–æ·±åº¦å­¦ä¹ ç»“æ„ç›¸æ¯”ï¼Œå·ç§¯ç¥ç»ç½‘ç»œåœ¨å›¾åƒå’Œè¯­éŸ³è¯†åˆ«æ–¹é¢èƒ½å¤Ÿç»™å‡ºæ›´å¥½çš„ç»“æœã€‚è¿™ä¸€æ¨¡å‹ä¹Ÿå¯ä»¥ä½¿ç”¨åå‘ä¼ æ’­ç®—æ³•è¿›è¡Œè®­ç»ƒã€‚ç›¸æ¯”è¾ƒå…¶ä»–æ·±åº¦ã€å‰é¦ˆç¥ç»ç½‘ç»œï¼Œå·ç§¯ç¥ç»ç½‘ç»œéœ€è¦è€ƒé‡çš„å‚æ•°æ›´å°‘ï¼Œä½¿ä¹‹æˆä¸ºä¸€ç§é¢‡å…·å¸å¼•åŠ›çš„æ·±åº¦å­¦ä¹ ç»“æ„ã€‚</p>\n<p>å·ç§¯ç¥ç»ç½‘ç»œçš„çµæ„Ÿæ¥è‡ªäºåŠ¨ç‰©è§†è§‰çš®å±‚ç»„ç»‡çš„ç¥ç»è¿æ¥æ–¹å¼ã€‚å•ä¸ªç¥ç»å…ƒåªå¯¹æœ‰é™åŒºåŸŸå†…çš„åˆºæ¿€ä½œå‡ºååº”ï¼Œä¸åŒç¥ç»å…ƒçš„æ„ŸçŸ¥åŒºåŸŸç›¸äº’é‡å ä»è€Œè¦†ç›–æ•´ä¸ªè§†é‡</p>\n<h2 id=\"æ¨¡å‹ç»“æ„-1\"><a href=\"#æ¨¡å‹ç»“æ„-1\" class=\"headerlink\" title=\"æ¨¡å‹ç»“æ„\"></a>æ¨¡å‹ç»“æ„</h2><p>å…¸å‹çš„ CNN ç”±3ä¸ªéƒ¨åˆ†æ„æˆï¼š</p>\n<p>1.å·ç§¯å±‚</p>\n<p>2.æ± åŒ–å±‚</p>\n<p>3.å…¨è¿æ¥å±‚</p>\n<p>å¦‚æœç®€å•æ¥æè¿°çš„è¯ï¼š</p>\n<p>å·ç§¯å±‚è´Ÿè´£æå–å›¾åƒä¸­çš„å±€éƒ¨ç‰¹å¾ï¼›æ± åŒ–å±‚ç”¨æ¥å¤§å¹…é™ä½å‚æ•°é‡çº§(é™ç»´)ï¼›å…¨è¿æ¥å±‚ç±»ä¼¼ä¼ ç»Ÿç¥ç»ç½‘ç»œçš„éƒ¨åˆ†ï¼Œç”¨æ¥è¾“å‡ºæƒ³è¦çš„ç»“æœã€‚</p>\n<h3 id=\"Convolutional-layer\"><a href=\"#Convolutional-layer\" class=\"headerlink\" title=\"Convolutional layer\"></a>Convolutional layer</h3><p>å·ç§¯å±‚çš„è¿ç®—è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼Œç”¨ä¸€ä¸ªå·ç§¯æ ¸æ‰«å®Œæ•´å¼ å›¾ç‰‡ï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/f144f-2019-06-19-juanji.gif?raw=true\" alt=\"è¯·ä½¿ç”¨é­”æ³•\"></p>\n<p>è¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªè¿‡æ»¤å™¨ï¼ˆå·ç§¯æ ¸ï¼‰æ¥è¿‡æ»¤å›¾åƒçš„å„ä¸ªå°åŒºåŸŸï¼Œä»è€Œå¾—åˆ°è¿™äº›å°åŒºåŸŸçš„ç‰¹å¾å€¼ã€‚</p>\n<p>åœ¨å…·ä½“åº”ç”¨ä¸­ï¼Œå¾€å¾€æœ‰å¤šä¸ªå·ç§¯æ ¸ï¼Œå¯ä»¥è®¤ä¸ºï¼Œæ¯ä¸ªå·ç§¯æ ¸ä»£è¡¨äº†ä¸€ç§å›¾åƒæ¨¡å¼ï¼Œå¦‚æœæŸä¸ªå›¾åƒå—ä¸æ­¤å·ç§¯æ ¸å·ç§¯å‡ºçš„å€¼å¤§ï¼Œåˆ™è®¤ä¸ºæ­¤å›¾åƒå—ååˆ†æ¥è¿‘äºæ­¤å·ç§¯æ ¸ã€‚å¦‚æœæˆ‘ä»¬è®¾è®¡äº†6ä¸ªå·ç§¯æ ¸ï¼Œå¯ä»¥ç†è§£ï¼šæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªå›¾åƒä¸Šæœ‰6ç§åº•å±‚çº¹ç†æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç”¨6ä¸­åŸºç¡€æ¨¡å¼å°±èƒ½æç»˜å‡ºä¸€å‰¯å›¾åƒã€‚ä»¥ä¸‹å°±æ˜¯25ç§ä¸åŒçš„å·ç§¯æ ¸çš„ç¤ºä¾‹ï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-14.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"Pooling-Layer\"><a href=\"#Pooling-Layer\" class=\"headerlink\" title=\"Pooling Layer\"></a>Pooling Layer</h3><p>æ± åŒ–å±‚ç®€å•è¯´å°±æ˜¯ä¸‹é‡‡æ ·ï¼Œä»–å¯ä»¥å¤§å¤§é™ä½æ•°æ®çš„ç»´åº¦ã€‚å…¶è¿‡ç¨‹å¦‚ä¸‹ï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/3fd53-2019-06-19-chihua.gif?raw=true\" alt=\"alt text\"><br>ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒåŸå§‹å›¾ç‰‡æ˜¯20Ã—20çš„ï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œä¸‹é‡‡æ ·ï¼Œé‡‡æ ·çª—å£ä¸º10Ã—10ï¼Œæœ€ç»ˆå°†å…¶ä¸‹é‡‡æ ·æˆä¸ºä¸€ä¸ª2Ã—2å¤§å°çš„ç‰¹å¾å›¾ã€‚</p>\n<p>ä¹‹æ‰€ä»¥è¿™ä¹ˆåšçš„åŸå› ï¼Œæ˜¯å› ä¸ºå³ä½¿åšå®Œäº†å·ç§¯ï¼Œå›¾åƒä»ç„¶å¾ˆå¤§ï¼ˆå› ä¸ºå·ç§¯æ ¸æ¯”è¾ƒå°ï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†é™ä½æ•°æ®ç»´åº¦ï¼Œå°±è¿›è¡Œä¸‹é‡‡æ ·ã€‚</p>\n<p>æ± åŒ–å±‚ç›¸æ¯”å·ç§¯å±‚å¯ä»¥æ›´æœ‰æ•ˆçš„é™ä½æ•°æ®ç»´åº¦ï¼Œè¿™ä¹ˆåšä¸ä½†å¯ä»¥å¤§å¤§å‡å°‘è¿ç®—é‡ï¼Œè¿˜å¯ä»¥æœ‰æ•ˆçš„é¿å…è¿‡æ‹Ÿåˆã€‚</p>\n<h3 id=\"Fully-connected-layer\"><a href=\"#Fully-connected-layer\" class=\"headerlink\" title=\"Fully connected layer\"></a>Fully connected layer</h3><p>è¿™ä¸ªéƒ¨åˆ†å°±æ˜¯æœ€åä¸€æ­¥äº†ï¼Œç»è¿‡å·ç§¯å±‚å’Œæ± åŒ–å±‚å¤„ç†è¿‡çš„æ•°æ®è¾“å…¥åˆ°å…¨è¿æ¥å±‚ï¼Œå¾—åˆ°æœ€ç»ˆæƒ³è¦çš„ç»“æœã€‚</p>\n<p>ç»è¿‡å·ç§¯å±‚å’Œæ± åŒ–å±‚é™ç»´è¿‡çš„æ•°æ®ï¼Œå…¨è¿æ¥å±‚æ‰èƒ½â€è·‘å¾—åŠ¨â€ï¼Œä¸ç„¶æ•°æ®é‡å¤ªå¤§ï¼Œè®¡ç®—æˆæœ¬é«˜ï¼Œæ•ˆç‡ä½ä¸‹ã€‚<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/c1a6d-2019-06-19-quanlianjie.png.webp?raw=true\" alt=\"alt text\"><br>å…¸å‹çš„ CNN å¹¶éåªæ˜¯ä¸Šé¢æåˆ°çš„3å±‚ç»“æ„ï¼Œè€Œæ˜¯å¤šå±‚ç»“æ„ï¼Œä¾‹å¦‚ LeNet-5 çš„ç»“æ„å°±å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>\n<p>å·ç§¯å±‚ â€“ æ± åŒ–å±‚- å·ç§¯å±‚ â€“ æ± åŒ–å±‚ â€“ å·ç§¯å±‚ â€“ å…¨è¿æ¥å±‚<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/a8f0b-2019-06-19-lenet.png.webp?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"DIMENSION-OF-THE-CONVOLUTION-OPERATION\"><a href=\"#DIMENSION-OF-THE-CONVOLUTION-OPERATION\" class=\"headerlink\" title=\"DIMENSION OF THE CONVOLUTION OPERATION\"></a>DIMENSION OF THE CONVOLUTION OPERATION</h3><p>é¦–å…ˆè¦ç†è§£çš„æ¦‚å¿µæ˜¯å·ç§¯è¿ç®—çš„ç»´æ•°ã€‚åœ¨æœ¬èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨äºŒç»´å·ç§¯è¿›è¡Œè¯´æ˜ï¼Œä½†æ˜¯æ ¹æ®æ•°æ®çš„æ€§è´¨ï¼Œè¿˜æœ‰æ›´é€‚åˆçš„å…¶ä»–ç»´åº¦çš„å·ç§¯ã€‚åœ¨PyTorchä¸­ï¼Œå·ç§¯å¯ä»¥æ˜¯ä¸€ç»´ã€äºŒç»´æˆ–ä¸‰ç»´çš„ï¼Œåˆ†åˆ«ç”±Conv1dã€Conv2då’ŒConv3dæ¨¡å—å®ç°ã€‚ä¸€ç»´å·ç§¯å¯¹äºæ¯ä¸ªæ—¶é—´æ­¥éƒ½æœ‰ä¸€ä¸ªç‰¹å¾å‘é‡çš„æ—¶é—´åºåˆ—éå¸¸æœ‰ç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—ç»´åº¦ä¸Šå­¦ä¹ æ¨¡å¼ã€‚NLPä¸­çš„å·ç§¯è¿ç®—å¤§å¤šæ˜¯ä¸€ç»´çš„å·ç§¯ã€‚å¦ä¸€æ–¹é¢ï¼ŒäºŒç»´å·ç§¯è¯•å›¾æ•æ‰æ•°æ®ä¸­æ²¿ä¸¤ä¸ªæ–¹å‘çš„æ—¶ç©ºæ¨¡å¼;ä¾‹å¦‚ï¼Œåœ¨å›¾åƒä¸­æ²¿é«˜åº¦å’Œå®½åº¦ç»´åº¦â€”â€”ä¸ºä»€ä¹ˆäºŒç»´å·ç§¯åœ¨å›¾åƒå¤„ç†ä¸­å¾ˆæµè¡Œã€‚ç±»ä¼¼åœ°ï¼Œåœ¨ä¸‰ç»´å·ç§¯ä¸­ï¼Œæ¨¡å¼æ˜¯æ²¿ç€æ•°æ®ä¸­çš„ä¸‰ç»´æ•è·çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨è§†é¢‘æ•°æ®ä¸­ï¼Œä¿¡æ¯æ˜¯ä¸‰ç»´çš„ï¼ŒäºŒç»´è¡¨ç¤ºå›¾åƒçš„å¸§ï¼Œæ—¶é—´ç»´è¡¨ç¤ºå¸§çš„åºåˆ—ã€‚æˆ‘ä»¬ä¸»è¦ä½¿ç”¨Conv1dã€‚</p>\n<h3 id=\"CHANNELS\"><a href=\"#CHANNELS\" class=\"headerlink\" title=\"CHANNELS\"></a>CHANNELS</h3><p>éæ­£å¼åœ°ï¼Œé€šé“(channel)æ˜¯æŒ‡æ²¿è¾“å…¥ä¸­çš„æ¯ä¸ªç‚¹çš„ç‰¹å¾ç»´åº¦ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾åƒä¸­ï¼Œå¯¹åº”äºRGBç»„ä»¶çš„å›¾åƒä¸­çš„æ¯ä¸ªåƒç´ æœ‰ä¸‰ä¸ªé€šé“ã€‚åœ¨ä½¿ç”¨å·ç§¯æ—¶ï¼Œæ–‡æœ¬æ•°æ®ä¹Ÿå¯ä»¥é‡‡ç”¨ç±»ä¼¼çš„æ¦‚å¿µã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œå¦‚æœæ–‡æœ¬æ–‡æ¡£ä¸­çš„â€œåƒç´ â€æ˜¯å•è¯ï¼Œé‚£ä¹ˆé€šé“çš„æ•°é‡å°±æ˜¯è¯æ±‡è¡¨çš„å¤§å°ã€‚å¦‚æœæˆ‘ä»¬æ›´ç»†ç²’åº¦åœ°è€ƒè™‘å­—ç¬¦çš„å·ç§¯ï¼Œé€šé“çš„æ•°é‡å°±æ˜¯å­—ç¬¦é›†çš„å¤§å°(åœ¨æœ¬ä¾‹ä¸­åˆšå¥½æ˜¯è¯æ±‡è¡¨)ã€‚åœ¨PyTorchå·ç§¯å®ç°ä¸­ï¼Œè¾“å…¥é€šé“çš„æ•°é‡æ˜¯in_channelså‚æ•°ã€‚å·ç§¯æ“ä½œå¯ä»¥åœ¨è¾“å‡º(out_channels)ä¸­äº§ç”Ÿå¤šä¸ªé€šé“ã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºå·ç§¯è¿ç®—ç¬¦å°†è¾“å…¥ç‰¹å¾ç»´â€œæ˜ å°„â€åˆ°è¾“å‡ºç‰¹å¾ç»´ã€‚ä¸‹å›¾è¯´æ˜äº†è¿™ä¸ªæ¦‚å¿µã€‚<br><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596033.png\"><br><font color=\"grey\"><center> å·ç§¯è¿ç®—ç”¨ä¸¤ä¸ªè¾“å…¥çŸ©é˜µï¼ˆä¸¤ä¸ªè¾“å…¥é€šé“ï¼‰è¡¨ç¤ºç›¸åº”çš„æ ¸ä¹Ÿæœ‰ä¸¤å±‚ï¼Œå®ƒå°†æ¯å±‚åˆ†åˆ«ç›¸ä¹˜ï¼Œç„¶åå¯¹ç»“æœæ±‚å’Œã€‚å‚æ•°é…ç½®ï¼šinput_channels&#x3D;2, output_channels&#x3D;1, kernel_size&#x3D;2, tride&#x3D;1, padding&#x3D;0, and dilation&#x3D;1.</center></font><br><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596054.png\"><br><font color=\"grey\"><center> ä¸€ç§å…·æœ‰ä¸€ä¸ªè¾“å…¥çŸ©é˜µï¼ˆä¸€ä¸ªè¾“å…¥é€šé“ï¼‰å’Œä¸¤ä¸ªå·ç§¯çš„å·ç§¯è¿ç®—æ ¸ï¼ˆä¸¤ä¸ªè¾“å‡ºé€šé“ï¼‰ã€‚è¿™äº›æ ¸åˆ†åˆ«åº”ç”¨äºè¾“å…¥çŸ©é˜µï¼Œå¹¶å †å åœ¨è¾“å‡ºå¼ é‡ã€‚å‚æ•°é…ç½®ï¼šinput_channels&#x3D;1, output_channels&#x3D;2, kernel_size&#x3D;2, tride&#x3D;1,\tpadding&#x3D;0, and dilation&#x3D;1.</center></font></p>\n<p>å¾ˆéš¾ç«‹å³çŸ¥é“æœ‰å¤šå°‘è¾“å‡ºé€šé“é€‚åˆå½“å‰çš„é—®é¢˜ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªå›°éš¾ï¼Œæˆ‘ä»¬å‡è®¾è¾¹ç•Œæ˜¯1,1,024â€”â€”æˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªåªæœ‰ä¸€ä¸ªé€šé“çš„å·ç§¯å±‚ï¼Œä¹Ÿå¯ä»¥æœ‰ä¸€ä¸ªåªæœ‰1,024ä¸ªé€šé“çš„å·ç§¯å±‚ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†è¾¹ç•Œï¼Œæ¥ä¸‹æ¥è¦è€ƒè™‘çš„æ˜¯æœ‰å¤šå°‘ä¸ªè¾“å…¥é€šé“ã€‚ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼æ˜¯ï¼Œä»ä¸€ä¸ªå·ç§¯å±‚åˆ°ä¸‹ä¸€ä¸ªå·ç§¯å±‚ï¼Œé€šé“æ•°é‡çš„ç¼©å‡ä¸è¶…è¿‡2å€ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªç¡¬æ€§çš„è§„åˆ™ï¼Œä½†æ˜¯å®ƒåº”è¯¥è®©æ‚¨äº†è§£é€‚å½“æ•°é‡çš„out_channelsæ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p>\n<h3 id=\"KERNEL-SIZE\"><a href=\"#KERNEL-SIZE\" class=\"headerlink\" title=\"KERNEL SIZE\"></a>KERNEL SIZE</h3><p>æ ¸çŸ©é˜µçš„å®½åº¦ç§°ä¸ºæ ¸å¤§å°(PyTorchä¸­çš„<code>kernel_size</code>)ã€‚æˆ‘ä»¬åˆ†åˆ«ç»™å‡ºä¸€ä¸ª2x2å’Œ3x3çš„æ ¸ã€‚å·ç§¯å°†è¾“å…¥ä¸­çš„ç©ºé—´(æˆ–æ—¶é—´)æœ¬åœ°ä¿¡æ¯ç»„åˆåœ¨ä¸€èµ·ï¼Œæ¯ä¸ªå·ç§¯çš„æœ¬åœ°ä¿¡æ¯é‡ç”±å†…æ ¸å¤§å°æ§åˆ¶ã€‚ç„¶è€Œï¼Œé€šè¿‡å¢åŠ æ ¸çš„å¤§å°ï¼Œä¹Ÿä¼šå‡å°‘è¾“å‡ºçš„å¤§å°(Dumoulinå’ŒVisin, 2016)ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æ ¸å¤§å°ä¸º3æ—¶ï¼Œè¾“å‡ºçŸ©é˜µ2x2ï¼Œè€Œå½“æ ¸å¤§å°ä¸º2æ—¶ï¼Œè¾“å‡ºçŸ©é˜µ3x3ã€‚</p>\n<p><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596071.png\"><br><font color=\"grey\"><center> å°†kernel_size&#x3D;3çš„å·ç§¯åº”ç”¨äºè¾“å…¥çŸ©é˜µã€‚ç»“æœæ˜¯ä¸€ä¸ªæŠ˜è¡·çš„ç»“æœï¼šåœ¨æ¯æ¬¡å°†å†…æ ¸åº”ç”¨äºçŸ©é˜µæ—¶ï¼Œéƒ½ä¼šä½¿ç”¨æ›´å¤šçš„å±€éƒ¨ä¿¡æ¯ï¼Œä½†è¾“å‡ºçš„å¤§å°ä¼šæ›´å°.</center></font></p>\n<p>æ­¤å¤–ï¼Œå¯ä»¥å°†NLPåº”ç”¨ç¨‹åºä¸­æ ¸å¤§å°çš„è¡Œä¸ºçœ‹ä½œç±»ä¼¼äºé€šè¿‡æŸ¥çœ‹å•è¯ç»„æ•è·è¯­è¨€æ¨¡å¼çš„n-gramçš„è¡Œä¸ºã€‚ä½¿ç”¨è¾ƒå°çš„æ ¸å¤§å°ï¼Œå¯ä»¥æ•è·è¾ƒå°çš„é¢‘ç¹æ¨¡å¼ï¼Œè€Œè¾ƒå¤§çš„æ ¸å¤§å°ä¼šå¯¼è‡´è¾ƒå¤§çš„æ¨¡å¼ï¼Œè¿™å¯èƒ½æ›´æœ‰æ„ä¹‰ï¼Œä½†æ˜¯å‘ç”Ÿçš„é¢‘ç‡æ›´ä½ã€‚è¾ƒå°çš„æ ¸å¤§å°ä¼šå¯¼è‡´è¾“å‡ºä¸­çš„ç»†ç²’åº¦ç‰¹æ€§ï¼Œè€Œè¾ƒå¤§çš„æ ¸å¤§å°ä¼šå¯¼è‡´ç²—ç²’åº¦ç‰¹æ€§ã€‚</p>\n<h3 id=\"STRIDE\"><a href=\"#STRIDE\" class=\"headerlink\" title=\"STRIDE\"></a>STRIDE</h3><p>Strideæ§åˆ¶å·ç§¯ä¹‹é—´çš„æ­¥é•¿ã€‚å¦‚æœæ­¥é•¿ä¸æ ¸ç›¸åŒï¼Œåˆ™å†…æ ¸è®¡ç®—ä¸ä¼šé‡å ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè·¨åº¦ä¸º1ï¼Œåˆ™å†…æ ¸é‡å æœ€å¤§ã€‚è¾“å‡ºå¼ é‡å¯ä»¥é€šè¿‡å¢åŠ æ­¥å¹…çš„æ–¹å¼è¢«æœ‰æ„çš„å‹ç¼©æ¥æ€»ç»“ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>\n<p><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596080.png\"><br><font color=\"grey\"><center> åº”ç”¨äºå…·æœ‰è¶…å‚æ•°æ­¥é•¿çš„è¾“å…¥çš„kernel_size&#x3D;2çš„å·ç§¯æ ¸ç­‰äº2ã€‚è¿™ä¼šå¯¼è‡´å†…æ ¸é‡‡å–æ›´å¤§çš„æ­¥éª¤ï¼Œä»è€Œäº§ç”Ÿæ›´å°çš„è¾“å‡ºçŸ©é˜µã€‚å¯¹äºæ›´ç¨€ç–åœ°å¯¹è¾“å…¥çŸ©é˜µè¿›è¡ŒäºŒæ¬¡é‡‡æ ·éå¸¸æœ‰ç”¨ã€‚</center></font></p>\n<h3 id=\"PADDING\"><a href=\"#PADDING\" class=\"headerlink\" title=\"PADDING\"></a>PADDING</h3><p>å³ä½¿strideå’Œkernel_sizeå…è®¸æ§åˆ¶æ¯ä¸ªè®¡ç®—å‡ºçš„ç‰¹å¾å€¼æœ‰å¤šå¤§èŒƒå›´ï¼Œå®ƒä»¬ä¹Ÿæœ‰ä¸€ä¸ªæœ‰å®³çš„ã€æœ‰æ—¶æ˜¯æ— æ„çš„å‰¯ä½œç”¨ï¼Œé‚£å°±æ˜¯ç¼©å°ç‰¹å¾æ˜ å°„çš„æ€»å¤§å°(å·ç§¯çš„è¾“å‡º)ã€‚ä¸ºäº†æŠµæ¶ˆè¿™ä¸€ç‚¹ï¼Œè¾“å…¥æ•°æ®å¼ é‡è¢«äººä¸ºåœ°å¢åŠ äº†é•¿åº¦(å¦‚æœæ˜¯ä¸€ç»´ã€äºŒç»´æˆ–ä¸‰ç»´)ã€é«˜åº¦(å¦‚æœæ˜¯äºŒç»´æˆ–ä¸‰ç»´)å’Œæ·±åº¦(å¦‚æœæ˜¯ä¸‰ç»´)ï¼Œæ–¹æ³•æ˜¯åœ¨æ¯ä¸ªç»´åº¦ä¸Šé™„åŠ å’Œå‰ç½®0ã€‚è¿™æ„å‘³ç€CNNå°†æ‰§è¡Œæ›´å¤šçš„å·ç§¯ï¼Œä½†æ˜¯è¾“å‡ºå½¢çŠ¶å¯ä»¥æ§åˆ¶ï¼Œè€Œä¸ä¼šå½±å“æ‰€éœ€çš„æ ¸å¤§å°ã€æ­¥å¹…æˆ–æ‰©å±•ã€‚ä¸‹å›¾å±•ç¤ºäº†æ­£åœ¨è¿è¡Œçš„å¡«å……ã€‚</p>\n<p><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596142.png\"><br><font color=\"grey\"><center> åº”ç”¨äºé«˜åº¦å’Œå®½åº¦ç­‰äºçš„è¾“å…¥çŸ©é˜µçš„kernel_size&#x3D;2çš„å·ç§¯2ã€‚ä½†æ˜¯ï¼Œç”±äºå¡«å……ï¼ˆç”¨æ·±ç°è‰²æ­£æ–¹å½¢è¡¨ç¤ºï¼‰ï¼Œè¾“å…¥çŸ©é˜µçš„é«˜åº¦å’Œå®½åº¦å¯ä»¥è¢«æ”¾å¤§ã€‚è¿™é€šå¸¸ä¸å¤§å°ä¸º3çš„å†…æ ¸ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·è¾“å‡ºçŸ©é˜µå°†ç­‰äºè¾“å…¥çŸ©é˜µçš„å¤§å°ã€‚</center></font></p>\n<h3 id=\"DILATION\"><a href=\"#DILATION\" class=\"headerlink\" title=\"DILATION\"></a>DILATION</h3><p>è†¨èƒ€æ§åˆ¶å·ç§¯æ ¸å¦‚ä½•åº”ç”¨äºè¾“å…¥çŸ©é˜µã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬æ˜¾ç¤ºï¼Œå°†è†¨èƒ€ä»1(é»˜è®¤å€¼)å¢åŠ åˆ°2æ„å‘³ç€å½“åº”ç”¨äºè¾“å…¥çŸ©é˜µæ—¶ï¼Œæ ¸çš„å…ƒç´ å½¼æ­¤ä¹‹é—´æ˜¯ä¸¤ä¸ªç©ºæ ¼ã€‚å¦ä¸€ç§è€ƒè™‘è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯åœ¨æ ¸ä¸­è·¨è·ƒâ€”â€”åœ¨æ ¸ä¸­çš„å…ƒç´ æˆ–æ ¸çš„åº”ç”¨ä¹‹é—´å­˜åœ¨ä¸€ä¸ªstep sizeï¼Œå³å­˜åœ¨â€œholesâ€ã€‚è¿™å¯¹äºåœ¨ä¸å¢åŠ å‚æ•°æ•°é‡çš„æƒ…å†µä¸‹æ€»ç»“è¾“å…¥ç©ºé—´çš„æ›´å¤§åŒºåŸŸæ˜¯æœ‰ç”¨çš„ã€‚å½“å·ç§¯å±‚è¢«å åŠ æ—¶ï¼Œæ‰©å¼ å·ç§¯è¢«è¯æ˜æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚è¿ç»­æ‰©å¼ çš„å·ç§¯æŒ‡æ•°çº§åœ°å¢å¤§äº†â€œæ¥å—åŸŸâ€çš„å¤§å°ï¼›å³ç½‘ç»œåœ¨åšå‡ºé¢„æµ‹ä¹‹å‰æ‰€çœ‹åˆ°çš„è¾“å…¥ç©ºé—´çš„å¤§å°ã€‚</p>\n<p><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596131.png\"><br><font color=\"grey\"><center> åº”ç”¨äºè¶…å‚æ•°dilation&#x3D;2çš„è¾“å…¥çŸ©é˜µçš„kernel_size&#x3D;2çš„å·ç§¯ã€‚ä»é»˜è®¤å€¼å¼€å§‹è†¨èƒ€çš„å¢åŠ æ„å‘³ç€æ ¸çŸ©é˜µçš„å…ƒç´ åœ¨ä¸è¾“å…¥çŸ©é˜µç›¸ä¹˜æ—¶è¿›ä¸€æ­¥åˆ†æ•£å¼€æ¥ã€‚è¿›ä¸€æ­¥å¢å¤§æ‰©å¼ ä¼šåŠ å‰§è¿™ç§æ‰©æ•£ã€‚</center></font></p>\n<h1 id=\"åŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„å§“æ°åˆ†ç±»\"><a href=\"#åŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„å§“æ°åˆ†ç±»\" class=\"headerlink\" title=\"åŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„å§“æ°åˆ†ç±»\"></a>åŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„å§“æ°åˆ†ç±»</h1><h2 id=\"Implementing-CNNs-in-PyTorch\"><a href=\"#Implementing-CNNs-in-PyTorch\" class=\"headerlink\" title=\"Implementing CNNs in PyTorch\"></a>Implementing CNNs in PyTorch</h2><p>åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ç«¯åˆ°ç«¯ç¤ºä¾‹æ¥åˆ©ç”¨ä¸Šä¸€èŠ‚ä¸­ä»‹ç»çš„æ¦‚å¿µã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç¥ç»ç½‘ç»œè®¾è®¡çš„ç›®æ ‡æ˜¯æ‰¾åˆ°ä¸€ä¸ªèƒ½å¤Ÿå®Œæˆä»»åŠ¡çš„è¶…å‚æ•°ç»„æ€ã€‚æˆ‘ä»¬å†æ¬¡è€ƒè™‘åœ¨â€œç¤ºä¾‹:å¸¦æœ‰å¤šå±‚æ„ŸçŸ¥å™¨çš„å§“æ°åˆ†ç±»â€ä¸­å¼•å…¥çš„ç°åœ¨å¾ˆç†Ÿæ‚‰çš„å§“æ°åˆ†ç±»ä»»åŠ¡ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä½¿ç”¨CNNsè€Œä¸æ˜¯MLPã€‚æˆ‘ä»¬ä»ç„¶éœ€è¦åº”ç”¨æœ€åä¸€ä¸ªçº¿æ€§å±‚ï¼Œå®ƒå°†å­¦ä¼šä»ä¸€ç³»åˆ—å·ç§¯å±‚åˆ›å»ºçš„ç‰¹å¾å‘é‡åˆ›å»ºé¢„æµ‹å‘é‡ã€‚è¿™æ„å‘³ç€ç›®æ ‡æ˜¯ç¡®å®šå·ç§¯å±‚çš„é…ç½®ï¼Œä»è€Œå¾—åˆ°æ‰€éœ€çš„ç‰¹å¾å‘é‡ã€‚æ‰€æœ‰CNNåº”ç”¨ç¨‹åºéƒ½æ˜¯è¿™æ ·çš„:é¦–å…ˆæœ‰ä¸€ç»„å·ç§¯å±‚ï¼Œå®ƒä»¬æå–ä¸€ä¸ªfeature mapï¼Œç„¶åå°†å…¶ä½œä¸ºä¸Šæ¸¸å¤„ç†çš„è¾“å…¥ã€‚åœ¨åˆ†ç±»ä¸­ï¼Œä¸Šæ¸¸å¤„ç†å‡ ä¹æ€»æ˜¯åº”ç”¨çº¿æ€§(æˆ–fc)å±‚ã€‚</p>\n<p>æœ¬è¯¾ç¨‹ä¸­çš„å®ç°éå†è®¾è®¡å†³ç­–ï¼Œä»¥æ„å»ºä¸€ä¸ªç‰¹å¾å‘é‡ã€‚æˆ‘ä»¬é¦–å…ˆæ„é€ ä¸€ä¸ªäººå·¥æ•°æ®å¼ é‡ï¼Œä»¥åæ˜ å®é™…æ•°æ®çš„å½¢çŠ¶ã€‚æ•°æ®å¼ é‡çš„å¤§å°æ˜¯ä¸‰ç»´çš„â€”â€”è¿™æ˜¯å‘é‡åŒ–æ–‡æœ¬æ•°æ®çš„æœ€å°æ‰¹å¤§å°ã€‚å¦‚æœä½ å¯¹ä¸€ä¸ªå­—ç¬¦åºåˆ—ä¸­çš„æ¯ä¸ªå­—ç¬¦ä½¿ç”¨onehotå‘é‡ï¼Œé‚£ä¹ˆonehotå‘é‡åºåˆ—å°±æ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œè€ŒonehotçŸ©é˜µçš„å°æ‰¹é‡å°±æ˜¯ä¸€ä¸ªä¸‰ç»´å¼ é‡ã€‚ä½¿ç”¨å·ç§¯çš„æœ¯è¯­ï¼Œæ¯ä¸ªonehot(é€šå¸¸æ˜¯è¯æ±‡è¡¨çš„å¤§å°)çš„å¤§å°æ˜¯â€input channelsâ€çš„æ•°é‡ï¼Œå­—ç¬¦åºåˆ—çš„é•¿åº¦æ˜¯â€œwidthâ€ã€‚</p>\n<p>åœ¨ä¾‹4-14ä¸­ï¼Œæ„é€ ç‰¹å¾å‘é‡çš„ç¬¬ä¸€æ­¥æ˜¯å°†PyTorchçš„Conv1dç±»çš„ä¸€ä¸ªå®ä¾‹åº”ç”¨åˆ°ä¸‰ç»´æ•°æ®å¼ é‡ã€‚é€šè¿‡æ£€æŸ¥è¾“å‡ºçš„å¤§å°ï¼Œä½ å¯ä»¥çŸ¥é“å¼ é‡å‡å°‘äº†å¤šå°‘ã€‚</p>\n<p>Example 4-14. Artificial data and using a Conv1d class</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SurnameDataset</span>(<span class=\"title class_ inherited__\">Dataset</span>):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__getitem__</span>(<span class=\"params\">self, index</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;PyTorchæ•°æ®é›†çš„ä¸»è¦å…¥å£æ–¹æ³•</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            index (int): æ•°æ®ç‚¹çš„ç´¢å¼• </span></span><br><span class=\"line\"><span class=\"string\">        è¿”å›:</span></span><br><span class=\"line\"><span class=\"string\">            ä¸€ä¸ªå­—å…¸ï¼Œä¿å­˜æ•°æ®ç‚¹çš„ç‰¹å¾ï¼ˆx_dataï¼‰å’Œæ ‡ç­¾ï¼ˆy_targetï¼‰</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        row = self._target_df.iloc[index]</span><br><span class=\"line\"></span><br><span class=\"line\">        surname_matrix = \\</span><br><span class=\"line\">            self._vectorizer.vectorize(row.surname)</span><br><span class=\"line\"></span><br><span class=\"line\">        nationality_index = \\</span><br><span class=\"line\">            self._vectorizer.nationality_vocab.lookup_token(row.nationality)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;x_surname&#x27;</span>: surname_matrix,</span><br><span class=\"line\">                <span class=\"string\">&#x27;y_nationality&#x27;</span>: nationality_index&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"Vocabulary-Vectorizer-and-DataLoader-1\"><a href=\"#Vocabulary-Vectorizer-and-DataLoader-1\" class=\"headerlink\" title=\"Vocabulary, Vectorizer, and DataLoader\"></a>Vocabulary, Vectorizer, and DataLoader</h2><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œå°½ç®¡è¯æ±‡è¡¨å’ŒDataLoaderçš„å®ç°æ–¹å¼ä¸â€œç¤ºä¾‹:å¸¦æœ‰å¤šå±‚æ„ŸçŸ¥å™¨çš„å§“æ°åˆ†ç±»â€ä¸­çš„ç¤ºä¾‹ç›¸åŒï¼Œä½†Vectorizerçš„vectorize()æ–¹æ³•å·²ç»æ›´æ”¹ï¼Œä»¥é€‚åº”CNNæ¨¡å‹çš„éœ€è¦ã€‚å…·ä½“æ¥è¯´ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ç¤ºä¾‹4-18ä¸­çš„ä»£ç ä¸­æ‰€ç¤ºï¼Œè¯¥å‡½æ•°å°†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦æ˜ å°„åˆ°ä¸€ä¸ªæ•´æ•°ï¼Œç„¶åä½¿ç”¨è¯¥æ•´æ•°æ„é€ ä¸€ä¸ªç”±onehotå‘é‡ç»„æˆçš„çŸ©é˜µã€‚é‡è¦çš„æ˜¯ï¼ŒçŸ©é˜µä¸­çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸åŒçš„onehotå‘é‡ã€‚ä¸»è¦åŸå› æ˜¯ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨çš„Conv1då±‚è¦æ±‚æ•°æ®å¼ é‡åœ¨ç¬¬0ç»´ä¸Šå…·æœ‰æ‰¹å¤„ç†ï¼Œåœ¨ç¬¬1ç»´ä¸Šå…·æœ‰é€šé“ï¼Œåœ¨ç¬¬2ç»´ä¸Šå…·æœ‰ç‰¹æ€§ã€‚</p>\n<p>é™¤äº†æ›´æ”¹ä¸ºä½¿ç”¨onehotçŸ©é˜µä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä¿®æ”¹äº†çŸ¢é‡åŒ–å™¨ï¼Œä»¥ä¾¿è®¡ç®—å§“æ°çš„æœ€å¤§é•¿åº¦å¹¶å°†å…¶ä¿å­˜ä¸ºmax_surname_length</p>\n<p>Example 4-18. Implementing the Surname Vectorizer for CNNs</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SurnameVectorizer</span>(<span class=\"title class_ inherited__\">object</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;åè°ƒè¯æ±‡è¡¨å¹¶å°†å®ƒä»¬åº”ç”¨åˆ°ä½¿ç”¨çš„å‘é‡åŒ–å™¨&quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, surname_vocab, nationality_vocab, max_surname_length</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            surname_vocab (Vocabulary): å°†å­—ç¬¦æ˜ å°„åˆ°æ•´æ•°çš„è¯æ±‡è¡¨</span></span><br><span class=\"line\"><span class=\"string\">            nationality_vocab (Vocabulary): å°†å›½ç±æ˜ å°„åˆ°æ•´æ•°çš„è¯æ±‡è¡¨</span></span><br><span class=\"line\"><span class=\"string\">            max_surname_length (int): æœ€é•¿å§“æ°çš„é•¿åº¦</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        self.surname_vocab = surname_vocab</span><br><span class=\"line\">        self.nationality_vocab = nationality_vocab</span><br><span class=\"line\">        self._max_surname_length = max_surname_length</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">vectorize</span>(<span class=\"params\">self, surname</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            surname (str): å§“æ°</span></span><br><span class=\"line\"><span class=\"string\">        è¿”å›:</span></span><br><span class=\"line\"><span class=\"string\">            one_hot_matrix (np.ndarray): ä¸€ä¸ªone-hotå‘é‡çš„çŸ©é˜µ</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        one_hot_matrix_size = (<span class=\"built_in\">len</span>(self.surname_vocab), self._max_surname_length)</span><br><span class=\"line\">        one_hot_matrix = np.zeros(one_hot_matrix_size, dtype=np.float32)</span><br><span class=\"line\">                               </span><br><span class=\"line\">        <span class=\"keyword\">for</span> position_index, character <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(surname):</span><br><span class=\"line\">            character_index = self.surname_vocab.lookup_token(character)</span><br><span class=\"line\">            one_hot_matrix[character_index][position_index] = <span class=\"number\">1</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> one_hot_matrix</span><br></pre></td></tr></table></figure>\n<h2 id=\"Reimplementing-the-SurnameClassifier-with-Convolutional-Networks\"><a href=\"#Reimplementing-the-SurnameClassifier-with-Convolutional-Networks\" class=\"headerlink\" title=\"Reimplementing the SurnameClassifier with Convolutional Networks\"></a>Reimplementing the SurnameClassifier with Convolutional Networks</h2><p>æˆ‘ä»¬åœ¨æœ¬ä¾‹ä¸­ä½¿ç”¨çš„æ¨¡å‹æ˜¯ä½¿ç”¨æˆ‘ä»¬åœ¨â€œå·ç§¯ç¥ç»ç½‘ç»œâ€ä¸­ä»‹ç»çš„æ–¹æ³•æ„å»ºçš„ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨è¯¥éƒ¨åˆ†ä¸­åˆ›å»ºçš„ç”¨äºæµ‹è¯•å·ç§¯å±‚çš„â€œäººå·¥â€æ•°æ®ä¸å§“æ°æ•°æ®é›†ä¸­ä½¿ç”¨æœ¬ä¾‹ä¸­çš„çŸ¢é‡åŒ–å™¨çš„æ•°æ®å¼ é‡çš„å¤§å°å®Œå…¨åŒ¹é…ã€‚æ­£å¦‚åœ¨ç¤ºä¾‹4-19ä¸­æ‰€çœ‹åˆ°çš„ï¼Œå®ƒä¸æˆ‘ä»¬åœ¨â€œå·ç§¯ç¥ç»ç½‘ç»œâ€ä¸­å¼•å…¥çš„Conv1dåºåˆ—æ—¢æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä¹Ÿæœ‰éœ€è¦è§£é‡Šçš„æ–°æ·»åŠ å†…å®¹ã€‚å…·ä½“æ¥è¯´ï¼Œè¯¥æ¨¡å‹ç±»ä¼¼äºâ€œå·ç§¯ç¥ç»ç½‘ç»œâ€ï¼Œå®ƒä½¿ç”¨ä¸€ç³»åˆ—ä¸€ç»´å·ç§¯æ¥å¢é‡åœ°è®¡ç®—æ›´å¤šçš„ç‰¹å¾ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªå•ç‰¹å¾å‘é‡ã€‚</p>\n<p>ç„¶è€Œï¼Œæœ¬ä¾‹ä¸­çš„æ–°å†…å®¹æ˜¯ä½¿ç”¨sequenceå’ŒELU PyTorchæ¨¡å—ã€‚åºåˆ—æ¨¡å—æ˜¯å°è£…çº¿æ€§æ“ä½œåºåˆ—çš„æ–¹ä¾¿åŒ…è£…å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥å°è£…Conv1dåºåˆ—çš„åº”ç”¨ç¨‹åºã€‚ELUæ˜¯ç±»ä¼¼äºå®éªŒ3ä¸­ä»‹ç»çš„ReLUçš„éçº¿æ€§å‡½æ•°ï¼Œä½†æ˜¯å®ƒä¸æ˜¯å°†å€¼è£å‰ªåˆ°0ä»¥ä¸‹ï¼Œè€Œæ˜¯å¯¹å®ƒä»¬æ±‚å¹‚ã€‚ELUå·²ç»è¢«è¯æ˜æ˜¯å·ç§¯å±‚ä¹‹é—´ä½¿ç”¨çš„ä¸€ç§å¾ˆæœ‰å‰é€”çš„éçº¿æ€§(Clevert et al.ï¼Œ 2015)ã€‚</p>\n<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå·ç§¯çš„é€šé“æ•°ä¸num_channelsè¶…å‚æ•°ç»‘å®šã€‚æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä¸åŒæ•°é‡çš„é€šé“åˆ†åˆ«è¿›è¡Œå·ç§¯è¿ç®—ã€‚è¿™æ ·åšéœ€è¦ä¼˜åŒ–æ›´å¤šçš„è¶…å‚æ•°ã€‚æˆ‘ä»¬å‘ç°256è¶³å¤Ÿå¤§ï¼Œå¯ä»¥ä½¿æ¨¡å‹è¾¾åˆ°åˆç†çš„æ€§èƒ½ã€‚</p>\n<p>Example 4-19. The CNN-based SurnameClassifier</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> torch.nn <span class=\"keyword\">as</span> nn</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.nn.functional <span class=\"keyword\">as</span> F</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SurnameClassifier</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, initial_num_channels, num_classes, num_channels</span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">        åˆ›å»ºä¸€ä¸ªå§“æ°åˆ†ç±»å™¨ã€‚</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            initial_num_channels (int): è¾“å…¥ç‰¹å¾å‘é‡çš„å¤§å°</span></span><br><span class=\"line\"><span class=\"string\">            num_classes (int): è¾“å‡ºé¢„æµ‹å‘é‡çš„å¤§å°</span></span><br><span class=\"line\"><span class=\"string\">            num_channels (int): ç½‘ç»œä¸­è¦å§‹ç»ˆä½¿ç”¨çš„æ’å®šé€šé“å¤§å°</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"built_in\">super</span>(SurnameClassifier, self).__init__()</span><br><span class=\"line\">        </span><br><span class=\"line\">        self.convnet = nn.Sequential(</span><br><span class=\"line\">            nn.Conv1d(in_channels=initial_num_channels, </span><br><span class=\"line\">                      out_channels=num_channels, kernel_size=<span class=\"number\">3</span>),</span><br><span class=\"line\">            nn.ELU(),</span><br><span class=\"line\">            nn.Conv1d(in_channels=num_channels, out_channels=num_channels, </span><br><span class=\"line\">                      kernel_size=<span class=\"number\">3</span>, stride=<span class=\"number\">2</span>),</span><br><span class=\"line\">            nn.ELU(),</span><br><span class=\"line\">            nn.Conv1d(in_channels=num_channels, out_channels=num_channels, </span><br><span class=\"line\">                      kernel_size=<span class=\"number\">3</span>, stride=<span class=\"number\">2</span>),</span><br><span class=\"line\">            nn.ELU(),</span><br><span class=\"line\">            nn.Conv1d(in_channels=num_channels, out_channels=num_channels, </span><br><span class=\"line\">                      kernel_size=<span class=\"number\">3</span>),</span><br><span class=\"line\">            nn.ELU()</span><br><span class=\"line\">        )</span><br><span class=\"line\">        self.fc = nn.Linear(num_channels, num_classes)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, x_surname, apply_softmax=<span class=\"literal\">False</span></span>):</span><br><span class=\"line\">        <span class=\"string\">&quot;&quot;&quot;åˆ†ç±»å™¨çš„å‰å‘ä¼ æ’­</span></span><br><span class=\"line\"><span class=\"string\">        </span></span><br><span class=\"line\"><span class=\"string\">        å‚æ•°:</span></span><br><span class=\"line\"><span class=\"string\">            x_surname (torch.Tensor): è¾“å…¥æ•°æ®å¼ é‡ã€‚</span></span><br><span class=\"line\"><span class=\"string\">                x_surname.shape åº”ä¸º (batch, initial_num_channels, max_surname_length)</span></span><br><span class=\"line\"><span class=\"string\">            apply_softmax (bool): softmax æ¿€æ´»çš„æ ‡å¿—</span></span><br><span class=\"line\"><span class=\"string\">                å¦‚æœä¸äº¤å‰ç†µæŸå¤±ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™åº”ä¸º False</span></span><br><span class=\"line\"><span class=\"string\">        è¿”å›:</span></span><br><span class=\"line\"><span class=\"string\">            ç»“æœå¼ é‡ã€‚tensor.shape åº”ä¸º (batch, num_classes)</span></span><br><span class=\"line\"><span class=\"string\">        &quot;&quot;&quot;</span></span><br><span class=\"line\">        features = self.convnet(x_surname).squeeze(dim=<span class=\"number\">2</span>)</span><br><span class=\"line\">       </span><br><span class=\"line\">        prediction_vector = self.fc(features)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> apply_softmax:</span><br><span class=\"line\">            prediction_vector = F.softmax(prediction_vector, dim=<span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> prediction_vector</span><br></pre></td></tr></table></figure>\n<h2 id=\"The-Training-Routine-1\"><a href=\"#The-Training-Routine-1\" class=\"headerlink\" title=\"The Training Routine\"></a>The Training Routine</h2><p>è®­ç»ƒç¨‹åºåŒ…æ‹¬ä»¥ä¸‹ä¼¼æ›¾ç›¸è¯†çš„çš„æ“ä½œåºåˆ—:å®ä¾‹åŒ–æ•°æ®é›†,å®ä¾‹åŒ–æ¨¡å‹,å®ä¾‹åŒ–æŸå¤±å‡½æ•°,å®ä¾‹åŒ–ä¼˜åŒ–å™¨,éå†æ•°æ®é›†çš„è®­ç»ƒåˆ†åŒºå’Œæ›´æ–°æ¨¡å‹å‚æ•°,éå†æ•°æ®é›†çš„éªŒè¯åˆ†åŒºå’Œæµ‹é‡æ€§èƒ½,ç„¶åé‡å¤æ•°æ®é›†è¿­ä»£ä¸€å®šæ¬¡æ•°ã€‚æ­¤æ—¶ï¼Œè¿™æ˜¯æœ¬ä¹¦åˆ°ç›®å‰ä¸ºæ­¢çš„ç¬¬ä¸‰ä¸ªè®­ç»ƒä¾‹ç¨‹å®ç°ï¼Œåº”è¯¥å°†è¿™ä¸ªæ“ä½œåºåˆ—å†…éƒ¨åŒ–ã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å°†ä¸å†è¯¦ç»†æè¿°å…·ä½“çš„è®­ç»ƒä¾‹ç¨‹ï¼Œå› ä¸ºå®ƒä¸â€œç¤ºä¾‹:å¸¦æœ‰å¤šå±‚æ„ŸçŸ¥å™¨çš„å§“æ°åˆ†ç±»â€ä¸­çš„ä¾‹ç¨‹å®Œå…¨ç›¸åŒã€‚ä½†æ˜¯ï¼Œè¾“å…¥å‚æ•°æ˜¯ä¸åŒçš„ï¼Œå¯ä»¥åœ¨ç¤ºä¾‹4-20ä¸­çœ‹åˆ°ã€‚</p>\n<p>Example 4-20. Input arguments to the CNN surname classifier</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">args = Namespace(</span><br><span class=\"line\">    <span class=\"comment\"># æ•°æ®å’Œè·¯å¾„ä¿¡æ¯</span></span><br><span class=\"line\">    surname_csv=<span class=\"string\">&quot;data/surnames/surnames_with_splits.csv&quot;</span>,</span><br><span class=\"line\">    vectorizer_file=<span class=\"string\">&quot;vectorizer.json&quot;</span>,</span><br><span class=\"line\">    model_state_file=<span class=\"string\">&quot;model.pth&quot;</span>,</span><br><span class=\"line\">    save_dir=<span class=\"string\">&quot;model_storage/ch4/cnn&quot;</span>,</span><br><span class=\"line\">    <span class=\"comment\"># æ¨¡å‹è¶…å‚æ•°</span></span><br><span class=\"line\">    hidden_dim=<span class=\"number\">100</span>,</span><br><span class=\"line\">    num_channels=<span class=\"number\">256</span>,</span><br><span class=\"line\">    <span class=\"comment\"># è®­ç»ƒè¶…å‚æ•°</span></span><br><span class=\"line\">    seed=<span class=\"number\">1337</span>,</span><br><span class=\"line\">    learning_rate=<span class=\"number\">0.001</span>,</span><br><span class=\"line\">    batch_size=<span class=\"number\">128</span>,</span><br><span class=\"line\">    num_epochs=<span class=\"number\">100</span>,</span><br><span class=\"line\">    early_stopping_criteria=<span class=\"number\">5</span>,</span><br><span class=\"line\">    dropout_p=<span class=\"number\">0.1</span>,</span><br><span class=\"line\">    <span class=\"comment\"># è¿è¡Œæ—¶é€‰é¡¹</span></span><br><span class=\"line\">    cuda=<span class=\"literal\">False</span>,</span><br><span class=\"line\">    reload_from_files=<span class=\"literal\">False</span>,</span><br><span class=\"line\">    expand_filepaths_to_save_dir=<span class=\"literal\">True</span>,</span><br><span class=\"line\">    catch_keyboard_interrupt=<span class=\"literal\">True</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<h2 id=\"Model-Evaluation-and-Prediction-1\"><a href=\"#Model-Evaluation-and-Prediction-1\" class=\"headerlink\" title=\"Model Evaluation and Prediction\"></a>Model Evaluation and Prediction</h2><p>è¦ç†è§£æ¨¡å‹çš„æ€§èƒ½ï¼Œéœ€è¦å¯¹æ€§èƒ½è¿›è¡Œå®šé‡å’Œå®šæ€§çš„åº¦é‡ã€‚ä¸‹é¢å°†æè¿°è¿™ä¸¤ä¸ªåº¦é‡çš„åŸºæœ¬ç»„ä»¶ã€‚</p>\n<h3 id=\"Evaluating-on-the-Test-Dataset\"><a href=\"#Evaluating-on-the-Test-Dataset\" class=\"headerlink\" title=\"Evaluating on the Test Dataset\"></a>Evaluating on the Test Dataset</h3><p>æ­£å¦‚â€œç¤ºä¾‹:å¸¦æœ‰å¤šå±‚æ„ŸçŸ¥å™¨çš„å§“æ°åˆ†ç±»â€ä¸­çš„ç¤ºä¾‹ä¸æœ¬ç¤ºä¾‹ä¹‹é—´çš„è®­ç»ƒä¾‹ç¨‹æ²¡æœ‰å˜åŒ–ä¸€æ ·ï¼Œæ‰§è¡Œè¯„ä¼°çš„ä»£ç ä¹Ÿæ²¡æœ‰å˜åŒ–ã€‚æ€»ä¹‹ï¼Œè°ƒç”¨åˆ†ç±»å™¨çš„<code>eval()</code>æ–¹æ³•æ¥é˜²æ­¢åå‘ä¼ æ’­ï¼Œå¹¶è¿­ä»£æµ‹è¯•æ•°æ®é›†ã€‚ä¸ MLP çº¦ 50% çš„æ€§èƒ½ç›¸æ¯”ï¼Œè¯¥æ¨¡å‹çš„æµ‹è¯•é›†æ€§èƒ½å‡†ç¡®ç‡çº¦ä¸º56%ã€‚å°½ç®¡è¿™äº›æ€§èƒ½æ•°å­—ç»ä¸æ˜¯è¿™äº›ç‰¹å®šæ¶æ„çš„ä¸Šé™ï¼Œä½†æ˜¯é€šè¿‡ä¸€ä¸ªç›¸å¯¹ç®€å•çš„CNNæ¨¡å‹è·å¾—çš„æ”¹è¿›åº”è¯¥è¶³ä»¥è®©æ‚¨åœ¨æ–‡æœ¬æ•°æ®ä¸Šå°è¯•CNNsã€‚</p>\n<h3 id=\"Classifying-or-retrieving-top-predictions-for-a-new-surname\"><a href=\"#Classifying-or-retrieving-top-predictions-for-a-new-surname\" class=\"headerlink\" title=\"Classifying or retrieving top predictions for a new surname\"></a>Classifying or retrieving top predictions for a new surname</h3><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>predict_nationality()</code>å‡½æ•°çš„ä¸€éƒ¨åˆ†å‘ç”Ÿäº†æ›´æ”¹ï¼Œå¦‚ä¾‹4-21:æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨è§†å›¾æ–¹æ³•é‡å¡‘æ–°åˆ›å»ºçš„æ•°æ®å¼ é‡ä»¥æ·»åŠ æ‰¹å¤„ç†ç»´åº¦ï¼Œè€Œæ˜¯ä½¿ç”¨PyTorchçš„<code>unsqueeze()</code>å‡½æ•°åœ¨æ‰¹å¤„ç†åº”è¯¥åœ¨çš„ä½ç½®æ·»åŠ å¤§å°ä¸º1çš„ç»´åº¦ã€‚ç›¸åŒçš„æ›´æ”¹åæ˜ åœ¨<code>predict_topk_nationality()</code>å‡½æ•°ä¸­ã€‚</p>\n<p>Example 4-21. Using the trained model to make predictions</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">predict_nationality</span>(<span class=\"params\">surname, classifier, vectorizer</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;é¢„æµ‹å§“æ°çš„å›½ç±</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        surname (str): è¦åˆ†ç±»çš„å§“æ°</span></span><br><span class=\"line\"><span class=\"string\">        classifier (SurnameClassifer): åˆ†ç±»å™¨çš„å®ä¾‹</span></span><br><span class=\"line\"><span class=\"string\">        vectorizer (SurnameVectorizer): ç›¸åº”çš„å‘é‡åŒ–å™¨</span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">        dict: åŒ…å«æœ€å¯èƒ½çš„å›½ç±åŠå…¶æ¦‚ç‡çš„å­—å…¸</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># å‘é‡åŒ–å§“æ°</span></span><br><span class=\"line\">    vectorized_surname = vectorizer.vectorize(surname)</span><br><span class=\"line\">    <span class=\"comment\"># å°†å‘é‡åŒ–çš„å§“æ°è½¬æ¢ä¸ºPyTorchå¼ é‡ï¼Œå¹¶æ·»åŠ æ‰¹æ¬¡ç»´åº¦</span></span><br><span class=\"line\">    vectorized_surname = torch.tensor(vectorized_surname).unsqueeze(<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"comment\"># ä½¿ç”¨åˆ†ç±»å™¨è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å¯¹è¾“å‡ºè¿›è¡Œsoftmaxå¤„ç†</span></span><br><span class=\"line\">    result = classifier(vectorized_surname, apply_softmax=<span class=\"literal\">True</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># è·å–æ¦‚ç‡æœ€é«˜çš„å›½ç±åŠå…¶å¯¹åº”çš„ç´¢å¼•</span></span><br><span class=\"line\">    probability_values, indices = result.<span class=\"built_in\">max</span>(dim=<span class=\"number\">1</span>)</span><br><span class=\"line\">    index = indices.item()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># é€šè¿‡ç´¢å¼•æŸ¥æ‰¾é¢„æµ‹çš„å›½ç±ï¼Œå¹¶è·å–å…¶æ¦‚ç‡å€¼</span></span><br><span class=\"line\">    predicted_nationality = vectorizer.nationality_vocab.lookup_index(index)</span><br><span class=\"line\">    probability_value = probability_values.item()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># è¿”å›é¢„æµ‹ç»“æœçš„å­—å…¸</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> &#123;<span class=\"string\">&#x27;nationality&#x27;</span>: predicted_nationality, <span class=\"string\">&#x27;probability&#x27;</span>: probability_value&#125;</span><br></pre></td></tr></table></figure>\n<p>ç¤ºä¾‹ï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-17.png?raw=true\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">predict_topk_nationality</span>(<span class=\"params\">surname, classifier, vectorizer, k=<span class=\"number\">5</span></span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;é¢„æµ‹å§“æ°çš„å‰Kä¸ªå¯èƒ½çš„å›½ç±</span></span><br><span class=\"line\"><span class=\"string\">    </span></span><br><span class=\"line\"><span class=\"string\">    Args:</span></span><br><span class=\"line\"><span class=\"string\">        surname (str): è¦åˆ†ç±»çš„å§“æ°</span></span><br><span class=\"line\"><span class=\"string\">        classifier (SurnameClassifer): åˆ†ç±»å™¨çš„å®ä¾‹</span></span><br><span class=\"line\"><span class=\"string\">        vectorizer (SurnameVectorizer): ç›¸åº”çš„å‘é‡åŒ–å™¨</span></span><br><span class=\"line\"><span class=\"string\">        k (int): è¦è¿”å›çš„å‰Kä¸ªå›½ç±æ•°é‡</span></span><br><span class=\"line\"><span class=\"string\">    Returns:</span></span><br><span class=\"line\"><span class=\"string\">        list: å­—å…¸çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå­—å…¸åŒ…å«ä¸€ä¸ªå›½ç±å’Œå…¶å¯¹åº”çš„æ¦‚ç‡</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    <span class=\"comment\"># å‘é‡åŒ–å§“æ°</span></span><br><span class=\"line\">    vectorized_surname = vectorizer.vectorize(surname)</span><br><span class=\"line\">    vectorized_surname = torch.tensor(vectorized_surname).unsqueeze(dim=<span class=\"number\">0</span>)</span><br><span class=\"line\">    <span class=\"comment\"># ä½¿ç”¨åˆ†ç±»å™¨è¿›è¡Œé¢„æµ‹ï¼Œå¹¶å¯¹è¾“å‡ºè¿›è¡Œsoftmaxå¤„ç†ï¼Œè·å–å‰Kä¸ªå›½ç±åŠå…¶æ¦‚ç‡</span></span><br><span class=\"line\">    prediction_vector = classifier(vectorized_surname, apply_softmax=<span class=\"literal\">True</span>)</span><br><span class=\"line\">    probability_values, indices = torch.topk(prediction_vector, k=k)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># è·å–é¢„æµ‹ç»“æœä¸­æ¦‚ç‡æœ€é«˜çš„Kä¸ªå›½ç±åŠå…¶æ¦‚ç‡å€¼</span></span><br><span class=\"line\">    probability_values = probability_values[<span class=\"number\">0</span>].detach().numpy()</span><br><span class=\"line\">    indices = indices[<span class=\"number\">0</span>].detach().numpy()</span><br><span class=\"line\">    </span><br><span class=\"line\">    results = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> kth_index <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k):</span><br><span class=\"line\">        <span class=\"comment\"># é€šè¿‡ç´¢å¼•æŸ¥æ‰¾å›½ç±ï¼Œå¹¶è·å–å…¶å¯¹åº”çš„æ¦‚ç‡å€¼ï¼Œå°†ç»“æœå­˜å‚¨ä¸ºå­—å…¸åˆ—è¡¨</span></span><br><span class=\"line\">        nationality = vectorizer.nationality_vocab.lookup_index(indices[kth_index])</span><br><span class=\"line\">        probability_value = probability_values[kth_index]</span><br><span class=\"line\">        results.append(&#123;<span class=\"string\">&#x27;nationality&#x27;</span>: nationality, </span><br><span class=\"line\">                        <span class=\"string\">&#x27;probability&#x27;</span>: probability_value&#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> results</span><br><span class=\"line\"></span><br><span class=\"line\">new_surname = <span class=\"built_in\">input</span>(<span class=\"string\">&quot;Enter a surname to classify: &quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">k = <span class=\"built_in\">int</span>(<span class=\"built_in\">input</span>(<span class=\"string\">&quot;How many of the top predictions to see? &quot;</span>))</span><br><span class=\"line\"><span class=\"keyword\">if</span> k &gt; <span class=\"built_in\">len</span>(vectorizer.nationality_vocab):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Sorry! That&#x27;s more than the # of nationalities we have.. defaulting you to max size :)&quot;</span>)</span><br><span class=\"line\">    k = <span class=\"built_in\">len</span>(vectorizer.nationality_vocab)</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># è°ƒç”¨å‡½æ•°è¿›è¡Œé¢„æµ‹å¹¶æ‰“å°ç»“æœ</span></span><br><span class=\"line\">predictions = predict_topk_nationality(new_surname, classifier, vectorizer, k=k)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;Top &#123;&#125; predictions:&quot;</span>.<span class=\"built_in\">format</span>(k))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;===================&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> prediction <span class=\"keyword\">in</span> predictions:</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;&#123;&#125; -&gt; &#123;&#125; (p=&#123;:0.2f&#125;)&quot;</span>.<span class=\"built_in\">format</span>(new_surname,</span><br><span class=\"line\">                                        prediction[<span class=\"string\">&#x27;nationality&#x27;</span>],</span><br><span class=\"line\">                                        prediction[<span class=\"string\">&#x27;probability&#x27;</span>]))</span><br></pre></td></tr></table></figure>\n<p>ç¤ºä¾‹ï¼š<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/image-18.png?raw=true\"></p>\n<h2 id=\"Miscellaneous-Topics-in-CNNs\"><a href=\"#Miscellaneous-Topics-in-CNNs\" class=\"headerlink\" title=\"Miscellaneous Topics in CNNs\"></a>Miscellaneous Topics in CNNs</h2><p>ä¸ºäº†ç»“æŸæˆ‘ä»¬çš„è®¨è®ºï¼Œæˆ‘ä»¬æ¦‚è¿°äº†å‡ ä¸ªå…¶ä»–çš„ä¸»é¢˜ï¼Œè¿™äº›ä¸»é¢˜æ˜¯CNNsçš„æ ¸å¿ƒï¼Œä½†åœ¨å®ƒä»¬çš„å…±åŒä½¿ç”¨ä¸­èµ·ç€ä¸»è¦ä½œç”¨ã€‚ç‰¹åˆ«æ˜¯ï¼Œä½ å°†çœ‹åˆ°Poolingæ“ä½œã€batch Normalizationã€network-in-network connectionå’Œresidual connectionsçš„æè¿°ã€‚</p>\n<h3 id=\"Pooling-Operation\"><a href=\"#Pooling-Operation\" class=\"headerlink\" title=\"Pooling Operation\"></a>Pooling Operation</h3><p>Poolingæ˜¯å°†é«˜ç»´ç‰¹å¾æ˜ å°„æ€»ç»“ä¸ºä½ç»´ç‰¹å¾æ˜ å°„çš„æ“ä½œã€‚å·ç§¯çš„è¾“å‡ºæ˜¯ä¸€ä¸ªç‰¹å¾æ˜ å°„ã€‚feature mapä¸­çš„å€¼æ€»ç»“äº†è¾“å…¥çš„ä¸€äº›åŒºåŸŸã€‚ç”±äºå·ç§¯è®¡ç®—çš„é‡å æ€§ï¼Œè®¸å¤šè®¡ç®—å‡ºçš„ç‰¹å¾å¯èƒ½æ˜¯å†—ä½™çš„ã€‚Poolingæ˜¯ä¸€ç§å°†é«˜ç»´(å¯èƒ½æ˜¯å†—ä½™çš„)ç‰¹å¾æ˜ å°„æ€»ç»“ä¸ºä½ç»´ç‰¹å¾æ˜ å°„çš„æ–¹æ³•ã€‚åœ¨å½¢å¼ä¸Šï¼Œæ± æ˜¯ä¸€ç§åƒsumã€meanæˆ–maxè¿™æ ·çš„ç®—æœ¯è¿ç®—ç¬¦ï¼Œç³»ç»Ÿåœ°åº”ç”¨äºfeature mapä¸­çš„å±€éƒ¨åŒºåŸŸï¼Œå¾—åˆ°çš„æ± æ“ä½œåˆ†åˆ«ç§°ä¸ºsum poolingã€average poolingå’Œmax poolingã€‚æ± è¿˜å¯ä»¥ä½œä¸ºä¸€ç§æ–¹æ³•ï¼Œå°†è¾ƒå¤§ä½†è¾ƒå¼±çš„feature mapçš„ç»Ÿè®¡å¼ºåº¦æ”¹è¿›ä¸ºè¾ƒå°ä½†è¾ƒå¼ºçš„feature mapã€‚ä¸‹å›¾è¯´æ˜äº†Poolingã€‚</p>\n<p><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596120.png\"><br><font color=\"grey\"><center> è¿™é‡Œæ‰€ç¤ºçš„æ± æ“ä½œåœ¨åŠŸèƒ½ä¸Šä¸å·ç§¯ç›¸åŒï¼šå®ƒåº”ç”¨äºè¾“å…¥çŸ©é˜µä¸­çš„ä¸åŒä½ç½®ã€‚ç„¶è€Œï¼Œæ± æ“ä½œä¸æ˜¯å°†è¾“å…¥çŸ©é˜µçš„å€¼ç›¸ä¹˜å’Œæ±‚å’Œï¼Œè€Œæ˜¯åº”ç”¨ä¸€äº›å‡½æ•°Gæ¥æ±‡é›†è¿™äº›å€¼ã€‚Gå¯ä»¥æ˜¯ä»»ä½•è¿ç®—ï¼Œä½†æ±‚å’Œã€æ±‚æœ€å¤§å€¼å’Œè®¡ç®—å¹³å‡å€¼æ˜¯æœ€å¸¸è§çš„ã€‚</center></font></p>\n<h3 id=\"Batch-Normalization-BatchNorm\"><a href=\"#Batch-Normalization-BatchNorm\" class=\"headerlink\" title=\"Batch Normalization (BatchNorm)\"></a>Batch Normalization (BatchNorm)</h3><p>æ‰¹å¤„ç†æ ‡å‡†åŒ–æ˜¯è®¾è®¡ç½‘ç»œæ—¶ç»å¸¸ä½¿ç”¨çš„ä¸€ç§å·¥å…·ã€‚BatchNormå¯¹CNNçš„è¾“å‡ºè¿›è¡Œè½¬æ¢ï¼Œæ–¹æ³•æ˜¯å°†æ¿€æ´»é‡ç¼©æ”¾ä¸ºé›¶å‡å€¼å’Œå•ä½æ–¹å·®ã€‚å®ƒç”¨äºZ-transformçš„å¹³å‡å€¼å’Œæ–¹å·®å€¼æ¯æ‰¹æ›´æ–°ä¸€æ¬¡ï¼Œè¿™æ ·ä»»ä½•å•ä¸ªæ‰¹ä¸­çš„æ³¢åŠ¨éƒ½ä¸ä¼šå¤ªå¤§åœ°ç§»åŠ¨æˆ–å½±å“å®ƒã€‚BatchNormå…è®¸æ¨¡å‹å¯¹å‚æ•°çš„åˆå§‹åŒ–ä¸é‚£ä¹ˆæ•æ„Ÿï¼Œå¹¶ä¸”ç®€åŒ–äº†å­¦ä¹ é€Ÿç‡çš„è°ƒæ•´(Ioffe and Szegedy, 2015)ã€‚åœ¨PyTorchä¸­ï¼Œæ‰¹å¤„ç†è§„èŒƒæ˜¯åœ¨nnæ¨¡å—ä¸­å®šä¹‰çš„ã€‚ä¾‹4-22å±•ç¤ºäº†å¦‚ä½•ç”¨å·ç§¯å’Œçº¿æ€§å±‚å®ä¾‹åŒ–å’Œä½¿ç”¨æ‰¹å¤„ç†è§„èŒƒã€‚</p>\n<p>Example 4-22. Using s Conv1D layer with batch normalization.</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">    self.conv1 = nn.Conv1d(in_channels=<span class=\"number\">1</span>, out_channels=<span class=\"number\">10</span>,</span><br><span class=\"line\">                           kernel_size=<span class=\"number\">5</span>,</span><br><span class=\"line\">                           stride=<span class=\"number\">1</span>)</span><br><span class=\"line\">    self.conv1_bn = nn.BatchNorm1d(num_features=<span class=\"number\">10</span>)</span><br><span class=\"line\">    <span class=\"comment\"># ...</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, x</span>):</span><br><span class=\"line\">   <span class=\"comment\"># ...</span></span><br><span class=\"line\">   x = F.relu(self.conv1(x))</span><br><span class=\"line\">   x = self.conv1_bn(x)</span><br></pre></td></tr></table></figure>\n<h3 id=\"Network-in-Network-Connections-1x1-Convolutions\"><a href=\"#Network-in-Network-Connections-1x1-Convolutions\" class=\"headerlink\" title=\"Network-in-Network Connections (1x1 Convolutions)\"></a>Network-in-Network Connections (1x1 Convolutions)</h3><p>Network-in-Network (NiN)è¿æ¥æ˜¯å…·æœ‰<code>kernel_size=1</code>çš„å·ç§¯å†…æ ¸ï¼Œå…·æœ‰ä¸€äº›æœ‰è¶£çš„ç‰¹æ€§ã€‚å…·ä½“æ¥è¯´ï¼Œ1x1å·ç§¯å°±åƒé€šé“ä¹‹é—´çš„ä¸€ä¸ªå®Œå…¨è¿é€šçš„çº¿æ€§å±‚ã€‚è¿™åœ¨ä»å¤šé€šé“feature mapæ˜ å°„åˆ°æ›´æµ…çš„feature mapæ—¶éå¸¸æœ‰ç”¨ã€‚åœ¨ä¸‹å›¾ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªåº”ç”¨äºè¾“å…¥çŸ©é˜µçš„NiNè¿æ¥ã€‚å®ƒå°†ä¸¤ä¸ªé€šé“ç®€åŒ–ä¸ºä¸€ä¸ªé€šé“ã€‚å› æ­¤ï¼ŒNiNæˆ–1x1å·ç§¯æä¾›äº†ä¸€ç§å»‰ä»·çš„æ–¹æ³•æ¥åˆå¹¶å‚æ•°è¾ƒå°‘çš„é¢å¤–éçº¿æ€§(Lin et al.ï¼Œ 2013)ã€‚</p>\n<p><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596110.png\"><br><font color=\"grey\"><center> ä¸€ä¸ª1Ã—1å·ç§¯è¿ç®—çš„ä¾‹å­ã€‚è§‚å¯Ÿ1Ã—1å·ç§¯æ˜¯å¦‚ä½•è¿›è¡Œçš„æ“ä½œå°†é€šé“æ•°ä»ä¸¤ä¸ªå‡å°‘åˆ°ä¸€ä¸ªã€‚</center></font></p>\n<h3 id=\"Residual-Connections-Residual-Block\"><a href=\"#Residual-Connections-Residual-Block\" class=\"headerlink\" title=\"Residual Connections&#x2F;Residual Block\"></a>Residual Connections&#x2F;Residual Block</h3><p>CNNsä¸­æœ€é‡è¦çš„è¶‹åŠ¿ä¹‹ä¸€æ˜¯Residual connectionï¼Œå®ƒæ”¯æŒçœŸæ­£æ·±å±‚çš„ç½‘ç»œ(è¶…è¿‡100å±‚)ã€‚å®ƒä¹Ÿç§°ä¸ºskip connectionã€‚å¦‚æœå°†å·ç§¯å‡½æ•°è¡¨ç¤ºä¸ºconvï¼Œåˆ™residual blockçš„è¾“å‡ºå¦‚ä¸‹:</p>\n<p>$$output &#x3D; conv ( input ) + input$$</p>\n<p>ç„¶è€Œï¼Œè¿™ä¸ªæ“ä½œæœ‰ä¸€ä¸ªéšå«çš„æŠ€å·§ï¼Œå¦‚å›¾ä¸‹æ‰€ç¤ºã€‚å¯¹äºè¦æ·»åŠ åˆ°å·ç§¯è¾“å‡ºçš„è¾“å…¥ï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„å½¢çŠ¶ã€‚ä¸ºæ­¤ï¼Œæ ‡å‡†åšæ³•æ˜¯åœ¨å·ç§¯ä¹‹å‰åº”ç”¨å¡«å……ã€‚åœ¨å›¾4-15ä¸­ï¼Œå¡«å……å°ºå¯¸ä¸º1ï¼Œå·ç§¯å¤§å°ä¸º3ã€‚</p>\n<p><img src=\"https://test.educg.net/userfiles/markdown/exp/2020_8/2034ll1597596102.png\"><br><font color=\"grey\"><center> æ®‹å·®è¿æ¥æ˜¯ä¸€ç§å°†åŸå§‹çŸ©é˜µåŠ åˆ°å·ç§¯è¾“å‡ºä¸Šçš„æ–¹æ³•ã€‚å½“å°†å·ç§¯å±‚åº”ç”¨äºè¾“å…¥çŸ©é˜µå¹¶å°†ç»“æœæ·»åŠ åˆ°è¾“å…¥çŸ©é˜µæ—¶ï¼Œä»¥ä¸Šç›´è§‚åœ°æè¿°äº†è¿™ä¸€ç‚¹ã€‚åˆ›å»ºä¸è¾“å…¥å¤§å°ç›¸åŒçš„è¾“å‡ºçš„é€šç”¨è¶…å‚æ•°è®¾ç½®æ˜¯è®©kernel_size&#x3D;3å’Œpadding&#x3D;1ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•å¸¦ adding&#x3D;(floor(kernel_size)&#x2F;2-1) çš„å¥‡æ•°å†…æ ¸å¤§å°éƒ½å°†å¯¼è‡´ä¸è¾“å…¥å¤§å°ç›¸åŒçš„è¾“å‡ºã€‚å·ç§¯å±‚äº§ç”Ÿçš„çŸ©é˜µè¢«åŠ åˆ°è¾“å…¥ç«¯ï¼Œæœ€åçš„ç»“æœæ˜¯å‰©ä½™è¿æ¥è®¡ç®—çš„è¾“å‡ºç«¯ã€‚</center></font></p>\n","categories":["Deep Learning"]},{"title":"çº¿æ€§å›å½’å®éªŒ","url":"/2023/11/20/mllab1/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ol>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡å•å˜é‡çº¿æ€§å›å½’ç®—æ³•</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡æ‰¹å¤„ç†æ¢¯åº¦ä¸‹é™ç®—æ³•</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡å¤šå˜é‡çº¿æ€§å›å½’ç®—æ³•</li>\n</ol>\n<h1 id=\"å®éªŒè¦æ±‚\"><a href=\"#å®éªŒè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒè¦æ±‚\"></a>å®éªŒè¦æ±‚</h1><ol>\n<li>   é‡‡ç”¨Pythonã€Matlabç­‰é«˜çº§è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œæ¨èä¼˜å…ˆé€‰ç”¨Pythonè¯­è¨€</li>\n<li>   æ ¸å¿ƒæ¨¡å‹å’Œç®—æ³•éœ€è‡ªä¸»ç¼–ç¨‹å®ç°ï¼Œä¸å¾—ç›´æ¥è°ƒç”¨Scikit-learnã€PyTorchç­‰æˆç†Ÿæ¡†æ¶çš„ç¬¬ä¸‰æ–¹å®ç°</li>\n<li>   ä»£ç å¯è¯»æ€§å¼ºï¼šå˜é‡ã€å‡½æ•°ã€ç±»ç­‰å‘½åå¯è¯»æ€§å¼ºï¼ŒåŒ…å«å¿…è¦çš„æ³¨é‡Š</li>\n</ol>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"ä¸€å…ƒçº¿æ€§å›å½’æ¨¡å‹\"><a href=\"#ä¸€å…ƒçº¿æ€§å›å½’æ¨¡å‹\" class=\"headerlink\" title=\"ä¸€å…ƒçº¿æ€§å›å½’æ¨¡å‹\"></a>ä¸€å…ƒçº¿æ€§å›å½’æ¨¡å‹<span id=\"more\"></span></h2><p>å³ $D&#x3D;\\left\\{\\left(x_i, y_i\\right)\\right\\}_{i&#x3D;1}^m$, å…¶ä¸­ $x_i \\in R$. å¯¹ç¦»æ•£å±æ€§, è‹¥å±æ€§å€¼é—´å­˜åœ¨ â€œåºâ€ å…³ç³», å¯ä»¥é€šè¿‡è¿ç»­åŒ–å°†å…¶è½¬åŒ–ä¸ºè¿ç»­å€¼ã€‚çº¿æ€§å›å½’è¯•å›¾å­¦å¾—<br>$$<br>f\\left(x_i\\right)&#x3D;w x_i+b \\text {, ä½¿å¾— } f\\left(x_i\\right) \\cong y_i<br>$$</p>\n<p>å‡æ–¹è¯¯å·®æ˜¯å›å½’ä»»åŠ¡ä¸­æœ€å¸¸ç”¨çš„æ€§èƒ½åº¦é‡, å› æ­¤æˆ‘ä»¬å¯è¯•å›¾è®©å‡æ–¹è¯¯å·®æœ€å°åŒ–, å³:<br>$$<br>\\left(w^*, b^*\\right)&#x3D;\\underset{(w, b)}{\\arg \\min } \\sum_{i&#x3D;1}^m\\left(f\\left(x_i\\right)-y_i\\right)^2&#x3D;\\underset{(w, b)}{\\arg \\min } \\sum_{i&#x3D;1}^m\\left(w x_i+b-y_i\\right)^2<br>$$</p>\n<p>å‡æ–¹è¯¯å·®å¯¹åº”äº†å¸¸ç”¨çš„æ¬§å‡ é‡Œå¾—è·ç¦»ã€‚åŸºäºå‡æ–¹è¯¯å·®æœ€å°åŒ–æ¥è¿›è¡Œæ¨¡å‹æ±‚è§£çš„æ–¹æ³•ç§°ä¸º â€œæœ€å°äºŒä¹˜æ³•â€ã€‚åœ¨çº¿æ€§å›å½’ä¸­, æœ€å°äºŒä¹˜æ³•å°±æ˜¯è¯•å›¾æ‰¾åˆ°ä¸€æ¡ç›´çº¿, ä½¿æ‰€æœ‰æ ·æœ¬åˆ°ç›´çº¿ä¸Šçš„æ¬§æ°è·ç¦»ä¹‹å’Œæœ€å°ã€‚</p>\n<p>æ±‚è§£ $w$ å’Œ $b$ ä½¿ $E_{(w, b)}&#x3D;\\sum_{i&#x3D;1}^m\\left(w x_i+b-y_i\\right)^2$ æœ€å°åŒ–çš„è¿‡ç¨‹, ç§°ä¸ºçº¿æ€§å›å½’æ¨¡å‹çš„æœ€å°äºŒä¹˜ â€œå‚æ•°ä¼°è®¡â€ã€‚æˆ‘ä»¬å¯å°† $E_{(w, b)}$ åˆ†åˆ«å¯¹ $w$ å’Œ $b$ æ±‚å¯¼, å¾—åˆ°:<br>$$<br>\\begin{gathered}<br>\\frac{\\partial E_{(w, b)}}{\\partial w}&#x3D;2\\left(w \\sum_{i&#x3D;1}^m x_i^2-\\sum_{i&#x3D;1}^m\\left(y_i-b\\right) x_i\\right), \\\\<br>\\frac{\\partial E_{(w, b)}}{\\partial w}&#x3D;2\\left(m b-\\sum_{i&#x3D;1}^m\\left(y_i-w x_i\\right)\\right),<br>\\end{gathered}<br>$$</p>\n<p>ç„¶åä»¤ä¸Šå¼ä¸º 0 , å¯ä»¥å¾—åˆ° $w$ å’Œ $b$ æœ€ä¼˜è§£çš„é—­å¼è§£:<br>$$<br>\\begin{gathered}<br>w&#x3D;\\frac{\\sum_{i&#x3D;1}^m y_i\\left(x_i-\\bar{x}\\right)}{\\sum_{i&#x3D;1}^m x_i^2-\\frac{1}{m}\\left(\\sum_{i&#x3D;1}^m x\\right)^2}, \\<br>b&#x3D;\\frac{1}{m} \\sum_{i&#x3D;1}^m\\left(y_i-w x_i\\right),<br>\\end{gathered}<br>$$</p>\n<p>å…¶ä¸­, $\\bar{x}&#x3D;\\frac{1}{m} \\sum_{i&#x3D;1}^m x$ ä¸º $x$ çš„å‡å€¼ã€‚</p>\n<h2 id=\"å¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹\"><a href=\"#å¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹\" class=\"headerlink\" title=\"å¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹\"></a>å¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹</h2><p>æ ·æœ¬ç”± $d$ ä¸ªå±æ€§æè¿°, æ­¤æ—¶æˆ‘ä»¬è¯•å›¾å­¦å¾—<br>$$<br>f\\left(x_i\\right)&#x3D;w^T x_i+b \\text {, ä½¿å¾— } f\\left(x_i\\right) \\cong y_i<br>$$</p>\n<p>ç±»ä¼¼çš„, å¯åˆ©ç”¨æœ€å°äºŒä¹˜æ³•æ¥å¯¹ $w$ å’Œ $b$ è¿›è¡Œä¼°è®¡ã€‚<br>$$<br>X&#x3D;\\left(\\begin{array}{ccccc}<br>x_{11} &amp; x_{12} &amp; \\cdots &amp; x_{1 d} &amp; 1 \\\\<br>x_{21} &amp; x_{22} &amp; \\cdots &amp; x_{2 d} &amp; 1 \\\\<br>\\vdots &amp; \\vdots &amp; \\ddots &amp; \\vdots &amp; 1 \\\\<br>x_{m 1} &amp; x_{m 2} &amp; \\cdots &amp; x_{m d} &amp; 1<br>\\end{array}\\right)&#x3D;\\left(\\begin{array}{cc}<br>x_1^T &amp; 1 \\\\<br>x_2^T &amp; 1 \\\\<br>\\vdots &amp; \\vdots \\\\<br>x_m^T &amp; 1<br>\\end{array}\\right)<br>$$</p>\n<p>å†æŠŠæ ‡è®°ä¹Ÿå†™æˆå‘é‡å½¢å¼ $y&#x3D;\\left(y_1 ; y_2 ; \\ldots ; y_m\\right)$, æœ‰<br>$$<br>\\widehat{w}^*&#x3D;\\underset{\\widehat{w}^*}{\\arg \\min } \\sum_{i&#x3D;1}^m(y-X \\widehat{w})^T(y-X \\widehat{w})<br>$$</p>\n<p>ä»¤ $E_{\\widehat{w}}&#x3D;(y-X \\widehat{w})^T(y-X \\widehat{w})$, å¯¹ $\\widehat{w}$ æ±‚å¯¼å¾—åˆ°<br>$$<br>\\frac{\\partial E_{\\hat{w}}}{\\partial \\widehat{w}}&#x3D;2 X^T(X \\widehat{w}-y) \\text {. }<br>$$</p>\n<p>ä»¤ä¸Šå¼ä¸º 0 å¯å¾— $\\widehat{w}$ çš„æœ€ä¼˜è§£çš„é—­å¼è§£, ä½†ç”±äºè®¾è®¡çŸ©é˜µé€†çš„è®¡ç®—, æ¯”å•å˜é‡æƒ…å½¢è¦å¤æ‚ä¸€äº›ã€‚ä¸‹é¢æˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„è®¨è®ºã€‚<br>å½“ $X^T X$ ä¸ºæ»¡ç§©çŸ©é˜µæˆ–æ­£å®šçŸ©é˜µæ—¶, ä»¤ä¸Šå¼ä¸º 0 , å¯å¾—<br>$$<br>\\widehat{w}&#x3D;\\left(X^T X\\right)^{-1} X^T y<br>$$</p>\n<p>å…¶ä¸­ $\\left(X^T X\\right)^{-1}$ æ˜¯çŸ©é˜µ $\\left(X^T X\\right)$ çš„é€†çŸ©é˜µ, ä»¤ $\\hat{x}_i&#x3D;\\left(x_i ; 1\\right)$. åˆ™æœ€ç»ˆå­¦å¾—çš„å¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹ä¸º<br>$$<br>f\\left(\\hat{x}_i\\right)&#x3D;\\hat{x}_i^T\\left(X^T X\\right)^{-1} X^T y<br>$$</p>\n<p>ç„¶è€Œ, ç°å®ä»»åŠ¡ä¸­ $X^T X$ å¾€å¾€ä¸æ˜¯æ»¡ç§©çŸ©é˜µ, ä¾‹å¦‚å†è®¸å¤šä»»åŠ¡ä¸­æˆ‘ä»¬ä¼šé‡åˆ°å¤§é‡çš„å˜é‡,å…¶æ•°ç›®ç”šè‡³è¶…è¿‡æ ·ä¾‹æ•°, å¯¼è‡´ $X$ çš„åˆ—æ•°å¤šäºè¡Œæ•°, $X^T X$ æ˜¾ç„¶ä¸æ»¡ç§©ã€‚æ­¤æ—¶å¯è§£å‡ºå¤šä¸ª $\\widehat{w}$, å®ƒä»¬éƒ½èƒ½ä½¿å‡æ–¹è¯¯å·®æœ€å°åŒ–ã€‚å¸¸è§çš„æ–¹æ³•è¿˜æœ‰å¼•å…¥æ­£åˆ™é¡¹ã€‚</p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"å•å˜é‡çº¿æ€§å›å½’\"><a href=\"#å•å˜é‡çº¿æ€§å›å½’\" class=\"headerlink\" title=\"å•å˜é‡çº¿æ€§å›å½’\"></a>å•å˜é‡çº¿æ€§å›å½’</h2><ol>\n<li>é‡‡ç”¨æ•°æ®é›† â€œdata&#x2F;regress_data1.csvâ€è¿›è¡Œå•å˜é‡çº¿æ€§å›å½’å®éªŒ</li>\n<li>å€ŸåŠ© matplotlib ç”»å‡ºåŸå§‹æ•°æ®åˆ†å¸ƒçš„æ•£ç‚¹å›¾ï¼ˆx&#x3D;â€äººå£â€, $y&#x3D;$ â€œæ”¶ç›Šâ€ï¼‰</li>\n<li>ä»¥æœ€å°å¹³æ–¹è¯¯å·®ä¸ºç›®æ ‡å‡½æ•°, æ„é€ æ¨¡å‹çš„æŸå¤±ï¼ˆè¯¯å·®ï¼‰è®¡ç®—å‡½æ•°:<br>$$<br>J(w)&#x3D;\\frac{1}{2 m} \\sum_{i&#x3D;1}^m\\left(h\\left(x^{(i)}\\right)-y^{(i)}\\right)^2<br>$$</li>\n</ol>\n<p>å…¶ä¸­, $h(x)&#x3D;w^T X&#x3D;w_0 x_0+w_1 x_1+w_2 x_2+\\ldots+w_n x_n$</p>\n<ol start=\"4\">\n<li><p>å®ç°æ‰¹é‡æ¢¯åº¦ä¸‹é™ç®—æ³•ï¼ˆBatch Gradient Decentï¼‰ç”¨äºä¼˜åŒ–çº¿æ€§å›å½’æ¨¡å‹:<br>$$<br>w_j&#x3D;w_j-\\alpha \\frac{1}{m} \\sum_{i&#x3D;1}^m \\frac{\\partial}{\\partial w_j} J(w)<br>$$<br>å…¶ä¸­, $w_j$ ä¸ºå‚æ•°å‘é‡, $m$ æ ·æœ¬é‡ã€‚<br>æç¤º:<br>æ‰¹é‡æ¢¯åº¦ä¸‹é™ç®—æ³•å¯ä»¥å‚è€ƒ ç¬¬ 5 ç« ç¥ç»ç½‘ç»œçš„ä¼˜åŒ–ç®—æ³•ï¼ˆP104ï¼‰<br>çº¿æ€§å›å½’æ¨¡å‹çš„åç½® $\\mathrm{b}$ å¯å¸æ”¶è¿›å‚æ•°å‘é‡ $\\mathrm{w}$, ä»è€Œé‡‡ç”¨å‘é‡å½¢å¼ (P55)</p>\n</li>\n<li><p>é‡‡ç”¨ä¸Šè¿°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•, ä¼˜åŒ–å•å˜é‡çº¿æ€§å›å½’æ¨¡å‹ã€‚å…¶ä¸­, è¿­ä»£è½®æ•° epoch è®¾å®šä¸º 1000 è½®, å­¦ä¹ ç‡è®¾å®šä¸º 0.01 , å‚æ•°åˆå§‹åŒ–ä¸º 0 ã€‚</p>\n</li>\n</ol>\n<p>ä»£ç è¾“å‡º:</p>\n<ul>\n<li><p>ä¼˜åŒ–ç»“æŸæ—¶çš„æŸå¤±å€¼å’Œæ¨¡å‹å‚æ•°</p>\n</li>\n<li><p>å°†æ¨¡å‹æ‹Ÿåˆçš„ç›´çº¿å’ŒåŸå§‹æ•°æ®æ•£ç‚¹å›¾ç”»åˆ°åŒä¸€å¼ å›¾ä¸­</p>\n</li>\n</ul>\n<h2 id=\"å¤šå˜é‡çº¿æ€§å›å½’\"><a href=\"#å¤šå˜é‡çº¿æ€§å›å½’\" class=\"headerlink\" title=\"å¤šå˜é‡çº¿æ€§å›å½’\"></a>å¤šå˜é‡çº¿æ€§å›å½’</h2><ol>\n<li>é‡‡ç”¨æ•°æ®é›† â€œdata&#x2F;regress_data2.csvâ€è¿›è¡Œå¤šå˜é‡çº¿æ€§å›å½’å®éªŒ, é€šè¿‡æˆ¿å­çš„å¤§å°å’Œæˆ¿é—´æ•°é‡ä¸¤ä¸ªå˜é‡ å›å½’æˆ¿å­çš„ä»·æ ¼ã€‚</li>\n<li>å¯¹æ•°æ®è¿›è¡Œç‰¹å¾å½’ä¸€åŒ–ï¼š $z_i&#x3D;\\frac{x_i-\\mu}{\\sigma}$</li>\n<li>é‡‡ç”¨ä¸Šè¿°æ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•, ä¼˜åŒ–å¤šå˜é‡çº¿æ€§å›å½’æ¨¡å‹ã€‚å…¶ä¸­, è¿­ä»£è½®æ•° epoch è®¾å®šä¸º 1000 è½®, å­¦ä¹ ç‡è®¾å®šä¸º 0.01 , å‚æ•°åˆå§‹åŒ–ä¸º 0 ã€‚</li>\n</ol>\n<p>ä»£ç è¾“å‡º:</p>\n<ul>\n<li><p>ä¼˜åŒ–ç»“æŸæ—¶çš„æŸå¤±å€¼å’Œæ¨¡å‹å‚æ•°</p>\n</li>\n<li><p>ç”»å›¾è¾“å‡ºè®­ç»ƒè¯¯å·®ï¼ˆæŸå¤±ï¼‰éšç€è¿­ä»£è½®æ•° epoch çš„å˜åŒ–æ›²çº¿</p>\n</li>\n</ul>\n<h1 id=\"å®éªŒä»£ç å’Œç»“æœ\"><a href=\"#å®éªŒä»£ç å’Œç»“æœ\" class=\"headerlink\" title=\"å®éªŒä»£ç å’Œç»“æœ\"></a>å®éªŒä»£ç å’Œç»“æœ</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">compute_loss</span>(<span class=\"params\">X, Y, theta</span>): <span class=\"comment\">#æŸå¤±å‡½æ•°çš„è®¡ç®—</span></span><br><span class=\"line\">    m = Y.size</span><br><span class=\"line\">    loss = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>, m):</span><br><span class=\"line\">        x = X[i, <span class=\"number\">1</span>]</span><br><span class=\"line\">        y = Y[i]</span><br><span class=\"line\">        loss += (y - (theta[<span class=\"number\">1</span>] * x + theta[<span class=\"number\">0</span>])) ** <span class=\"number\">2</span></span><br><span class=\"line\">    loss = loss / (<span class=\"number\">2.0</span> * m)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> loss</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">gradient_descent</span>(<span class=\"params\">X, Y, theta, lr, epoch</span>): <span class=\"comment\">#BGDå®ç° </span></span><br><span class=\"line\">    m = Y.size</span><br><span class=\"line\">    t = theta.size</span><br><span class=\"line\">    J_history = np.zeros(epoch)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> <span class=\"built_in\">iter</span> <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(epoch):</span><br><span class=\"line\">        <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(t):</span><br><span class=\"line\">            theta[j] = theta[j] - lr * np.<span class=\"built_in\">sum</span>((np.dot(X, theta) - Y) * X[:, j]) / m</span><br><span class=\"line\"></span><br><span class=\"line\">        J_history[<span class=\"built_in\">iter</span>] = compute_loss(X, Y, theta)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> theta, J_history</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">path = <span class=\"string\">&#x27;regress_data1.csv&#x27;</span></span><br><span class=\"line\">data = pd.read_csv(path)</span><br><span class=\"line\">X = data[[<span class=\"string\">&#x27;äººå£&#x27;</span>]]</span><br><span class=\"line\">Y = data[[<span class=\"string\">&#x27;æ”¶ç›Š&#x27;</span>]].values.ravel()  <span class=\"comment\"># Flatten Y to 1D array</span></span><br><span class=\"line\">m = X.size</span><br><span class=\"line\">X = np.c_[np.ones(m), X]  <span class=\"comment\"># Add a column of ones for the bias term</span></span><br><span class=\"line\">theta = np.zeros(<span class=\"number\">2</span>)</span><br><span class=\"line\">epoch = <span class=\"number\">1000</span></span><br><span class=\"line\">lr = <span class=\"number\">0.01</span></span><br><span class=\"line\">theta, J_history = gradient_descent(X, Y, theta, lr, epoch)</span><br><span class=\"line\">ine1,=plt.plot(X[:,<span class=\"number\">1</span>],np.dot(X,theta),color=<span class=\"string\">&#x27;red&#x27;</span>)</span><br><span class=\"line\">plt.scatter(data[[<span class=\"string\">&#x27;äººå£&#x27;</span>]],data[[<span class=\"string\">&#x27;æ”¶ç›Š&#x27;</span>]]);plt.xlabel(<span class=\"string\">&quot;population&quot;</span>);plt.ylabel(<span class=\"string\">&quot;profit&quot;</span>);</span><br><span class=\"line\"><span class=\"comment\">#plt.plot(range(1000),J_history)</span></span><br><span class=\"line\">plt.show()</span><br><span class=\"line\"><span class=\"built_in\">print</span>(theta,J_history[<span class=\"number\">999</span>])</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu.png?raw=true\" alt=\"alt text\"></p>\n<p>$$<br>\\begin{aligned}<br>&amp; b&#x3D;-3.25088222 \\\\<br>&amp; w&#x3D;1.12836314<br>\\end{aligned}<br>$$</p>\n<p>è®­ç»ƒ 1000 æ¬¡åçš„æŸå¤±ä¸º 4.514833339953508</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-1.png?raw=true\" alt=\"alt text\"></p>\n<p>æˆ‘ä»¬åªéœ€å¯¹å‰é¢çš„ä»£ç åšç®€å•çš„ä¿®æ”¹å³å¯ç”¨äºå¤šå˜é‡çº¿æ€§å›å½’ï¼Œå°†è®¡ç®—æŸå¤±å‡½æ•°çš„æ”¹ä¸º</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">loss += (y - (theta[<span class=\"number\">1</span>] * x1 + theta[<span class=\"number\">0</span>]+theta[<span class=\"number\">2</span>]*x2)) ** <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<p>å¯¹æ•°æ®è¿›è¡Œå½’ä¸€åŒ–</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">X=(X-np.average(X))/np.std(X)</span><br><span class=\"line\">Y=(Y-np.average(Y))/np.std(Y)</span><br><span class=\"line\">Z=(Z-np.average(Z))/np.std(Z)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-2.png?raw=true\" alt=\"alt text\"></p>\n<p>$$<br>\\begin{aligned}<br>&amp; \\mathrm{b}&#x3D;-8.21860310 \\mathrm{e}-17 \\\\<br>&amp; \\mathrm{w} 1&#x3D;8.79149410 \\mathrm{e}-01 \\\\<br>&amp; \\mathrm{w} 2&#x3D;4.75747766 \\mathrm{e}-02<br>\\end{aligned}<br>$$</p>\n<p>è¿­ä»£ 1000 æ¬¡çš„æŸå¤±ä¸º 0.1335413413355335</p>\n<h1 id=\"å°ç»“æˆ–è®¨è®º\"><a href=\"#å°ç»“æˆ–è®¨è®º\" class=\"headerlink\" title=\"å°ç»“æˆ–è®¨è®º\"></a>å°ç»“æˆ–è®¨è®º</h1><p>çº¿æ€§å›å½’æ˜¯åŸºäºå‡è®¾ç›®æ ‡å˜é‡ä¸ç‰¹å¾å˜é‡ä¹‹é—´å­˜åœ¨çº¿æ€§å…³ç³»ï¼Œç„¶åé€šè¿‡æ‹Ÿåˆæœ€ä½³çš„çº¿æ€§å‡½æ•°æ¥é¢„æµ‹ç›®æ ‡å˜é‡ã€‚</p>\n<p>çº¿æ€§å›å½’å»ºç«‹äº†è¾“å…¥ç‰¹å¾ï¼ˆè‡ªå˜é‡ï¼‰ä¸è¾“å‡ºå˜é‡ï¼ˆå› å˜é‡ï¼‰ä¹‹é—´çš„çº¿æ€§å…³ç³»ï¼Œé€šè¿‡æ‹Ÿåˆæœ€ä½³çš„çº¿æ€§æ¨¡å‹æ¥é¢„æµ‹è¾“å‡ºå˜é‡çš„å€¼ã€‚</p>\n<p>çº¿æ€§å›å½’çš„ä¸»è¦ç›®æ ‡æ˜¯é€šè¿‡å­¦ä¹ æ ·æœ¬æ•°æ®é›†ä¸­çš„ç‰¹å¾å’Œç›®æ ‡å˜é‡ä¹‹é—´çš„çº¿æ€§å…³ç³»ï¼Œæ¥è¿›è¡Œé¢„æµ‹å’Œè§£é‡Šã€‚çº¿æ€§å›å½’å¯ä»¥ç”¨äºé¢„æµ‹è¿ç»­æ•°å€¼å‹çš„ç›®æ ‡å˜é‡ï¼Œä¹Ÿå¯ä»¥ç”¨äºåˆ†æç‰¹å¾å¯¹ç›®æ ‡å˜é‡çš„å½±å“ç¨‹åº¦å’Œæ–¹å‘ã€‚çº¿æ€§å›å½’çš„ç›®æ ‡æ˜¯æ‰¾åˆ°æœ€ä½³çš„æƒé‡å’Œæˆªè·ï¼Œä½¿å¾—æ¨¡å‹çš„é¢„æµ‹å€¼ä¸å®é™…å€¼ä¹‹é—´çš„å·®å¼‚æœ€å°åŒ–ã€‚</p>\n<p>æ¢¯åº¦ä¸‹é™æ³•ï¼šâ‘ æ¢¯åº¦ä¸‹é™æ³•æ˜¯ä¸€ç§è¿­ä»£ä¼˜åŒ–ç®—æ³•ï¼Œé€šè¿‡ä¸æ–­è°ƒæ•´æ¨¡å‹å‚æ•°æ¥æœ€å°åŒ–æŸå¤±å‡½æ•°ã€‚åœ¨çº¿æ€§å›å½’ä¸­ï¼Œæ¢¯åº¦ä¸‹é™æ³•é€šè¿‡è®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¨¡å‹å‚æ•°çš„æ¢¯åº¦ï¼Œå¹¶æ ¹æ®æ¢¯åº¦çš„æ–¹å‘å’Œå¤§å°æ›´æ–°å‚æ•°å€¼ï¼Œç›´åˆ°è¾¾åˆ°æœ€å°åŒ–æŸå¤±çš„ç›®æ ‡ã€‚â‘¡æ¢¯åº¦ä¸‹é™æ³•ä½¿ç”¨å­¦ä¹ ç‡æ¥æ§åˆ¶æ¯æ¬¡è¿­ä»£ä¸­å‚æ•°çš„æ›´æ–°æ­¥é•¿ã€‚å­¦ä¹ ç‡éœ€è¦æ‰‹åŠ¨é€‰æ‹©ï¼Œå¹¶ä¸”å½±å“ç®—æ³•çš„æ”¶æ•›é€Ÿåº¦å’Œç¨³å®šæ€§ã€‚â‘¢æ¢¯åº¦ä¸‹é™æ³•å¯èƒ½é™·å…¥å±€éƒ¨æœ€ä¼˜è§£è€Œä¸æ˜¯å…¨å±€æœ€ä¼˜è§£ï¼Œç‰¹åˆ«æ˜¯åœ¨éå‡¸çš„æŸå¤±å‡½æ•°ä¸­ã€‚è¿™å¯ä»¥é€šè¿‡é€‰æ‹©åˆé€‚çš„å­¦ä¹ ç‡å’Œåˆå§‹åŒ–å‚æ•°æ¥ç¼“è§£ã€‚â‘£æ¢¯åº¦ä¸‹é™æ³•çš„æ”¶æ•›é€Ÿåº¦å–å†³äºå­¦ä¹ ç‡çš„é€‰æ‹©å’ŒæŸå¤±å‡½æ•°çš„å½¢çŠ¶ã€‚è¾ƒå°çš„å­¦ä¹ ç‡å¯èƒ½å¯¼è‡´æ”¶æ•›é€Ÿåº¦è¾ƒæ…¢ï¼Œè€Œè¾ƒå¤§çš„å­¦ä¹ ç‡å¯èƒ½å¯¼è‡´æ— æ³•æ”¶æ•›æˆ–å‘æ•£ã€‚â‘¤æ¢¯åº¦ä¸‹é™æ³•ç›¸å¯¹äºæœ€å°äºŒä¹˜æ³•å¯¹å¼‚å¸¸å€¼å…·æœ‰ä¸€å®šçš„é²æ£’æ€§ï¼Œä½†ä»ç„¶å¯èƒ½å—åˆ°å¤§çš„å¼‚å¸¸å€¼çš„å½±å“ã€‚â‘¥æ¢¯åº¦ä¸‹é™æ³•å¯ä»¥ä¸»è¦åˆ†ä¸ºæ‰¹é‡æ¢¯åº¦ä¸‹é™æ³•ã€éšæœºæ¢¯åº¦ä¸‹é™æ³•å’Œmini-batchæ¢¯åº¦ä¸‹é™æ³•ï¼Œè¿™ä¸‰ç§æ¢¯åº¦ä¸‹é™æ³•çš„é€‰æ‹©å–å†³äºæ•°æ®é›†çš„è§„æ¨¡ã€è®¡ç®—èµ„æºçš„é™åˆ¶ä»¥åŠä¼˜åŒ–æ•ˆæœçš„è¦æ±‚ã€‚â‘¦æ¢¯åº¦ä¸‹é™æ³•ä¸»è¦é€‚ç”¨äºç›®æ ‡å˜é‡å’Œç‰¹å¾å˜é‡ä¹‹é—´å­˜åœ¨è¿‘ä¼¼çº¿æ€§å…³ç³»ï¼Œæ•°æ®é›†è§„æ¨¡è¾ƒå¤§ï¼Œæ— æ³•ç›´æ¥è®¡ç®—çŸ©é˜µçš„é€†çŸ©é˜µï¼Œæ•°æ®é›†ä¸­å­˜åœ¨å™ªå£°æˆ–å¼‚å¸¸å€¼ç­‰æƒ…å†µã€‚</p>\n","categories":["Machine Learning"]},{"title":"åŸºäºæ”¹è¿›UNetç®—æ³•çš„å†œä¸šå›¾åƒåˆ†å‰²","url":"/2024/05/23/mllab10/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"ä¸»è¦ç›®æ ‡\"><a href=\"#ä¸»è¦ç›®æ ‡\" class=\"headerlink\" title=\"ä¸»è¦ç›®æ ‡\"></a>ä¸»è¦ç›®æ ‡</h1><p>åŸºäºæ”¹è¿›çš„U-Netç®—æ³•å®ç°å†œä¸šé¥æ„Ÿå›¾åƒè¯­ä¹‰åˆ†å‰²è®­ç»ƒ</p>\n<h1 id=\"å®éªŒè¿‡ç¨‹\"><a href=\"#å®éªŒè¿‡ç¨‹\" class=\"headerlink\" title=\"å®éªŒè¿‡ç¨‹\"></a>å®éªŒè¿‡ç¨‹</h1><h2 id=\"åŸºæœ¬åŸç†\"><a href=\"#åŸºæœ¬åŸç†\" class=\"headerlink\" title=\"åŸºæœ¬åŸç†\"></a>åŸºæœ¬åŸç†</h2><p>å›¾åƒåˆ†å‰²æ˜¯å°†å›¾ç‰‡æ ¹æ®å†…å®¹åˆ†å‰²æˆä¸åŒçš„å—ï¼Œå®ƒéœ€è¦å¯¹æ¯ä¸ªåƒç´ ç‚¹è¿›è¡Œåˆ†ç±»ï¼Œç‰©ä½“çš„è½®å»“æ˜¯ç²¾å‡†å‹¾å‹’çš„ï¼Œè€Œä¸æ˜¯åƒæ£€æµ‹é‚£æ ·ç»™å‡ºè¾¹ç•Œæ¡†ã€‚æŒ‰ç…§åˆ†å‰²ç›®çš„æ¥è¿›è¡Œåˆ’åˆ†ï¼Œå›¾åƒåˆ†å‰²å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§ï¼š</p>\n<p>æ™®é€šåˆ†å‰²ï¼šä¸å…³æ³¨ç‰©ä½“æ˜¯ä»€ä¹ˆï¼Œåªæ˜¯åˆ’å®šä¸åŒç‰©ä½“ä¹‹é—´çš„ç•Œé™ï¼Œå°†åˆ†å±ä¸åŒç‰©ä½“çš„åƒç´ åŒºåŸŸåˆ’åˆ†å¼€æ¥ï¼Œæ¯”å¦‚å°†å‰æ™¯å’ŒèƒŒæ™¯åˆ†å¼€ã€‚</p>\n<p>è¯­ä¹‰åˆ†å‰²ï¼šåœ¨æ™®é€šåˆ†å‰²çš„åŸºç¡€ä¸Šï¼Œåˆ†ç±»å‡ºæ¯ä¸€å—åŒºåŸŸçš„æ ‡ç­¾ï¼Œè¯†åˆ«å‡ºè¯¥åŒºåŸŸçš„ç‰©ä½“ã€‚</p>\n<span id=\"more\"></span>\n<p>å®ä¾‹åˆ†å‰²ï¼šåœ¨è¯­ä¹‰åˆ†å‰²çš„åŸºç¡€ä¸Šï¼Œå°†æ¯ä¸ªç‰©ä½“éƒ½åˆ†åˆ«å¼€æ¥ï¼ŒåŒç±»çš„ç‰©ä½“ä¹Ÿæœ‰ä¸åŒçš„ç¼–å·ï¼Œæ¯”å¦‚è¯†åˆ«åœºæ™¯ä¸­çš„ä¸åŒçš„äººã€‚</p>\n<p>æœ¬å®éªŒç›®æ ‡ï¼šæˆ‘ä»¬æœ¬æ¬¡å®éªŒè¦åšçš„å°±æ˜¯å¯¹å†œä¸šå¤§æ•°æ®å›¾åƒè¿›è¡Œè¯­ä¹‰åˆ†å‰²ï¼Œå°†ä¸åŒåŒºåŸŸçš„å†œä½œç‰©è¿›è¡Œåˆ†ç±»ã€‚æ— è®ºæ˜¯å“ªç§å›¾åƒåˆ†å‰²ï¼Œæ•´ä½“æµç¨‹éƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹å›¾åƒåˆ†å‰²çš„åŸºæœ¬æµç¨‹å’Œè®­ç»ƒè¿‡ç¨‹ã€‚</p>\n<h3 id=\"å›¾åƒåˆ†å‰²çš„åŸºæœ¬æµç¨‹\"><a href=\"#å›¾åƒåˆ†å‰²çš„åŸºæœ¬æµç¨‹\" class=\"headerlink\" title=\"å›¾åƒåˆ†å‰²çš„åŸºæœ¬æµç¨‹\"></a>å›¾åƒåˆ†å‰²çš„åŸºæœ¬æµç¨‹</h3><h4 id=\"ä¸‹é‡‡æ ·ä¸ä¸Šé‡‡æ ·\"><a href=\"#ä¸‹é‡‡æ ·ä¸ä¸Šé‡‡æ ·\" class=\"headerlink\" title=\"ä¸‹é‡‡æ ·ä¸ä¸Šé‡‡æ ·\"></a>ä¸‹é‡‡æ ·ä¸ä¸Šé‡‡æ ·</h4><p>Convolutionï¼ˆå·ç§¯ï¼‰ï¼šé€šè¿‡å·ç§¯å±‚æå–å›¾åƒçš„å¤šå±‚æ¬¡ç‰¹å¾ã€‚<br>Deconvolutionï¼ˆåå·ç§¯ï¼‰æˆ–Resizeï¼ˆé‡é‡‡æ ·ï¼‰ï¼šé€šè¿‡åå·ç§¯æˆ–é‡é‡‡æ ·æ¢å¤å›¾åƒçš„ç©ºé—´åˆ†è¾¨ç‡ã€‚</p>\n<h4 id=\"å¤šå°ºåº¦ç‰¹å¾èåˆ\"><a href=\"#å¤šå°ºåº¦ç‰¹å¾èåˆ\" class=\"headerlink\" title=\"å¤šå°ºåº¦ç‰¹å¾èåˆ\"></a>å¤šå°ºåº¦ç‰¹å¾èåˆ</h4><p>ç‰¹å¾é€ç‚¹ç›¸åŠ ï¼šä¸åŒå±‚çš„ç‰¹å¾å›¾é€ç‚¹ç›¸åŠ ï¼Œèåˆå¤šå±‚ç‰¹å¾ã€‚<br>ç‰¹å¾channelç»´åº¦æ‹¼æ¥ï¼šä¸åŒå±‚çš„ç‰¹å¾å›¾åœ¨channelç»´åº¦æ‹¼æ¥ï¼Œä¿ç•™å¤šå±‚ç‰¹å¾ä¿¡æ¯ã€‚</p>\n<h4 id=\"è·å¾—åƒç´ çº§åˆ«çš„segmentation-map\"><a href=\"#è·å¾—åƒç´ çº§åˆ«çš„segmentation-map\" class=\"headerlink\" title=\"è·å¾—åƒç´ çº§åˆ«çš„segmentation map\"></a>è·å¾—åƒç´ çº§åˆ«çš„segmentation map</h4><p>å¯¹æ¯ä¸€ä¸ªåƒç´ ç‚¹è¿›è¡Œç±»åˆ«åˆ¤æ–­ï¼Œç”Ÿæˆæ¯ä¸ªåƒç´ ç‚¹çš„åˆ†ç±»æ ‡ç­¾ã€‚</p>\n<h3 id=\"è®­ç»ƒè¿‡ç¨‹\"><a href=\"#è®­ç»ƒè¿‡ç¨‹\" class=\"headerlink\" title=\"è®­ç»ƒè¿‡ç¨‹\"></a>è®­ç»ƒè¿‡ç¨‹</h3><p>è¾“å…¥ï¼šimage + labelï¼ˆè¾“å…¥å›¾åƒå’Œæ ‡ç­¾ï¼‰</p>\n<p>å‰å‘è®¡ç®—ï¼šout &#x3D; model(image)ï¼ˆé€šè¿‡æ¨¡å‹è¿›è¡Œå‰å‘è®¡ç®—ï¼Œè¾“å‡ºé¢„æµ‹ç»“æœï¼‰</p>\n<p>è®¡ç®—æŸå¤±ï¼šloss &#x3D; loss_func(out, label)ï¼ˆé€šè¿‡æŸå¤±å‡½æ•°è®¡ç®—é¢„æµ‹ç»“æœä¸æ ‡ç­¾ä¹‹é—´çš„å·®å¼‚ï¼‰</p>\n<p>åå‘ä¼ æ’­ï¼šloss.backward()ï¼ˆè®¡ç®—æ¢¯åº¦ï¼Œè¿›è¡Œåå‘ä¼ æ’­ï¼‰</p>\n<p>æ›´æ–°æƒé‡ï¼šoptimizer.minimize(loss)ï¼ˆä½¿ç”¨ä¼˜åŒ–å™¨æ›´æ–°æ¨¡å‹æƒé‡ï¼‰</p>\n<h3 id=\"å¯¼å…¥ç»„ä»¶åŒ…\"><a href=\"#å¯¼å…¥ç»„ä»¶åŒ…\" class=\"headerlink\" title=\"å¯¼å…¥ç»„ä»¶åŒ…\"></a>å¯¼å…¥ç»„ä»¶åŒ…</h3><p>åœ¨å®ç°åŸºäºæ”¹è¿›çš„U-Netç®—æ³•è¿›è¡Œå†œä¸šé¥æ„Ÿå›¾åƒè¯­ä¹‰åˆ†å‰²çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å¯¼å…¥ä¸€ç³»åˆ—ç”¨äºæ•°æ®å¤„ç†ã€å¯è§†åŒ–å’Œæ¨¡å‹è®­ç»ƒçš„å·¥å…·åŒ…ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> matplotlib</span><br><span class=\"line\">matplotlib.use(<span class=\"string\">&quot;Agg&quot;</span>)</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np  </span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.models <span class=\"keyword\">import</span> Sequential  </span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.layers <span class=\"keyword\">import</span> *  </span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.utils.np_utils <span class=\"keyword\">import</span> to_categorical  </span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.preprocessing.image <span class=\"keyword\">import</span> img_to_array  </span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.callbacks <span class=\"keyword\">import</span> ModelCheckpoint  </span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.preprocessing <span class=\"keyword\">import</span> LabelEncoder  </span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.models <span class=\"keyword\">import</span> Model</span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.models <span class=\"keyword\">import</span> load_model</span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.layers.merge <span class=\"keyword\">import</span> concatenate</span><br><span class=\"line\"><span class=\"keyword\">from</span> PIL <span class=\"keyword\">import</span> Image  </span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt  </span><br><span class=\"line\"><span class=\"keyword\">import</span> cv2</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> tqdm <span class=\"keyword\">import</span> tqdm  </span><br><span class=\"line\">os.environ[<span class=\"string\">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = <span class=\"string\">&quot;4&quot;</span></span><br><span class=\"line\">%matplotlib inline</span><br></pre></td></tr></table></figure>\n<h2 id=\"å‡†å¤‡æ•°æ®\"><a href=\"#å‡†å¤‡æ•°æ®\" class=\"headerlink\" title=\"å‡†å¤‡æ•°æ®\"></a>å‡†å¤‡æ•°æ®</h2><h3 id=\"å¤§å°ºåº¦å†œä½œç‰©å«æ˜Ÿé¥æ„Ÿæ•°æ®\"><a href=\"#å¤§å°ºåº¦å†œä½œç‰©å«æ˜Ÿé¥æ„Ÿæ•°æ®\" class=\"headerlink\" title=\"å¤§å°ºåº¦å†œä½œç‰©å«æ˜Ÿé¥æ„Ÿæ•°æ®\"></a>å¤§å°ºåº¦å†œä½œç‰©å«æ˜Ÿé¥æ„Ÿæ•°æ®</h3><p>æ•°æ®æ¥æºäºæ— äººæœºé¥æ„Ÿå½±åƒã€‚æ— äººæœºé¥æ„Ÿæµ‹é‡æŠ€æœ¯ä½œä¸ºç©ºé—´ä¿¡æ¯æŠ€æœ¯çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œæ—¢èƒ½ä½œä¸ºæ˜Ÿè½½é¥æ„Ÿå½±åƒçš„é‡è¦è¡¥å……ï¼Œåˆèƒ½æœ‰æ•ˆæ›¿ä»£äººå·¥å®åœ°è°ƒæŸ¥ã€‚å‡­å€Ÿç€é™ä½åœ°é¢äººå·¥è°ƒæŸ¥å¼ºåº¦å’Œè°ƒæŸ¥æˆæœ¬ã€å¿«é€Ÿè·å–å®æ—¶é«˜åˆ†è¾¨æ•°æ®çš„ä¼˜åŠ¿ï¼Œå®ƒæˆä¸ºå†œä¸šç»Ÿè®¡è°ƒæŸ¥å·¥ä½œä¸­çš„ä¸€å¤§åˆ›æ–°ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ç²¾å‡†å†œä¸šçš„é‡è¦æ–¹å‘ä¹‹ä¸€ã€‚</p>\n<h3 id=\"æ•°æ®æ¥æºåœ°å€\"><a href=\"#æ•°æ®æ¥æºåœ°å€\" class=\"headerlink\" title=\"æ•°æ®æ¥æºåœ°å€\"></a>æ•°æ®æ¥æºåœ°å€</h3><p><a href=\"https://tianchi.aliyun.com/competition/entrance/231717/\">å¤©æ± å¤§èµ› - å†œä½œç‰©é¥æ„Ÿå½±åƒæ•°æ®é›†</a></p>\n<h3 id=\"æ•°æ®å¯è§†åŒ–\"><a href=\"#æ•°æ®å¯è§†åŒ–\" class=\"headerlink\" title=\"æ•°æ®å¯è§†åŒ–\"></a>æ•°æ®å¯è§†åŒ–</h3><p>æ ‡æ³¨ä½œç‰©ç±»å‹å›¾ç‰‡æ˜¯ä¸€å¼ unint8å•é€šé“å›¾åƒã€‚æ¯ä¸ªåƒç´ ç‚¹å€¼è¡¨ç¤ºåŸå§‹å›¾ç‰‡ä¸­å¯¹åº”ä½ç½®æ‰€å±ç±»åˆ«ï¼Œå…¶ä¸­â€œçƒ¤çƒŸâ€åƒç´ å€¼ 1ï¼Œâ€œç‰ç±³â€åƒç´ å€¼ 2ï¼Œâ€œè–ä»ç±³â€åƒç´ å€¼ 3ï¼Œâ€œäººé€ å»ºç­‘â€åƒç´ å€¼ 4ï¼Œå…¶ä½™æ‰€æœ‰ä½ç½®è§†ä¸ºâ€œå…¶ä»–â€åƒç´ å€¼ 0ã€‚</p>\n<p>éšæœºé€‰æ‹©è®­ç»ƒé›†ä¸­çš„18å¼ å›¾åƒï¼Œå¹¶ä¸”åˆ©ç”¨matplotlibåº“å¯¹å…¶è¿›è¡Œå¯è§†åŒ–ï¼Œå±•ç¤ºæ•°æ®é›†çš„åŸºæœ¬æƒ…å†µã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">directory = <span class=\"string\">&quot;/root/data/Lab4/Lab4-data/UNetP_data/train_data&quot;</span></span><br><span class=\"line\">images = random.choices(os.listdir(directory), k=<span class=\"number\">18</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">fig = plt.figure(figsize=(<span class=\"number\">20</span>, <span class=\"number\">10</span>))</span><br><span class=\"line\">columns = <span class=\"number\">6</span></span><br><span class=\"line\">rows = <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> x, i <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(images):</span><br><span class=\"line\">    path = os.path.join(directory, i)</span><br><span class=\"line\">    img = plt.imread(path)</span><br><span class=\"line\">    fig.add_subplot(rows, columns, x + <span class=\"number\">1</span>)</span><br><span class=\"line\">    plt.imshow(img)</span><br><span class=\"line\"></span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"è®¾ç½®æ•°æ®å’Œæ ‡ç­¾\"><a href=\"#è®¾ç½®æ•°æ®å’Œæ ‡ç­¾\" class=\"headerlink\" title=\"è®¾ç½®æ•°æ®å’Œæ ‡ç­¾\"></a>è®¾ç½®æ•°æ®å’Œæ ‡ç­¾</h3><p>è¿™é‡Œé‡‡ç”¨labelEncoderæ–¹æ³•è¿›è¡Œæ ‡ç­¾çš„å¤„ç†ï¼Œæ ‡å‡†åŒ–æ ‡ç­¾ï¼Œå°†æ ‡ç­¾å€¼ç»Ÿä¸€è½¬æ¢æˆrangeèŒƒå›´å†…ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">width = <span class=\"number\">512</span>  </span><br><span class=\"line\">height = <span class=\"number\">512</span>  </span><br><span class=\"line\">classes = [<span class=\"number\">0.</span> ,  <span class=\"number\">1.</span>,  <span class=\"number\">2.</span>,   <span class=\"number\">3.</span>  , <span class=\"number\">4.</span>]  </span><br><span class=\"line\">labelencoder = LabelEncoder()  </span><br><span class=\"line\">labelencoder.fit(classes) </span><br></pre></td></tr></table></figure>\n<h3 id=\"å›¾ç‰‡åŠ è½½å‡½æ•°\"><a href=\"#å›¾ç‰‡åŠ è½½å‡½æ•°\" class=\"headerlink\" title=\"å›¾ç‰‡åŠ è½½å‡½æ•°\"></a>å›¾ç‰‡åŠ è½½å‡½æ•°</h3><p>å¯¹æŒ‡å®šè·¯å¾„çš„å›¾ç‰‡è¿›è¡ŒåŠ è½½ï¼Œå¦‚æœæ˜¯ç°åº¦å›¾ï¼Œç›´æ¥è¯»å–ï¼Œå¦‚æœæ˜¯RGBå›¾åƒï¼Œåˆ™å¯¹å›¾åƒè¿›è¡Œå½’ä¸€åŒ–ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_img</span>(<span class=\"params\">path, grayscale=<span class=\"literal\">False</span></span>):</span><br><span class=\"line\">    <span class=\"keyword\">if</span> grayscale:</span><br><span class=\"line\">        img = cv2.imread(path,cv2.IMREAD_GRAYSCALE)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        img = cv2.imread(path)</span><br><span class=\"line\">        img = np.array(img,dtype=<span class=\"string\">&quot;float&quot;</span>) / <span class=\"number\">255.0</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"å®šä¹‰è®­ç»ƒå‚æ•°å’Œæ•°æ®\"><a href=\"#å®šä¹‰è®­ç»ƒå‚æ•°å’Œæ•°æ®\" class=\"headerlink\" title=\"å®šä¹‰è®­ç»ƒå‚æ•°å’Œæ•°æ®\"></a>å®šä¹‰è®­ç»ƒå‚æ•°å’Œæ•°æ®</h3><p>è®¾ç½®éšæœºæ•°ç§å­</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">seed = <span class=\"number\">7</span>  </span><br><span class=\"line\">np.random.seed(seed)  </span><br></pre></td></tr></table></figure>\n<p>è®¾ç½®éªŒè¯é›†è·å–è§„åˆ™ï¼Œå°†è®­ç»ƒé›†çš„1&#x2F;4ç”¨ä½œéªŒè¯é›†ã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_train_val</span>(<span class=\"params\">val_rate=<span class=\"number\">0.25</span></span>):</span><br><span class=\"line\">    train_url = []</span><br><span class=\"line\">    train_set = []</span><br><span class=\"line\">    val_set = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> pic <span class=\"keyword\">in</span> os.listdir(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/UNetP_data/train_data/&#x27;</span>):</span><br><span class=\"line\">        train_url.append(pic)</span><br><span class=\"line\">    random.shuffle(train_url)</span><br><span class=\"line\">    total_num = <span class=\"built_in\">len</span>(train_url)</span><br><span class=\"line\">    val_num = <span class=\"built_in\">int</span>(val_rate * total_num)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(train_url)):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> i &lt; val_num:</span><br><span class=\"line\">            val_set.append(train_url[i])</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            train_set.append(train_url[i])</span><br><span class=\"line\">    <span class=\"keyword\">return</span> train_set, val_set</span><br></pre></td></tr></table></figure>\n<p>è®¾ç½®è®­ç»ƒé›†ç”Ÿæˆå‡½æ•°</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generateData</span>(<span class=\"params\">batch_size, data=[]</span>):</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        train_data = []</span><br><span class=\"line\">        train_label = []</span><br><span class=\"line\">        batch = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> (<span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(data))):</span><br><span class=\"line\">            url = data[i]</span><br><span class=\"line\">            batch += <span class=\"number\">1</span></span><br><span class=\"line\">            img = load_img(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/UNetP_data/train_data/&#x27;</span> + url)</span><br><span class=\"line\">            img = img_to_array(img)</span><br><span class=\"line\">            train_data.append(img)</span><br><span class=\"line\">            label = load_img(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/UNetP_data/train_label/&#x27;</span> + url, grayscale=<span class=\"literal\">True</span>)</span><br><span class=\"line\">            label = img_to_array(label)</span><br><span class=\"line\">            train_label.append(label)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> batch % batch_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">                train_data = np.array(train_data)</span><br><span class=\"line\">                train_label = np.array(train_label)</span><br><span class=\"line\">                <span class=\"keyword\">yield</span> (train_data, train_label)</span><br><span class=\"line\">                train_data = []</span><br><span class=\"line\">                train_label = []</span><br><span class=\"line\">                batch = <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<p>è®¾ç½®éªŒè¯é›†ç”Ÿæˆå‡½æ•°</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">generateValidData</span>(<span class=\"params\">batch_size, data=[]</span>):</span><br><span class=\"line\">    <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">        valid_data = []</span><br><span class=\"line\">        valid_label = []</span><br><span class=\"line\">        batch = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> (<span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(data))):</span><br><span class=\"line\">            url = data[i]</span><br><span class=\"line\">            batch += <span class=\"number\">1</span></span><br><span class=\"line\">            img = load_img(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/UNetP_data/train_data/&#x27;</span> + url)</span><br><span class=\"line\">            img = img_to_array(img)</span><br><span class=\"line\">            valid_data.append(img)</span><br><span class=\"line\">            label = load_img(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/UNetP_data/train_label/&#x27;</span> + url, grayscale=<span class=\"literal\">True</span>)</span><br><span class=\"line\">            label = img_to_array(label)</span><br><span class=\"line\">            valid_label.append(label)</span><br><span class=\"line\">            <span class=\"keyword\">if</span> batch % batch_size == <span class=\"number\">0</span>:</span><br><span class=\"line\">                valid_data = np.array(valid_data)</span><br><span class=\"line\">                valid_label = np.array(valid_label)</span><br><span class=\"line\">                <span class=\"keyword\">yield</span> (valid_data, valid_label)</span><br><span class=\"line\">                valid_data = []</span><br><span class=\"line\">                valid_label = []</span><br><span class=\"line\">                batch = <span class=\"number\">0</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"æ¨¡å‹æ­å»ºè®­ç»ƒå’Œæ”¹è¿›\"><a href=\"#æ¨¡å‹æ­å»ºè®­ç»ƒå’Œæ”¹è¿›\" class=\"headerlink\" title=\"æ¨¡å‹æ­å»ºè®­ç»ƒå’Œæ”¹è¿›\"></a>æ¨¡å‹æ­å»ºè®­ç»ƒå’Œæ”¹è¿›</h2><h3 id=\"UNetç½‘ç»œçš„ä»‹ç»\"><a href=\"#UNetç½‘ç»œçš„ä»‹ç»\" class=\"headerlink\" title=\"UNetç½‘ç»œçš„ä»‹ç»\"></a>UNetç½‘ç»œçš„ä»‹ç»</h3><p>Unetç½‘ç»œç»“æ„å¦‚å…¶åå‘ˆç°ä¸€ä¸ªUå­—å½¢ï¼Œå³ç”±å·ç§¯å’Œæ± åŒ–å•å…ƒæ„æˆã€‚å·¦åŠè¾¹ä¸ºç¼–ç å™¨ï¼Œå³å¦‚ä¼ ç»Ÿçš„åˆ†ç±»ç½‘ç»œæ˜¯â€œä¸‹é‡‡æ ·é˜¶æ®µâ€ï¼›å³åŠè¾¹ä¸ºè§£ç å™¨ï¼Œæ˜¯â€œä¸Šé‡‡æ ·é˜¶æ®µâ€ã€‚ä¸­é—´çš„ç°è‰²ç®­å¤´ä¸ºè·³è·ƒè¿æ¥ï¼Œå°†æµ…å±‚çš„ç‰¹å¾ä¸æ·±å±‚çš„ç‰¹å¾æ‹¼æ¥ã€‚å› ä¸ºæµ…å±‚é€šå¸¸å¯ä»¥æŠ“å–å›¾åƒçš„ä¸€äº›ç®€å•çš„ç‰¹å¾ï¼Œæ¯”å¦‚è¾¹ç•Œã€é¢œè‰²ï¼Œè€Œæ·±å±‚ç»è¿‡çš„å·ç§¯æ“ä½œå¤šæŠ“å–åˆ°å›¾åƒçš„ä¸€äº›æŠ½è±¡ç‰¹å¾ï¼Œå°†æµ…æ·±åŒæ—¶åˆ©ç”¨èµ·æ¥ä¼šèµ·åˆ°æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚Unetçš„æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-1.png?raw=true\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-2.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"è®­ç»ƒå‡½æ•°çš„å®šä¹‰\"><a href=\"#è®­ç»ƒå‡½æ•°çš„å®šä¹‰\" class=\"headerlink\" title=\"è®­ç»ƒå‡½æ•°çš„å®šä¹‰\"></a>è®­ç»ƒå‡½æ•°çš„å®šä¹‰</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">train</span>(<span class=\"params\">mselect</span>): </span><br><span class=\"line\">    EPOCHS = <span class=\"number\">10</span></span><br><span class=\"line\">    BS = <span class=\"number\">16</span>  </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(mselect==<span class=\"string\">&#x27;UNet&#x27;</span>):</span><br><span class=\"line\">        model = unet()</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        model = unet_new()</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(mselect==<span class=\"string\">&#x27;UNet&#x27;</span>):</span><br><span class=\"line\">        modelcheck = ModelCheckpoint(<span class=\"string\">&#x27;model.h5&#x27;</span>,monitor=<span class=\"string\">&#x27;val_acc&#x27;</span>,save_best_only=<span class=\"literal\">True</span>,mode=<span class=\"string\">&#x27;max&#x27;</span>)  </span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        modelcheck = ModelCheckpoint(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/models/model_new_&#123;epoch:02d&#125;_&#123;val_accuracy:.2f&#125;.h5&#x27;</span>,monitor=<span class=\"string\">&#x27;val_acc&#x27;</span>,save_best_only=<span class=\"literal\">False</span>,mode=<span class=\"string\">&#x27;max&#x27;</span>,save_freq=<span class=\"string\">&#x27;epoch&#x27;</span>) </span><br><span class=\"line\">    <span class=\"built_in\">callable</span> = [modelcheck]  </span><br><span class=\"line\">    train_set,val_set = get_train_val()</span><br><span class=\"line\">    train_numb = <span class=\"built_in\">len</span>(train_set)  </span><br><span class=\"line\">    valid_numb = <span class=\"built_in\">len</span>(val_set)  </span><br><span class=\"line\">    <span class=\"built_in\">print</span> (<span class=\"string\">&quot;the number of train data is&quot;</span>,train_numb)  </span><br><span class=\"line\">    <span class=\"built_in\">print</span> (<span class=\"string\">&quot;the number of val data is&quot;</span>,valid_numb)</span><br><span class=\"line\">    H = model.fit_generator(generator=generateData(BS,train_set),steps_per_epoch=train_numb//BS,epochs=EPOCHS,verbose=<span class=\"number\">1</span>,  </span><br><span class=\"line\">                    validation_data=generateValidData(BS,val_set),validation_steps=valid_numb//BS,callbacks=<span class=\"built_in\">callable</span>,max_queue_size=<span class=\"number\">1</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># plot the training loss and accuracy</span></span><br><span class=\"line\">    plt.style.use(<span class=\"string\">&quot;ggplot&quot;</span>)</span><br><span class=\"line\">    plt.figure()</span><br><span class=\"line\">    N = EPOCHS</span><br><span class=\"line\">    plt.plot(np.arange(<span class=\"number\">0</span>, N), H.history[<span class=\"string\">&quot;loss&quot;</span>], label=<span class=\"string\">&quot;train_loss&quot;</span>)</span><br><span class=\"line\">    plt.plot(np.arange(<span class=\"number\">0</span>, N), H.history[<span class=\"string\">&quot;val_loss&quot;</span>], label=<span class=\"string\">&quot;val_loss&quot;</span>)</span><br><span class=\"line\">    plt.plot(np.arange(<span class=\"number\">0</span>, N), H.history[<span class=\"string\">&quot;accuracy&quot;</span>], label=<span class=\"string\">&quot;train_acc&quot;</span>)</span><br><span class=\"line\">    plt.plot(np.arange(<span class=\"number\">0</span>, N), H.history[<span class=\"string\">&quot;val_accuracy&quot;</span>], label=<span class=\"string\">&quot;val_acc&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(mselect==<span class=\"string\">&#x27;UNet&#x27;</span>):</span><br><span class=\"line\">        plt.title(<span class=\"string\">&quot;Training Loss and Accuracy on U-Net Satellite Seg&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        plt.title(<span class=\"string\">&quot;Training Loss and Accuracy on U-Net_new Satellite Seg&quot;</span>)</span><br><span class=\"line\">    plt.xlabel(<span class=\"string\">&quot;Epoch #&quot;</span>)</span><br><span class=\"line\">    plt.ylabel(<span class=\"string\">&quot;Loss/Accuracy&quot;</span>)</span><br><span class=\"line\">    plt.legend(loc=<span class=\"string\">&quot;lower left&quot;</span>)</span><br><span class=\"line\">    plt.savefig(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/plot.png&#x27;</span>)</span><br><span class=\"line\">    plt.show()</span><br></pre></td></tr></table></figure>\n<h3 id=\"unetç½‘ç»œçš„å®šä¹‰\"><a href=\"#unetç½‘ç»œçš„å®šä¹‰\" class=\"headerlink\" title=\"unetç½‘ç»œçš„å®šä¹‰\"></a>unetç½‘ç»œçš„å®šä¹‰</h3><p>æ± åŒ–å±‚é‡‡ç”¨æœ€å¤§æ± åŒ–ï¼Œæ¿€æ´»å‡½æ•°é‡‡ç”¨reluï¼Œä¸Šé‡‡æ ·çš„çº¿æ€§æ’å€¼æ–¹å¼é‡‡å–kerasçš„UpSampling2Dæ–¹æ³•</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">unet</span>():</span><br><span class=\"line\">    inputs = Input((<span class=\"number\">3</span>, width, height))</span><br><span class=\"line\"></span><br><span class=\"line\">    conv1 = Conv2D(<span class=\"number\">32</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(inputs)</span><br><span class=\"line\">    conv1 = Conv2D(<span class=\"number\">32</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv1)</span><br><span class=\"line\">    pool1 = MaxPooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv1)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv2 = Conv2D(<span class=\"number\">64</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(pool1)</span><br><span class=\"line\">    conv2 = Conv2D(<span class=\"number\">64</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv2)</span><br><span class=\"line\">    pool2 = MaxPooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv2)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv3 = Conv2D(<span class=\"number\">128</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(pool2)</span><br><span class=\"line\">    conv3 = Conv2D(<span class=\"number\">128</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv3)</span><br><span class=\"line\">    pool3 = MaxPooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv3)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv4 = Conv2D(<span class=\"number\">256</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(pool3)</span><br><span class=\"line\">    conv4 = Conv2D(<span class=\"number\">256</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv4)</span><br><span class=\"line\">    pool4 = MaxPooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv4)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv5 = Conv2D(<span class=\"number\">512</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(pool4)</span><br><span class=\"line\">    conv5 = Conv2D(<span class=\"number\">512</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv5)</span><br><span class=\"line\"></span><br><span class=\"line\">    up6 = concatenate([UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv5), conv4], axis=<span class=\"number\">1</span>)</span><br><span class=\"line\">    conv6 = Conv2D(<span class=\"number\">256</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(up6)</span><br><span class=\"line\">    conv6 = Conv2D(<span class=\"number\">256</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv6)</span><br><span class=\"line\"></span><br><span class=\"line\">    up7 = concatenate([UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv6), conv3], axis=<span class=\"number\">1</span>)</span><br><span class=\"line\">    conv7 = Conv2D(<span class=\"number\">128</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(up7)</span><br><span class=\"line\">    conv7 = Conv2D(<span class=\"number\">128</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv7)</span><br><span class=\"line\"></span><br><span class=\"line\">    up8 = concatenate([UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv7), conv2], axis=<span class=\"number\">1</span>)</span><br><span class=\"line\">    conv8 = Conv2D(<span class=\"number\">64</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(up8)</span><br><span class=\"line\">    conv8 = Conv2D(<span class=\"number\">64</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv8)</span><br><span class=\"line\"></span><br><span class=\"line\">    up9 = concatenate([UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv8), conv1], axis=<span class=\"number\">1</span>)</span><br><span class=\"line\">    conv9 = Conv2D(<span class=\"number\">32</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(up9)</span><br><span class=\"line\">    conv9 = Conv2D(<span class=\"number\">32</span>, (<span class=\"number\">3</span>, <span class=\"number\">3</span>), activation=<span class=\"string\">&quot;relu&quot;</span>, padding=<span class=\"string\">&quot;same&quot;</span>)(conv9)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv10 = Conv2D(<span class=\"number\">1</span>, (<span class=\"number\">1</span>, <span class=\"number\">1</span>), activation=<span class=\"string\">&quot;sigmoid&quot;</span>)(conv9)</span><br><span class=\"line\">    <span class=\"comment\">#conv10 = Conv2D(n_label, (1, 1), activation=&quot;softmax&quot;)(conv9)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    model = Model(inputs=inputs, outputs=conv10)</span><br><span class=\"line\">    model.<span class=\"built_in\">compile</span>(optimizer=<span class=\"string\">&#x27;Adam&#x27;</span>, loss=<span class=\"string\">&#x27;binary_crossentropy&#x27;</span>, metrics=[<span class=\"string\">&#x27;accuracy&#x27;</span>])</span><br><span class=\"line\"><span class=\"keyword\">return</span> model</span><br></pre></td></tr></table></figure>\n<h3 id=\"è®­ç»ƒunetç½‘ç»œ\"><a href=\"#è®­ç»ƒunetç½‘ç»œ\" class=\"headerlink\" title=\"è®­ç»ƒunetç½‘ç»œ\"></a>è®­ç»ƒunetç½‘ç»œ</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-3.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-4.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"æ¨¡å‹æ”¹è¿›\"><a href=\"#æ¨¡å‹æ”¹è¿›\" class=\"headerlink\" title=\"æ¨¡å‹æ”¹è¿›\"></a>æ¨¡å‹æ”¹è¿›</h3><p>æˆ‘ä»¬å¯¹åŸæ¥çš„unetç½‘ç»œå¢åŠ äº†ä¸‹é‡‡æ ·å±‚ï¼Œå¹¶ä¸”è®¾å®šäº†æƒé‡çš„éšæœºåˆå§‹åŒ–ï¼Œæ± åŒ–æ–¹å¼æ›´æ”¹ä¸ºå¹³å‡æ± åŒ–ï¼Œå¹¶ä¸”åœ¨ç½‘ç»œä¸­åŠ å…¥äº†æ‰¹è§„èŒƒåŒ–BatchNormalizationçš„å¤„ç†ï¼ŒåŸºäºæ¢¯åº¦çš„è®­ç»ƒè¿‡ç¨‹å¯ä»¥æ›´åŠ æœ‰æ•ˆçš„è¿›è¡Œï¼Œå³åŠ å¿«æ”¶æ•›é€Ÿåº¦ï¼Œå‡è½»æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸å¯¼è‡´çš„æ— æ³•è®­ç»ƒçš„é—®é¢˜ï¼Œå¹¶ä¸”å¢åŠ äº†Dropoutçš„æœºåˆ¶ï¼Œæœ‰æ•ˆçš„é˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">unet_new</span>():</span><br><span class=\"line\"> </span><br><span class=\"line\">    inputs = Input((width, height, <span class=\"number\">3</span>))<span class=\"comment\">#æ”¹è¿›</span></span><br><span class=\"line\">    conv1 = Conv2D(<span class=\"number\">8</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(inputs)</span><br><span class=\"line\">    pool1 = AveragePooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv1)  <span class=\"comment\"># 16</span></span><br><span class=\"line\"></span><br><span class=\"line\">    conv2 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(pool1)</span><br><span class=\"line\">    conv2 = Conv2D(<span class=\"number\">64</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv2)</span><br><span class=\"line\">    conv2 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(conv2)</span><br><span class=\"line\">    conv2 = Conv2D(<span class=\"number\">64</span>, <span class=\"number\">1</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv2)</span><br><span class=\"line\">    conv2 = Dropout(<span class=\"number\">0.02</span>)(conv2)</span><br><span class=\"line\">    pool2 = AveragePooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv2)  <span class=\"comment\"># 8</span></span><br><span class=\"line\"></span><br><span class=\"line\">    conv3 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(pool2)</span><br><span class=\"line\">    conv3 = Conv2D(<span class=\"number\">128</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv3)</span><br><span class=\"line\">    conv3 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(conv3)</span><br><span class=\"line\">    conv3 = Conv2D(<span class=\"number\">128</span>, <span class=\"number\">1</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv3)</span><br><span class=\"line\">    conv3 = Dropout(<span class=\"number\">0.02</span>)(conv3)</span><br><span class=\"line\">    pool3 = AveragePooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv3)  <span class=\"comment\"># 4</span></span><br><span class=\"line\"></span><br><span class=\"line\">    conv4 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(pool3)</span><br><span class=\"line\">    conv4 = Conv2D(<span class=\"number\">256</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv4)</span><br><span class=\"line\">    conv4 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(conv4)</span><br><span class=\"line\">    conv4 = Conv2D(<span class=\"number\">256</span>, <span class=\"number\">1</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv4)</span><br><span class=\"line\">    conv4 = Dropout(<span class=\"number\">0.02</span>)(conv4)</span><br><span class=\"line\">    pool4 = AveragePooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv4)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv5 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(pool4)</span><br><span class=\"line\">    conv5 = Conv2D(<span class=\"number\">512</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv5)</span><br><span class=\"line\">    conv5 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(conv5)</span><br><span class=\"line\">    conv5 = Conv2D(<span class=\"number\">512</span>, <span class=\"number\">1</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv5)</span><br><span class=\"line\">    conv5 = Dropout(<span class=\"number\">0.02</span>)(conv5)</span><br><span class=\"line\">    pool4 = AveragePooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv4)</span><br><span class=\"line\"><span class=\"comment\"># conv5 = Conv2D(35, 3, activation=&#x27;relu&#x27;, padding=&#x27;same&#x27;, kernel_initializer=&#x27;he_normal&#x27;)(conv4)</span></span><br><span class=\"line\"><span class=\"comment\"># drop4 = Dropout(0.02)(conv5)</span></span><br><span class=\"line\">    pool4 = AveragePooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(pool3)  <span class=\"comment\"># 2</span></span><br><span class=\"line\">    pool5 = AveragePooling2D(pool_size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(pool4)  <span class=\"comment\"># 1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    conv6 = BatchNormalization(momentum=<span class=\"number\">0.99</span>)(pool5)</span><br><span class=\"line\">    conv6 = Conv2D(<span class=\"number\">256</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv6)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv7 = Conv2D(<span class=\"number\">256</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv6)</span><br><span class=\"line\">    up7 = (UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv7))  <span class=\"comment\"># 2</span></span><br><span class=\"line\">    conv7 = Conv2D(<span class=\"number\">256</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(up7)</span><br><span class=\"line\">    merge7 = concatenate([pool4, conv7], axis=<span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv8 = Conv2D(<span class=\"number\">128</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(merge7)</span><br><span class=\"line\">    up8 = (UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv8))  <span class=\"comment\"># 4</span></span><br><span class=\"line\">    conv8 = Conv2D(<span class=\"number\">128</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(up8)</span><br><span class=\"line\">    merge8 = concatenate([pool3, conv8], axis=<span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv9 = Conv2D(<span class=\"number\">64</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(merge8)</span><br><span class=\"line\">    up9 = (UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv9))  <span class=\"comment\"># 8</span></span><br><span class=\"line\">    conv9 = Conv2D(<span class=\"number\">64</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(up9)</span><br><span class=\"line\">    merge9 = concatenate([pool2, conv9], axis=<span class=\"number\">3</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv10 = Conv2D(<span class=\"number\">32</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(merge9)</span><br><span class=\"line\">    up10 = (UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv10))  <span class=\"comment\"># 16</span></span><br><span class=\"line\">    conv10 = Conv2D(<span class=\"number\">32</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(up10)</span><br><span class=\"line\"></span><br><span class=\"line\">    conv11 = Conv2D(<span class=\"number\">16</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv10)</span><br><span class=\"line\">    up11 = (UpSampling2D(size=(<span class=\"number\">2</span>, <span class=\"number\">2</span>))(conv11))  <span class=\"comment\"># 32</span></span><br><span class=\"line\">    conv11 = Conv2D(<span class=\"number\">8</span>, <span class=\"number\">3</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(up11)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># conv12 = Conv2D(3, 1, activation=&#x27;relu&#x27;, padding=&#x27;same&#x27;, kernel_initializer=&#x27;he_normal&#x27;)(conv11)</span></span><br><span class=\"line\">    conv12 = Conv2D(<span class=\"number\">1</span>, <span class=\"number\">1</span>, activation=<span class=\"string\">&#x27;relu&#x27;</span>, padding=<span class=\"string\">&#x27;same&#x27;</span>, kernel_initializer=<span class=\"string\">&#x27;he_normal&#x27;</span>)(conv11)</span><br><span class=\"line\"></span><br><span class=\"line\">    model = Model(<span class=\"built_in\">input</span>=inputs, output=conv12)</span><br><span class=\"line\">    <span class=\"comment\">#print(model.summary())</span></span><br><span class=\"line\">    model.<span class=\"built_in\">compile</span>(optimizer=<span class=\"string\">&#x27;adam&#x27;</span>, loss=<span class=\"string\">&#x27;mse&#x27;</span>, metrics=[<span class=\"string\">&#x27;accuracy&#x27;</span>])</span><br><span class=\"line\">      </span><br><span class=\"line\">    <span class=\"keyword\">return</span> model</span><br></pre></td></tr></table></figure>\n<h3 id=\"æ¨¡å‹ç»“æ„\"><a href=\"#æ¨¡å‹ç»“æ„\" class=\"headerlink\" title=\"æ¨¡å‹ç»“æ„\"></a>æ¨¡å‹ç»“æ„</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-5.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-6.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"è®­ç»ƒæ”¹è¿›åçš„æ¨¡å‹\"><a href=\"#è®­ç»ƒæ”¹è¿›åçš„æ¨¡å‹\" class=\"headerlink\" title=\"è®­ç»ƒæ”¹è¿›åçš„æ¨¡å‹\"></a>è®­ç»ƒæ”¹è¿›åçš„æ¨¡å‹</h3><p>å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡æ”¹è¿›åï¼Œè®­ç»ƒå‡½æ•°çš„æ”¶æ•›è¿…é€Ÿï¼Œå¹¶ä¸”å‡†ç¡®ç‡ä¹Ÿå¾—åˆ°äº†æ˜æ˜¾çš„æé«˜</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-7.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-8.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-9.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"æ¨¡å‹ä½¿ç”¨\"><a href=\"#æ¨¡å‹ä½¿ç”¨\" class=\"headerlink\" title=\"æ¨¡å‹ä½¿ç”¨\"></a>æ¨¡å‹ä½¿ç”¨</h2><h3 id=\"å¼•å…¥ç»„ä»¶åŒ…\"><a href=\"#å¼•å…¥ç»„ä»¶åŒ…\" class=\"headerlink\" title=\"å¼•å…¥ç»„ä»¶åŒ…\"></a>å¼•å…¥ç»„ä»¶åŒ…</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> cv2</span><br><span class=\"line\"><span class=\"keyword\">import</span> random</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.preprocessing.image <span class=\"keyword\">import</span> img_to_array</span><br><span class=\"line\"><span class=\"keyword\">from</span> keras.models <span class=\"keyword\">import</span> load_model</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.preprocessing <span class=\"keyword\">import</span> LabelEncoder  </span><br><span class=\"line\">os.environ[<span class=\"string\">&quot;CUDA_VISIBLE_DEVICES&quot;</span>] = <span class=\"string\">&quot;0&quot;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"è®¾ç½®æµ‹è¯•æ•°æ®çš„æ ¼å¼å’Œæ ‡ç­¾\"><a href=\"#è®¾ç½®æµ‹è¯•æ•°æ®çš„æ ¼å¼å’Œæ ‡ç­¾\" class=\"headerlink\" title=\"è®¾ç½®æµ‹è¯•æ•°æ®çš„æ ¼å¼å’Œæ ‡ç­¾\"></a>è®¾ç½®æµ‹è¯•æ•°æ®çš„æ ¼å¼å’Œæ ‡ç­¾</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">image_size = <span class=\"number\">512</span></span><br><span class=\"line\">classes = [<span class=\"number\">0.</span> ,  <span class=\"number\">1.</span>,  <span class=\"number\">2.</span>,   <span class=\"number\">3.</span>  , <span class=\"number\">4.</span>]</span><br><span class=\"line\">TEST_SET = [<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/test.png&#x27;</span>]</span><br><span class=\"line\">labelencoder = LabelEncoder()  </span><br><span class=\"line\">labelencoder.fit(classes) </span><br></pre></td></tr></table></figure>\n<h3 id=\"å®šä¹‰é¢„æµ‹å‡½æ•°ï¼ŒåŠ è½½é¢„æµ‹æ¨¡å‹\"><a href=\"#å®šä¹‰é¢„æµ‹å‡½æ•°ï¼ŒåŠ è½½é¢„æµ‹æ¨¡å‹\" class=\"headerlink\" title=\"å®šä¹‰é¢„æµ‹å‡½æ•°ï¼ŒåŠ è½½é¢„æµ‹æ¨¡å‹\"></a>å®šä¹‰é¢„æµ‹å‡½æ•°ï¼ŒåŠ è½½é¢„æµ‹æ¨¡å‹</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">predict</span>():</span><br><span class=\"line\">    <span class=\"comment\"># load the trained convolutional neural network</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">&quot;[INFO] loading network...&quot;</span>)</span><br><span class=\"line\">    model = load_model(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/model.h5&#x27;</span>)</span><br><span class=\"line\">    stride = <span class=\"number\">512</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> n <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(TEST_SET)):</span><br><span class=\"line\">        path = TEST_SET[n]</span><br><span class=\"line\">        <span class=\"comment\">#load the image</span></span><br><span class=\"line\">        image = cv2.imread(path)</span><br><span class=\"line\">        </span><br><span class=\"line\">        h,w,_ = image.shape</span><br><span class=\"line\">        </span><br><span class=\"line\">        padding_h = (h//stride + <span class=\"number\">1</span>) * stride </span><br><span class=\"line\">        padding_w = (w//stride + <span class=\"number\">1</span>) * stride</span><br><span class=\"line\">        padding_img = np.zeros((padding_h,padding_w,<span class=\"number\">3</span>),dtype=np.uint8)</span><br><span class=\"line\">        padding_img[<span class=\"number\">0</span>:h,<span class=\"number\">0</span>:w,:] = image[:,:,:]</span><br><span class=\"line\">        <span class=\"comment\">#padding_img = padding_img.astype(&quot;float&quot;) / 255.0</span></span><br><span class=\"line\">        padding_img = img_to_array(padding_img)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">print</span> (<span class=\"string\">&#x27;src:&#x27;</span>,padding_img.shape)</span><br><span class=\"line\">        mask_whole = np.zeros((padding_h,padding_w),dtype=np.uint8)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(padding_h//stride):</span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(padding_w//stride):</span><br><span class=\"line\">                crop = padding_img[i*stride:i*stride+image_size,j*stride:j*stride+image_size,:<span class=\"number\">3</span>]<span class=\"comment\">#trick</span></span><br><span class=\"line\">               </span><br><span class=\"line\">                <span class=\"comment\">#_,ch,cw = crop.shape</span></span><br><span class=\"line\"><span class=\"comment\">#                 if ch != 512 or cw != 512:</span></span><br><span class=\"line\"><span class=\"comment\">#                     print (&#x27;invalid size!&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\">#                     continue</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                crop = np.expand_dims(crop, axis=<span class=\"number\">0</span>) </span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">#crop.transpose(0,3,2,1)</span></span><br><span class=\"line\">                </span><br><span class=\"line\">               <span class=\"comment\"># crop.reshape(1,3,512,512)</span></span><br><span class=\"line\">                <span class=\"comment\">#print(crop.shape)</span></span><br><span class=\"line\">                pred = model.predict(crop.transpose(<span class=\"number\">0</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>),verbose=<span class=\"number\">2</span>)</span><br><span class=\"line\">                <span class=\"comment\">#print (np.unique(pred))  </span></span><br><span class=\"line\">                pred = pred.reshape((<span class=\"number\">512</span>,<span class=\"number\">512</span>)).astype(np.uint8)</span><br><span class=\"line\">                <span class=\"comment\">#print &#x27;pred:&#x27;,pred.shape</span></span><br><span class=\"line\">                mask_whole[i*stride:i*stride+image_size,j*stride:j*stride+image_size] = pred[:,:]</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        cv2.imwrite(<span class=\"string\">&#x27;pre&#x27;</span>+<span class=\"built_in\">str</span>(n+<span class=\"number\">1</span>)+<span class=\"string\">&#x27;.png&#x27;</span>,mask_whole[<span class=\"number\">0</span>:h,<span class=\"number\">0</span>:w])</span><br></pre></td></tr></table></figure>\n<h3 id=\"ç”Ÿæˆé¢„æµ‹ç»“æœ\"><a href=\"#ç”Ÿæˆé¢„æµ‹ç»“æœ\" class=\"headerlink\" title=\"ç”Ÿæˆé¢„æµ‹ç»“æœ\"></a>ç”Ÿæˆé¢„æµ‹ç»“æœ</h3><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> keras <span class=\"keyword\">import</span> backend <span class=\"keyword\">as</span> K</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># K.set_image_dim_ordering(&#x27;th&#x27;)#trick</span></span><br><span class=\"line\">predict()</span><br></pre></td></tr></table></figure>\n<h3 id=\"å›¾åƒåˆ†å‰²ç»“æœå¯è§†åŒ–\"><a href=\"#å›¾åƒåˆ†å‰²ç»“æœå¯è§†åŒ–\" class=\"headerlink\" title=\"å›¾åƒåˆ†å‰²ç»“æœå¯è§†åŒ–\"></a>å›¾åƒåˆ†å‰²ç»“æœå¯è§†åŒ–</h3><p>åŠ è½½åŸå§‹å›¾åƒ</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">img_org = cv2.imread(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/test.png&#x27;</span>, cv2.IMREAD_GRAYSCALE)</span><br><span class=\"line\">plt.imshow(img_org)</span><br><span class=\"line\">plt.savefig(<span class=\"string\">&#x27;img_org.png&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-10.png?raw=true\" alt=\"alt text\"><br>é¢„æµ‹ç»“æœå¯è§†åŒ–</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># åŠ è½½æ¨¡å‹é¢„æµ‹ç»“æœ</span></span><br><span class=\"line\">img_label = cv2.imread(<span class=\"string\">&#x27;/root/data/Lab4/Lab4-data/pre1.png&#x27;</span>, cv2.IMREAD_GRAYSCALE)</span><br><span class=\"line\"><span class=\"comment\"># åƒç´ æ”¾å¤§</span></span><br><span class=\"line\">img_label*=<span class=\"number\">30</span></span><br><span class=\"line\">plt.imshow(img_label)</span><br><span class=\"line\">plt.savefig(<span class=\"string\">&#x27;img_label.png&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-11.png?raw=true\" alt=\"alt text\"></p>\n<p>åˆå¹¶æ¨¡å‹ç»“æœä¸åŸå§‹å›¾åƒï¼Œå¯ä»¥çœ‹åˆ°æ¨¡å‹æ¯”è¾ƒæˆåŠŸåœ°å°†æ¤è¢«ä¸èƒŒæ™¯ç¯å¢ƒåˆ†å‰²å¼€æ¥ï¼ŒåŸºæœ¬è¾¾åˆ°äº†é¢„æœŸæ•ˆæœã€‚</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">img_show = cv2.addWeighted(img_org, <span class=\"number\">0.1</span>, img_label, <span class=\"number\">0.8</span>, <span class=\"number\">0</span>,dtype = cv2.CV_32F) </span><br><span class=\"line\">plt.imshow(img_show)</span><br><span class=\"line\">plt.savefig(<span class=\"string\">&#x27;weight.png&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-12.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒæ€»ç»“\"><a href=\"#å®éªŒæ€»ç»“\" class=\"headerlink\" title=\"å®éªŒæ€»ç»“\"></a>å®éªŒæ€»ç»“</h1><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨unetä¸­é™¤æœ€åä¸€ä¸ªå±‚æ¿€æ´»å‡½æ•°ä¸ºsigmoidï¼Œå…¶ä½™å‡ä¸ºreluï¼Œè€Œé»˜è®¤çš„åˆå§‹åŒ–æ–¹æ³•ä¸ºXavieråˆå§‹åŒ–ï¼Œæ˜¾ç„¶ä¸æ»¡è¶³ç¥ç»å…ƒæ¿€æ´»å‡å€¼ä¸º0çš„å‡è®¾ï¼Œè€Œunet_newçš„æ¿€æ´»å‡½æ•°å‡ä¸ºreluï¼Œé‡‡ç”¨äº†Heåˆå§‹åŒ–</p>\n<p>Uneté‡‡ç”¨çš„æ˜¯2*2æœ€å¤§æ± åŒ–ï¼Œå¯¹é‚»åŸŸå†…ç‰¹å¾ç‚¹å–æœ€å¤§ã€‚</p>\n<p>æ­£å‘ä¼ æ’­ï¼šå–é‚»åŸŸå†…æœ€å¤§ï¼Œå¹¶è®°ä½æœ€å¤§å€¼çš„ç´¢å¼•ä½ç½®ã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-14.png?raw=true\" alt=\"alt text\"></p>\n<p>åå‘ä¼ æ’­ï¼šå°†ç‰¹å¾å€¼å¡«å……åˆ°æ­£å‘ä¼ æ’­ä¸­å€¼æœ€å¤§çš„ç´¢å¼•ä½ç½®ï¼Œå…¶ä»–ä½ç½®è¡¥0</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-15.png?raw=true\" alt=\"alt text\"></p>\n<p>unet_newé‡‡ç”¨çš„æ˜¯2*2çš„å¹³å‡æ± åŒ–ï¼Œé‚»åŸŸå†…ç‰¹å¾ç‚¹åªæ±‚å¹³å‡ã€‚</p>\n<p>æ­£å‘ä¼ æ’­ï¼šé‚»åŸŸå†…å–å¹³å‡ã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-16.png?raw=true\" alt=\"alt text\"></p>\n<p>åå‘ä¼ æ’­ï¼šç‰¹å¾å€¼æ ¹æ®é‚»åŸŸå¤§å°è¢«å¹³å‡ï¼Œç„¶åä¼ ç»™æ¯ä¸ªç´¢å¼•ä½ç½®ã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-17.png?raw=true\" alt=\"alt text\"></p>\n<p>unet_newè¿˜é‡‡ç”¨äº†drop-outï¼Œå¯¹äºä¸€æ¬¡è¿­ä»£ä¸­çš„æŸä¸€å±‚ç¥ç»ç½‘ç»œï¼Œå…ˆéšæœºé€‰æ‹©ä¸­çš„ä¸€äº›ç¥ç»å…ƒå¹¶å°†å…¶ä¸´æ—¶éšè—(ä¸¢å¼ƒ)ï¼Œç„¶åå†è¿›è¡Œæœ¬æ¬¡è®­ç»ƒå’Œä¼˜åŒ–ã€‚åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œç»§ç»­éšæœºéšè—ä¸€äº›ç¥ç»å…ƒï¼Œå¦‚æ­¤ç›´è‡³è®­ç»ƒç»“æŸã€‚ç”±äºæ˜¯éšæœºä¸¢å¼ƒï¼Œæ•…è€Œæ¯ä¸€ä¸ªmini-batchéƒ½åœ¨è®­ç»ƒä¸åŒçš„ç½‘ç»œï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿‡æ‹Ÿåˆã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/ml-18.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"Xavieråˆå§‹åŒ–\"><a href=\"#Xavieråˆå§‹åŒ–\" class=\"headerlink\" title=\"Xavieråˆå§‹åŒ–\"></a>Xavieråˆå§‹åŒ–</h2><p>Xavieråˆå§‹åŒ–ï¼Œç”±Xavier Glorot åœ¨2010å¹´çš„è®ºæ–‡ Understanding the difficulty of training deep feedforward neural networks æå‡ºã€‚ä¸ºäº†é¿å…æ¢¯åº¦çˆ†ç‚¸æˆ–è€…æ¢¯åº¦æ¶ˆå¤±ï¼Œæœ‰ä¸¤ä¸ªç»éªŒæ€§çš„å‡†åˆ™:</p>\n<ol>\n<li>æ¯ä¸€å±‚ç¥ç»å…ƒæ¿€æ´»å€¼çš„å‡å€¼è¦ä¿æŒä¸º 0</li>\n<li>æ¯ä¸€å±‚æ¿€æ´»çš„æ–¹å·®åº”è¯¥ä¿æŒä¸å˜ã€‚</li>\n</ol>\n<p>åœ¨æ­£å‘ä¼ æ’­æ—¶ï¼Œæ¯å±‚çš„æ¿€æ´»å€¼çš„æ–¹å·®ä¿æŒä¸å˜ï¼›åœ¨åå‘ä¼ æ’­æ—¶ï¼Œæ¯å±‚çš„æ¢¯åº¦å€¼çš„æ–¹å·®ä¿æŒä¸å˜ã€‚<br>åŸºäºä¸Šè¿°çš„å‡†åˆ™ï¼Œåˆå§‹çš„æƒå€¼å‚æ•° $W^l$ ( $l$ ä¸ºç½‘ç»œçš„ç¬¬ $l$ å±‚) è¦ç¬¦åˆä»¥ä¸‹å…¬å¼<br>$$<br>\\begin{aligned}<br>W^{[l]} &amp; \\sim \\mathcal{N}\\left(\\mu&#x3D;0, \\sigma^2&#x3D;\\frac{1}{n^{[l-1]}}\\right) \\<br>b^{[l]} &amp; &#x3D;0<br>\\end{aligned}<br>$$</p>\n<p>å…¶ä¸­ $n^{n-1}$ æ˜¯ç¬¬ $l-1$ å±‚çš„ç¥ç»å…ƒçš„ä¸ªæ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåˆå§‹çš„æƒå€¼ $w$ å¯ä»¥ä»å‡å€¼ $\\mu&#x3D;0$ ï¼Œæ–¹å·®ä¸º $\\sigma^2&#x3D;\\frac{1}{n^{l-1}}$ çš„æ­£æ€åˆ†å¸ƒ $\\mathrm{Q}$ ä¸­éšæœºé€‰å–ã€‚</p>\n<h2 id=\"Heåˆå§‹åŒ–-MSRA\"><a href=\"#Heåˆå§‹åŒ–-MSRA\" class=\"headerlink\" title=\"Heåˆå§‹åŒ– (MSRA)\"></a>Heåˆå§‹åŒ– (MSRA)</h2><p>ç”± Kaiming åœ¨è®ºæ–‡Delving Deep into Rectifiers: Surpassing Human-Level Performance on ImageNet Classificationæå‡ºï¼Œç”±äºXavierçš„å‡è®¾æ¡ä»¶æ˜¯æ¿€æ´»å‡½æ•°æ˜¯å…³äº0å¯¹ç§°çš„ï¼Œè€Œå¸¸ç”¨çš„ReLUæ¿€æ´»å‡½æ•°å¹¶ä¸èƒ½æ»¡è¶³è¯¥æ¡ä»¶ã€‚</p>\n<p>åªè€ƒè™‘è¾“å…¥çš„ä¸ªæ•°ï¼ŒMSRAçš„åˆå§‹åŒ–æ˜¯ä¸€ä¸ªå‡å€¼ä¸º 0 ï¼Œæ–¹å·®ä¸º $\\sqrt{\\frac{2}{F_{\\text {in }}}}$ çš„é«˜æ–¯åˆ†å¸ƒ<br>$$<br>w \\sim G\\left[0, \\sqrt{\\frac{2}{F_{i n}}}\\right]<br>$$</p>\n","categories":["Machine Learning"]},{"title":"ç¥ç»ç½‘ç»œå®éªŒ","url":"/2023/11/27/mllab2/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ol>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡æ„ŸçŸ¥æœºç¥ç»ç½‘ç»œ</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•</li>\n<li>   äº†è§£å’ŒæŒæ¡ç¬¬ä¸‰æ–¹æœºå™¨å­¦ä¹ åº“Scikit-learnä¸­çš„æ¨¡å‹è°ƒç”¨</li>\n</ol>\n<h1 id=\"å®éªŒè¦æ±‚\"><a href=\"#å®éªŒè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒè¦æ±‚\"></a>å®éªŒè¦æ±‚</h1><ol>\n<li>   é‡‡ç”¨Pythonã€Matlabç­‰é«˜çº§è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œæ¨èä¼˜å…ˆé€‰ç”¨Pythonè¯­è¨€</li>\n<li>   æ ¸å¿ƒæ¨¡å‹å’Œç®—æ³•éœ€è‡ªä¸»ç¼–ç¨‹å®ç°ï¼Œä¸å¾—ç›´æ¥è°ƒç”¨Scikit-learnã€PyTorchç­‰æˆç†Ÿæ¡†æ¶çš„ç¬¬ä¸‰æ–¹å®ç°ï¼ˆé™¤éå®éªŒå†…å®¹æ˜ç¡®æŒ‡å®šè°ƒç”¨ï¼‰</li>\n<li>   ä»£ç å¯è¯»æ€§å¼ºï¼šå˜é‡ã€å‡½æ•°ã€ç±»ç­‰å‘½åå¯è¯»æ€§å¼ºï¼ŒåŒ…å«å¿…è¦çš„æ³¨é‡Š</li>\n</ol>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†<span id=\"more\"></span></h1><p>æ„ŸçŸ¥æœºï¼ˆperceptronï¼‰æ˜¯äºŒåˆ†ç±»çš„çº¿æ€§åˆ†ç±»æ¨¡å‹ï¼Œå±äºç›‘ç£å­¦ä¹ ç®—æ³•ã€‚è¾“å…¥ä¸ºå®ä¾‹çš„ç‰¹å¾å‘é‡ï¼Œè¾“å‡ºä¸ºå®ä¾‹çš„ç±»åˆ«ï¼ˆå–+1å’Œ-1ï¼‰ã€‚æ„ŸçŸ¥æœºæ—¨åœ¨æ±‚å‡ºå°†è¾“å…¥ç©ºé—´ä¸­çš„å®ä¾‹åˆ’åˆ†ä¸ºä¸¤ç±»çš„åˆ†ç¦»è¶…å¹³é¢ã€‚ä¸ºæ±‚å¾—è¶…å¹³é¢ï¼Œæ„ŸçŸ¥æœºå¯¼å…¥äº†åŸºäºè¯¯åˆ†ç±»çš„æŸå¤±å‡½æ•°ï¼Œåˆ©ç”¨æ¢¯åº¦ä¸‹é™æ³•å¯¹æŸå¤±å‡½æ•°è¿›è¡Œæœ€ä¼˜åŒ–æ±‚è§£ã€‚</p>\n<p>å¦‚æœè®­ç»ƒæ•°æ®é›†æ˜¯çº¿æ€§å¯åˆ†çš„ï¼Œåˆ™æ„ŸçŸ¥æœºä¸€å®šèƒ½æ±‚å¾—åˆ†ç¦»è¶…å¹³é¢ã€‚å¦‚æœæ˜¯éçº¿æ€§å¯åˆ†çš„æ•°æ®ï¼Œåˆ™æ— æ³•è·å¾—è¶…å¹³é¢ã€‚</p>\n<p>æ„ŸçŸ¥æœºå…·æœ‰ç®€å•è€Œæ˜“äºå®ç°çš„ä¼˜ç‚¹ï¼Œåˆ†ä¸ºåŸå§‹å½¢å¼å’Œå¯¹å¶å½¢å¼ã€‚æ„ŸçŸ¥æœºé¢„æµ‹æ˜¯ç”¨å­¦ä¹ å¾—åˆ°çš„æ„ŸçŸ¥æœºæ¨¡å‹å¯¹æ–°çš„å®ä¾‹è¿›è¡Œé¢„æµ‹çš„ï¼Œå› æ­¤å±äºåˆ¤åˆ«æ¨¡å‹ã€‚æ„ŸçŸ¥æœºæ˜¯ç¥ç»ç½‘ç»œå’Œæ”¯æŒå‘é‡æœºçš„åŸºç¡€ã€‚</p>\n<p>äºŒåˆ†ç±»æ¨¡å‹: $f(x)&#x3D;\\operatorname{sign}(w * x+b)$</p>\n<p>æŸå¤±å‡½æ•°: $L(w, b)&#x3D;-\\Sigma y_i(w *+b)$<br>ç®—æ³•: </p>\n<p>éšå³æ¢¯åº¦ä¸‹é™æ³• Stochastic Gradient Descent </p>\n<p>éšæœºæŠ½å–ä¸€ä¸ªè¯¯åˆ†ç±»ç‚¹ä½¿å…¶æ¢¯åº¦ä¸‹é™ã€‚</p>\n<p>$w&#x3D;w+\\eta y i x i$</p>\n<p>$b&#x3D;b+\\eta y i$</p>\n<p>å½“å®ä¾‹ç‚¹è¢«è¯¯åˆ†ç±», å³ä½äºåˆ†ç¦»è¶…å¹³é¢çš„é”™è¯¯ä¾§, åˆ™è°ƒæ•´ $\\mathrm{w}, \\mathrm{b}$ çš„å€¼, ä½¿åˆ†ç¦»è¶…å¹³é¢å‘è¯¥æ— åˆ†ç±»ç‚¹çš„ä¸€ä¸€ä¾§ç§»åŠ¨ï¼Œç›´ è‡³è¯¯åˆ†ç±»ç‚¹è¢«æ­£ç¡®åˆ†ç±»æ‹¿å‡º iris æ•°æ®é›†ä¸­ä¸¤ä¸ªåˆ†ç±»çš„æ•°æ®å’Œ[sepal length, sepal width]ä½œä¸ºç‰¹å¾</p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"æ„ŸçŸ¥æœºç¥ç»ç½‘ç»œåˆ†ç±»\"><a href=\"#æ„ŸçŸ¥æœºç¥ç»ç½‘ç»œåˆ†ç±»\" class=\"headerlink\" title=\"æ„ŸçŸ¥æœºç¥ç»ç½‘ç»œåˆ†ç±»\"></a>æ„ŸçŸ¥æœºç¥ç»ç½‘ç»œåˆ†ç±»</h2><ol>\n<li>   ä»irisæ•°æ®é›†ä¸­å–å‡º[sepal lengthï¼Œsepal width]ä¸¤ä¸ªå±æ€§ä½œä¸ºæ ·æœ¬ç‰¹å¾ï¼Œä¿æŒç±»åˆ«æ ‡è®°ä¸å˜ï¼Œè®­ç»ƒå•éšå±‚æ„ŸçŸ¥æœºç½‘ç»œè¿›è¡ŒäºŒåˆ†ç±»å®éªŒã€‚æ³¨æ„å–å‰100ä¸ªæ ·æœ¬ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™çš„50ä¸ªæ ·æœ¬ä½œä¸ºæµ‹è¯•é›†ã€‚<ul>\n<li>Irisæ•°æ®é›†ä»‹ç»è¯¦è§ï¼š<a href=\"https://archive.ics.uci.edu/dataset/53/iris\">https://archive.ics.uci.edu/dataset/53/iris</a></li>\n<li>Scikit-learnåº“ä¸­é¢„è£…äº†Irisæ•°æ®é›†ï¼Œå®‰è£…åº“åé‡‡ç”¨ â€œfrom sklearn.datasets import load_irisâ€ å¯ä»¥ç›´æ¥è¯»å–ï¼Œå‚è€ƒ<a href=\"https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_iris.html\">https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_iris.html</a></li>\n</ul>\n</li>\n<li>   å€ŸåŠ©matplotlib ç”»å‡ºåŸå§‹è®­ç»ƒæ•°æ®åˆ†å¸ƒçš„æ•£ç‚¹å›¾ï¼ˆx&#x3D;â€œsepal lengthâ€ï¼Œy&#x3D;â€œsepal widthâ€ï¼Œç‚¹çš„é¢œè‰²ä»£è¡¨ä¸åŒç±»åˆ«ï¼‰</li>\n<li>æŒ‰ç…§ä¸‹è¿°æ¨¡å‹å’Œä¼˜åŒ–ç›®æ ‡, æ„é€ æ„ŸçŸ¥æœºæ¨¡å‹å’ŒæŸå¤±å‡½æ•°ï¼š<ul>\n<li>æ¨¡å‹: $f(x)&#x3D;\\operatorname{sign}(w \\cdot x+b)$</li>\n<li>ä¼˜åŒ–ç›®æ ‡: $\\min <em>{w, b} L(w, b)&#x3D;-\\sum</em>{x_i \\in M} y_i\\left(w \\cdot x_i+b\\right)$</li>\n</ul>\n</li>\n<li>   ç¼–å†™é€‚ç”¨äºæ„ŸçŸ¥æœºçš„éšæœºæ¢¯åº¦ä¸‹é™ç®—æ³•ï¼ˆStochastic Gradient Descentï¼ŒSGDï¼‰ï¼Œå¯¹å•éšå±‚çš„æ„ŸçŸ¥æœºè¿›è¡Œæ¢¯åº¦ä¸‹é™<ul>\n<li>æ­¤æ•°æ®é›†çº¿æ€§å¯åˆ†ï¼Œå¯ä»¥è®¾ç½®è¿­ä»£çš„åœæ­¢æ¡ä»¶ä¸ºâ€œç›´åˆ°è®­ç»ƒé›†å†…æ²¡æœ‰è¯¯åˆ†ç±»æ ·æœ¬ä¸ºæ­¢â€</li>\n<li>å­¦ä¹ ç‡è®¾ç½®ä¸º0.1, åç½®åˆå§‹åŒ–0ï¼Œæƒé‡å‡åˆå§‹åŒ–ä¸º1</li>\n<li>SGD æ›´æ–°:<br>$$<br>\\begin{aligned}<br>&amp; w&#x3D;w+\\eta y_i x_i \\\\<br>&amp; b&#x3D;b+\\eta y_i<br>\\end{aligned}<br>$$<br>ç»“æœå±•ç¤º</li>\n</ul>\n</li>\n</ol>\n<ul>\n<li>å°†æ¨¡å‹æ‹Ÿåˆçš„åˆ†ç±»è¾¹ç•Œä¸ä¸Šè¿°åŸå§‹æ•°æ®ç‚¹ç”»åˆ°åŒä¸€å›¾ä¸­ï¼Œè§‚å¯Ÿè®­ç»ƒæ•ˆæœ</li>\n<li>ç”¨è®­ç»ƒçš„æ¨¡å‹å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œå¾—åˆ°æµ‹è¯•é”™è¯¯ç‡</li>\n<li>å°†æ¨¡å‹æ‹Ÿåˆçš„åˆ†ç±»è¾¹ç•Œä¸æµ‹è¯•æ•°æ®ç‚¹ç”»åˆ°åŒä¸€å›¾ä¸­ï¼Œè§‚å¯Ÿæ•ˆæœ</li>\n</ul>\n<h2 id=\"ç¥ç»ç½‘ç»œè°ƒå‚\"><a href=\"#ç¥ç»ç½‘ç»œè°ƒå‚\" class=\"headerlink\" title=\"ç¥ç»ç½‘ç»œè°ƒå‚\"></a>ç¥ç»ç½‘ç»œè°ƒå‚</h2><p>è°ƒæ•´å­¦ä¹ ç‡å‚æ•°å–å€¼åˆ†åˆ«ä¸º[0.01, 0.05, 0.1, 0.5]è¿è¡Œæ¨¡å‹ï¼Œæ¯”è¾ƒæ¨¡å‹æœ€åçš„æµ‹è¯•æ­£ç¡®ç‡ä»¥åŠæ¨¡å‹æ”¶æ•›æ‰€éœ€è¦çš„è®­ç»ƒè½®æ•°ï¼ˆepochï¼‰æ•°ã€‚</p>\n<h2 id=\"Sciki-learnæœºå™¨å­¦ä¹ åº“çš„è°ƒç”¨\"><a href=\"#Sciki-learnæœºå™¨å­¦ä¹ åº“çš„è°ƒç”¨\" class=\"headerlink\" title=\"Sciki-learnæœºå™¨å­¦ä¹ åº“çš„è°ƒç”¨\"></a>Sciki-learnæœºå™¨å­¦ä¹ åº“çš„è°ƒç”¨</h2><ol>\n<li>   ç›´æ¥è°ƒç”¨æœºå™¨å­¦ä¹ åº“Scikit-learnä¸­æ„ŸçŸ¥æœºæ¨¡å‹ï¼ˆ<a href=\"https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Perceptron.html\">https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Perceptron.html</a> ï¼‰ï¼Œç”¨ä¸Šè¿°è®­ç»ƒå’Œæµ‹è¯•é›†è®­ç»ƒè¿›è¡Œè®­ç»ƒï¼Œ é‡‡ç”¨ä¸Šè¿°ç±»ä¼¼çš„æ–¹æ³•å¯è§†åŒ–è®­ç»ƒé›†å’ŒéªŒè¯é›†ä¸Šæ¨¡å‹çš„åˆ†ç±»ç»“æœã€‚ï¼ˆè°ƒç”¨æ—¶ä¿æŒæ¨¡å‹è¶…å‚æ•°tolçš„å–å€¼ä¸ºé»˜è®¤å€¼0.001ï¼‰</li>\n<li>   æ¯”è¾ƒè‡ªå·±å®ç°çš„æ¨¡å‹å’Œè°ƒç”¨çš„Scikit-learnä¸­æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„å¯è§†åŒ–ç»“æœå›¾ï¼Œè§‚å¯Ÿæœ‰ä½•ä¸åŒï¼Œåˆ†æäº§ç”Ÿä¸åŒçš„åŸå› ã€‚</li>\n</ol>\n<h1 id=\"å®éªŒä»£ç å’Œç»“æœ\"><a href=\"#å®éªŒä»£ç å’Œç»“æœ\" class=\"headerlink\" title=\"å®éªŒä»£ç å’Œç»“æœ\"></a>å®éªŒä»£ç å’Œç»“æœ</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> load_iris</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Model</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self</span>):</span><br><span class=\"line\">        self.w = np.ones(<span class=\"built_in\">len</span>(data[<span class=\"number\">0</span>]) - <span class=\"number\">1</span>, dtype=np.float32)</span><br><span class=\"line\">        self.b = <span class=\"number\">0</span>  <span class=\"comment\"># åˆå§‹w/bçš„å€¼</span></span><br><span class=\"line\">        self.epoch=<span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">sign</span>(<span class=\"params\">self, x, w, b</span>):</span><br><span class=\"line\">        y = np.dot(x, w) + b  <span class=\"comment\"># æ±‚wï¼Œbçš„å€¼</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> y</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># éšæœºæ¢¯åº¦ä¸‹é™æ³•</span></span><br><span class=\"line\">    <span class=\"comment\"># éšæœºæ¢¯åº¦ä¸‹é™æ³•ï¼ˆSGDï¼‰ï¼ŒéšæœºæŠ½å–ä¸€ä¸ªè¯¯åˆ†ç±»ç‚¹ä½¿å…¶æ¢¯åº¦ä¸‹é™ã€‚æ ¹æ®æŸå¤±å‡½æ•°çš„æ¢¯åº¦ï¼Œå¯¹wï¼Œbè¿›è¡Œæ›´æ–°</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">fit</span>(<span class=\"params\">self, X_train, y_train,lr</span>):  <span class=\"comment\"># å°†å‚æ•°æ‹Ÿåˆ X_trainæ•°æ®é›†çŸ©é˜µ y_trainç‰¹å¾å‘é‡</span></span><br><span class=\"line\">        is_wrong = <span class=\"literal\">False</span></span><br><span class=\"line\">        <span class=\"comment\"># è¯¯åˆ†ç±»ç‚¹çš„æ„æ€å°±æ˜¯å¼€å§‹çš„æ—¶å€™ï¼Œè¶…å¹³é¢å¹¶æ²¡æœ‰æ­£ç¡®åˆ’åˆ†ï¼Œåšäº†é”™è¯¯åˆ†ç±»çš„æ•°æ®ã€‚</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> <span class=\"keyword\">not</span> is_wrong:</span><br><span class=\"line\">            self.epoch +=<span class=\"number\">1</span>;</span><br><span class=\"line\">            wrong_count = <span class=\"number\">0</span>  <span class=\"comment\"># è¯¯åˆ†ä¸º0ï¼Œå°±ä¸ç”¨å¾ªç¯ï¼Œå¾—åˆ°wï¼Œb</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> d <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(X_train)):</span><br><span class=\"line\">                X = X_train[d]</span><br><span class=\"line\">                y = y_train[d]</span><br><span class=\"line\">                <span class=\"keyword\">if</span> y * self.sign(X, self.w, self.b) &lt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                    <span class=\"comment\"># å¦‚æœæŸä¸ªæ ·æœ¬å‡ºç°åˆ†ç±»é”™è¯¯ï¼Œå³ä½äºåˆ†ç¦»è¶…å¹³é¢çš„é”™è¯¯ä¾§ï¼Œåˆ™è°ƒæ•´å‚æ•°ï¼Œä½¿åˆ†ç¦»è¶…å¹³é¢å¼€å§‹ç§»åŠ¨ï¼Œç›´è‡³è¯¯åˆ†ç±»ç‚¹è¢«æ­£ç¡®åˆ†ç±»ã€‚</span></span><br><span class=\"line\">                    self.w = self.w + lr * np.dot(y, X)  <span class=\"comment\"># è°ƒæ•´wå’Œb</span></span><br><span class=\"line\">                    self.b = self.b + lr * y</span><br><span class=\"line\">                    wrong_count += <span class=\"number\">1</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> wrong_count == <span class=\"number\">0</span>:</span><br><span class=\"line\">                is_wrong = <span class=\"literal\">True</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;Perceptron Model!&#x27;</span></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">test</span>(<span class=\"params\">self,X_test,y_test</span>):</span><br><span class=\"line\">        <span class=\"built_in\">all</span>=<span class=\"built_in\">len</span>(X_test)</span><br><span class=\"line\">        error=<span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> d <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">all</span>):</span><br><span class=\"line\">            X=X_test[d]</span><br><span class=\"line\">            y=y_test[d]</span><br><span class=\"line\">            <span class=\"keyword\">if</span> y * self.sign(X, self.w, self.b) &lt;= <span class=\"number\">0</span>:</span><br><span class=\"line\">                error+=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span>(error/<span class=\"built_in\">all</span>)</span><br><span class=\"line\">iris = load_iris()</span><br><span class=\"line\">df = pd.DataFrame(iris.data, columns=iris.feature_names) </span><br><span class=\"line\">df[<span class=\"string\">&#x27;label&#x27;</span>] = iris.target</span><br><span class=\"line\">df.columns = [<span class=\"string\">&#x27;sepal length&#x27;</span>, <span class=\"string\">&#x27;sepal width&#x27;</span>, <span class=\"string\">&#x27;petal length&#x27;</span>, <span class=\"string\">&#x27;petal width&#x27;</span>, <span class=\"string\">&#x27;label&#x27;</span>]</span><br><span class=\"line\">first_40_rows = df.head(<span class=\"number\">40</span>)</span><br><span class=\"line\">rows_50_to_90 = df[<span class=\"number\">50</span>:<span class=\"number\">90</span>]</span><br><span class=\"line\">dt = pd.concat([first_40_rows, rows_50_to_90])</span><br><span class=\"line\">data = np.array(dt.iloc[:<span class=\"number\">90</span>, [<span class=\"number\">0</span>, <span class=\"number\">1</span>, -<span class=\"number\">1</span>]])</span><br><span class=\"line\">test1=df[<span class=\"number\">40</span>:<span class=\"number\">50</span>]</span><br><span class=\"line\">test2=df[<span class=\"number\">90</span>:<span class=\"number\">100</span>]</span><br><span class=\"line\">test=pd.concat([test1,test1])</span><br><span class=\"line\">test=np.array(test.iloc[:<span class=\"number\">100</span>, [<span class=\"number\">0</span>, <span class=\"number\">1</span>, -<span class=\"number\">1</span>]])</span><br><span class=\"line\">TX, Ty = test[:,:-<span class=\"number\">1</span>], test[:,-<span class=\"number\">1</span>]</span><br><span class=\"line\">Ty = np.array([<span class=\"number\">1</span> <span class=\"keyword\">if</span> i == <span class=\"number\">1</span> <span class=\"keyword\">else</span> -<span class=\"number\">1</span> <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> Ty])</span><br><span class=\"line\"><span class=\"comment\">#print(len(Ty))</span></span><br><span class=\"line\"><span class=\"comment\">#print(data)</span></span><br><span class=\"line\">plt.scatter(df[:<span class=\"number\">40</span>][<span class=\"string\">&#x27;sepal length&#x27;</span>], df[:<span class=\"number\">40</span>][<span class=\"string\">&#x27;sepal width&#x27;</span>], label=<span class=\"string\">&#x27;0&#x27;</span>) </span><br><span class=\"line\">plt.scatter(df[<span class=\"number\">50</span>:<span class=\"number\">90</span>][<span class=\"string\">&#x27;sepal length&#x27;</span>], df[<span class=\"number\">50</span>:<span class=\"number\">90</span>][<span class=\"string\">&#x27;sepal width&#x27;</span>], label=<span class=\"string\">&#x27;1&#x27;</span>) </span><br><span class=\"line\">plt.xlabel(<span class=\"string\">&#x27;sepal length&#x27;</span>)<span class=\"comment\">#ç»™xåæ ‡å‘½å</span></span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&#x27;sepal width&#x27;</span>)<span class=\"comment\">#ç»™yåæ ‡å‘½å</span></span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.title(<span class=\"string\">&quot;train&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">X, y = data[:,:-<span class=\"number\">1</span>], data[:,-<span class=\"number\">1</span>]</span><br><span class=\"line\">y = np.array([<span class=\"number\">1</span> <span class=\"keyword\">if</span> i == <span class=\"number\">1</span> <span class=\"keyword\">else</span> -<span class=\"number\">1</span> <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> y])</span><br><span class=\"line\"></span><br><span class=\"line\">perceptron = Model()</span><br><span class=\"line\">perceptron.fit(X, y,<span class=\"number\">0.1</span>)</span><br><span class=\"line\">x_points = np.linspace(<span class=\"number\">4</span>, <span class=\"number\">7</span>,<span class=\"number\">10</span>)</span><br><span class=\"line\">y_ = -(perceptron.w[<span class=\"number\">0</span>]*x_points + perceptron.b)/perceptron.w[<span class=\"number\">1</span>]</span><br><span class=\"line\">plt.plot(x_points, y_)</span><br><span class=\"line\">plt.show()</span><br><span class=\"line\"><span class=\"comment\">#print(perceptron.epoch)</span></span><br><span class=\"line\">er=perceptron.test(TX,Ty)</span><br><span class=\"line\">plt.scatter(df[<span class=\"number\">40</span>:<span class=\"number\">50</span>][<span class=\"string\">&#x27;sepal length&#x27;</span>], df[<span class=\"number\">40</span>:<span class=\"number\">50</span>][<span class=\"string\">&#x27;sepal width&#x27;</span>], label=<span class=\"string\">&#x27;0&#x27;</span>)</span><br><span class=\"line\">plt.scatter(df[<span class=\"number\">90</span>:<span class=\"number\">100</span>][<span class=\"string\">&#x27;sepal length&#x27;</span>], df[<span class=\"number\">90</span>:<span class=\"number\">100</span>][<span class=\"string\">&#x27;sepal width&#x27;</span>], label=<span class=\"string\">&#x27;1&#x27;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.title(<span class=\"string\">&quot;test&quot;</span>)</span><br><span class=\"line\">plt.plot(x_points, y_)</span><br><span class=\"line\"><span class=\"comment\">#plt.show()</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(er)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-3.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-4.png?raw=true\" alt=\"alt text\"></p>\n<p>å­¦ä¹ ç‡ä¸º0.1æ—¶ï¼Œè®­ç»ƒäº†13æ¬¡ï¼Œé”™è¯¯ç‡ä¸º0.1</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-5.png?raw=true\" alt=\"alt text\"></p>\n<p>å­¦ä¹ ç‡ä¸º0.01æ—¶ï¼Œè®­ç»ƒäº†62æ¬¡ï¼Œé”™è¯¯ç‡ä¸º0.1</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-6.png?raw=true\" alt=\"alt text\"></p>\n<p>å­¦ä¹ ç‡ä¸º0.05æ—¶ï¼Œè®­ç»ƒäº†16æ¬¡ï¼Œé”™è¯¯ç‡ä¸º0.1</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-7.png?raw=true\" alt=\"alt text\"></p>\n<p>å­¦ä¹ ç‡ä¸º0. 5æ—¶ï¼Œè®­ç»ƒäº†13æ¬¡ï¼Œé”™è¯¯ç‡ä¸º0.1</p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class=\"number\">0.8</span>, random_state=<span class=\"number\">42</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä½¿ç”¨Scikit-learnä¸­çš„Perceptronæ¨¡å‹è¿›è¡Œè®­ç»ƒ</span></span><br><span class=\"line\">perceptron = Perceptron(tol=<span class=\"number\">0.001</span>)</span><br><span class=\"line\">perceptron.fit(X_train, y_train)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é¢„æµ‹æµ‹è¯•é›†</span></span><br><span class=\"line\">y_pred = perceptron.predict(X_test)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—æµ‹è¯•é›†å‡†ç¡®ç‡</span></span><br><span class=\"line\">accuracy = accuracy_score(y_test, y_pred)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&quot;æµ‹è¯•é›†çš„å‡†ç¡®ç‡: <span class=\"subst\">&#123;accuracy&#125;</span>&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">plt.scatter(X_train[y_train == <span class=\"number\">1</span>][:, <span class=\"number\">0</span>], X_train[y_train == <span class=\"number\">1</span>][:, <span class=\"number\">1</span>], label=<span class=\"string\">&#x27;0&#x27;</span>)</span><br><span class=\"line\">plt.scatter(X_train[y_train == -<span class=\"number\">1</span>][:, <span class=\"number\">0</span>], X_train[y_train == -<span class=\"number\">1</span>][:, <span class=\"number\">1</span>], label=<span class=\"string\">&#x27;1&#x27;</span>)</span><br><span class=\"line\">plt.xlabel(<span class=\"string\">&#x27;sepal length&#x27;</span>)</span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&#x27;sepal width&#x27;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&#x27;Training Set&#x27;</span>)</span><br><span class=\"line\">x_min, x_max = X_train[:, <span class=\"number\">0</span>].<span class=\"built_in\">min</span>() - <span class=\"number\">1</span>, X_train[:, <span class=\"number\">0</span>].<span class=\"built_in\">max</span>() + <span class=\"number\">1</span></span><br><span class=\"line\">x_points = np.linspace(x_min, x_max, <span class=\"number\">10</span>)</span><br><span class=\"line\">y_ = -(perceptron.coef_[<span class=\"number\">0</span>][<span class=\"number\">0</span>] * x_points + perceptron.intercept_) / perceptron.coef_[<span class=\"number\">0</span>][<span class=\"number\">1</span>]</span><br><span class=\"line\">plt.plot(x_points, y_, color=<span class=\"string\">&#x27;blue&#x27;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-8.png?raw=true\" alt=\"alt text\"><br>å‡†ç¡®ç‡ä¸º0.9875</p>\n<p>ç»“æœä¸åŒå¯èƒ½æ˜¯ç”±äºå­¦ä¹ ç‡è®¾ç½®ä¸åŒï¼Œä»¥åŠéšæœºç§å­çš„å·®å¼‚</p>\n<h1 id=\"å°ç»“æˆ–è®¨è®º\"><a href=\"#å°ç»“æˆ–è®¨è®º\" class=\"headerlink\" title=\"å°ç»“æˆ–è®¨è®º\"></a>å°ç»“æˆ–è®¨è®º</h1><p>æ„ŸçŸ¥å™¨æ˜¯äººå·¥ç¥ç»ç½‘ç»œä¸­çš„ä¸€ç§å…¸å‹ç»“æ„ï¼Œ å®ƒçš„ä¸»è¦çš„ç‰¹ç‚¹æ˜¯ç»“æ„ç®€å•ã€‚å®ƒæ˜¯ä¸€ç§åˆ†ç±»å­¦ä¹ å™¨ï¼Œæ˜¯å¾ˆå¤šå¤æ‚ç®—æ³•çš„åŸºç¡€ã€‚å…¶â€œèµç½šæ¦‚å¿µâ€åœ¨æœºå™¨å­¦ä¹ ç®—æ³•åœ¨ä¸­å¹¿ä¸ºåº”ç”¨ã€‚åœ¨åˆ†ç±»æ­£ç¡®æ—¶ï¼Œå¯¹æ­£ç¡®çš„æƒé‡å‘é‡wå¥–èµï¼Œå³wä¸å˜ï¼›å½“åˆ†ç±»é”™è¯¯æ—¶ï¼Œå¯¹æƒé‡å‘é‡æƒ©ç½šï¼Œå³å°†æƒé‡å‘é‡wå‘ç€äº‰å–çš„æ–¹å‘è½¬å˜</p>\n<p>Perceptron ç”± Frank Rosenblatt å‡å‘, å¹¶äº 1962 å¹´å‡ºç‰ˆçš„â€œç¥ç»åŠ¨åŠ›å­¦åŸç†ï¼šæ„ŸçŸ¥å™¨å’Œè„‘æœºåˆ¶ç†è®ºâ€ä¸€æ–‡ä¸­æ‰€æå‡ºã€‚å½“æ—¶, Rosenblatt çš„æ–‡ç« è¢« Marvin Minksy å’Œ Seymour Papert åå¯¹ï¼Œè®¤ä¸ºç¥ç»ç½‘ç»œæœ‰ç¼ºé™·ï¼Œåªèƒ½è§£å†³çº¿æ€§åˆ†ç±»é—®é¢˜ã€‚ç„¶è€Œ, è¿™ç§é™åˆ¶ä»…å‘ç”Ÿåœ¨å•å±‚ç¥ç»ç½‘ç»œä¸­ã€‚Perceptron å¯ç”¨äºè§£å†³äºŒåˆ†ç±»é—®é¢˜ã€‚åœ¨ä¼ ç»Ÿçº¿æ€§å¯åˆ†çš„äºŒåˆ†ç±»æƒ…å†µä¸‹, å¯ä»¥ä½¿ $w^T x&gt;&#x3D;0$ æ—¶åˆ†ç±»ä¸ºæ­£æ ·æœ¬, $w^T x&lt;0$ åˆ†ç±»ä¸ºè´Ÿæ ·æœ¬ã€‚</p>\n<p>ç®—æ³•æ­¥éª¤ä¸ºå¯¹æ‰€æœ‰è´Ÿæ ·æœ¬ä¹˜ä»¥ -1 ä»¥æ–¹ä¾¿ç®—æ³•æµç¨‹, å³ä½¿ $w^T x&gt;&#x3D;0$ æ—¶åˆ¤æ–­ä¸ºåˆ†ç±»æ­£ç¡®ã€‚</p>\n<p>éšæœºç”Ÿæˆåˆå§‹æƒé‡å‘é‡ $w 0$, åœ¨æ¯è½®è¿­ä»£ä¸­, è‹¥æ ·æœ¬ $i$ åˆ†ç±»æ­£ç¡®å³ $w^T x_i&gt;&#x3D;0$ æ—¶,ä¸å¯¹ $w$ è¿›è¡Œä¿®æ”¹; å½“æœ¬è½®è¿­ä»£ä¸­, é’ˆå¯¹æ ·æœ¬ $i$ å‡ºç°åˆ†ç±»é”™è¯¯, å³  $w^T xi&lt;0$ æ—¶, å¯¹æƒé‡å‘é‡ $w$ æƒ©ç½š, ä½¿ä¹‹æœç€æ­£ç¡®çš„è¶‹åŠ¿æ”¹è¿›ã€‚ $\\eta$ ä¸ºå­¦ä¹ ç‡ã€‚å¦‚æœæ— é”™è¯¯åˆ†ç±»ï¼Œåˆ™è¿­ä»£ç»“æŸ</p>\n","categories":["Machine Learning"]},{"title":"æ”¯æŒå‘é‡æœºå®éªŒ","url":"/2023/12/04/mllab3/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ol>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡æ”¯æŒå‘é‡æœº</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡æ ¸å‡½æ•°å¤„ç†éçº¿æ€§æ€§é—®é¢˜</li>\n<li>   äº†è§£å’ŒæŒæ¡ç¬¬ä¸‰æ–¹æœºå™¨å­¦ä¹ åº“Scikit-learnä¸­çš„æ¨¡å‹è°ƒç”¨</li>\n</ol>\n<h1 id=\"å®éªŒè¦æ±‚\"><a href=\"#å®éªŒè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒè¦æ±‚\"></a>å®éªŒè¦æ±‚</h1><ol>\n<li>   é‡‡ç”¨Pythonã€Matlabç­‰é«˜çº§è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œæ¨èä¼˜å…ˆé€‰ç”¨Pythonè¯­è¨€</li>\n<li>   æœ¬æ¬¡å®éªŒå¯ä»¥ç›´æ¥è°ƒç”¨Scikit-learnã€PyTorchç­‰æˆç†Ÿæ¡†æ¶çš„ç¬¬ä¸‰æ–¹å®ç°</li>\n<li>   ä»£ç å¯è¯»æ€§å¼ºï¼šå˜é‡ã€å‡½æ•°ã€ç±»ç­‰å‘½åå¯è¯»æ€§å¼ºï¼ŒåŒ…å«å¿…è¦çš„æ³¨é‡Š</li>\n</ol>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†<span id=\"more\"></span></h1><p>æ”¯æŒå‘é‡æœº(Support Vector Machine)æ˜¯Corteså’ŒVapnikäº1995å¹´é¦–å…ˆæå‡ºçš„ï¼Œå®ƒåœ¨è§£å†³å°æ ·æœ¬ã€éçº¿æ€§åŠé«˜ç»´æ¨¡å¼è¯†åˆ«ä¸­è¡¨ç°å‡ºè®¸å¤šç‰¹æœ‰çš„ä¼˜åŠ¿ï¼Œå¹¶èƒ½å¤Ÿæ¨å¹¿åº”ç”¨åˆ°å‡½æ•°æ‹Ÿåˆç­‰å…¶ä»–æœºå™¨å­¦ä¹ é—®é¢˜ä¸­ã€‚</p>\n<p>å°æ ·æœ¬ï¼Œå¹¶ä¸æ˜¯è¯´æ ·æœ¬çš„ç»å¯¹æ•°é‡å°‘ï¼ˆå®é™…ä¸Šï¼Œå¯¹ä»»ä½•ç®—æ³•æ¥è¯´ï¼Œæ›´å¤šçš„æ ·æœ¬å‡ ä¹æ€»æ˜¯èƒ½å¸¦æ¥æ›´å¥½çš„æ•ˆæœï¼‰ï¼Œè€Œæ˜¯è¯´ä¸é—®é¢˜çš„å¤æ‚åº¦æ¯”èµ·æ¥ï¼ŒSVMç®—æ³•è¦æ±‚çš„æ ·æœ¬æ•°æ˜¯ç›¸å¯¹æ¯”è¾ƒå°‘çš„ã€‚</p>\n<p>éçº¿æ€§ï¼Œæ˜¯æŒ‡SVMæ“…é•¿åº”ä»˜æ ·æœ¬æ•°æ®çº¿æ€§ä¸å¯åˆ†çš„æƒ…å†µï¼Œä¸»è¦é€šè¿‡æ¾å¼›å˜é‡ï¼ˆä¹Ÿæœ‰äººå«æƒ©ç½šå˜é‡ï¼‰å’Œæ ¸å‡½æ•°æŠ€æœ¯æ¥å®ç°ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯SVMçš„ç²¾é«“ï¼Œä»¥åä¼šè¯¦ç»†è®¨è®ºã€‚</p>\n<p>é«˜ç»´æ¨¡å¼è¯†åˆ«æ˜¯æŒ‡æ ·æœ¬ç»´æ•°å¾ˆé«˜ï¼Œä¾‹å¦‚æ–‡æœ¬çš„å‘é‡è¡¨ç¤ºï¼Œå¦‚æœæ²¡æœ‰ç»è¿‡å¦ä¸€ç³»åˆ—æ–‡ç« ï¼ˆã€Šæ–‡æœ¬åˆ†ç±»å…¥é—¨ã€‹ï¼‰ä¸­æåˆ°è¿‡çš„é™ç»´å¤„ç†ï¼Œå‡ºç°å‡ ä¸‡ç»´çš„æƒ…å†µå¾ˆæ­£å¸¸ï¼Œå…¶ä»–ç®—æ³•åŸºæœ¬å°±æ²¡æœ‰èƒ½åŠ›åº”ä»˜äº†ï¼ŒSVMå´å¯ä»¥ï¼Œä¸»è¦æ˜¯å› ä¸ºSVM äº§ç”Ÿçš„åˆ†ç±»å™¨å¾ˆç®€æ´ï¼Œç”¨åˆ°çš„æ ·æœ¬ä¿¡æ¯å¾ˆå°‘ï¼ˆä»…ä»…ç”¨åˆ°é‚£äº›ç§°ä¹‹ä¸ºâ€œæ”¯æŒå‘é‡â€çš„æ ·æœ¬ï¼‰ï¼Œä½¿å¾—å³ä½¿æ ·æœ¬ç»´æ•°å¾ˆé«˜ï¼Œä¹Ÿä¸ä¼šç»™å­˜å‚¨å’Œè®¡ç®—å¸¦æ¥å¤§éº»çƒ¦</p>\n<p>ç›®å‰åœ¨å¼•å…¥SVMæ¦‚è¿°æ—¶ä¸»è¦æœ‰ä¸¤ä¸ªæ–¹å¼ï¼š</p>\n<p>ä¸€æ˜¯ï¼š</p>\n<p>æ”¯æŒå‘é‡æœºæ–¹æ³•æ˜¯å»ºç«‹åœ¨ç»Ÿè®¡å­¦ä¹ ç†è®ºçš„VC ç»´ç†è®ºå’Œç»“æ„é£é™©æœ€å°åŸç†åŸºç¡€ä¸Šçš„ï¼Œæ ¹æ®æœ‰é™çš„æ ·æœ¬ä¿¡æ¯åœ¨æ¨¡å‹çš„å¤æ‚æ€§ï¼ˆå³å¯¹ç‰¹å®šè®­ç»ƒæ ·æœ¬çš„å­¦ä¹ ç²¾åº¦ï¼ŒAccuracyï¼‰å’Œå­¦ä¹ èƒ½åŠ›ï¼ˆå³æ— é”™è¯¯åœ°è¯†åˆ«ä»»æ„æ ·æœ¬çš„èƒ½åŠ›ï¼‰ä¹‹é—´å¯»æ±‚æœ€ä½³æŠ˜è¡·ï¼Œä»¥æœŸè·å¾—æœ€å¥½çš„æ¨å¹¿èƒ½åŠ›ï¼ˆæˆ–ç§°æ³›åŒ–èƒ½åŠ›ï¼‰ã€‚</p>\n<p>æ‰€è°“VCç»´æ˜¯å¯¹å‡½æ•°ç±»çš„ä¸€ç§åº¦é‡ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºé—®é¢˜çš„å¤æ‚ç¨‹åº¦ï¼ŒVCç»´è¶Šé«˜ï¼Œä¸€ä¸ªé—®é¢˜å°±è¶Šå¤æ‚ã€‚æ­£æ˜¯å› ä¸ºSVMå…³æ³¨çš„æ˜¯VCç»´ï¼Œåé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒSVMè§£å†³é—®é¢˜çš„æ—¶å€™ï¼Œå’Œæ ·æœ¬çš„ç»´æ•°æ˜¯æ— å…³çš„ï¼ˆç”šè‡³æ ·æœ¬æ˜¯ä¸Šä¸‡ç»´çš„éƒ½å¯ä»¥ï¼Œè¿™ä½¿å¾—SVMå¾ˆé€‚åˆç”¨æ¥è§£å†³æ–‡æœ¬åˆ†ç±»çš„é—®é¢˜ï¼Œå½“ç„¶ï¼Œæœ‰è¿™æ ·çš„èƒ½åŠ›ä¹Ÿå› ä¸ºå¼•å…¥äº†æ ¸å‡½æ•°ï¼‰ã€‚</p>\n<p>ç»“æ„é£é™©æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæœºå™¨å­¦ä¹ æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§å¯¹é—®é¢˜çœŸå®æ¨¡å‹çš„é€¼è¿‘ï¼Œä½†æ¯«æ— ç–‘é—®ï¼ŒçœŸå®æ¨¡å‹ä¸€å®šæ˜¯ä¸çŸ¥é“çš„ã€‚æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªå‡è®¾ä¹‹åï¼ŒçœŸå®è¯¯å·®æ— ä»å¾—çŸ¥ï¼Œä½†æˆ‘ä»¬å¯ä»¥ç”¨æŸäº›å¯ä»¥æŒæ¡çš„é‡æ¥é€¼è¿‘å®ƒã€‚æœ€ç›´è§‚çš„æƒ³æ³•å°±æ˜¯ä½¿ç”¨åˆ†ç±»å™¨åœ¨æ ·æœ¬æ•°æ®ä¸Šçš„åˆ†ç±»çš„ç»“æœä¸çœŸå®ç»“æœä¹‹é—´çš„å·®å€¼æ¥è¡¨ç¤ºã€‚è¿™ä¸ªå·®å€¼å«åšç»éªŒé£é™©Remp(w)ã€‚æ­¤æ—¶çš„æƒ…å†µä¾¿æ˜¯é€‰æ‹©äº†ä¸€ä¸ªè¶³å¤Ÿå¤æ‚çš„åˆ†ç±»å‡½æ•°ï¼Œèƒ½å¤Ÿç²¾ç¡®çš„è®°ä½æ¯ä¸€ä¸ªæ ·æœ¬ï¼Œä½†å¯¹æ ·æœ¬ä¹‹å¤–çš„æ•°æ®ä¸€å¾‹åˆ†ç±»é”™è¯¯ã€‚ç»Ÿè®¡å­¦ä¹ å› æ­¤è€Œå¼•å…¥äº†æ³›åŒ–è¯¯å·®ç•Œçš„æ¦‚å¿µï¼Œå°±æ˜¯æŒ‡çœŸå®é£é™©åº”è¯¥ç”±ä¸¤éƒ¨åˆ†å†…å®¹åˆ»ç”»ï¼Œä¸€æ˜¯ç»éªŒé£é™©ï¼Œä»£è¡¨äº†åˆ†ç±»å™¨åœ¨ç»™å®šæ ·æœ¬ä¸Šçš„è¯¯å·®ï¼›äºŒæ˜¯ç½®ä¿¡é£é™©ï¼Œä»£è¡¨äº†æˆ‘ä»¬åœ¨å¤šå¤§ç¨‹åº¦ä¸Šå¯ä»¥ä¿¡ä»»åˆ†ç±»å™¨åœ¨æœªçŸ¥æ•°æ®åˆ†ç±»çš„ç»“æœã€‚å¾ˆæ˜¾ç„¶ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯æ²¡æœ‰åŠæ³•ç²¾ç¡®è®¡ç®—çš„ï¼Œå› æ­¤åªèƒ½ç»™å‡ºä¸€ä¸ªä¼°è®¡çš„åŒºé—´ï¼Œä¹Ÿä½¿å¾—æ•´ä¸ªè¯¯å·®åªèƒ½è®¡ç®—ä¸Šç•Œï¼Œè€Œæ— æ³•è®¡ç®—å‡†ç¡®çš„å€¼ï¼ˆæ‰€ä»¥å«åšæ³›åŒ–è¯¯å·®ç•Œï¼Œè€Œä¸å«æ³›åŒ–è¯¯å·®ï¼‰ã€‚</p>\n<p>ç½®ä¿¡é£é™©ä¸ä¸¤ä¸ªé‡æœ‰å…³ï¼Œä¸€æ˜¯æ ·æœ¬æ•°é‡ï¼Œæ˜¾ç„¶ç»™å®šçš„æ ·æœ¬æ•°é‡è¶Šå¤§ï¼Œæˆ‘ä»¬çš„å­¦ä¹ ç»“æœè¶Šæœ‰å¯èƒ½æ­£ç¡®ï¼Œæ­¤æ—¶ç½®ä¿¡é£é™©è¶Šå°ï¼›äºŒæ˜¯åˆ†ç±»å‡½æ•°çš„VCç»´ï¼Œæ˜¾ç„¶VCç»´è¶Šå¤§ï¼Œæ¨å¹¿èƒ½åŠ›è¶Šå·®ï¼Œç½®ä¿¡é£é™©ä¼šå˜å¤§ã€‚</p>\n<p>æ³›åŒ–è¯¯å·®ç•Œçš„å…¬å¼ä¸º: $\\mathrm{R}(\\mathrm{w}) \\leqslant \\operatorname{Remp}(\\mathrm{w})+\\Phi(\\mathrm{n} &#x2F; \\mathrm{h})$ ã€‚å…¬å¼ä¸­ $\\mathrm{R}(\\mathrm{w})$ å°±æ˜¯çœŸå®é£é™©, $\\operatorname{Remp}(\\mathrm{w})$ å°±æ˜¯ç»éªŒé£é™©, $\\Phi(\\mathrm{n} &#x2F; \\mathrm{h})$ å°±æ˜¯ç½®ä¿¡é£é™©ã€‚ç»Ÿè®¡å­¦ä¹ çš„ç›®æ ‡ä»ç»éªŒé£é™©æœ€å°åŒ–å˜ä¸ºäº†å¯»æ±‚ç»éªŒé£é™©ä¸ç½®ä¿¡é£é™©çš„å’Œæœ€å°, å³ç»“æ„é£é™©æœ€å°ã€‚SVM æ­£æ˜¯è¿™æ ·ä¸€ç§åŠªåŠ›æœ€å°åŒ–ç»“æ„é£é™©çš„ç®—æ³•ã€‚</p>\n<p>ä»logisticå›å½’å‡ºå‘ï¼Œå¼•å‡ºäº†SVMï¼Œæ—¢æ­ç¤ºäº†æ¨¡å‹é—´çš„è”ç³»ï¼Œä¹Ÿè®©äººè§‰å¾—è¿‡æ¸¡æ›´è‡ªç„¶ã€‚</p>\n<p>Logisticå›å½’ç›®çš„æ˜¯ä»ç‰¹å¾å­¦ä¹ å‡ºä¸€ä¸ª0&#x2F;1åˆ†ç±»æ¨¡å‹ï¼Œè€Œè¿™ä¸ªæ¨¡å‹æ˜¯å°†ç‰¹æ€§çš„çº¿æ€§ç»„åˆä½œä¸ºè‡ªå˜é‡ï¼Œç”±äºè‡ªå˜é‡çš„å–å€¼èŒƒå›´æ˜¯è´Ÿæ— ç©·åˆ°æ­£æ— ç©·ã€‚å› æ­¤ï¼Œä½¿ç”¨logisticå‡½æ•°ï¼ˆæˆ–ç§°ä½œsigmoidå‡½æ•°ï¼‰å°†è‡ªå˜é‡æ˜ å°„åˆ°(0,1)ä¸Šï¼Œæ˜ å°„åçš„å€¼è¢«è®¤ä¸ºæ˜¯å±äºy&#x3D;1çš„æ¦‚ç‡ã€‚</p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"irisæ•°æ®é›†æ”¯æŒå‘é‡æœºåˆ†ç±»å®éªŒ\"><a href=\"#irisæ•°æ®é›†æ”¯æŒå‘é‡æœºåˆ†ç±»å®éªŒ\" class=\"headerlink\" title=\"irisæ•°æ®é›†æ”¯æŒå‘é‡æœºåˆ†ç±»å®éªŒ\"></a>irisæ•°æ®é›†æ”¯æŒå‘é‡æœºåˆ†ç±»å®éªŒ</h2><ol>\n<li>   ä»irisæ•°æ®é›†ä¸­å–å‡º[sepal lengthï¼Œsepal width]ä¸¤ä¸ªå±æ€§ä½œä¸ºæ ·æœ¬ç‰¹å¾ï¼Œå–å‰ä¸¤ç±»æ ·æœ¬è®­ç»ƒæ”¯æŒå‘é‡æœºè¿›è¡ŒäºŒåˆ†ç±»å®éªŒã€‚æ³¨æ„æ¯ä¸€ç±»å–å‰30ä¸ªæ ·æœ¬ä½œä¸ºè®­ç»ƒé›†ï¼Œå‰©ä½™çš„20ä¸ªæ ·æœ¬ä½œä¸ºæµ‹è¯•é›†ã€‚<ul>\n<li>Irisæ•°æ®é›†ä»‹ç»è¯¦è§ï¼š<a href=\"https://archive.ics.uci.edu/dataset/53/iris\">https://archive.ics.uci.edu/dataset/53/iris</a> </li>\n<li>Scikit-learnåº“ä¸­é¢„è£…äº†Irisæ•°æ®é›†ï¼Œå®‰è£…åº“åé‡‡ç”¨ â€œfrom sklearn.datasets import load_irisâ€ å¯ä»¥ç›´æ¥è¯»å–ï¼Œå‚è€ƒï¼š<a href=\"https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_iris.html\">https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_iris.html</a></li>\n</ul>\n</li>\n<li>   å€ŸåŠ©matplotlib ç”»å‡ºåŸå§‹è®­ç»ƒæ•°æ®åˆ†å¸ƒçš„æ•£ç‚¹å›¾ï¼ˆx&#x3D;â€œsepal lengthâ€ï¼Œy&#x3D;â€œsepal widthâ€ï¼Œç‚¹çš„é¢œè‰²ä»£è¡¨ä¸åŒç±»åˆ«ï¼‰</li>\n<li>   è°ƒç”¨sklearnçš„SVMæ¨¡å‹åŒ…ï¼Œå®ç°åˆ†ç±»ç®—æ³•</li>\n</ol>\n<p>ç»“æœå±•ç¤ºï¼š</p>\n<ul>\n<li>ç”¨è®­ç»ƒçš„æ¨¡å‹å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œåˆ†ç±»ï¼Œå¾—åˆ°æµ‹è¯•é”™è¯¯ç‡</li>\n<li>ä½¿ç”¨ä¸åŒçš„è¯¯å·®æƒ©ç½šç³»æ•°å–å€¼ï¼ˆåˆ†åˆ«ä¸º0.01ã€0.1ã€1.0ã€10å’Œ100ï¼‰å’Œæ ¸å‡½æ•°ï¼ˆåˆ†åˆ«ä¸ºâ€œlinearâ€å’Œâ€œpolyâ€ï¼‰æ¥ç»„åˆï¼Œè¿è¡Œæ¨¡å‹ï¼Œå¹¶æ¯”è¾ƒæ¨¡å‹åœ¨æœ€åçš„æµ‹è¯•æ­£ç¡®ç‡ä»¥åŠå¯è§†åŒ–æµ‹è¯•æ•°æ®çš„SVMå†³ç­–é—´éš”ã€‚ï¼ˆæç¤ºï¼šå¯è°ƒç”¨sklearnåº“ä¸­çš„DecisionBoundaryDisplayï¼‰ã€‚</li>\n</ul>\n<h2 id=\"åŸºäºæ ¸å‡½æ•°çš„SVMéçº¿æ€§åˆ†ç±»å®éªŒ\"><a href=\"#åŸºäºæ ¸å‡½æ•°çš„SVMéçº¿æ€§åˆ†ç±»å®éªŒ\" class=\"headerlink\" title=\"åŸºäºæ ¸å‡½æ•°çš„SVMéçº¿æ€§åˆ†ç±»å®éªŒ\"></a>åŸºäºæ ¸å‡½æ•°çš„SVMéçº¿æ€§åˆ†ç±»å®éªŒ</h2><ol>\n<li>   åˆ©ç”¨sklearnç”Ÿæˆéçº¿æ€§æ•°æ®<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> make_moons</span><br><span class=\"line\">x, y = make_moons(n_samples=<span class=\"number\">100</span>, noise=<span class=\"number\">0.2</span>, random_state=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure></li>\n<li>   å€ŸåŠ©matplotlib ç”»å‡ºç”Ÿæˆéçº¿æ€§æ•°æ®çš„æ•£ç‚¹å›¾</li>\n<li>   åˆ†åˆ«é€‰å–æ ¸å‡½æ•°ï¼ˆâ€œlinearâ€,â€œpolyâ€,â€rbfâ€ï¼‰,æ ¹æ®APIæ‰‹å†Œäº†è§£ä¸åŒæ ¸å‡½æ•°å¯¹åº”çš„è¶…å‚æ•°ï¼Œé€šè¿‡è°ƒèŠ‚è¶…å‚æ•°å±•ç¤ºç»˜åˆ¶çš„å†³ç­–å¹³é¢ã€‚å‚è€ƒ<a href=\"sklearn.svm.SVR-scikit-learn\">sklearn API</a></li>\n</ol>\n<p>ç»“æœå±•ç¤ºï¼šå±•ç¤ºä½¿ç”¨ä¸‰ç§ä¸åŒæ ¸å‡½æ•°ï¼Œåœ¨ä¸åŒè¶…å‚æ•°ä¸‹çš„å†³ç­–å¹³é¢</p>\n<h2 id=\"æ‰‹å†™SVMæ¨¡å‹\"><a href=\"#æ‰‹å†™SVMæ¨¡å‹\" class=\"headerlink\" title=\"æ‰‹å†™SVMæ¨¡å‹\"></a>æ‰‹å†™SVMæ¨¡å‹</h2><p>å°è¯•æ‰‹å†™SVMæ¨¡å‹ï¼Œå®ç°é¸¢å°¾èŠ±æ•°æ®é›†åˆ†ç±»</p>\n<h1 id=\"å®éªŒä»£ç å’Œç»“æœ\"><a href=\"#å®éªŒä»£ç å’Œç»“æœ\" class=\"headerlink\" title=\"å®éªŒä»£ç å’Œç»“æœ\"></a>å®éªŒä»£ç å’Œç»“æœ</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.svm <span class=\"keyword\">import</span> SVC, LinearSVC</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> make_blobs</span><br><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> load_iris</span><br><span class=\"line\">iris = load_iris()</span><br><span class=\"line\">df = pd.DataFrame(iris.data, columns=iris.feature_names)</span><br><span class=\"line\">df[<span class=\"string\">&#x27;label&#x27;</span>] = iris.target</span><br><span class=\"line\">df.columns = [<span class=\"string\">&#x27;sepal length&#x27;</span>, <span class=\"string\">&#x27;sepal width&#x27;</span>, <span class=\"string\">&#x27;petal length&#x27;</span>, <span class=\"string\">&#x27;petal width&#x27;</span>, <span class=\"string\">&#x27;label&#x27;</span>]</span><br><span class=\"line\">first_40_rows = df.head(<span class=\"number\">30</span>)</span><br><span class=\"line\">rows_50_to_90 = df[<span class=\"number\">50</span>:<span class=\"number\">80</span>]</span><br><span class=\"line\">dt = pd.concat([first_40_rows, rows_50_to_90])</span><br><span class=\"line\">data = np.array(dt.iloc[:<span class=\"number\">80</span>, [<span class=\"number\">0</span>, <span class=\"number\">1</span>, -<span class=\"number\">1</span>]])</span><br><span class=\"line\">test1=df[<span class=\"number\">30</span>:<span class=\"number\">50</span>]</span><br><span class=\"line\">test2=df[<span class=\"number\">80</span>:<span class=\"number\">100</span>]</span><br><span class=\"line\">test=pd.concat([test1,test1])</span><br><span class=\"line\">test=np.array(test.iloc[:<span class=\"number\">100</span>, [<span class=\"number\">0</span>, <span class=\"number\">1</span>, -<span class=\"number\">1</span>]])</span><br><span class=\"line\">TX, Ty = test[:,:-<span class=\"number\">1</span>], test[:,-<span class=\"number\">1</span>]</span><br><span class=\"line\">Ty = np.array([<span class=\"number\">1</span> <span class=\"keyword\">if</span> i == <span class=\"number\">1</span> <span class=\"keyword\">else</span> -<span class=\"number\">1</span> <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> Ty])</span><br><span class=\"line\">X, y = data[:,:-<span class=\"number\">1</span>], data[:,-<span class=\"number\">1</span>]</span><br><span class=\"line\">y = np.array([<span class=\"number\">1</span> <span class=\"keyword\">if</span> i == <span class=\"number\">1</span> <span class=\"keyword\">else</span> -<span class=\"number\">1</span> <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> y])</span><br><span class=\"line\">ker=[<span class=\"string\">&#x27;linear&#x27;</span>,<span class=\"string\">&#x27;poly&#x27;</span>]</span><br><span class=\"line\">C=[<span class=\"number\">0.01</span>,<span class=\"number\">0.1</span>,<span class=\"number\">1</span>,<span class=\"number\">10</span>,<span class=\"number\">100</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> ker:</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> C:</span><br><span class=\"line\">     modelSVM = SVC(kernel=i, C=j)  <span class=\"comment\"># SVC å»ºæ¨¡ï¼šä½¿ç”¨ SVCç±»ï¼Œçº¿æ€§æ ¸å‡½æ•°</span></span><br><span class=\"line\"><span class=\"comment\"># modelSVM = LinearSVC(C=100)  # SVC å»ºæ¨¡ï¼šä½¿ç”¨ LinearSVCç±»ï¼Œè¿è¡Œç»“æœåŒä¸Š</span></span><br><span class=\"line\">     modelSVM.fit(X, y)  <span class=\"comment\"># ç”¨æ ·æœ¬é›† X,y è®­ç»ƒ SVM æ¨¡å‹</span></span><br><span class=\"line\">     <span class=\"built_in\">print</span>(<span class=\"string\">&#x27;åˆ†ç±»å‡†ç¡®åº¦ï¼š&#123;:.4f&#125;&#x27;</span>.<span class=\"built_in\">format</span>(modelSVM.score(TX, Ty)))  <span class=\"comment\"># å¯¹è®­ç»ƒé›†çš„åˆ†ç±»å‡†ç¡®åº¦</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»˜åˆ¶åˆ†å‰²è¶…å¹³é¢å’Œæ ·æœ¬é›†åˆ†ç±»ç»“æœ</span></span><br><span class=\"line\">     plt.scatter(X[:,<span class=\"number\">0</span>], X[:,<span class=\"number\">1</span>], c=y, s=<span class=\"number\">30</span>, cmap=plt.cm.Paired)  <span class=\"comment\"># æ•£ç‚¹å›¾ï¼Œæ ¹æ® yå€¼è®¾ç½®ä¸åŒé¢œè‰²</span></span><br><span class=\"line\">     ax = plt.gca()  <span class=\"comment\"># ç§»åŠ¨åæ ‡è½´</span></span><br><span class=\"line\">     xlim = ax.get_xlim()  <span class=\"comment\"># è·å¾—Axesçš„ xåæ ‡èŒƒå›´</span></span><br><span class=\"line\">     ylim = ax.get_ylim()  <span class=\"comment\"># è·å¾—Axesçš„ yåæ ‡èŒƒå›´</span></span><br><span class=\"line\">     xx = np.linspace(xlim[<span class=\"number\">0</span>], xlim[<span class=\"number\">1</span>], <span class=\"number\">30</span>)  <span class=\"comment\"># åˆ›å»ºç­‰å·®æ•°åˆ—ï¼Œä» start åˆ° stopï¼Œå…± num ä¸ª</span></span><br><span class=\"line\">     yy = np.linspace(ylim[<span class=\"number\">0</span>], ylim[<span class=\"number\">1</span>], <span class=\"number\">30</span>)</span><br><span class=\"line\">     YY, XX = np.meshgrid(yy, xx)</span><br><span class=\"line\">     xy = np.vstack([XX.ravel(), YY.ravel()]).T  <span class=\"comment\"># å°†ç½‘æ ¼çŸ©é˜µå±•å¹³åé‡æ„ä¸ºæ•°ç»„</span></span><br><span class=\"line\">     Z = modelSVM.decision_function(xy).reshape(XX.shape)</span><br><span class=\"line\">     ax.contour(XX, YY, Z, colors=<span class=\"string\">&#x27;k&#x27;</span>, levels=[-<span class=\"number\">1</span>, <span class=\"number\">0</span>, <span class=\"number\">1</span>], alpha=<span class=\"number\">0.5</span>,</span><br><span class=\"line\">           linestyles=[<span class=\"string\">&#x27;--&#x27;</span>, <span class=\"string\">&#x27;-&#x27;</span>, <span class=\"string\">&#x27;--&#x27;</span>])  <span class=\"comment\"># ç»˜åˆ¶å†³ç­–è¾¹ç•Œå’Œåˆ†éš”</span></span><br><span class=\"line\">     ax.scatter(modelSVM.support_vectors_[:, <span class=\"number\">0</span>], modelSVM.support_vectors_[:, <span class=\"number\">1</span>], s=<span class=\"number\">100</span>,</span><br><span class=\"line\">           linewidth=<span class=\"number\">1</span>, facecolors=<span class=\"string\">&#x27;none&#x27;</span>, edgecolors=<span class=\"string\">&#x27;k&#x27;</span>)  <span class=\"comment\"># ç»˜åˆ¶ æ”¯æŒå‘é‡</span></span><br><span class=\"line\">     plt.title(<span class=\"string\">f&quot;SVM Decision Boundary with kernel=<span class=\"subst\">&#123;i&#125;</span> and C=<span class=\"subst\">&#123;j&#125;</span>&quot;</span>)</span><br><span class=\"line\">     plt.show()</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-9.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-10.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-11.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-12.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-13.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-14.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-15.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-16.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-17.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-18.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-19.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> make_moons</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.svm <span class=\"keyword\">import</span> SVC</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.model_selection <span class=\"keyword\">import</span> train_test_split</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.preprocessing <span class=\"keyword\">import</span> StandardScaler</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.metrics <span class=\"keyword\">import</span> accuracy_score</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç”Ÿæˆéçº¿æ€§æ•°æ®</span></span><br><span class=\"line\">x, y = make_moons(n_samples=<span class=\"number\">100</span>, noise=<span class=\"number\">0.2</span>, random_state=<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç”»å‡ºæ•£ç‚¹å›¾</span></span><br><span class=\"line\">plt.scatter(x[:, <span class=\"number\">0</span>], x[:, <span class=\"number\">1</span>], c=y, cmap=plt.cm.Paired)</span><br><span class=\"line\"></span><br><span class=\"line\">plt.show()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†</span></span><br><span class=\"line\">x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=<span class=\"number\">0.2</span>, random_state=<span class=\"number\">42</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># æ•°æ®æ ‡å‡†åŒ–</span></span><br><span class=\"line\">scaler = StandardScaler()</span><br><span class=\"line\">x_train = scaler.fit_transform(x_train)</span><br><span class=\"line\">x_test = scaler.transform(x_test)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ä¸åŒæ ¸å‡½æ•°çš„è¶…å‚æ•°è®¾ç½®</span></span><br><span class=\"line\">kernel_params = [&#123;<span class=\"string\">&#x27;kernel&#x27;</span>: <span class=\"string\">&#x27;poly&#x27;</span>, <span class=\"string\">&#x27;degree&#x27;</span>: <span class=\"number\">3</span>, <span class=\"string\">&#x27;C&#x27;</span>: <span class=\"number\">1.0</span>&#125;,</span><br><span class=\"line\">    &#123;<span class=\"string\">&#x27;kernel&#x27;</span>: <span class=\"string\">&#x27;rbf&#x27;</span>, <span class=\"string\">&#x27;gamma&#x27;</span>: <span class=\"number\">0.5</span>, <span class=\"string\">&#x27;C&#x27;</span>: <span class=\"number\">1.0</span>&#125;,</span><br><span class=\"line\">    &#123;<span class=\"string\">&#x27;kernel&#x27;</span>: <span class=\"string\">&#x27;linear&#x27;</span>, <span class=\"string\">&#x27;C&#x27;</span>: <span class=\"number\">1.0</span>&#125;,</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ç»˜åˆ¶å†³ç­–å¹³é¢</span></span><br><span class=\"line\">plt.figure(figsize=(<span class=\"number\">15</span>, <span class=\"number\">5</span>))</span><br><span class=\"line\"><span class=\"keyword\">for</span> i, params <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(kernel_params, <span class=\"number\">1</span>):</span><br><span class=\"line\">    <span class=\"comment\"># åˆ›å»ºSVMæ¨¡å‹</span></span><br><span class=\"line\">    svm_model = SVC(**params)</span><br><span class=\"line\">    svm_model.fit(x_train, y_train)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># åœ¨è®­ç»ƒé›†ä¸Šç»˜åˆ¶å†³ç­–å¹³é¢</span></span><br><span class=\"line\"></span><br><span class=\"line\">    plt.scatter(x_train[:, <span class=\"number\">0</span>], x_train[:, <span class=\"number\">1</span>], c=y_train, cmap=plt.cm.Paired)</span><br><span class=\"line\">    plt.title(<span class=\"string\">f&quot;SVM Decision Boundary (<span class=\"subst\">&#123;params[<span class=\"string\">&#x27;kernel&#x27;</span>]&#125;</span> kernel)&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># ç»˜åˆ¶å†³ç­–å¹³é¢</span></span><br><span class=\"line\">    h = <span class=\"number\">0.02</span></span><br><span class=\"line\">    x_min, x_max = x_train[:, <span class=\"number\">0</span>].<span class=\"built_in\">min</span>() - <span class=\"number\">1</span>, x_train[:, <span class=\"number\">0</span>].<span class=\"built_in\">max</span>() + <span class=\"number\">1</span></span><br><span class=\"line\">    y_min, y_max = x_train[:, <span class=\"number\">1</span>].<span class=\"built_in\">min</span>() - <span class=\"number\">1</span>, x_train[:, <span class=\"number\">1</span>].<span class=\"built_in\">max</span>() + <span class=\"number\">1</span></span><br><span class=\"line\">    xx, yy = np.meshgrid(np.arange(x_min, x_max, h), np.arange(y_min, y_max, h))</span><br><span class=\"line\"></span><br><span class=\"line\">    Z = svm_model.predict(np.c_[xx.ravel(), yy.ravel()])</span><br><span class=\"line\">    Z = Z.reshape(xx.shape)</span><br><span class=\"line\"></span><br><span class=\"line\">    plt.contourf(xx, yy, Z, cmap=plt.cm.Paired, alpha=<span class=\"number\">0.6</span>)</span><br><span class=\"line\">    plt.show()</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-20.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-21.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-22.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-23.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å°ç»“æˆ–è®¨è®º\"><a href=\"#å°ç»“æˆ–è®¨è®º\" class=\"headerlink\" title=\"å°ç»“æˆ–è®¨è®º\"></a>å°ç»“æˆ–è®¨è®º</h1><p>SVMçš„ä¼˜ç¼ºç‚¹ï¼š</p>\n<p>ä¼˜ç‚¹:</p>\n<p>å¯ç”¨äºçº¿æ€§&#x2F;éçº¿æ€§åˆ†ç±»ï¼Œä¹Ÿå¯ä»¥ç”¨äºå›å½’ï¼Œæ³›åŒ–é”™è¯¯ç‡ä½ï¼Œä¹Ÿå°±æ˜¯è¯´å…·æœ‰è‰¯å¥½çš„å­¦ä¹ èƒ½åŠ›ï¼Œä¸”å­¦åˆ°çš„ç»“æœå…·æœ‰å¾ˆå¥½çš„æ¨å¹¿æ€§ã€‚</p>\n<p>å¯ä»¥è§£å†³å°æ ·æœ¬æƒ…å†µä¸‹çš„æœºå™¨å­¦ä¹ é—®é¢˜ï¼Œå¯ä»¥è§£å†³é«˜ç»´é—®é¢˜ï¼Œå¯ä»¥é¿å…ç¥ç»ç½‘ç»œç»“æ„é€‰æ‹©å’Œå±€éƒ¨æå°ç‚¹é—®é¢˜ã€‚</p>\n<p>SVMæ˜¯æœ€å¥½çš„ç°æˆçš„åˆ†ç±»å™¨ï¼Œç°æˆæ˜¯æŒ‡ä¸åŠ ä¿®æ”¹å¯ç›´æ¥ä½¿ç”¨ã€‚å¹¶ä¸”èƒ½å¤Ÿå¾—åˆ°è¾ƒä½çš„é”™è¯¯ç‡ï¼ŒSVMå¯ä»¥å¯¹è®­ç»ƒé›†ä¹‹å¤–çš„æ•°æ®ç‚¹åšå¾ˆå¥½çš„åˆ†ç±»å†³ç­–ã€‚</p>\n<p>ç¼ºç‚¹ï¼š</p>\n<p>å¯¹å‚æ•°è°ƒèŠ‚å’Œå’Œå‡½æ•°çš„é€‰æ‹©æ•æ„Ÿã€‚</p>\n","categories":["Machine Learning"]},{"title":"é›†æˆå­¦ä¹ å®éªŒ","url":"/2023/12/11/mllab4/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ol>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡é›†æˆå­¦ä¹ çš„åŸºæœ¬åŸç†</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡é›†æˆå­¦ä¹ çš„å¹¶è¡Œç­–ç•¥ï¼ŒBaggingä¸éšæœºæ£®æ—è§£å†³å¤æ‚åˆ†ç±»é—®é¢˜</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡é›†æˆå­¦ä¹ çš„ä¸²è¡Œç­–ç•¥ï¼ŒBoostingä¸Adaboostè§£å†³å¤æ‚åˆ†ç±»é—®é¢˜</li>\n<li>   äº†è§£å’ŒæŒæ¡ç¬¬ä¸‰æ–¹æœºå™¨å­¦ä¹ åº“Scikit-learnä¸­çš„æ¨¡å‹è°ƒç”¨</li>\n</ol>\n<h1 id=\"å®éªŒè¦æ±‚\"><a href=\"#å®éªŒè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒè¦æ±‚\"></a>å®éªŒè¦æ±‚</h1><ol>\n<li>   é‡‡ç”¨Pythonã€Matlabç­‰é«˜çº§è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œæ¨èä¼˜å…ˆé€‰ç”¨Pythonè¯­è¨€</li>\n<li>   æœ¬æ¬¡å®éªŒå¯ä»¥ç›´æ¥è°ƒç”¨Scikit-learnã€PyTorchç­‰æˆç†Ÿæ¡†æ¶çš„ç¬¬ä¸‰æ–¹å®ç°<span id=\"more\"></span></li>\n<li>   ä»£ç å¯è¯»æ€§å¼ºï¼šå˜é‡ã€å‡½æ•°ã€ç±»ç­‰å‘½åå¯è¯»æ€§å¼ºï¼ŒåŒ…å«å¿…è¦çš„æ³¨é‡Š</li>\n</ol>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"æ¦‚å¿µ\"><a href=\"#æ¦‚å¿µ\" class=\"headerlink\" title=\"æ¦‚å¿µ\"></a>æ¦‚å¿µ</h2><p>é›†æˆå­¦ä¹ (Ensemble learning)é€šè¿‡æ„å»ºå¹¶ç»“åˆå¤šä¸ªå­¦ä¹ å™¨æ¥å®Œæˆå­¦ä¹ ä»»åŠ¡ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸ºå¤šåˆ†ç±»å™¨ç³»ç»Ÿã€åŸºäºå§”å‘˜ä¼šçš„å­¦ä¹ ç­‰ï¼Œé›†æˆå­¦ä¹ é€šå¸¸å¯ä»¥è·å¾—æ¯”å•ä¸€å­¦ä¹ æ¨¡å‹æ›´å¥½çš„æ³›åŒ–æ€§ã€‚</p>\n<h2 id=\"åŸºæœ¬ç»“æ„\"><a href=\"#åŸºæœ¬ç»“æ„\" class=\"headerlink\" title=\"åŸºæœ¬ç»“æ„\"></a>åŸºæœ¬ç»“æ„</h2><p>å…ˆäº§ç”Ÿå¤šä¸ªâ€œä¸ªä½“å­¦ä¹ å™¨â€ï¼Œä¹Ÿå«åšâ€œåŸºå­¦ä¹ å™¨â€ï¼Œå†ç”¨æŸç§ç­–ç•¥å°†å®ƒä»¬ç»“åˆèµ·æ¥ï¼Œé›†æˆä¸­åªåŒ…å«åŒç§ç±»å‹çš„ä¸ªä½“å­¦ä¹ å™¨å«åšåŒè´¨ï¼ŒåŒ…å«ä¸åŒç±»å‹çš„ä¸ªä½“å­¦ä¹ å™¨å«åšå¼‚è´¨ã€‚è¦è·å¾—å¥½çš„é›†æˆå°±åº”è¯¥æ‰¾åˆ°â€œå¥½è€Œä¸åŒâ€çš„ä¸ªä½“å­¦ä¹ å™¨ï¼Œè¿™å°±æ˜¯é›†æˆå­¦ä¹ çš„ç ”ç©¶æ ¸å¿ƒã€‚</p>\n<h2 id=\"Boosting\"><a href=\"#Boosting\" class=\"headerlink\" title=\"Boosting\"></a>Boosting</h2><p>Boostingæ˜¯ä¸€ç°‡å¯å°†å¼±å­¦ä¹ å™¨æå‡ä¸ºå¼ºå­¦ä¹ å™¨çš„ç®—æ³•ã€‚å…¶å·¥ä½œæœºåˆ¶ä¸ºï¼š<br>å…ˆä»åˆå§‹è®­ç»ƒé›†è®­ç»ƒå‡ºä¸€ä¸ªåŸºå­¦ä¹ å™¨<br>å†æ ¹æ®åŸºå­¦ä¹ å™¨çš„è¡¨ç°å¯¹æ ·æœ¬åˆ†å¸ƒè¿›è¡Œè°ƒæ•´ï¼Œä½¿å¾—å…ˆå‰çš„åŸºå­¦ä¹ å™¨åšé”™çš„è®­ç»ƒæ ·æœ¬åœ¨åç»­æ”¶åˆ°æ›´å¤šçš„å…³æ³¨<br>ç„¶ååŸºäºè°ƒæ•´åçš„æ ·æœ¬åˆ†å¸ƒæ¥è®­ç»ƒä¸‹ä¸€ä¸ªåŸºå­¦ä¹ å™¨ï¼›å¦‚æ­¤é‡å¤è¿›è¡Œï¼Œç›´è‡³åŸºå­¦ä¹ å™¨æ•°ç›®è¾¾åˆ°å®ç°æŒ‡å®šçš„å€¼Tï¼Œæˆ–æ•´ä¸ªé›†æˆç»“æœè¾¾åˆ°é€€å‡ºæ¡ä»¶<br>ç„¶åå°†è¿™äº›å­¦ä¹ å™¨è¿›è¡ŒåŠ æƒç»“åˆã€‚</p>\n<h2 id=\"AdaBoost\"><a href=\"#AdaBoost\" class=\"headerlink\" title=\"AdaBoost\"></a>AdaBoost</h2><p>AdaBoostæ˜¯Boostingä¸­çš„ç»å…¸ç®—æ³•ï¼Œå…¶ä¸»è¦åº”ç”¨äºäºŒåˆ†ç±»é—®é¢˜ã€‚<br>Adaboost ç®—æ³•é‡‡ç”¨è°ƒæ•´æ ·æœ¬æƒé‡çš„æ–¹å¼æ¥å¯¹æ ·æœ¬åˆ†å¸ƒè¿›è¡Œè°ƒæ•´ï¼Œå³æé«˜å‰ä¸€è½®ä¸ªä½“å­¦ä¹ å™¨é”™è¯¯åˆ†ç±»çš„æ ·æœ¬çš„æƒé‡ï¼Œè€Œé™ä½é‚£äº›æ­£ç¡®åˆ†ç±»çš„æ ·æœ¬çš„æƒé‡ï¼Œè¿™æ ·å°±èƒ½ä½¿å¾—é”™è¯¯åˆ†ç±»çš„æ ·æœ¬å¯ä»¥å—åˆ°æ›´å¤šçš„å…³æ³¨ï¼Œä»è€Œåœ¨ä¸‹ä¸€è½®ä¸­å¯ä»¥æ­£ç¡®åˆ†ç±»ï¼Œä½¿å¾—åˆ†ç±»é—®é¢˜è¢«ä¸€ç³»åˆ—çš„å¼±åˆ†ç±»å™¨â€œåˆ†è€Œæ²»ä¹‹â€ã€‚å¯¹äºç»„åˆæ–¹å¼ï¼ŒAdaBoosté‡‡ç”¨åŠ æƒå¤šæ•°è¡¨å†³çš„æ–¹æ³•ï¼Œå…·ä½“åœ°ï¼ŒåŠ å¤§åˆ†ç±»è¯¯å·®ç‡å°çš„è‹¥åˆ†ç±»å™¨çš„æƒå€¼ï¼Œå‡å°åˆ†ç±»è¯¯å·®ç‡å¤§çš„è‹¥åˆ†ç±»å™¨çš„æƒå€¼ï¼Œä»è€Œè°ƒæ•´ä»–ä»¬åœ¨è¡¨å†³ä¸­çš„ä½œç”¨ã€‚</p>\n<h2 id=\"éšæœºæ£®æ—\"><a href=\"#éšæœºæ£®æ—\" class=\"headerlink\" title=\"éšæœºæ£®æ—\"></a>éšæœºæ£®æ—</h2><p>éšæœºæ£®æ—(Random Forestï¼Œç®€ç§°RF)æ˜¯Baggingé›†æˆå­¦ä¹ æ–¹æ³•çš„ä¸€ä¸ªæ‰©å±•å˜ä½“ã€‚éšæœºæ£®æ—ä»¥å†³ç­–æ ‘ä½œä¸ºBaggingé›†æˆå­¦ä¹ çš„åŸºå­¦ä¹ å™¨ï¼Œä¸ç»å…¸çš„å†³ç­–æ ‘ä¸åŒï¼Œéšæœºæ£®æ—åœ¨æ„å»ºå†³ç­–æ ‘æ¨¡å‹çš„æ—¶å€™ä¸æ˜¯åœ¨æ‰€æœ‰çš„å±æ€§ä¸Šå»é€‰æ‹©æœ€ä¼˜åˆ’åˆ†å±æ€§ï¼Œè€Œæ˜¯åœ¨æ•°æ®é›†å±æ€§çš„ä¸€ä¸ªéšæœºå­é›†ä¸Šè¿›è¡Œæœ€ä¼˜åˆ’åˆ†å±æ€§çš„é€‰æ‹©ã€‚ç”±äºåŸºå­¦ä¹ å™¨çš„è®­ç»ƒæ•°æ®ä»¥åŠç‰¹å¾å±æ€§éƒ½ä¸å®Œå…¨ç›¸åŒï¼Œéšæœºæ£®æ—æ„é€ çš„åŸºå­¦ä¹ å™¨å…·æœ‰è¾ƒå¤§çš„å·®å¼‚ï¼Œä½¿å¾—éšæœºæ£®æ—ä¸ä»…ç®€å•ã€è®¡ç®—å¼€é”€å°ï¼Œè€Œä¸”åœ¨å¾ˆå¤šå®é™…ä»»åŠ¡ä¸­å±•ç°å‡ºå¼ºå¤§çš„æ€§èƒ½ã€‚</p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"æ•°æ®é›†å‡†å¤‡\"><a href=\"#æ•°æ®é›†å‡†å¤‡\" class=\"headerlink\" title=\"æ•°æ®é›†å‡†å¤‡\"></a>æ•°æ®é›†å‡†å¤‡</h2><ol>\n<li>   åˆ©ç”¨sklearnç”Ÿæˆéçº¿æ€§æ•°æ®ï¼ˆç”¨äºä¸»ä½“å®éªŒæ•°æ®ï¼‰<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> make_moons</span><br><span class=\"line\">x, y = make_moons(n_samples=<span class=\"number\">1000</span>, noise=<span class=\"number\">0.4</span>, random_state=<span class=\"number\">0</span>)</span><br></pre></td></tr></table></figure></li>\n</ol>\n<ul>\n<li>ç”Ÿæˆçš„æ•°æ®æŒ‰ç…§æŒ‰ç…§3:1åˆ‡åˆ†è®­ç»ƒé›†ä¸æµ‹è¯•é›†</li>\n<li>æ•°æ®åˆ‡åˆ†çš„éšæœºç§å­è°ƒæˆ0ï¼ˆå³random_state&#x3D;0ï¼‰</li>\n</ul>\n<ol start=\"2\">\n<li>   åˆ©ç”¨sklearnè‡ªå¸¦.çš„Irisæ•°æ®é›†ï¼ˆä¸»è¦å®Œæˆéšæœºæ£®æ—çš„ç‰¹å¾å¯è§†åŒ–ï¼‰</li>\n</ol>\n<h2 id=\"åŸºäºä¸åŒåˆ†ç±»å™¨çš„é›†æˆå­¦ä¹ ï¼ˆä»…åœ¨make-moonsæ•°æ®é›†ä¸Šå®ç°ï¼‰\"><a href=\"#åŸºäºä¸åŒåˆ†ç±»å™¨çš„é›†æˆå­¦ä¹ ï¼ˆä»…åœ¨make-moonsæ•°æ®é›†ä¸Šå®ç°ï¼‰\" class=\"headerlink\" title=\"åŸºäºä¸åŒåˆ†ç±»å™¨çš„é›†æˆå­¦ä¹ ï¼ˆä»…åœ¨make_moonsæ•°æ®é›†ä¸Šå®ç°ï¼‰\"></a>åŸºäºä¸åŒåˆ†ç±»å™¨çš„é›†æˆå­¦ä¹ ï¼ˆä»…åœ¨make_moonsæ•°æ®é›†ä¸Šå®ç°ï¼‰</h2><ol>\n<li>   åˆ©è°ƒç”¨sklearnä¸­çš„knnï¼Œlogisticå›å½’å’Œé«˜æ–¯æœ´ç´ è´å¶æ–¯ä¸‰ç§åˆ†ç±»å™¨</li>\n<li>   æ¨¡å‹åˆ†åˆ«å­¦ä¹ make_moonsè®­ç»ƒé›†ä¸­çš„æ•°æ®</li>\n<li>   è‡ªå·±ç¼–ç¨‹å®ç°åŸºäºå¤šæ•°æŠ•ç¥¨çš„é›†æˆé€‰æ‹©ï¼ˆä¸å¾—ä½¿ç”¨skleanå®ç°ï¼‰</li>\n<li>   å°è¯•é‡‡ç”¨skleanä¸­çš„VotingClassifierå®ç°åŸºäºâ€œç¡¬æŠ•ç¥¨â€å’Œâ€œè½¯æŠ•ç¥¨â€çš„åˆ†ç±»</li>\n</ol>\n<p>ç»“æœå±•ç¤ºï¼š</p>\n<ul>\n<li>åˆ†åˆ«å±•ç¤ºä¸‰ç§åˆ†ç±»å™¨çš„åˆ†ç±»ç»“æœä»¥åŠæ‰‹å†™å¤šæ•°æŠ•ç¥¨çš„é›†æˆå®éªŒç»“æœ</li>\n<li>å±•ç¤ºåŸºäºç¡¬æŠ•ç¥¨å’Œè½¯æŠ•ç¥¨é›†æˆçš„åˆ†ç±»ç»“æœ</li>\n</ul>\n<h2 id=\"åŸºäºBaggingçš„éšæœºæ£®æ—ç®—æ³•å®ç°\"><a href=\"#åŸºäºBaggingçš„éšæœºæ£®æ—ç®—æ³•å®ç°\" class=\"headerlink\" title=\"åŸºäºBaggingçš„éšæœºæ£®æ—ç®—æ³•å®ç°\"></a>åŸºäºBaggingçš„éšæœºæ£®æ—ç®—æ³•å®ç°</h2><ol>\n<li>   å°è¯•åŸºäºsklearnä¸­çš„BaggingClassifierå’ŒDecisionTreeClassifieræ„å»ºéšæœºæ£®æ—ï¼Œå¹¶å®ç°make_moonsæ•°æ®é›†çš„åˆ†ç±»</li>\n<li>   å°è¯•åŸºäºsklearnä¸­çš„RandomForestClassifieræ„å»ºéšæœºæ£®æ—ï¼Œå¹¶åˆ©ç”¨feature_importances_åˆ†æå±æ€§çš„é‡è¦æ€§ï¼ˆå±æ€§çš„é‡è¦æ€§å¯åœ¨make_moonså’Œirisæ•°æ®é›†ä¸­åˆ†åˆ«å°è¯•ï¼‰<br>ç»“æœå±•ç¤ºï¼š</li>\n</ol>\n<ul>\n<li>åˆ†åˆ«å±•ç¤ºä¸¤ç§æ„é€ éšæœºæ£®æ—æ–¹æ³•åœ¨make_moonsæµ‹è¯•é›†ä¸Šçš„åˆ†ç±»ç»“æœ</li>\n<li>å±•ç¤ºéšæœºæ£®æ—å¯¹make_moonså’Œirisç‰¹å¾é‡è¦æ€§çš„æ¯”ä¾‹</li>\n</ul>\n<h2 id=\"åŸºäºBoostingçš„ç®—æ³•å®ç°\"><a href=\"#åŸºäºBoostingçš„ç®—æ³•å®ç°\" class=\"headerlink\" title=\"åŸºäºBoostingçš„ç®—æ³•å®ç°\"></a>åŸºäºBoostingçš„ç®—æ³•å®ç°</h2><ol>\n<li>   å°è¯•åŸºäºsklearnä¸­çš„AdaBoostClassifierå®ç°make_moonsæ•°æ®é›†çš„åˆ†ç±»</li>\n<li>   å°è¯•åŸºäºsklearnä¸­çš„GradientBoostingClassifierå®ç°make_moonsæ•°æ®é›†çš„åˆ†ç±»</li>\n</ol>\n<p>ç»“æœå±•ç¤ºï¼šåˆ†åˆ«å±•ç¤ºä¸¤ç§boostingæ–¹æ³•åœ¨make_moonsæµ‹è¯•é›†ä¸Šçš„åˆ†ç±»ç»“æœ</p>\n<h1 id=\"å®éªŒä»£ç å’Œç»“æœ\"><a href=\"#å®éªŒä»£ç å’Œç»“æœ\" class=\"headerlink\" title=\"å®éªŒä»£ç å’Œç»“æœ\"></a>å®éªŒä»£ç å’Œç»“æœ</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.model_selection <span class=\"keyword\">import</span> train_test_split</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> make_moons</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> load_iris</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.neighbors <span class=\"keyword\">import</span> KNeighborsClassifier</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.linear_model <span class=\"keyword\">import</span> LogisticRegression</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.naive_bayes <span class=\"keyword\">import</span> GaussianNB</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.ensemble <span class=\"keyword\">import</span> VotingClassifier</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.metrics <span class=\"keyword\">import</span> accuracy_score</span><br><span class=\"line\">x, y = make_moons(n_samples=<span class=\"number\">1000</span>, noise=<span class=\"number\">0.4</span>, random_state=<span class=\"number\">0</span>)</span><br><span class=\"line\">X_train,X_test,y_train,y_test=train_test_split(x,y,train_size=<span class=\"number\">0.75</span>,test_size=<span class=\"number\">0.25</span>,random_state=<span class=\"number\">0</span>)</span><br><span class=\"line\">knn = KNeighborsClassifier()    <span class=\"comment\">#å®ä¾‹åŒ–KNNæ¨¡å‹</span></span><br><span class=\"line\">knn.fit(X_train, y_train)   <span class=\"comment\">#æ”¾å…¥è®­ç»ƒæ•°æ®è¿›è¡Œè®­ç»ƒ</span></span><br><span class=\"line\">pk=knn.predict(X_test)</span><br><span class=\"line\">lstr=LogisticRegression()</span><br><span class=\"line\">lstr.fit(X_train,y_train)</span><br><span class=\"line\">pl=lstr.predict(X_test)</span><br><span class=\"line\">gnb=GaussianNB()</span><br><span class=\"line\">gnb.fit(X_train,y_train)</span><br><span class=\"line\">pg=gnb.predict(X_test)</span><br><span class=\"line\">pre=(pk+pl+pg)/<span class=\"number\">3</span></span><br><span class=\"line\">count=<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(pre)):</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(pre[i]&lt;<span class=\"number\">0.5</span>): pre[i]=<span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:pre[i]=<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;KNNåˆ†ç±»å‡†ç¡®ç‡:&quot;</span>,accuracy_score(y_test,pk))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;logistic regressionåˆ†ç±»å‡†ç¡®ç‡:&quot;</span>,accuracy_score(y_test,pl))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;é«˜æ–¯æœ´ç´ è´å¶æ–¯åˆ†ç±»å‡†ç¡®ç‡:&quot;</span>,accuracy_score(y_test,pg))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;æ‰‹å†™æŠ•ç¥¨æµ‹è¯•å‡†ç¡®ç‡:&quot;</span> + <span class=\"built_in\">str</span>(accuracy_score(y_test,pre)))</span><br><span class=\"line\">voting_clf = VotingClassifier(estimators=[</span><br><span class=\"line\">    (<span class=\"string\">&#x27;knn&#x27;</span>, knn),</span><br><span class=\"line\">    (<span class=\"string\">&#x27;lstr&#x27;</span>, lstr),</span><br><span class=\"line\">    (<span class=\"string\">&#x27;gnb&#x27;</span>, gnb),</span><br><span class=\"line\">], voting=<span class=\"string\">&#x27;hard&#x27;</span>)</span><br><span class=\"line\">voting_clf.fit(X_train,y_train)</span><br><span class=\"line\">vh=voting_clf.predict(X_test)</span><br><span class=\"line\">votings = VotingClassifier(estimators=[</span><br><span class=\"line\">    (<span class=\"string\">&#x27;knn&#x27;</span>, knn),</span><br><span class=\"line\">    (<span class=\"string\">&#x27;lstr&#x27;</span>, lstr),</span><br><span class=\"line\">    (<span class=\"string\">&#x27;gnb&#x27;</span>, gnb),</span><br><span class=\"line\">], voting=<span class=\"string\">&#x27;soft&#x27;</span>)</span><br><span class=\"line\">votings.fit(X_train,y_train)</span><br><span class=\"line\">vs=votings.predict(X_test)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;ç¡¬æŠ•ç¥¨æµ‹è¯•å‡†ç¡®ç‡:&quot;</span> + <span class=\"built_in\">str</span>(accuracy_score(y_test,vh)))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;è½¯æŠ•ç¥¨æµ‹è¯•å‡†ç¡®ç‡:&quot;</span> + <span class=\"built_in\">str</span>(accuracy_score(y_test,vs)))</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.datasets <span class=\"keyword\">import</span> load_iris</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.ensemble <span class=\"keyword\">import</span> VotingClassifier</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.metrics <span class=\"keyword\">import</span> accuracy_score</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.tree <span class=\"keyword\">import</span> DecisionTreeClassifier</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.ensemble <span class=\"keyword\">import</span> BaggingClassifier</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.ensemble <span class=\"keyword\">import</span> RandomForestClassifier</span><br><span class=\"line\">iris=load_iris()</span><br><span class=\"line\">Xi=iris.data</span><br><span class=\"line\">Xi=Xi[<span class=\"number\">0</span>:<span class=\"number\">100</span>]</span><br><span class=\"line\">yi=iris.target</span><br><span class=\"line\">yi=yi[<span class=\"number\">0</span>:<span class=\"number\">100</span>]</span><br><span class=\"line\">Xi_train,Xi_test,yi_train,yi_test=train_test_split(Xi,yi,train_size=<span class=\"number\">0.75</span>,test_size=<span class=\"number\">0.25</span>,random_state=<span class=\"number\">0</span>)</span><br><span class=\"line\">x, y = make_moons(n_samples=<span class=\"number\">1000</span>, noise=<span class=\"number\">0.4</span>, random_state=<span class=\"number\">0</span>)</span><br><span class=\"line\">X_train,X_test,y_train,y_test=train_test_split(x,y,train_size=<span class=\"number\">0.75</span>,test_size=<span class=\"number\">0.25</span>,random_state=<span class=\"number\">0</span>)</span><br><span class=\"line\">clf = DecisionTreeClassifier()</span><br><span class=\"line\">rfc1 = BaggingClassifier(clf,n_estimators=<span class=\"number\">50</span>)</span><br><span class=\"line\">rfc1.fit(X_train,y_train)</span><br><span class=\"line\">pr=rfc1.predict(X_test)</span><br><span class=\"line\">rfc2=RandomForestClassifier(n_estimators=<span class=\"number\">50</span>)</span><br><span class=\"line\">rfc2.fit(X_train,y_train)</span><br><span class=\"line\">pr2=rfc2.predict(X_test)</span><br><span class=\"line\">rfc3=RandomForestClassifier(n_estimators=<span class=\"number\">50</span>)</span><br><span class=\"line\">rfc3.fit(Xi_train,yi_train)</span><br><span class=\"line\">pr3=rfc3.predict(Xi_test)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;BaggingClassifierçš„å‡†ç¡®ç‡:&quot;</span>,accuracy_score(y_test,pr))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;RandomForestClassifierçš„å‡†ç¡®ç‡:&quot;</span>,accuracy_score(y_test,pr2))</span><br><span class=\"line\">feai=rfc2.feature_importances_</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;ç‰¹å¾çš„é‡è¦æ€§:&quot;</span>,feai)</span><br></pre></td></tr></table></figure>\n<p>make moonçš„ç»“æœ:</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-24.png?raw=true\" alt=\"alt text\"></p>\n<p>irisçš„ç»“æœï¼š</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-25.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">adb = AdaBoostClassifier(n_estimators=<span class=\"number\">100</span>)</span><br><span class=\"line\">grb=GradientBoostingClassifier(n_estimators=<span class=\"number\">100</span>)</span><br><span class=\"line\">adb.fit(X_train,y_train)</span><br><span class=\"line\">grb.fit(X_train,y_train)</span><br><span class=\"line\">pa=adb.predict(X_test)</span><br><span class=\"line\">pg=grb.predict(X_test)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;AdaBoostClassifierçš„å‡†ç¡®ç‡ä¸º&quot;</span>,accuracy_score(y_test,pa))</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;GradientBoostingClassifierçš„å‡†ç¡®ç‡ä¸º&quot;</span>,accuracy_score(y_test,pg))</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-26.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å°ç»“æˆ–è®¨è®º\"><a href=\"#å°ç»“æˆ–è®¨è®º\" class=\"headerlink\" title=\"å°ç»“æˆ–è®¨è®º\"></a>å°ç»“æˆ–è®¨è®º</h1><p>é›†æˆæ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œä¸€ç§å«åšbaggingï¼Œbaggingçš„æ€æƒ³æ˜¯ï¼Œæˆ‘æŠŠæˆ‘çš„æ•°æ®åšä¸€ç‚¹å¾®å°çš„è°ƒæ•´ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªè·ŸåŸæ¥ä¸ä¸€æ ·çš„æ•°æ®é›†ï¼Œæˆ‘å°±èƒ½å¤šè®­ç»ƒä¸€ä¸ªæ¨¡å‹å‡ºæ¥ï¼Œæ¨¡å‹çš„æ•°é‡å¤šäº†ï¼Œè§£é‡ŠåŠ›è‡ªç„¶å°±å¢å¼ºäº†ã€‚æ¯”å¦‚è¯´æˆ‘åŸæ¥æœ‰100ä¸ªäººçš„æ•°æ®ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªåˆ†åˆ«å«Tonyå’ŒLilyï¼Œæˆ‘æŠŠTonyè¿™æ¡æ•°æ®åˆ æ‰ï¼Œç”¨Lilyçš„æ•°æ®æ¥æ›¿æ¢ï¼Œè¿™æ ·å°±å¾—åˆ°äº†ä¸€ä¸ªè·ŸåŸæ¥ä¸ä¸€æ ·çš„èˆ¹æ–°çš„æ•°æ®é›†ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšBootstrap</p>\n<p>æ¯ä¸€ä¸ªBootstrapæ•°æ®é›†éƒ½èƒ½ç”¨æ¥è®­ç»ƒä¸€æ¬¡æ¨¡å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯”å¦‚é‡å¤1000æ¬¡ï¼Œä¸€æ¬¡æ˜¯Tonyæ›¿ä»£Ciciï¼Œä¸€æ¬¡æ˜¯Ivyæ›¿ä»£Yukiï¼Œè¿™æ ·æ¯ä¸€æ¬¡éƒ½æ˜¯ä¸ä¸€æ ·çš„æ•°æ®ï¼Œä¹Ÿå°±å¯ä»¥è®­ç»ƒ1000æ¬¡ï¼Œå¾—åˆ°äº†1000ä¸ªå†³ç­–æ ‘ï¼Œæˆ‘ä»¬æŠŠè¿™1000ä¸ªå†³ç­–æ ‘æ‰“åŒ…åˆ°ä¸€èµ·ä½œä¸ºæˆ‘ä»¬æœ€ç»ˆçš„æ¨¡å‹ï¼Œè¿™ä¸ªæ‰“åŒ…å°±å«åšbagging</p>\n<p>ä¸€èˆ¬æˆ‘ä»¬ä¼šæŠŠbaggingè·Ÿéšæœºæ£®æ—ä¸€èµ·å åŠ ä½¿ç”¨ï¼Œåœ¨æ•°æ®ç‚¹çš„å¤„ç†ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨baggingæ¥åˆ›é€ è®¸å¤šç»„ï¼ˆæ¯”å¦‚è¯´1000ç»„ï¼‰bootstrapæ•°æ®ï¼Œå¯¹äºæ¯ä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºæ£®æ—æ¥è®­ç»ƒæ¨¡å‹ï¼Œæœ€åå†æŠŠæ‰€æœ‰æ¨¡å‹çš„é¢„æµ‹ç»“æœbaggingèµ·æ¥</p>\n<p>ç¬¬äºŒç§é›†æˆçš„æ–¹æ³•æ˜¯boostingï¼Œboostingè·Ÿbaggingä¸€æ ·éƒ½å±äºé›†æˆçš„æ€æƒ³ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯è®­ç»ƒå¾ˆå¤šæ¨¡å‹ï¼Œç”¨æ•°é‡å †ç§¯å‡ºè´¨é‡ã€‚è¿˜æ˜¯ä¸¾1000ä¸ªmodelï¼Œ100ä¸ªvariableçš„ä¾‹å­ï¼Œbaggingæ˜¯è®­ç»ƒ1000ä¸ªç­‰ä»·çš„æ¨¡å‹ï¼Œæ¯”å¦‚è¯´ç”¨éšæœºæ£®æ—ï¼Œè¿™äº›æ¨¡å‹éƒ½æ˜¯åŒæ ·éšæœºä»100ä¸ªé‡Œé¢é€‰10ä¸ªvariableå‡ºæ¥è®­ç»ƒï¼Œæ¯ä¸€ä¸ªæ¨¡å‹ä¹‹é—´æ˜¯åŒä¸€çº§åˆ«çš„ã€äº’ä¸å¹²æ‰°çš„</p>\n<p>ä½†boostingçš„æ€è·¯å’Œbaggingä¸åŒï¼Œboostingé‡Œæ¯ä¸€ä¸ªæ¨¡å‹éƒ½æ˜¯åŸºäºä¸Šä¸€ä¸ªæ¨¡å‹æ¥è¿›è¡Œä¼˜åŒ–ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯è®­ç»ƒ1000ä¸ªæ¨¡å‹ï¼Œæ¯ä¸€ä¸ªæ¨¡å‹åœ¨ä¸Šä¸€ä¸ªæ¨¡å‹çš„åŸºç¡€ä¸Šå†å¥½ä¸€ç‚¹ç‚¹</p>\n","categories":["Machine Learning"]},{"title":"èšç±»å®éªŒ","url":"/2023/12/18/mllab5/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ol>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡k-meansèšç±»ç®—æ³•</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡DBSCANèšç±»ç®—æ³•</li>\n</ol>\n<h1 id=\"å®éªŒè¦æ±‚\"><a href=\"#å®éªŒè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒè¦æ±‚\"></a>å®éªŒè¦æ±‚</h1><ol>\n<li>   é‡‡ç”¨Pythonã€Matlabç­‰é«˜çº§è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œæ¨èä¼˜å…ˆé€‰ç”¨Pythonè¯­è¨€</li>\n<li>   æ ¸å¿ƒæ¨¡å‹å’Œç®—æ³•éœ€è‡ªä¸»ç¼–ç¨‹å®ç°ï¼Œä¸å¾—ç›´æ¥è°ƒç”¨Scikit-learnã€PyTorchç­‰æˆç†Ÿæ¡†æ¶çš„ç¬¬ä¸‰æ–¹å®ç°</li>\n<li>   ä»£ç å¯è¯»æ€§å¼ºï¼šå˜é‡ã€å‡½æ•°ã€ç±»ç­‰å‘½åå¯è¯»æ€§å¼ºï¼ŒåŒ…å«å¿…è¦çš„æ³¨é‡Š</li>\n</ol>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†<span id=\"more\"></span></h1><p>K-meansç®—æ³•æ˜¯æœ€ç®€å•çš„ä¸€ç§èšç±»ç®—æ³•ã€‚ç®—æ³•çš„ç›®çš„æ˜¯ä½¿å„ä¸ªæ ·æœ¬ä¸æ‰€åœ¨ç±»å‡å€¼çš„è¯¯å·®å¹³æ–¹å’Œè¾¾åˆ°æœ€å°ï¼ˆè¿™ä¹Ÿæ˜¯è¯„ä»·K-meansç®—æ³•æœ€åèšç±»æ•ˆæœçš„è¯„ä»·æ ‡å‡†ï¼‰<br>K-meansèšç±»ç®—æ³•çš„ä¸€èˆ¬æ­¥éª¤ï¼š<br>1.\tåˆå§‹åŒ–ã€‚è¾“å…¥åŸºå› è¡¨è¾¾çŸ©é˜µä½œä¸ºå¯¹è±¡é›†Xï¼Œè¾“å…¥æŒ‡å®šèšç±»ç±»æ•°Nï¼Œå¹¶åœ¨Xä¸­éšæœºé€‰å–Nä¸ªå¯¹è±¡ä½œä¸ºåˆå§‹èšç±»ä¸­å¿ƒã€‚è®¾å®šè¿­ä»£ä¸­æ­¢æ¡ä»¶ï¼Œæ¯”å¦‚æœ€å¤§å¾ªç¯æ¬¡æ•°æˆ–è€…èšç±»ä¸­å¿ƒæ”¶æ•›è¯¯å·®å®¹é™ã€‚<br>2.\tè¿›è¡Œè¿­ä»£ã€‚æ ¹æ®ç›¸ä¼¼åº¦å‡†åˆ™å°†æ•°æ®å¯¹è±¡åˆ†é…åˆ°æœ€æ¥è¿‘çš„èšç±»ä¸­å¿ƒï¼Œä»è€Œå½¢æˆä¸€ç±»ã€‚åˆå§‹åŒ–éš¶å±åº¦çŸ©é˜µã€‚<br>3.\tæ›´æ–°èšç±»ä¸­å¿ƒã€‚ç„¶åä»¥æ¯ä¸€ç±»çš„å¹³å‡å‘é‡ä½œä¸ºæ–°çš„èšç±»ä¸­å¿ƒï¼Œé‡æ–°åˆ†é…æ•°æ®å¯¹è±¡ã€‚<br>4.\tåå¤æ‰§è¡Œç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ç›´è‡³æ»¡è¶³ä¸­æ­¢æ¡ä»¶ã€‚</p>\n<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜é—®é¢˜ï¼š</p>\n<p>è®¾æœ‰ä¸€ç»„æ•°æ®é›†x1&#x3D;(2,1),x2&#x3D;(1,3),x3&#x3D;(6,7),x4&#x3D;(4,7)</p>\n<p>(1)é€‰å–èšç±»ä¸­å¿ƒï¼Œè¯¥ä¸­å¿ƒå¯ä»¥ä»»æ„é€‰å–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç›´æ–¹å›¾è¿›è¡Œé€‰å–ï¼Œè¿˜å¯ä»¥é€šè¿‡å–å‰2ä¸ªå€¼è¿›è¡Œé€‰å–ã€‚æˆ‘ä»¬é€‰æ‹©ä¸¤ä¸ªèšç±»ä¸­å¿ƒã€‚</p>\n<p>(2)è®¡ç®—æ¯ä¸€ä¸ªæ ·æœ¬å€¼åˆ°èšç±»ä¸­å¿ƒçš„è·ç¦»ï¼›å¹¶åˆ’åˆ†æ–°çš„èšç±»ä¸­å¿ƒï¼›<br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-27.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-28.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-29.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-30.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-31.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-32.png?raw=true\" alt=\"alt text\"></p>\n<p>è¯„ä»·æ ‡å‡†ï¼š<br>$$<br>J(c, \\mu)&#x3D;\\sum_{i&#x3D;1}^m\\left|x^{(i)}-\\mu_{c^{(i)}}\\right|^2<br>$$<br>å‡è®¾æœ‰ $\\mathrm{M}$ ä¸ªæ•°æ®æºï¼Œ $\\mathrm{C}$ ä¸ªèšç±»ä¸­å¿ƒã€‚ $\\mu \\mathrm{c}$ ä¸ºèšç±»ä¸­å¿ƒã€‚è¯¥å…¬å¼çš„æ„æ€ä¹Ÿå°±æ˜¯å°†æ¯ä¸ªç±»ä¸­çš„æ•°æ®ä¸æ¯ä¸ªèšç±»ä¸­å¿ƒåšå·®çš„å¹³æ–¹å’Œ, $\\mathrm{J}$ æœ€å°, æ„å‘³ç€åˆ†å‰²çš„æ•ˆæœæœ€å¥½ã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-33.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"K-meansèšç±»ç®—æ³•\"><a href=\"#K-meansèšç±»ç®—æ³•\" class=\"headerlink\" title=\"K-meansèšç±»ç®—æ³•\"></a>K-meansèšç±»ç®—æ³•</h2><p>é‡‡ç”¨æ•°æ®é›† â€œdata&#x2F;clustering1.csvâ€è¿›è¡Œk-meansèšç±»ç®—æ³•å®éªŒã€‚<br>æ•°æ®é›†ç®€ä»‹ï¼šæœ¬æ•°æ®é›†æ¥è‡ªUCIæ•°æ®åº“Sales_Transactions_Dataset_Weeklyæ•°æ®ï¼Œç»è¿‡ç®€å•ç­›é€‰åç»´åº¦ä¸º666\\times52ï¼Œå¯¹åº”666ç§å•†å“åœ¨52å‘¨çš„é”€é‡ã€‚</p>\n<ol>\n<li>å°†æ¯ä¸€ç§å•†å“çœ‹ä½œä¸€ä¸ªæ ·æœ¬, æ¯ä¸€å‘¨çœ‹ä½œä¸€ä¸ªå±æ€§, å¯¹å…¶è¿›è¡Œèšç±»ã€‚</li>\n<li>å¯¹æ•°æ®è¿›è¡Œ min-max å½’ä¸€åŒ–è‡³ $[0,1]$ åŒºé—´å†…:</li>\n<li>éšæœºæŒ‘é€‰ $\\mathrm{k}$ ä¸ªåˆå§‹èšç±»ä¸­å¿ƒ, ä½¿ç”¨æ¬§æ°è·ç¦»åº¦é‡å„æ ·æœ¬ä¸èšç±»ä¸­å¿ƒçš„è·ç¦»,åˆ’åˆ†èšç±»ã€‚</li>\n<li>æ›´æ–°èšç±»ä¸­å¿ƒ, é‡æ–°åˆ’åˆ†èšç±»ã€‚</li>\n<li>é‡å¤ç¬¬ 4 æ­¥, ç›´åˆ°å„ç±»åŒ…å«çš„æ ·æœ¬ä¸å†æ”¹å˜æˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°, è¾“å‡ºç»“æœã€‚</li>\n<li>å¯¹åŸæ ·æœ¬æ•°æ®è®¡ç®—å‡å€¼å’Œæ–¹å·®, è¿›è¡Œæ ‡å‡†åŒ–, ä½¿ç”¨ PCA é™ç»´æ–¹æ³•é™è‡³äºŒç»´,æ‰“å°æ•£ç‚¹å›¾è‡³äºŒç»´å¹³é¢ä¸­, ä»¥ä¸åŒçš„é¢œè‰²åŒºåˆ†ä¸åŒç±»åˆ«çš„æ ·æœ¬ã€‚</li>\n<li>æ›´æ¢éšæœºèšç±»ä¸­å¿ƒ, é‡å¤ä¸Šè¿°ç¬¬ 3-5 æ­¥å¹¶æ‰“å°æ•£ç‚¹å›¾ã€‚</li>\n<li>å‚æ•°è®¾ç½®: k åˆ†åˆ«å– 2ã€3ã€5ï¼Œæœ€å¤§è¿­ä»£æ¬¡æ•° maxiter å– 100</li>\n</ol>\n<p>ä»£ç è¾“å‡ºï¼šæ ·æœ¬äºŒç»´å›¾åƒï¼Œå…±6å¹…æ”¾åœ¨ä¸€èµ·ï¼Œä¸‰è¡Œä¸¤åˆ—ï¼Œåˆ†åˆ«å¯¹åº”3ä¸ªä¸åŒçš„kå€¼ï¼Œæ¯ä¸ªkå€¼å¯¹åº”ä¸¤æ¬¡ä¸åŒçš„åˆå§‹èšç±»ä¸­å¿ƒã€‚<br>##\tDBSCANèšç±»ç®—æ³•<br>é‡‡ç”¨æ•°æ®é›† â€œdata&#x2F;clustering2.csvâ€è¿›è¡ŒDBSCANèšç±»ç®—æ³•å®éªŒã€‚</p>\n<p>æ•°æ®é›†ç®€ä»‹: æœ¬æ•°æ®æ¥è‡ª DIP æ•°æ®åº“, ä¸ºè›‹ç™½è´¨ç›¸äº’ä½œç”¨ç½‘ç»œæ•°æ®, ç½‘ç»œ $G-$<br>$(E, V), \\mathrm{E}$ æ˜¯ç½‘ç»œä¸­çš„èŠ‚ç‚¹çš„é›†åˆ, å³è›‹ç™½è´¨, $\\mathrm{V}$ æ˜¯ç½‘ç»œä¸­çš„è¾¹çš„é›†åˆ, å³è›‹ç™½è´¨ -è›‹ç™½è´¨ç›¸äº’ä½œç”¨ã€‚ç½‘ç»œä¿å­˜ä¸ºé‚»æ¥çŸ©é˜µ $\\mathrm{A}$ çš„å½¢å¼, çŸ©é˜µä¸­å…ƒç´  $A_{i j}$ ä»£è¡¨ç¬¬ $\\mathrm{i}$ ä¸ªè›‹ç™½è´¨å’Œç¬¬ $\\mathrm{j}$ ä¸ªè›‹ç™½è´¨æ˜¯å¦å­˜åœ¨ç›¸äº’ä½œç”¨, è‹¥å€¼ä¸º 1 , åˆ™å­˜åœ¨ç›¸äº’ä½œç”¨, å¹¶æœ‰ä¸€æ¡è¾¹è¿æ¥è¿™ä¸¤ä¸ªèŠ‚ç‚¹ã€‚çŸ©é˜µä¸­ $A_{i j}$ å’Œ $A_{j i}$ å¯¹åº”åŒä¸€æ¡è¾¹ã€‚çŸ©é˜µç»´åº¦ä¸º $1274 \\times 1274$, å³å…±æœ‰ $1274$ ä¸ªè›‹ç™½è´¨ã€‚å­˜åœ¨ç›¸äº’ä½œç”¨çš„ä¸¤ä¸ªè›‹ç™½è´¨ä¹‹é—´çš„è·ç¦»å®šä¸º $1$ , æ— é¡»è®¡ç®—ã€‚</p>\n<ol>\n<li>æœ¬å®éªŒä¸­, é‚»åŸŸåŠå¾„ $\\varepsilon$ è®¾ä¸º 1 , å³å¯†åº¦ç›´è¾¾çš„ä¸¤ä¸ªèŠ‚ç‚¹å°±æ˜¯å­˜åœ¨ç›¸äº’ä½œç”¨çš„ä¸¤ä¸ªè›‹ç™½è´¨, ä¹Ÿå°±æ˜¯è¯´é‚»æ¥çŸ©é˜µä¸­å€¼ä¸º 1 çš„å…ƒç´ æ‰€åœ¨çš„è¡Œå’Œåˆ—æ‰€å¯¹åº”çš„ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¯†åº¦ç›´è¾¾çš„ã€‚</li>\n<li>å¯†åº¦é˜ˆå€¼ MinPts è®¾ä¸º $10 ã€ 15 ã€ 20$ ã€‚</li>\n<li>ä¾æ®å¯†åº¦èšç±»æµç¨‹, é¦–å…ˆæ ¹æ® MinPts æ„é€ æ ¸å¿ƒå¯¹è±¡å­é›†ã€‚</li>\n<li>ä¾æ¬¡ä»ä¸­å–å‡ºä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡ (åŒæ—¶ä»å­é›†ä¸­åˆ å»è¯¥èŠ‚ç‚¹), å°†å®ƒçš„é‚»å±…åŠ å…¥å¾…è®¿é—®èŠ‚ç‚¹å­é›†ã€‚ä¾æ¬¡ä»å¾…è®¿é—®èŠ‚ç‚¹å­é›†ä¸­å–å‡ºä¸€ä¸ªèŠ‚ç‚¹ $v$ (åŒæ—¶ä»å­é›†ä¸­åˆ å»è¯¥èŠ‚ç‚¹), è‹¥å®ƒæ˜¯æ ¸å¿ƒå¯¹è±¡, å°†å®ƒçš„é‚»å±…ä¹Ÿæ”¾å…¥å¾…è®¿é—®èŠ‚ç‚¹å­é›†ã€‚é‡å¤è¿™ä¸€è¿‡ç¨‹, ç›´åˆ°å¾…è®¿é—®èŠ‚ç‚¹å­é›†ä¸ºç©ºé›†, æ­¤æ—¶æ‰€æœ‰è®¿é—®è¿‡çš„ç»“ç‚¹æ„æˆä¸€ä¸ªèšç±»ã€‚</li>\n<li>é‡å¤ç¬¬ 5 æ­¥, ç›´åˆ°æ ¸å¿ƒå¯¹è±¡å­é›†ä¸ºç©ºé›†ã€‚</li>\n<li>è®¡ç®—å„ä¸ªèšç±»çš„èšç±»ç³»æ•°ï¼š<br>$$coef&#x3D;\\frac{n_{edge}}{2\\times n_{node}\\times\\left(n_{node-1}\\right)}$$</li>\n<li>   ä¿å­˜æ‰€æœ‰èšç±»çš„èšç±»ç³»æ•°ã€‚</li>\n</ol>\n<p>ä»£ç è¾“å‡º:ä¸åŒå¯†åº¦é˜ˆå€¼MinPtså–å€¼æ—¶å¯¹åº”çš„èšç±»æ•°é‡å’Œç›¸åº”å„ä¸ªèšç±»çš„èšç±»ç³»æ•°</p>\n<h1 id=\"å®éªŒä»£ç å’Œç»“æœ\"><a href=\"#å®éªŒä»£ç å’Œç»“æœ\" class=\"headerlink\" title=\"å®éªŒä»£ç å’Œç»“æœ\"></a>å®éªŒä»£ç å’Œç»“æœ</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">from</span> matplotlib <span class=\"keyword\">import</span> pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">KMeans</span>:</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">distEclud</span>(<span class=\"params\">self, vecA, vecB</span>):</span><br><span class=\"line\">        <span class=\"keyword\">return</span> np.linalg.norm(vecA - vecB)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">initCentroids</span>(<span class=\"params\">self, dataSet, k</span>):</span><br><span class=\"line\">        numSamples, dim = dataSet.shape</span><br><span class=\"line\">        centroids = np.zeros((k, dim))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k):</span><br><span class=\"line\">            index = <span class=\"built_in\">int</span>(np.random.uniform(<span class=\"number\">0</span>, numSamples))</span><br><span class=\"line\">            centroids[i, :] = dataSet[index, :]</span><br><span class=\"line\">        <span class=\"keyword\">return</span> centroids</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">kmeans</span>(<span class=\"params\">self, dataSet, k</span>):</span><br><span class=\"line\">        numSamples = dataSet.shape[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">        clusterAssment = np.mat(np.zeros((numSamples, <span class=\"number\">2</span>)))</span><br><span class=\"line\">        clusterChanged = <span class=\"literal\">True</span></span><br><span class=\"line\"></span><br><span class=\"line\">        centroids = self.initCentroids(dataSet, k)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">while</span> clusterChanged:</span><br><span class=\"line\">            clusterChanged = <span class=\"literal\">False</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(numSamples):</span><br><span class=\"line\">                minDist = <span class=\"number\">100000.0</span></span><br><span class=\"line\">                minIndex = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k):</span><br><span class=\"line\">                    distance = self.distEclud(centroids[j, :], dataSet[i, :])</span><br><span class=\"line\">                    <span class=\"keyword\">if</span> distance &lt; minDist:</span><br><span class=\"line\">                        minDist = distance</span><br><span class=\"line\">                        minIndex = j</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> clusterAssment[i, <span class=\"number\">0</span>] != minIndex:</span><br><span class=\"line\">                    clusterChanged = <span class=\"literal\">True</span></span><br><span class=\"line\">                    clusterAssment[i, :] = minIndex, minDist ** <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(k):</span><br><span class=\"line\">                pointsInCluster = dataSet[np.nonzero(clusterAssment[:, <span class=\"number\">0</span>].A == j)[<span class=\"number\">0</span>]]</span><br><span class=\"line\">                centroids[j, :] = np.mean(pointsInCluster, axis=<span class=\"number\">0</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> centroids, clusterAssment</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">pca</span>(<span class=\"params\">data, k=<span class=\"number\">2</span></span>):</span><br><span class=\"line\">    mean_vals = np.mean(data, axis=<span class=\"number\">0</span>)</span><br><span class=\"line\">    mean_removed = data - mean_vals</span><br><span class=\"line\">    cov_mat = np.cov(mean_removed, rowvar=<span class=\"literal\">False</span>)</span><br><span class=\"line\">    eig_vals, eig_vecs = np.linalg.eig(np.mat(cov_mat))</span><br><span class=\"line\">    eig_val_index = np.argsort(eig_vals)[::-<span class=\"number\">1</span>]</span><br><span class=\"line\">    eig_val_index = eig_val_index[:k]</span><br><span class=\"line\">    reduced_data = mean_removed * eig_vecs[:, eig_val_index]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> reduced_data</span><br><span class=\"line\"></span><br><span class=\"line\">data = pd.read_csv(<span class=\"string\">r&#x27;E:\\Google\\data\\clustering1.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">data1=data.values</span><br><span class=\"line\">Max=data1.<span class=\"built_in\">max</span>()</span><br><span class=\"line\">Min=data1.<span class=\"built_in\">min</span>()</span><br><span class=\"line\">data1=(data1-Min)/(Max-Min)</span><br><span class=\"line\">kmeans_instance = KMeans()</span><br><span class=\"line\">centroids, cluster_assignment = kmeans_instance.kmeans(data1, k=<span class=\"number\">5</span>)</span><br><span class=\"line\">data=data.values</span><br><span class=\"line\">Mean=data.mean()</span><br><span class=\"line\">Std=data.std()</span><br><span class=\"line\">data=(data-Mean)/Std</span><br><span class=\"line\">rd=pca(data)</span><br><span class=\"line\">rd=np.column_stack((rd,cluster_assignment[:, <span class=\"number\">0</span>]))</span><br><span class=\"line\">color=[<span class=\"string\">&#x27;r&#x27;</span>,<span class=\"string\">&#x27;g&#x27;</span>,<span class=\"string\">&#x27;b&#x27;</span>,<span class=\"string\">&#x27;c&#x27;</span>,<span class=\"string\">&#x27;m&#x27;</span>,<span class=\"string\">&#x27;y&#x27;</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(rd)):</span><br><span class=\"line\">    plt.scatter(rd[i,<span class=\"number\">0</span>],rd[i,<span class=\"number\">1</span>],color=color[<span class=\"built_in\">int</span>(rd[i,<span class=\"number\">2</span>])])</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n<p>k&#x3D;2</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-34.png?raw=true\" alt=\"alt text\"></p>\n<p>k&#x3D;3</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-35.png?raw=true\" alt=\"alt text\"></p>\n<p>k&#x3D;5</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-36.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">DBSCAN</span>(<span class=\"params\">Matrix, eps, min_pts</span>):</span><br><span class=\"line\">    Cluster = np.full(Matrix.shape[<span class=\"number\">0</span>], -<span class=\"number\">1</span>, dtype=<span class=\"built_in\">int</span>)</span><br><span class=\"line\">    cluster_id = <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(Matrix.shape[<span class=\"number\">0</span>]):</span><br><span class=\"line\">        <span class=\"keyword\">if</span> Cluster[i] != -<span class=\"number\">1</span>:</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">        neighbors = Neighbors(Matrix, i, eps)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(neighbors) &lt; min_pts:</span><br><span class=\"line\">            Cluster[i] = <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            Expand(Matrix, Cluster, i, neighbors, cluster_id, eps, min_pts)</span><br><span class=\"line\">            cluster_id += <span class=\"number\">1</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> Cluster</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">Neighbors</span>(<span class=\"params\">Matrix, center, eps</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> np.where(Matrix[center] == <span class=\"number\">1</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">Expand</span>(<span class=\"params\">Matrix, Cluster, center, neighbors, cluster_id, eps, min_pts</span>):</span><br><span class=\"line\">    Cluster[center] = cluster_id</span><br><span class=\"line\"></span><br><span class=\"line\">    i = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">while</span> i &lt; <span class=\"built_in\">len</span>(neighbors):</span><br><span class=\"line\">        n = neighbors[i]</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> Cluster[n] == -<span class=\"number\">1</span>:</span><br><span class=\"line\">            Cluster[n] = cluster_id</span><br><span class=\"line\">            new_neighbors = Neighbors(Matrix, n, eps)</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(new_neighbors) &gt;= min_pts:</span><br><span class=\"line\">                neighbors = np.concatenate((neighbors, new_neighbors))</span><br><span class=\"line\"></span><br><span class=\"line\">        i += <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">Coefficient</span>(<span class=\"params\">Matrix, Cluster, cluster_id</span>):</span><br><span class=\"line\">    cluster_nodes = np.where(Cluster == cluster_id)[<span class=\"number\">0</span>]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">len</span>(cluster_nodes) &lt; <span class=\"number\">2</span>:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0.0</span></span><br><span class=\"line\"></span><br><span class=\"line\">    internal_edges = np.<span class=\"built_in\">sum</span>(Matrix[np.ix_(cluster_nodes, cluster_nodes)])</span><br><span class=\"line\"></span><br><span class=\"line\">    cluster_coefficient = <span class=\"number\">2.0</span> * internal_edges / (<span class=\"built_in\">len</span>(cluster_nodes) * (<span class=\"built_in\">len</span>(cluster_nodes) - <span class=\"number\">1</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> cluster_coefficient</span><br><span class=\"line\">A = pd.read_csv(<span class=\"string\">r&#x27;E:\\Google\\data\\clustering2.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">A=A.to_numpy()</span><br><span class=\"line\">min_pts_values = [<span class=\"number\">10</span>, <span class=\"number\">15</span>, <span class=\"number\">20</span>]</span><br><span class=\"line\"><span class=\"keyword\">for</span> min_pts <span class=\"keyword\">in</span> min_pts_values:</span><br><span class=\"line\">    Cluster = DBSCAN(A, eps=<span class=\"number\">1</span>, min_pts=min_pts)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;MinPts=<span class=\"subst\">&#123;min_pts&#125;</span>\\n&#x27;</span>)</span><br><span class=\"line\">    unique_Cluster= np.unique(Cluster)</span><br><span class=\"line\">    <span class=\"keyword\">for</span> cluster <span class=\"keyword\">in</span> unique_Cluster:</span><br><span class=\"line\">        cluster_members = np.where(Cluster == cluster)[<span class=\"number\">0</span>]</span><br><span class=\"line\">        coefficient = Coefficient(A, Cluster, cluster)</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Cluster <span class=\"subst\">&#123;cluster&#125;</span>: <span class=\"subst\">&#123;coefficient&#125;</span>\\n&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-37.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-38.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-39.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å°ç»“æˆ–è®¨è®º\"><a href=\"#å°ç»“æˆ–è®¨è®º\" class=\"headerlink\" title=\"å°ç»“æˆ–è®¨è®º\"></a>å°ç»“æˆ–è®¨è®º</h1><p>kå‡å€¼ç®€å•å¹¶ä¸”å¯ä»¥ç”¨äºå„ç§æ•°æ®ç±»å‹ã€‚å®ƒç›¸å½“æœ‰æ•ˆï¼Œå°½ç®¡å¸¸å¸¸å¤šæ¬¡è¿è¡Œã€‚kå‡å€¼çš„æŸäº›å˜ç§ï¼ˆåŒ…æ‹¬äºŒåˆ†Kå‡å€¼ï¼‰ç”šè‡³æ›´æœ‰æ•ˆï¼Œå¹¶ä¸”ä¸å¤ªå—åˆå§‹åŒ–é—®é¢˜çš„å½±å“ã€‚ç„¶è€Œï¼Œkå‡å€¼å¹¶ä¸é€‚åˆæ‰€æœ‰çš„æ•°æ®ç±»å‹ã€‚å®ƒä¸èƒ½å‡ºæ¥éçƒå½¢ç°‡ã€ä¸åŒå°ºå¯¸å’Œä¸åŒå¯†åº¦çš„ç°‡ã€‚æœ€åï¼Œkå‡å€¼ä»…é™äºå…·æœ‰ä¸­å¿ƒï¼ˆè´¨å¿ƒï¼‰æ¦‚å¿µçš„æ•°æ®ã€‚</p>\n<p>DBSCAN(Density-Based Spatial Clustering of Applications with Noise)æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„åŸºäºå¯†åº¦çš„èšç±»ç®—æ³•ã€‚ä¸åˆ’åˆ†å’Œå±‚æ¬¡èšç±»æ–¹æ³•ä¸åŒï¼Œå®ƒå°†ç°‡å®šä¹‰ä¸ºå¯†åº¦ç›¸è¿çš„ç‚¹çš„æœ€å¤§é›†åˆï¼Œèƒ½å¤ŸæŠŠå…·æœ‰è¶³å¤Ÿé«˜å¯†åº¦çš„åŒºåŸŸåˆ’åˆ†ä¸ºç°‡ï¼Œå¹¶å¯åœ¨å™ªå£°çš„ç©ºé—´æ•°æ®åº“ä¸­å‘ç°ä»»æ„å½¢çŠ¶çš„èšç±»ï¼ˆç¬”è€…è®¤ä¸ºæ˜¯å› ä¸ºä»–ä¸æ˜¯åŸºäºè·ç¦»çš„ï¼ŒåŸºäºè·ç¦»çš„å‘ç°çš„æ˜¯çƒçŠ¶ç°‡ï¼‰ã€‚</p>\n<p>è¯¥ç®—æ³•åˆ©ç”¨åŸºäºå¯†åº¦çš„èšç±»çš„æ¦‚å¿µï¼Œå³è¦æ±‚èšç±»ç©ºé—´ä¸­çš„ä¸€å®šåŒºåŸŸå†…æ‰€åŒ…å«å¯¹è±¡ï¼ˆç‚¹æˆ–å…¶ä»–ç©ºé—´å¯¹è±¡ï¼‰çš„æ•°ç›®ä¸å°äºæŸä¸€ç»™å®šé˜ˆå€¼ã€‚DBSCANç®—æ³•çš„æ˜¾è‘—ä¼˜ç‚¹æ˜¯èšç±»é€Ÿåº¦å¿«ä¸”èƒ½å¤Ÿæœ‰æ•ˆå¤„ç†å™ªå£°ç‚¹å’Œå‘ç°ä»»æ„å½¢çŠ¶çš„ç©ºé—´èšç±»ã€‚ä½†æ˜¯ç”±äºå®ƒç›´æ¥å¯¹æ•´ä¸ªæ•°æ®åº“è¿›è¡Œæ“ä½œä¸”è¿›è¡Œèšç±»æ—¶ä½¿ç”¨äº†ä¸€ä¸ªå…¨å±€æ€§çš„è¡¨å¾å¯†åº¦çš„å‚æ•°ï¼Œå› æ­¤ä¹Ÿå…·æœ‰ä¸¤ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„å¼±ç‚¹ï¼š</p>\n<p>ï¼ˆ1ï¼‰å½“æ•°æ®é‡å¢å¤§æ—¶ï¼Œè¦æ±‚è¾ƒå¤§çš„å†…å­˜æ”¯æŒI&#x2F;Oæ¶ˆè€—ä¹Ÿå¾ˆå¤§ï¼›</p>\n<p>ï¼ˆ2ï¼‰å½“ç©ºé—´èšç±»çš„å¯†åº¦ä¸å‡åŒ€ã€èšç±»é—´è·å·®ç›¸å·®å¾ˆå¤§æ—¶ï¼Œèšç±»è´¨é‡è¾ƒå·®ï¼ˆæœ‰äº›ç°‡å†…è·ç¦»è¾ƒå°ï¼Œæœ‰äº›ç°‡å†…è·ç¦»å¾ˆå¤§ï¼Œä½†æ˜¯Epsæ˜¯ç¡®å®šçš„ï¼Œæ‰€ä»¥ï¼Œå¤§çš„ç‚¹å¯èƒ½è¢«è¯¯åˆ¤æ–­ä¸ºç¦»ç¾¤ç‚¹æˆ–è€…è¾¹ç•Œç‚¹ï¼Œå¦‚æœEpså¤ªå¤§ï¼Œé‚£ä¹ˆå°è·ç¦»çš„ç°‡å†…ï¼Œå¯èƒ½ä¼šåŒ…å«ä¸€äº›ç¦»ç¾¤ç‚¹æˆ–è€…è¾¹ç•Œç‚¹ï¼ŒKNNçš„kä¹Ÿå­˜åœ¨åŒæ ·çš„é—®é¢˜ï¼‰ã€‚</p>\n<p>ï¼ˆ1ï¼‰ä¸K-MEANSæ¯”è¾ƒèµ·æ¥ï¼Œä¸éœ€è¦è¾“å…¥è¦åˆ’åˆ†çš„èšç±»ä¸ªæ•°ï¼›</p>\n<p>ï¼ˆ2ï¼‰èšç±»ç°‡çš„å½¢çŠ¶æ²¡æœ‰åå€šï¼›</p>\n<p>ï¼ˆ3ï¼‰å¯ä»¥åœ¨éœ€è¦æ—¶è¾“å…¥è¿‡æ»¤å™ªå£°çš„å‚æ•°ï¼›</p>\n","categories":["Machine Learning"]},{"title":"ç¥ç»ç½‘ç»œåˆ†ç±»ä»»åŠ¡ç»¼åˆå®éªŒ","url":"/2023/12/25/mllab6/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ol>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡æœºå™¨å­¦ä¹ çš„å®Œæ•´æµç¨‹</li>\n<li>   ç†Ÿæ‚‰å’ŒæŒæ¡ç¥ç»ç½‘ç»œçš„æ„å»º</li>\n</ol>\n<h1 id=\"å®éªŒè¦æ±‚\"><a href=\"#å®éªŒè¦æ±‚\" class=\"headerlink\" title=\"å®éªŒè¦æ±‚\"></a>å®éªŒè¦æ±‚</h1><ol>\n<li>   é‡‡ç”¨Pythonã€Matlabç­‰é«˜çº§è¯­è¨€è¿›è¡Œç¼–ç¨‹ï¼Œæ¨èä¼˜å…ˆé€‰ç”¨Pythonè¯­è¨€</li>\n<li>   ä»£ç å¯è¯»æ€§å¼ºï¼šå˜é‡ã€å‡½æ•°ã€ç±»ç­‰å‘½åå¯è¯»æ€§å¼ºï¼ŒåŒ…å«å¿…è¦çš„æ³¨é‡Š</li>\n</ol>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†<span id=\"more\"></span></h1><p>äººå·¥ç¥ç»ç½‘ç»œï¼ˆANNï¼‰ï¼Œç®€ç§°ç¥ç»ç½‘ç»œï¼Œæ˜¯ä¸€ç§æ¨¡ä»¿ç”Ÿç‰©ç¥ç»ç½‘ç»œçš„ç»“æ„å’ŒåŠŸèƒ½çš„æ•°å­¦æ¨¡å‹æˆ–è®¡ç®—æ¨¡å‹ã€‚ç¥ç»ç½‘ç»œç”±å¤§é‡çš„äººå·¥ç¥ç»å…ƒè”ç»“è¿›è¡Œè®¡ç®—ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹äººå·¥ç¥ç»ç½‘ç»œèƒ½åœ¨å¤–ç•Œä¿¡æ¯çš„åŸºç¡€ä¸Šæ”¹å˜å†…éƒ¨ç»“æ„ï¼Œæ˜¯ä¸€ç§è‡ªé€‚åº”ç³»ç»Ÿã€‚ç°ä»£ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§éçº¿æ€§ç»Ÿè®¡æ€§æ•°æ®å»ºæ¨¡å·¥å…·ï¼Œå¸¸ç”¨æ¥å¯¹è¾“å…¥å’Œè¾“å‡ºé—´å¤æ‚çš„å…³ç³»è¿›è¡Œå»ºæ¨¡ï¼Œæˆ–ç”¨æ¥æ¢ç´¢æ•°æ®çš„æ¨¡å¼ã€‚<br>äººå·¥ç¥ç»ç½‘ç»œä»ä»¥ä¸‹å››ä¸ªæ–¹é¢å»æ¨¡æ‹Ÿäººçš„æ™ºèƒ½è¡Œä¸º:</p>\n<ul>\n<li>ç‰©ç†ç»“æ„ï¼šäººå·¥ç¥ç»å…ƒå°†æ¨¡æ‹Ÿç”Ÿç‰©ç¥ç»å…ƒçš„åŠŸèƒ½</li>\n<li>è®¡ç®—æ¨¡æ‹Ÿï¼šäººè„‘çš„ç¥ç»å…ƒæœ‰å±€éƒ¨è®¡ç®—å’Œå­˜å‚¨çš„åŠŸèƒ½ï¼Œé€šè¿‡è¿æ¥æ„æˆä¸€ä¸ªç³»ç»Ÿã€‚äººå·¥ç¥ç»ç½‘ç»œä¸­ä¹Ÿæœ‰å¤§é‡æœ‰å±€éƒ¨å¤„ç†èƒ½åŠ›çš„ç¥ç»å…ƒï¼Œä¹Ÿèƒ½å¤Ÿå°†ä¿¡æ¯è¿›è¡Œå¤§è§„æ¨¡å¹¶è¡Œå¤„ç†</li>\n<li>å­˜å‚¨ä¸æ“ä½œï¼šäººè„‘å’Œäººå·¥ç¥ç»ç½‘ç»œéƒ½æ˜¯é€šè¿‡ç¥ç»å…ƒçš„è¿æ¥å¼ºåº¦æ¥å®ç°è®°å¿†å­˜å‚¨åŠŸèƒ½ï¼ŒåŒæ—¶ä¸ºæ¦‚æ‹¬ã€ç±»æ¯”ã€æ¨å¹¿æä¾›æœ‰åŠ›çš„æ”¯æŒ</li>\n<li>è®­ç»ƒï¼šåŒäººè„‘ä¸€æ ·ï¼Œäººå·¥ç¥ç»ç½‘ç»œå°†æ ¹æ®è‡ªå·±çš„ç»“æ„ç‰¹æ€§ï¼Œä½¿ç”¨ä¸åŒçš„è®­ç»ƒã€å­¦ä¹ è¿‡ç¨‹ï¼Œè‡ªåŠ¨ä»å®è·µä¸­è·å¾—ç›¸å…³çŸ¥è¯†</li>\n</ul>\n<p>ç¥ç»ç½‘ç»œæ˜¯ä¸€ç§è¿ç®—æ¨¡å‹ï¼Œç”±å¤§é‡çš„èŠ‚ç‚¹ï¼ˆæˆ–ç§°â€œç¥ç»å…ƒâ€ï¼Œæˆ–â€œå•å…ƒâ€ï¼‰å’Œä¹‹é—´ç›¸äº’è”æ¥æ„æˆã€‚æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ç§ç‰¹å®šçš„è¾“å‡ºå‡½æ•°ï¼Œç§°ä¸ºæ¿€åŠ±å‡½æ•°ã€‚æ¯ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„è¿æ¥éƒ½ä»£è¡¨ä¸€ä¸ªå¯¹äºé€šè¿‡è¯¥è¿æ¥ä¿¡å·çš„åŠ æƒå€¼ï¼Œç§°ä¹‹ä¸ºæƒé‡ï¼Œè¿™ç›¸å½“äºäººå·¥ç¥ç»ç½‘ç»œçš„è®°å¿†ã€‚ç½‘ç»œçš„è¾“å‡ºåˆ™ä¾ç½‘ç»œçš„è¿æ¥æ–¹å¼ï¼Œæƒé‡å€¼å’Œæ¿€åŠ±å‡½æ•°çš„ä¸åŒè€Œä¸åŒã€‚è€Œç½‘ç»œè‡ªèº«é€šå¸¸éƒ½æ˜¯å¯¹è‡ªç„¶ç•ŒæŸç§ç®—æ³•æˆ–è€…å‡½æ•°çš„é€¼è¿‘ï¼Œä¹Ÿå¯èƒ½æ˜¯å¯¹ä¸€ç§é€»è¾‘ç­–ç•¥çš„è¡¨è¾¾ã€‚</p>\n<h2 id=\"æ„ŸçŸ¥å™¨\"><a href=\"#æ„ŸçŸ¥å™¨\" class=\"headerlink\" title=\"æ„ŸçŸ¥å™¨\"></a>æ„ŸçŸ¥å™¨</h2><p>å†å²ä¸Šï¼Œç§‘å­¦å®¶ä¸€ç›´å¸Œæœ›æ¨¡æ‹Ÿäººçš„å¤§è„‘ï¼Œé€ å‡ºå¯ä»¥æ€è€ƒçš„æœºå™¨ã€‚äººä¸ºä»€ä¹ˆèƒ½å¤Ÿæ€è€ƒï¼Ÿç§‘å­¦å®¶å‘ç°ï¼ŒåŸå› åœ¨äºäººä½“çš„ç¥ç»ç½‘ç»œã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-40.png?raw=true\" alt=\"alt text\"></p>\n<p>æ—¢ç„¶æ€è€ƒçš„åŸºç¡€æ˜¯ç¥ç»å…ƒï¼Œå¦‚æœèƒ½å¤Ÿâ€äººé€ ç¥ç»å…ƒâ€ï¼ˆartificial neuronï¼‰ï¼Œå°±èƒ½ç»„æˆäººå·¥ç¥ç»ç½‘ç»œï¼Œæ¨¡æ‹Ÿæ€è€ƒã€‚ä¸Šä¸ªä¸–çºªå…­åå¹´ä»£ï¼Œæå‡ºäº†æœ€æ—©çš„â€äººé€ ç¥ç»å…ƒâ€æ¨¡å‹ï¼Œå«åšâ€æ„ŸçŸ¥å™¨â€ï¼ˆperceptronï¼‰ï¼Œç›´åˆ°ä»Šå¤©è¿˜åœ¨ç”¨ã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-41.png?raw=true\" alt=\"alt text\"></p>\n<p>ä¸Šå›¾çš„åœ†åœˆå°±ä»£è¡¨ä¸€ä¸ªæ„ŸçŸ¥å™¨ã€‚å®ƒæ¥å—å¤šä¸ªè¾“å…¥ï¼ˆx1ï¼Œx2ï¼Œx3â€¦ï¼‰ï¼Œäº§ç”Ÿä¸€ä¸ªè¾“å‡ºï¼ˆoutputï¼‰ï¼Œå¥½æ¯”ç¥ç»æœ«æ¢¢æ„Ÿå—å„ç§å¤–éƒ¨ç¯å¢ƒçš„å˜åŒ–ï¼Œæœ€åäº§ç”Ÿç”µä¿¡å·ã€‚</p>\n<p>ä¸ºäº†ç®€åŒ–æ¨¡å‹ï¼Œæˆ‘ä»¬çº¦å®šæ¯ç§è¾“å…¥åªæœ‰ä¸¤ç§å¯èƒ½ï¼š1 æˆ– 0ã€‚å¦‚æœæ‰€æœ‰è¾“å…¥éƒ½æ˜¯1ï¼Œè¡¨ç¤ºå„ç§æ¡ä»¶éƒ½æˆç«‹ï¼Œè¾“å‡ºå°±æ˜¯1ï¼›å¦‚æœæ‰€æœ‰è¾“å…¥éƒ½æ˜¯0ï¼Œè¡¨ç¤ºæ¡ä»¶éƒ½ä¸æˆç«‹ï¼Œè¾“å‡ºå°±æ˜¯0</p>\n<h2 id=\"å†³ç­–æ¨¡å‹\"><a href=\"#å†³ç­–æ¨¡å‹\" class=\"headerlink\" title=\"å†³ç­–æ¨¡å‹\"></a>å†³ç­–æ¨¡å‹</h2><p>å•ä¸ªçš„æ„ŸçŸ¥å™¨æ„æˆäº†ä¸€ä¸ªç®€å•çš„å†³ç­–æ¨¡å‹ï¼Œå·²ç»å¯ä»¥æ‹¿æ¥ç”¨äº†ã€‚çœŸå®ä¸–ç•Œä¸­ï¼Œå®é™…çš„å†³ç­–æ¨¡å‹åˆ™è¦å¤æ‚å¾—å¤šï¼Œæ˜¯ç”±å¤šä¸ªæ„ŸçŸ¥å™¨ç»„æˆçš„å¤šå±‚ç½‘ç»œã€‚</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-42.png?raw=true\" alt=\"alt text\"></p>\n<p>ä¸Šå›¾ä¸­ï¼Œåº•å±‚æ„ŸçŸ¥å™¨æ¥æ”¶å¤–éƒ¨è¾“å…¥ï¼Œåšå‡ºåˆ¤æ–­ä»¥åï¼Œå†å‘å‡ºä¿¡å·ï¼Œä½œä¸ºä¸Šå±‚æ„ŸçŸ¥å™¨çš„è¾“å…¥ï¼Œç›´è‡³å¾—åˆ°æœ€åçš„ç»“æœã€‚ï¼ˆæ³¨æ„ï¼šæ„ŸçŸ¥å™¨çš„è¾“å‡ºä¾ç„¶åªæœ‰ä¸€ä¸ªï¼Œä½†æ˜¯å¯ä»¥å‘é€ç»™å¤šä¸ªç›®æ ‡ã€‚ï¼‰</p>\n<p>ä¸€ä¸ªç¥ç»ç½‘ç»œçš„æ­å»ºï¼Œéœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ã€‚</p>\n<ul>\n<li>è¾“å…¥å’Œè¾“å‡º</li>\n<li>æƒé‡ï¼ˆWï¼‰å’Œé˜ˆå€¼ï¼ˆbï¼‰</li>\n<li>å¤šå±‚æ„ŸçŸ¥æœºçš„ç»“æ„</li>\n</ul>\n<p>ç¥ç»ç½‘ç»œçš„è¿ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p>\n<p>ç¡®å®šè¾“å…¥å’Œè¾“å‡º<br>1.\tæ‰¾åˆ°ä¸€ç§æˆ–å¤šç§ç®—æ³•ï¼Œå¯ä»¥ä»è¾“å…¥å¾—åˆ°è¾“å‡º<br>2.\tæ‰¾åˆ°ä¸€ç»„å·²çŸ¥ç­”æ¡ˆçš„æ•°æ®é›†ï¼Œç”¨æ¥è®­ç»ƒæ¨¡å‹ï¼Œä¼°ç®—Wå’Œb<br>3.\tä¸€æ—¦æ–°çš„æ•°æ®äº§ç”Ÿï¼Œè¾“å…¥æ¨¡å‹ï¼Œå°±å¯ä»¥å¾—åˆ°ç»“æœï¼ŒåŒæ—¶å¯¹Wå’Œbè¿›è¡Œæ ¡æ­£</p>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦æµ·é‡è®¡ç®—ã€‚æ‰€ä»¥ï¼Œç¥ç»ç½‘ç»œç›´åˆ°æœ€è¿‘è¿™å‡ å¹´æ‰æœ‰å®ç”¨ä»·å€¼ï¼Œè€Œä¸”ä¸€èˆ¬çš„ CPU è¿˜ä¸è¡Œï¼Œè¦ä½¿ç”¨ä¸“é—¨ä¸ºæœºå™¨å­¦ä¹ å®šåˆ¶çš„ GPU æ¥è®¡ç®—ã€‚</p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"æ•°æ®ç®€ä»‹\"><a href=\"#æ•°æ®ç®€ä»‹\" class=\"headerlink\" title=\"æ•°æ®ç®€ä»‹\"></a>æ•°æ®ç®€ä»‹</h2><p>é‡‡ç”¨æ•°æ®é›† â€œdata&#x2F;positive.csvâ€å’Œâ€œdata&#x2F;negative.csvâ€è¿›è¡Œæœ¬æ¬¡å®éªŒã€‚</p>\n<h2 id=\"åŸå§‹æ•°æ®å¯è§†åŒ–\"><a href=\"#åŸå§‹æ•°æ®å¯è§†åŒ–\" class=\"headerlink\" title=\"åŸå§‹æ•°æ®å¯è§†åŒ–\"></a>åŸå§‹æ•°æ®å¯è§†åŒ–</h2><p>è°ƒç”¨å¯è§†åŒ–å·¥å…·ï¼Œå°†åŸå§‹æ•°æ®å¯è§†åŒ–è¾“å‡ºè‡³äºŒç»´å¹³é¢å†…ï¼Œä»¥é¢œè‰²åŒºåˆ†ä¸åŒç±»åˆ«ã€‚ï¼ˆpythonå¯ä½¿ç”¨UMAPï¼Œconda install umap-learnï¼›matlabå¯ä½¿ç”¨t-sneå‡½æ•°ï¼‰ã€‚</p>\n<h2 id=\"æ¨¡å‹è®¾è®¡\"><a href=\"#æ¨¡å‹è®¾è®¡\" class=\"headerlink\" title=\"æ¨¡å‹è®¾è®¡\"></a>æ¨¡å‹è®¾è®¡</h2><ol>\n<li>   æœ¬å®éªŒä¸ºäºŒåˆ†ç±»é—®é¢˜ï¼Œæ­£è´Ÿæ ·æœ¬å„200ä¸ªã€‚</li>\n<li>   ä½¿ç”¨BPç¥ç»ç½‘ç»œè¿›è¡ŒäºŒåˆ†ç±»ï¼ˆPythonå¯ä½¿ç”¨Pytorchï¼ŒMATLABå¯ä½¿ç”¨ç¥ç»ç½‘ç»œå·¥å…·ç®±newffå‡½æ•°ã€‚</li>\n<li>   è®¾è®¡åŒ…å«3ä¸ªéšè—å±‚çš„BPç¥ç»ç½‘ç»œï¼Œè¾“å…¥å±‚ç»´åº¦ä¸ºæ ·æœ¬ç»´åº¦ï¼›éšè—å±‚ç»´åº¦åˆ†åˆ«æ˜¯128ï¼Œ32ï¼Œ2ï¼Œéšè—å±‚ä½¿ç”¨reluæ¿€æ´»å‡½æ•°ï¼›è¾“å‡ºå±‚ç»´åº¦1ï¼Œä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•°ã€‚</li>\n</ol>\n<h2 id=\"æ¨¡å‹è®­ç»ƒä¸æ€§èƒ½è¯„ä¼°\"><a href=\"#æ¨¡å‹è®­ç»ƒä¸æ€§èƒ½è¯„ä¼°\" class=\"headerlink\" title=\"æ¨¡å‹è®­ç»ƒä¸æ€§èƒ½è¯„ä¼°\"></a>æ¨¡å‹è®­ç»ƒä¸æ€§èƒ½è¯„ä¼°</h2><ol>\n<li>   ä½¿ç”¨äº”æŠ˜äº¤å‰éªŒè¯ï¼ˆ5-fold cross-validationï¼‰è¯„ä¼°ç¥ç»ç½‘ç»œåœ¨è¯¥æ•°æ®ä¸Šçš„æ€§èƒ½ã€‚</li>\n<li>   äº”æŠ˜äº¤å‰éªŒè¯ï¼šå°†æ­£è´Ÿæ ·æœ¬å„åˆ†ä¸ºæ•°é‡ç›¸ç­‰çš„5ä»½ï¼š1-40ï¼Œ41-80ï¼Œ81-120ï¼Œ121-160ï¼Œ161-200ï¼Œå¹¶æŠŠ1ä»½æ­£æ ·æœ¬ä¸1ä»½è´Ÿæ ·æœ¬åˆå¹¶æ„æˆ1ä¸ªå­é›†ï¼Œåˆ™åŸæ•°æ®åˆ†æˆäº†5ä¸ªå­é›†ï¼Œä¸”å­é›†ä¸­æ­£è´Ÿæ ·æœ¬æ¯”ä¾‹1ï¼š1ä¿æŒä¸å˜ã€‚å¯¹æ¨¡å‹è¿›è¡Œ5æ¬¡è®­ç»ƒæµ‹è¯•ï¼š<ul>\n<li>ç¬¬iæ¬¡æ—¶ï¼Œé€‰æ‹©ç¬¬iä»½å­é›†ä½œä¸ºæµ‹è¯•é›†ï¼Œå…¶ä½™4ä»½æ•°æ®å­é›†ä½œä¸ºè®­ç»ƒé›†ã€‚ä½¿ç”¨è®­ç»ƒé›†è®­ç»ƒæ•°æ®ï¼Œå¹¶ä½¿ç”¨æµ‹è¯•é›†éªŒè¯&#x2F;æµ‹è¯•æ€§èƒ½ï¼Œè®¡ç®—æµ‹è¯•é›†çš„AUROCå€¼ã€‚</li>\n<li>æ¨¡å‹å€’æ•°ç¬¬2å±‚ç»´åº¦ä¸º2ï¼Œå¯¼å‡ºæµ‹è¯•é›†æ•°æ®åœ¨è¿™ä¸€å±‚ä¸Šçš„æ•°å€¼ï¼Œè¾“å‡ºæˆäºŒç»´æ•£ç‚¹å›¾ï¼ŒåŒ…å«ä¸¤ä¸ªå­å›¾ï¼šå­å›¾1çš„æ ‡ç­¾ä¸ºæµ‹è¯•æ ·æœ¬çš„é¢„æµ‹æ ‡ç­¾ï¼ˆå–å†³äºæ¨¡å‹è¾“å‡ºï¼Œå°†è¾“å‡ºå¤§äº0.5çš„æ ·æœ¬é¢„æµ‹ä¸ºæ­£æ ·æœ¬ï¼Œå¦åˆ™é¢„æµ‹ä¸ºè´Ÿæ ·æœ¬ï¼‰ï¼Œä»¥ä¸åŒé¢œè‰²åŒºåˆ†ä¸åŒçš„é¢„æµ‹ç»“æœï¼›å­å›¾2çš„æ ‡ç­¾ä¸ºæµ‹è¯•æ ·æœ¬çš„çœŸå®æ ‡ç­¾ï¼Œä»¥ä¸åŒé¢œè‰²åŒºåˆ†ä¸åŒçš„çœŸå®ç»“æœã€‚</li>\n<li>å®Œæˆ5æ¬¡ï¼Œä½¿å¾—æ¯ä¸€ä¸ªå­é›†éƒ½ä½œä¸ºæµ‹è¯•é›†1æ¬¡ï¼Œä½œä¸ºè®­ç»ƒé›†4æ¬¡ã€‚è®¡ç®—æ•´ä½“çš„AUROCã€‚</li>\n</ul>\n</li>\n<li>   æ‰“æ–­æ­£è´Ÿæ ·æœ¬æ’åˆ—ï¼Œé‡æ–°åˆ’åˆ†è®­ç»ƒé›†ä¸æµ‹è¯•é›†ï¼Œé‡æ–°è®­ç»ƒæ¨¡å‹ï¼ŒæŸ¥çœ‹æ€§èƒ½å˜åŒ–ã€‚</li>\n</ol>\n<h2 id=\"ç‰¹å¾é€‰æ‹©å’Œç‰¹å¾æå–\"><a href=\"#ç‰¹å¾é€‰æ‹©å’Œç‰¹å¾æå–\" class=\"headerlink\" title=\"ç‰¹å¾é€‰æ‹©å’Œç‰¹å¾æå–\"></a>ç‰¹å¾é€‰æ‹©å’Œç‰¹å¾æå–</h2><ol>\n<li>   ç‰¹å¾é€‰æ‹©ï¼šé’ˆå¯¹åŸå§‹æ•°æ®ï¼Œè®¡ç®—æ¯ä¸ªç‰¹å¾çš„æ–¹å·®ï¼Œé€‰å–ä¸¤ä¸ªæ–¹å·®æœ€å¤§çš„ç‰¹å¾ã€‚å°†æ­£è´Ÿæ ·æœ¬ç‚¹è¾“å‡ºä¸ºäºŒç»´æ•£ç‚¹å›¾ï¼Œä»¥é¢œè‰²åŒºåˆ†ã€‚</li>\n<li>   ç‰¹å¾æå–ï¼šé’ˆå¯¹åŸå§‹æ•°æ®ï¼Œè°ƒç”¨PCAé™ç»´å‡½æ•°å°†æ•°æ®é™åˆ°äºŒç»´ï¼Œå°†æ­£è´Ÿæ ·æœ¬ç‚¹è¾“å‡ºä¸ºäºŒç»´æ•£ç‚¹å›¾ï¼Œä»¥é¢œè‰²åŒºåˆ†ã€‚</li>\n</ol>\n<p>ä»£ç è¾“å‡ºï¼š</p>\n<ul>\n<li>åŸå§‹æ•°æ®çš„æ•£ç‚¹å›¾ï¼›</li>\n<li>æµ‹è¯•é›†çš„æ•£ç‚¹å›¾ï¼›</li>\n<li>ç»è¿‡ç‰¹å¾é€‰æ‹©åçš„æ•£ç‚¹å›¾ï¼›</li>\n<li>ç»è¿‡PCAé™ç»´åçš„æ•£ç‚¹å›¾ã€‚</li>\n</ul>\n<h1 id=\"å®éªŒä»£ç å’Œç»“æœ\"><a href=\"#å®éªŒä»£ç å’Œç»“æœ\" class=\"headerlink\" title=\"å®éªŒä»£ç å’Œç»“æœ\"></a>å®éªŒä»£ç å’Œç»“æœ</h1><figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\">po = pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\positive.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">ne=pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\negative.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">poe = umap.UMAP(n_components=<span class=\"number\">2</span>).fit_transform(po)</span><br><span class=\"line\">nee= umap.UMAP(n_components=<span class=\"number\">2</span>).fit_transform(ne)</span><br><span class=\"line\">plt.scatter(poe[:, <span class=\"number\">0</span>], poe[:, <span class=\"number\">1</span>],label=<span class=\"string\">&quot;positive&quot;</span>)</span><br><span class=\"line\">plt.scatter(nee[:, <span class=\"number\">0</span>], nee[:, <span class=\"number\">1</span>],label=<span class=\"string\">&quot;negative&quot;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-43.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.nn <span class=\"keyword\">as</span> nn</span><br><span class=\"line\"><span class=\"keyword\">import</span> torch.optim <span class=\"keyword\">as</span> optim</span><br><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.metrics <span class=\"keyword\">import</span> roc_auc_score</span><br><span class=\"line\"><span class=\"keyword\">import</span> matplotlib.pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.model_selection <span class=\"keyword\">import</span> StratifiedKFold</span><br><span class=\"line\"><span class=\"keyword\">from</span> sklearn.preprocessing <span class=\"keyword\">import</span> StandardScaler</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">NeuralNetwork</span>(nn.Module):</span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">__init__</span>(<span class=\"params\">self, input_dim, hidden_dims</span>):</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(NeuralNetwork, self).__init__()</span><br><span class=\"line\">        self.input_layer = nn.Linear(input_dim, hidden_dims[<span class=\"number\">0</span>])</span><br><span class=\"line\">        self.hidden_layers = nn.ModuleList([nn.Linear(hidden_dims[i], hidden_dims[i+<span class=\"number\">1</span>]) <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(hidden_dims)-<span class=\"number\">1</span>)])</span><br><span class=\"line\">        self.output_layer = nn.Linear(hidden_dims[-<span class=\"number\">1</span>], <span class=\"number\">1</span>)</span><br><span class=\"line\">        self.relu = nn.ReLU()</span><br><span class=\"line\">        self.sigmoid = nn.Sigmoid()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">def</span> <span class=\"title function_\">forward</span>(<span class=\"params\">self, x</span>):</span><br><span class=\"line\">        x = self.relu(self.input_layer(x))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> layer <span class=\"keyword\">in</span> self.hidden_layers:</span><br><span class=\"line\">            x = self.relu(layer(x))</span><br><span class=\"line\">        x = self.sigmoid(self.output_layer(x))</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¯»å–æ•°æ®</span></span><br><span class=\"line\">positive_data = pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\positive.csv&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">negative_data = pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\negative.csv&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆå¹¶æ•°æ®</span></span><br><span class=\"line\">data = pd.concat([positive_data, negative_data], ignore_index=<span class=\"literal\">True</span>,axis=<span class=\"number\">1</span>).T.values</span><br><span class=\"line\">label_train = np.concatenate([np.ones(<span class=\"number\">200</span>), np.zeros(<span class=\"number\">200</span>)])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å­˜å‚¨æ¯æ¬¡çš„AUCå€¼</span></span><br><span class=\"line\">auc_values = []</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># åˆå§‹åŒ–æ¨¡å‹</span></span><br><span class=\"line\">input_dim = data.shape[<span class=\"number\">1</span>]</span><br><span class=\"line\">hidden_dims = [<span class=\"number\">128</span>, <span class=\"number\">32</span>, <span class=\"number\">2</span>]</span><br><span class=\"line\">model = NeuralNetwork(input_dim, hidden_dims)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨</span></span><br><span class=\"line\">criterion = nn.BCELoss()</span><br><span class=\"line\">optimizer = optim.Adam(model.parameters(), lr=<span class=\"number\">0.001</span>)</span><br><span class=\"line\">skf=StratifiedKFold(n_splits=<span class=\"number\">5</span>,shuffle=<span class=\"literal\">True</span>)</span><br><span class=\"line\"><span class=\"comment\"># è¿›è¡Œ5æ¬¡æµ‹è¯•</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> fold,(train_indices,test_indices) <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(skf.split(data,label_train)):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;Fold <span class=\"subst\">&#123;fold + <span class=\"number\">1</span>&#125;</span>:&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    X_train, X_test = data[train_indices], data[test_indices]</span><br><span class=\"line\">    y_train, y_test = label_train[train_indices], label_train[test_indices]</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># Check if there are both positive and negative samples in the test set</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"built_in\">set</span>(y_test) == &#123;<span class=\"number\">0</span>&#125; <span class=\"keyword\">or</span> <span class=\"built_in\">set</span>(y_test) == &#123;<span class=\"number\">1</span>&#125;:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Warning: Test set contains only one class. Skipping evaluation for this fold.&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># æ•°æ®æ ‡å‡†åŒ–</span></span><br><span class=\"line\">    scaler = StandardScaler()</span><br><span class=\"line\">    X_train = scaler.fit_transform(X_train)</span><br><span class=\"line\">    X_test = scaler.transform(X_test)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># è½¬æ¢ä¸ºPyTorchçš„Tensor</span></span><br><span class=\"line\">    X_train_tensor = torch.tensor(X_train, dtype=torch.float32)</span><br><span class=\"line\">    y_train_tensor = torch.tensor(y_train, dtype=torch.float32).view(-<span class=\"number\">1</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    X_test_tensor = torch.tensor(X_test, dtype=torch.float32)</span><br><span class=\"line\">    y_test_tensor = torch.tensor(y_test, dtype=torch.float32).view(-<span class=\"number\">1</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># è®­ç»ƒæ¨¡å‹</span></span><br><span class=\"line\">    num_epochs = <span class=\"number\">1000</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> epoch <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(num_epochs):</span><br><span class=\"line\">        model.train()</span><br><span class=\"line\">        optimizer.zero_grad()</span><br><span class=\"line\">        outputs = model(X_train_tensor)</span><br><span class=\"line\">        loss = criterion(outputs, y_train_tensor)</span><br><span class=\"line\">        loss.backward()</span><br><span class=\"line\">        optimizer.step()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹</span></span><br><span class=\"line\">    model.<span class=\"built_in\">eval</span>()</span><br><span class=\"line\">    <span class=\"keyword\">with</span> torch.no_grad():</span><br><span class=\"line\">        test_outputs = model(X_test_tensor)</span><br><span class=\"line\">        predicted_labels = (test_outputs &gt;= <span class=\"number\">0.5</span>).<span class=\"built_in\">float</span>()</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Check if there are both positive and negative predictions</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"built_in\">set</span>(predicted_labels.numpy().flatten()) == &#123;<span class=\"number\">0</span>&#125; <span class=\"keyword\">or</span> <span class=\"built_in\">set</span>(predicted_labels.numpy().flatten()) == &#123;<span class=\"number\">1</span>&#125;:</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Warning: Predictions contain only one class. Skipping evaluation for this fold.&quot;</span>)</span><br><span class=\"line\">            <span class=\"keyword\">continue</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># è®¡ç®—AUCå€¼</span></span><br><span class=\"line\">        auc = roc_auc_score(y_test, predicted_labels.numpy())</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;AUC on test set: <span class=\"subst\">&#123;auc:<span class=\"number\">.4</span>f&#125;</span>&#x27;</span>)</span><br><span class=\"line\">        auc_values.append(auc)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># ç»˜åˆ¶æ•£ç‚¹å›¾</span></span><br><span class=\"line\">        plt.figure(figsize=(<span class=\"number\">8</span>, <span class=\"number\">6</span>))</span><br><span class=\"line\">        plt.subplot(<span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">        plt.scatter(<span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(predicted_labels)), predicted_labels.numpy(), label=<span class=\"string\">f&#x27;Fold <span class=\"subst\">&#123;fold + <span class=\"number\">1</span>&#125;</span>&#x27;</span>)</span><br><span class=\"line\">        plt.title(<span class=\"string\">&#x27;Predicted Labels&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        plt.subplot(<span class=\"number\">2</span>, <span class=\"number\">1</span>, <span class=\"number\">2</span>)</span><br><span class=\"line\">        plt.scatter(<span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(y_test)), y_test, label=<span class=\"string\">f&#x27;Fold <span class=\"subst\">&#123;fold + <span class=\"number\">1</span>&#125;</span>&#x27;</span>)</span><br><span class=\"line\">        plt.title(<span class=\"string\">&#x27;True Labels&#x27;</span>)</span><br><span class=\"line\">        plt.show()</span><br><span class=\"line\"></span><br><span class=\"line\">plt.tight_layout()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—æ•´ä½“çš„å¹³å‡AUCå€¼</span></span><br><span class=\"line\"></span><br><span class=\"line\">mean_auc = <span class=\"built_in\">sum</span>(auc_values) / <span class=\"built_in\">len</span>(auc_values)</span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">f&#x27;Mean AUC across folds: <span class=\"subst\">&#123;mean_auc:<span class=\"number\">.4</span>f&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-44.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-45.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-46.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-47.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-48.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-49.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-50.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-51.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-52.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-53.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-54.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-55.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">from</span> matplotlib <span class=\"keyword\">import</span> pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">X = pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\positive.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">Y=pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\negative.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">X=X.values</span><br><span class=\"line\">Y=Y.values</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—æ¯ä¸ªç‰¹å¾çš„æ–¹å·®</span></span><br><span class=\"line\">X_variances = np.var(X, axis=<span class=\"number\">0</span>)</span><br><span class=\"line\">Y_variances = np.var(Y, axis=<span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"comment\"># é€‰æ‹©ä¸¤ä¸ªæ–¹å·®æœ€å¤§çš„ç‰¹å¾</span></span><br><span class=\"line\">X_features = X[:, np.argsort(X_variances)[-<span class=\"number\">2</span>:]]</span><br><span class=\"line\">Y_features = Y[:, np.argsort(Y_variances)[-<span class=\"number\">2</span>:]]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºäºŒç»´æ•£ç‚¹å›¾</span></span><br><span class=\"line\">plt.scatter(X_features[:,<span class=\"number\">0</span>], X_features[:,<span class=\"number\">1</span>], color=<span class=\"string\">&#x27;blue&#x27;</span>, label=<span class=\"string\">&#x27;Positive Samples&#x27;</span>)</span><br><span class=\"line\">plt.scatter(Y_features[:,<span class=\"number\">0</span>], Y_features[:,<span class=\"number\">1</span>], color=<span class=\"string\">&#x27;red&#x27;</span>, label=<span class=\"string\">&#x27;Negative Samples&#x27;</span>)</span><br><span class=\"line\">plt.xlabel(<span class=\"string\">&#x27;Feature 1&#x27;</span>)</span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&#x27;Feature 2&#x27;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&#x27;Feature Selection&#x27;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-56.png?raw=true\" alt=\"alt text\"></p>\n<figure class=\"highlight python\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> pandas <span class=\"keyword\">as</span> pd</span><br><span class=\"line\"><span class=\"keyword\">from</span> matplotlib <span class=\"keyword\">import</span> pyplot <span class=\"keyword\">as</span> plt</span><br><span class=\"line\"><span class=\"keyword\">import</span> numpy <span class=\"keyword\">as</span> np</span><br><span class=\"line\">X = pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\positive.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">Y=pd.read_csv(<span class=\"string\">r&#x27;E:\\firefox download\\negative.csv&#x27;</span>,sep=<span class=\"string\">&#x27;,&#x27;</span>,header=<span class=\"literal\">None</span>)</span><br><span class=\"line\">X=X.values</span><br><span class=\"line\">Y=Y.values</span><br><span class=\"line\"></span><br><span class=\"line\">cov_matrix = np.cov(X, rowvar=<span class=\"literal\">False</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è®¡ç®—ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡</span></span><br><span class=\"line\">eigenvalues, eigenvectors = np.linalg.eigh(cov_matrix)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># é€‰æ‹©å‰ä¸¤ä¸ªç‰¹å¾å‘é‡å¯¹åº”çš„ç‰¹å¾å€¼æœ€å¤§çš„ä¸¤ä¸ªç‰¹å¾</span></span><br><span class=\"line\">X_features = np.dot(X, eigenvectors[:, -<span class=\"number\">2</span>:])</span><br><span class=\"line\">Y_features = np.dot(Y, eigenvectors[:, -<span class=\"number\">2</span>:])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># è¾“å‡ºäºŒç»´æ•£ç‚¹å›¾</span></span><br><span class=\"line\">plt.scatter(X_features[:,<span class=\"number\">0</span>], X_features[:,<span class=\"number\">1</span>], color=<span class=\"string\">&#x27;blue&#x27;</span>, label=<span class=\"string\">&#x27;Positive Samples&#x27;</span>)</span><br><span class=\"line\">plt.scatter(Y_features[:,<span class=\"number\">0</span>], Y_features[:,<span class=\"number\">1</span>], color=<span class=\"string\">&#x27;red&#x27;</span>, label=<span class=\"string\">&#x27;Negative Samples&#x27;</span>)</span><br><span class=\"line\">plt.xlabel(<span class=\"string\">&#x27;Principal Component 1&#x27;</span>)</span><br><span class=\"line\">plt.ylabel(<span class=\"string\">&#x27;Principal Component 2&#x27;</span>)</span><br><span class=\"line\">plt.title(<span class=\"string\">&#x27;Feature Extraction (PCA)&#x27;</span>)</span><br><span class=\"line\">plt.legend()</span><br><span class=\"line\">plt.show()</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/mlu-57.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å°ç»“æˆ–è®¨è®º\"><a href=\"#å°ç»“æˆ–è®¨è®º\" class=\"headerlink\" title=\"å°ç»“æˆ–è®¨è®º\"></a>å°ç»“æˆ–è®¨è®º</h1><p>æ˜¾è€Œæ˜“è§çš„æ˜¯ï¼Œç¥ç»ç½‘ç»œçš„åˆ†ç±»æ–¹æ³•èƒ½å¤Ÿé€‚ç”¨äºä»»ä½•æ•°æ®é›†ï¼Œåœ¨æ¨¡å‹æ­å»ºå¥½ä¹‹åï¼Œåªéœ€è¦è¿›è¡Œè®­ç»ƒï¼Œå°±å¯ä»¥å¾—åˆ°ä¸é”™çš„ç»“æœï¼Œè®­ç»ƒçš„è½®æ•°è¶Šå¤šï¼Œç½‘ç»œçš„å±‚æ•°è¶Šæ·±ï¼Œå°±èƒ½å¤Ÿå¾—åˆ°çº¦å‡†ç¡®çš„åˆ†ç±»ï¼Œä½†æ˜¯å¸¦æ¥çš„æ—¶é—´å¼€é”€ä¹Ÿæ˜¯å·¨å¤§çš„ã€‚</p>\n","categories":["Machine Learning"]},{"title":"è¿›ç¨‹è°ƒåº¦(ä¸Š)","url":"/2023/11/24/oslab1/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ul>\n<li>é’ˆå¯¹è¿›ç¨‹è°ƒåº¦çš„ç‰¹ç‚¹ï¼Œè®¾è®¡è¿›ç¨‹æ§åˆ¶å—PCBçš„æ•°æ®ç»“æ„</li>\n<li>é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„å»ºç«‹è¿›ç¨‹å°±ç»ªé˜Ÿåˆ—ï¼Œå®ç°å¯¹è¿›ç¨‹çš„æœ‰åºç»„ç»‡</li>\n<li>å®ç°æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•</li>\n<li>å®ç°åŸºäºä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•</li>\n</ul>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><ul>\n<li>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•ï¼ˆround robinï¼‰<span id=\"more\"></span><ul>\n<li>è¯¥ç®—æ³•é‡‡å–äº†éå¸¸å…¬å¹³çš„æ–¹å¼ï¼Œå³è®©å°±ç»ªé˜Ÿåˆ—ä¸Šçš„æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡ä»…è¿è¡Œä¸€ä¸ªæ—¶é—´ç‰‡ã€‚å¦‚æœå°±ç»ªé˜Ÿåˆ—ä¸Šæœ‰Nä¸ªè¿›ç¨‹ï¼Œåˆ™æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡å¤§çº¦éƒ½å¯è·å¾—1&#x2F;Nçš„å¤„ç†æœºæ—¶é—´ã€‚</li>\n<li>æ—¶é—´ç‰‡çš„å¤§å°å¯¹äºç³»ç»Ÿæ€§èƒ½æœ‰å¾ˆå¤§çš„å½±å“ã€‚è‹¥é€‰æ‹©å¾ˆå°çš„æ—¶é—´ç‰‡ï¼Œå°†æœ‰åˆ©äºçŸ­ä½œä¸šï¼Œä½†æ„å‘³ç€ä¼šé¢‘ç¹åœ°æ‰§è¡Œè¿›ç¨‹è°ƒåº¦å’Œè¿›ç¨‹ä¸Šä¸‹æ–‡çš„åˆ‡æ¢ï¼Œè¿™æ— ç–‘ä¼šå¢åŠ ç³»ç»Ÿçš„å¼€é”€ã€‚åä¹‹ï¼Œè‹¥æ—¶é—´ç‰‡é€‰æ‹©å¾—å¤ªé•¿ï¼Œä¸”ä¸ºä½¿æ¯ä¸ªè¿›ç¨‹éƒ½èƒ½åœ¨ä¸€ä¸ªæ—¶é—´ç‰‡å†…å®Œæˆï¼ŒRRç®—æ³•ä¾¿é€€åŒ–ä¸ºFCFSç®—æ³•ï¼Œæ— æ³•æ»¡è¶³çŸ­ä½œä¸šå’Œäº¤äº’å¼ç”¨æˆ·çš„éœ€æ±‚ã€‚</li>\n<li>è¿›ç¨‹çš„åˆ‡æ¢æ—¶æœºä½“ç°å‡ºRRç®—æ³•çš„ç‰¹ç‚¹ã€‚è‹¥ä¸€ä¸ªè¿›ç¨‹åœ¨æ—¶é—´ç‰‡è¿˜æ²¡ç»“æŸæ—¶å°±å·²å®Œæˆï¼Œæ­¤æ—¶ç«‹å³æ¿€æ´»è°ƒåº¦ç¨‹åºï¼Œå°†å®ƒä»æ‰§è¡Œé˜Ÿåˆ—ä¸­åˆ é™¤ã€‚è‹¥ä¸€ä¸ªè¿›ç¨‹åœ¨æ—¶é—´ç‰‡ç»“æŸæ—¶è¿˜æœªè¿è¡Œå®Œæ¯•ï¼Œåˆ™è°ƒåº¦ç¨‹åºå°†æŠŠå®ƒé€å¾€å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡æ‰§è¡Œã€‚ç”¨Cè¯­è¨€ç¼–ç¨‹æ¨¡æ‹Ÿè°ƒåº¦ç¨‹åºæ—¶ï¼Œå°†æ—¶é—´ç‰‡ï¼Œç¨‹åºè¿è¡Œæ—¶é—´é‡åŒ–ä¸ºæ•´æ•°</li>\n</ul>\n</li>\n<li>ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•<ul>\n<li>åœ¨æ—¶é—´ç‰‡ç®—æ³•ä¸­ï¼Œæ— æ³•å¯¹è¿›ç¨‹çš„ç´§æ€¥ç¨‹åº¦åŠ ä»¥åŒºåˆ†ã€‚è€Œä¼˜å…ˆçº§ç®—æ³•æ­£å¥½å¯ä»¥è§£å†³è¿™ä¸€é—®é¢˜ã€‚</li>\n<li>è¿›ç¨‹ä¼˜å…ˆçº§çš„ç¡®å®šåŒæ ·é‡è¦ã€‚è¿›ç¨‹ä¼˜å…ˆçº§å¯ä»¥åˆ†ä¸ºé™æ€ä¼˜å…ˆçº§å’ŒåŠ¨æ€ä¼˜å…ˆçº§ã€‚é™æ€ä¼˜å…ˆçº§æ˜¯åœ¨è¿›ç¨‹åˆ›å»ºåˆæœŸå°±è¢«ç¡®å®šçš„å€¼ï¼Œæ­¤åä¸å†æ›´æ”¹ã€‚åŠ¨æ€ä¼˜å…ˆçº§æŒ‡è¿›ç¨‹åœ¨åˆ›å»ºæ—¶è¢«èµ‹äºˆä¸€ä¸ªåˆå€¼ï¼Œæ­¤åå…¶å€¼ä¼šæ‰€è¿›ç¨‹çš„æ¨è¿›æˆ–ç­‰å¾…æ—¶é—´çš„å¢åŠ è€Œæ”¹å˜ã€‚</li>\n<li>ç”¨Cè¯­è¨€æ¨¡æ‹Ÿè°ƒåº¦ç¨‹åºæ—¶ï¼Œå¯ç”¨<code>p-&gt;priority += 1; /*ä¼˜å…ˆæ•°åŠ ,è‹¥è®¾ä¸º0åˆ™ä¼˜å…ˆçº§ä¸å˜*/ </code>è¿™æ¡è¯­å¥æ§åˆ¶é™æ€åŠ¨æ€ä¼˜å…ˆçº§çš„åˆ‡æ¢ã€‚</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"PCBçš„æ•°æ®ç»“æ„åŠè¿›ç¨‹çš„åŸºæœ¬æ“ä½œ\"><a href=\"#PCBçš„æ•°æ®ç»“æ„åŠè¿›ç¨‹çš„åŸºæœ¬æ“ä½œ\" class=\"headerlink\" title=\"PCBçš„æ•°æ®ç»“æ„åŠè¿›ç¨‹çš„åŸºæœ¬æ“ä½œ\"></a>PCBçš„æ•°æ®ç»“æ„åŠè¿›ç¨‹çš„åŸºæœ¬æ“ä½œ</h2><figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">pcb</span> &#123;</span> <span class=\"comment\">// å®šä¹‰è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰ç»“æ„ä½“</span></span><br><span class=\"line\">\t<span class=\"type\">char</span> name;</span><br><span class=\"line\">\t<span class=\"type\">char</span> state;</span><br><span class=\"line\">\t<span class=\"type\">int</span> arrivetime=<span class=\"number\">65535</span>;<span class=\"comment\">//åˆ°è¾¾æ—¶é—´</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> needtime=<span class=\"number\">65535</span>;<span class=\"comment\">//æ‰€éœ€æ—¶é—´</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> finishtime=<span class=\"number\">65535</span>;<span class=\"comment\">//ç»“æŸæ—¶é—´</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> servicetime = <span class=\"number\">0</span>; <span class=\"comment\">//æœåŠ¡æ—¶é—´</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> priority = <span class=\"number\">65535</span>; <span class=\"comment\">//ä¼˜å…ˆæ•°</span></span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">pcb</span>* <span class=\"title\">next</span>=</span><span class=\"literal\">NULL</span>; <span class=\"comment\">//ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">pcb</span> <span class=\"title\">PCB</span>;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">ReadyQueue</span>//å°±ç»ªé˜Ÿåˆ—</span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">\tPCB* head;</span><br><span class=\"line\">\tPCB* tail;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">initQueue</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue* rq)</span> &#123;<span class=\"comment\">//åˆå§‹åŒ–å°±ç»ªé˜Ÿåˆ—</span></span><br><span class=\"line\">\trq-&gt;head = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\trq-&gt;tail = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">EnQueue</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue* rq, PCB* p)</span> &#123;<span class=\"comment\">//å…¥é˜Ÿ</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!rq-&gt;head) &#123;</span><br><span class=\"line\">\t\trq-&gt;head = p;</span><br><span class=\"line\">\t\trq-&gt;tail = p;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\trq-&gt;tail-&gt;next = p;</span><br><span class=\"line\">\t\trq-&gt;tail = p;</span><br><span class=\"line\">\t\tp-&gt;next = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Dequeue</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue* rq, PCB** p)</span> &#123;<span class=\"comment\">//å‡ºé˜Ÿ</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (rq-&gt;head != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t*p = rq-&gt;head;</span><br><span class=\"line\">\t\trq-&gt;head = rq-&gt;head-&gt;next;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (rq-&gt;head == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t\trq-&gt;tail = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t(*p)-&gt;next = <span class=\"literal\">NULL</span>;  <span class=\"comment\">// Ensure the dequeued PCB points to NULL</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Creat</span><span class=\"params\">(<span class=\"type\">int</span> n, <span class=\"keyword\">struct</span> ReadyQueue* rq)</span> &#123;<span class=\"comment\">//åˆ›å»ºå°±ç»ªé˜Ÿåˆ—</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">\t\tPCB* temp1 = new PCB;</span><br><span class=\"line\">\t\t <span class=\"comment\">// Declare temp inside the loop to create a new object for each process</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//printf(&quot;Enter process name,arrive time and execution time: \\n&quot;);</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Enter process name,arrive time,execution time and priority: \\n&quot;</span>);</span><br><span class=\"line\">\t\tgetchar();</span><br><span class=\"line\">\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%c&quot;</span>, &amp;temp1-&gt;name);</span><br><span class=\"line\">\t\t<span class=\"comment\">//scanf(&quot;%d%d&quot;, &amp;temp1-&gt;arrivetime, &amp;temp1-&gt;needtime);</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d%d%d&quot;</span>, &amp;temp1-&gt;arrivetime,&amp;temp1-&gt;needtime, &amp;temp1-&gt;priority);</span><br><span class=\"line\">\t\ttemp1-&gt;state = <span class=\"string\">&#x27;W&#x27;</span>;</span><br><span class=\"line\">\t\tEnQueue(rq, temp1);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Processin</span><span class=\"params\">(PCB** p, ReadyQueue* rq1, <span class=\"type\">int</span> i)</span> &#123;<span class=\"comment\">//è¿›ç¨‹è¿›å…¥å°±ç»ªé˜Ÿåˆ—</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (*p &amp;&amp; (*p)-&gt;arrivetime &lt;= i) &#123;</span><br><span class=\"line\">\t\tPCB* temp1 = new PCB;</span><br><span class=\"line\">\t\ttemp1-&gt;arrivetime = (*p)-&gt;arrivetime;</span><br><span class=\"line\">\t\ttemp1-&gt;name = (*p)-&gt;name;</span><br><span class=\"line\">\t\ttemp1-&gt;state = (*p)-&gt;state;</span><br><span class=\"line\">\t\ttemp1-&gt;needtime = (*p)-&gt;needtime;</span><br><span class=\"line\">\t\ttemp1-&gt;priority = (*p)-&gt;priority;</span><br><span class=\"line\">\t\ttemp1-&gt;next = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (rq1-&gt;head == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t\trq1-&gt;head = temp1;</span><br><span class=\"line\">\t\t\trq1-&gt;tail = temp1;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\trq1-&gt;tail-&gt;next = temp1;</span><br><span class=\"line\">\t\t\trq1-&gt;tail = temp1;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t(*p) = (*p)-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">PCB* <span class=\"title function_\">Getprior</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq)</span>&#123; <span class=\"comment\">//è·å¾—ä¼˜å…ˆçº§æœ€é«˜çš„è¿›ç¨‹</span></span><br><span class=\"line\">\tPCB* p = rq.head; PCB* p1 = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p-&gt;priority &lt; p1-&gt;priority)p1 = p;</span><br><span class=\"line\">\t\tp = p-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Delete</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue* rq, PCB* p)</span> &#123;<span class=\"comment\">//åˆ é™¤èŠ‚ç‚¹</span></span><br><span class=\"line\">\tPCB* p1 = rq-&gt;head;PCB* p2;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p1-&gt;name == p-&gt;name) Dequeue(rq, &amp;p2);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p1-&gt;name != p-&gt;name) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (p1-&gt;next-&gt;name != p-&gt;name)</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tp1 = p1-&gt;next;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p1-&gt;next)p1-&gt;next = p1-&gt;next-&gt;next;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Print</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq)</span> &#123;<span class=\"comment\">//æ‰“å°å°±ç»ªé˜Ÿåˆ—</span></span><br><span class=\"line\">\tPCB* p = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (p)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//printf(&quot;è¿›ç¨‹å:%c\\tåˆ°è¾¾æ—¶é—´:%d\\tæ‰€éœ€æ—¶é—´:%d\\tè¿›ç¨‹çŠ¶æ€:%c\\t\\n&quot;, p-&gt;name,p-&gt;arrivetime,p-&gt;needtime, p-&gt;state);</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;è¿›ç¨‹å:%c\\tåˆ°è¾¾æ—¶é—´:%d\\tæ‰€éœ€æ—¶é—´:%d\\tä¼˜å…ˆæ•°:%d\\tè¿›ç¨‹çŠ¶æ€:%c\\t\\n\\</span></span><br><span class=\"line\"><span class=\"string\">&quot;</span>, p-&gt;name, p-&gt;arrivetime, p-&gt;needtime,p-&gt;priority,p-&gt;state);</span><br><span class=\"line\">\t\tp = p-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"ç®—æ³•å®ç°\"><a href=\"#ç®—æ³•å®ç°\" class=\"headerlink\" title=\"ç®—æ³•å®ç°\"></a>ç®—æ³•å®ç°</h2><figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">RR</span><span class=\"params\">(<span class=\"type\">int</span> n, <span class=\"keyword\">struct</span> ReadyQueue rq, ReadyQueue* rq1, <span class=\"keyword\">struct</span> ReadyQueue* rq2)</span> &#123;<span class=\"comment\">//æ—¶é—´ç‰‡è½®è½¬</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>,j=<span class=\"number\">1</span>;</span><br><span class=\"line\">\tPCB* p = rq.head;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (rq1-&gt;head != <span class=\"literal\">NULL</span> || p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!rq1-&gt;head &amp;&amp; p-&gt;arrivetime - i &lt; n&amp;&amp; p-&gt;arrivetime-i&gt;<span class=\"number\">0</span>) i = p-&gt;arrivetime;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!rq1-&gt;head &amp;&amp; p-&gt;arrivetime &gt;= i + n) &#123; i += n; <span class=\"keyword\">continue</span>; j++; &#125;</span><br><span class=\"line\">\t\tProcessin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\tPCB* temp;</span><br><span class=\"line\">\t\trq1-&gt;head-&gt;state = <span class=\"string\">&#x27;R&#x27;</span>;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> t = rq1-&gt;head-&gt;needtime;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ç¬¬%dä¸ªæ—¶é—´ç‰‡\\n&quot;</span>, j);</span><br><span class=\"line\">\t\tPrint(*rq1);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;******************************\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (rq1-&gt;head-&gt;needtime &gt; n) &#123; rq1-&gt;head-&gt;needtime -= n; rq1-&gt;head-&gt;state = <span class=\"string\">&#x27;W&#x27;</span>; rq1-&gt;head-&gt;servicetime += n; &#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\trq1-&gt;head-&gt;finishtime = i + t; rq1-&gt;head-&gt;servicetime += t;</span><br><span class=\"line\">\t\t\trq1-&gt;head-&gt;needtime = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\trq1-&gt;head-&gt;state = <span class=\"string\">&#x27;F&#x27;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tDequeue(rq1, &amp;temp); <span class=\"comment\">//printf(&quot;%d&quot;, temp-&gt;needtime);</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (temp-&gt;needtime) &#123;</span><br><span class=\"line\">\t\t\ti += n;</span><br><span class=\"line\">\t\t\tProcessin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\t\tEnQueue(rq1, temp);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\ti += t;</span><br><span class=\"line\">\t\t\tEnQueue(rq2, temp);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tj++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Preemptive</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq, ReadyQueue* rq1, <span class=\"keyword\">struct</span> ReadyQueue* rq2)</span>&#123; <span class=\"comment\">//æŠ¢å å¼</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tPCB* p = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (rq1-&gt;head != <span class=\"literal\">NULL</span>||p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!rq1-&gt;head) i = p-&gt;arrivetime;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(p)Processin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\tPCB* p1 = Getprior(*rq1);</span><br><span class=\"line\">\t\tp1-&gt;state = <span class=\"string\">&#x27;R&#x27;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ç¬¬%dä¸ªæ—¶åˆ»\\n&quot;</span>, i);</span><br><span class=\"line\">\t\tPrint(*rq1);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;******************************\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p1-&gt;needtime&gt;<span class=\"number\">1</span>) &#123; p1-&gt;state = <span class=\"string\">&#x27;W&#x27;</span>; p1-&gt;priority += <span class=\"number\">1</span>;&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tp1-&gt;finishtime =i+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\tp1-&gt;state = <span class=\"string\">&#x27;F&#x27;</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tp1-&gt;needtime -= <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tp1-&gt;servicetime += <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!p1-&gt;needtime) &#123; Delete(rq1, p1); EnQueue(rq2, p1); &#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//Print(*rq1);</span></span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">NonPreemptive</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq, ReadyQueue* rq1, <span class=\"keyword\">struct</span> ReadyQueue* rq2)</span> &#123;<span class=\"comment\">//éæŠ¢å å¼</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tPCB* p = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (rq1-&gt;head != <span class=\"literal\">NULL</span> || p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!rq1-&gt;head) i = p-&gt;arrivetime;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p)Processin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\tPCB* p1 = Getprior(*rq1);</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (p1-&gt;needtime) &#123;</span><br><span class=\"line\">\t\t\tp1-&gt;state = <span class=\"string\">&#x27;R&#x27;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ç¬¬%dä¸ªæ—¶åˆ»\\n&quot;</span>, i);</span><br><span class=\"line\">\t\t\tPrint(*rq1);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;******************************\\n&quot;</span>);</span><br><span class=\"line\">\t\t\ti++;</span><br><span class=\"line\">\t\t\tp1-&gt;servicetime += <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\tp1-&gt;state = <span class=\"string\">&#x27;W&#x27;</span>; </span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p)Processin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\t\tp1-&gt;needtime -= <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tp1-&gt;finishtime = i;</span><br><span class=\"line\">\t\tp1-&gt;state = <span class=\"string\">&#x27;F&#x27;</span>;</span><br><span class=\"line\">\t\tDelete(rq1, p1); EnQueue(rq2, p1);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Show</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq)</span> &#123;<span class=\"comment\">//æ‰“å°å‘¨è½¬æ—¶é—´</span></span><br><span class=\"line\">\tPCB* p = rq.head;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>; <span class=\"type\">float</span> t = <span class=\"number\">0</span>, w = <span class=\"number\">0</span>,m;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (p)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tm = (p-&gt;finishtime - p-&gt;arrivetime)*<span class=\"number\">1.0</span> / (p-&gt;servicetime);</span><br><span class=\"line\">\t\tt += p-&gt;finishtime - p-&gt;arrivetime;</span><br><span class=\"line\">\t\tw += m;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;è¿›ç¨‹å:%c\\tå®Œæˆæ—¶é—´:%d\\tå‘¨è½¬æ—¶é—´:%d\\tå¸¦æƒå‘¨è½¬æ—¶é—´:%f\\t\\n&quot;</span>, p-&gt;name, p-&gt;finishtime, p-&gt;finishtime - p-&gt;arrivetime,m);</span><br><span class=\"line\">\t\tp = p-&gt;next;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%dä¸ªè¿›ç¨‹çš„å¹³å‡å‘¨è½¬æ—¶é—´ä¸º%fï¼Œå¹³å‡å¸¦æƒå‘¨è½¬æ—¶é—´ä¸º%f&quot;</span>, i, t/i , w/ i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tReadyQueue rq, rq2; ReadyQueue rq1; initQueue(&amp;rq1);</span><br><span class=\"line\">\tinitQueue(&amp;rq); initQueue(&amp;rq2);</span><br><span class=\"line\">\t<span class=\"type\">int</span> n1, n2;</span><br><span class=\"line\">\t<span class=\"comment\">//scanf(&quot;%d%d&quot;, &amp;n1, &amp;n2);</span></span><br><span class=\"line\">\t<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;n1);</span><br><span class=\"line\">\tCreat(n1, &amp;rq);</span><br><span class=\"line\">\tNonPreemptive(rq, &amp;rq1, &amp;rq2);</span><br><span class=\"line\">\t<span class=\"comment\">//RR(n2, rq, &amp;rq1, &amp;rq2);</span></span><br><span class=\"line\">\tShow(rq2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"æ—¶é—´ç‰‡è½®è½¬ç®—æ³•æ¼”ç¤º\"><a href=\"#æ—¶é—´ç‰‡è½®è½¬ç®—æ³•æ¼”ç¤º\" class=\"headerlink\" title=\"æ—¶é—´ç‰‡è½®è½¬ç®—æ³•æ¼”ç¤º\"></a>æ—¶é—´ç‰‡è½®è½¬ç®—æ³•æ¼”ç¤º</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-1.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-2.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"éæŠ¢å å¼ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•\"><a href=\"#éæŠ¢å å¼ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•\" class=\"headerlink\" title=\"éæŠ¢å å¼ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•\"></a>éæŠ¢å å¼ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-3.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒæ€»ç»“\"><a href=\"#å®éªŒæ€»ç»“\" class=\"headerlink\" title=\"å®éªŒæ€»ç»“\"></a>å®éªŒæ€»ç»“</h1><p>é€šè¿‡è¿™æ¬¡å®éªŒï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•å’Œæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•å„æœ‰ä¼˜ç¼ºç‚¹ã€‚ä¼˜å…ˆæƒè°ƒåº¦ç®—æ³•èƒ½å¤Ÿä¿è¯é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ä¼˜å…ˆå¾—åˆ°æ‰§è¡Œï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹é¥¥é¥¿ï¼›è€Œæ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•èƒ½å¤Ÿä¿è¯æ‰€æœ‰çš„è¿›ç¨‹éƒ½æœ‰æœºä¼šå¾—åˆ°æ‰§è¡Œï¼Œä½†å…¶æ•ˆç‡å¯èƒ½ä¼šå—åˆ°æ—¶é—´ç‰‡é•¿åº¦é€‰æ‹©çš„å½±å“ã€‚å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚å’Œç¯å¢ƒæ¥é€‰æ‹©åˆé€‚çš„è°ƒåº¦ç®—æ³•ã€‚</p>\n","categories":["Operating System"]},{"title":"è¿›ç¨‹è°ƒåº¦(ä¸‹)","url":"/2023/12/01/oslab2/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ul>\n<li>é’ˆå¯¹ä½œä¸šè°ƒåº¦é—®é¢˜ï¼Œèƒ½å¤Ÿåˆ†æå½±å“ä½œä¸šè°ƒåº¦æ€§èƒ½çš„ä¸»è¦å› ç´ ï¼Œé€šè¿‡è®¾è®¡æœ€ä¼˜çš„æ–¹æ¡ˆå®ç°ä½œä¸šè°ƒåº¦ç®—æ³•</li>\n<li>é’ˆå¯¹ä¸åŒä½œä¸šçš„è¦æ±‚ï¼Œé€‰æ‹©ä¸åŒçš„è°ƒåº¦ç®—æ³•ï¼Œæ»¡è¶³ä¸åŒä½œä¸šï¼Œå°¤å…¶çŸ­ä½œä¸šè¿è¡Œçš„éœ€æ±‚</li>\n</ul>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ï¼š\"><a href=\"#å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ï¼š\" class=\"headerlink\" title=\"å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ï¼š\"></a>å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ï¼š<span id=\"more\"></span></h2><p>æŒ‰ä½œä¸šæäº¤çš„&#x2F;åˆ°è¾¾çš„ï¼ˆåˆ°è¾¾åå¤‡é˜Ÿåˆ—çš„æ—¶é—´ï¼‰å…ˆåæ¬¡åºä»å¤–å­˜åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©å‡ ä¸ªæœ€å…ˆè¿›å…¥è¯¥é˜Ÿåˆ—çš„ä½œä¸šä¸ºä»–ä»¬åˆ†é…èµ„æºã€åˆ›å»ºè¿›ç¨‹ï¼Œç„¶åå†æ”¾å…¥å°±ç»ªé˜Ÿåˆ—ã€‚</p>\n<p>æ¯ä¸ªä½œä¸šç”±ä¸€ä¸ªä½œä¸šæ§åˆ¶å—JCBè¡¨ç¤ºï¼ŒJCBå¯ä»¥åŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼šä½œä¸šåã€æäº¤æ—¶é—´ã€æ‰€éœ€çš„è¿è¡Œæ—¶é—´ã€ä½œä¸šçŠ¶æ€ç­‰ç­‰ã€‚<br>ä½œä¸šçš„çŠ¶æ€å¯ä»¥æ˜¯ç­‰å¾…W(Wait)ã€è¿è¡ŒR(Run)å’Œå®ŒæˆF(Finish)ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ã€‚æ¯ä¸ªä½œä¸šçš„æœ€åˆçŠ¶æ€æ€»æ˜¯ç­‰å¾…Wã€‚ å„ä¸ªç­‰å¾…çš„ä½œä¸šæŒ‰ç…§æäº¤æ—¶åˆ»çš„å…ˆåæ¬¡åºæ’é˜Ÿã€‚</p>\n<p>æ¯ä¸ªä½œä¸šå®Œæˆåè¦è¾“å‡ºè¯¥ä½œä¸šçš„å¼€å§‹è¿è¡Œæ—¶åˆ»ã€å®Œæˆæ—¶åˆ»ã€å‘¨è½¬æ—¶é—´å’Œå¸¦æƒå‘¨è½¬æ—¶é—´ï¼Œè¿™ä¸€ç»„ä½œä¸šå®Œæˆåè®¡ç®—å¹¶è¾“å‡ºè¿™ç»„ä½œä¸šçš„å¹³å‡å‘¨è½¬æ—¶é—´ã€å¹³å‡å¸¦æƒå‘¨è½¬æ—¶é—´ã€‚</p>\n<h2 id=\"çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼›\"><a href=\"#çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼›\" class=\"headerlink\" title=\"çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼›\"></a>çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦ç®—æ³•ï¼›</h2><p>æ ¹æ®ä½œä¸šçš„ä¼°è®¡è¿è¡Œæ—¶é—´çš„é•¿çŸ­ï¼Œä»å¤–å­˜åå¤‡é˜Ÿåˆ—ä¸­é€‰æ‹©è‹¥å¹²ä¸ªä½œä¸šä¸ºä»–ä»¬åˆ†é…èµ„æºã€åˆ›å»ºè¿›ç¨‹ï¼Œç„¶åå†æ”¾å…¥å°±ç»ªé˜Ÿåˆ—ã€‚</p>\n<p>æ¯ä¸ªä½œä¸šç”±ä¸€ä¸ªä½œä¸šæ§åˆ¶å—JCBè¡¨ç¤ºï¼ŒJCBå¯ä»¥åŒ…å«å¦‚ä¸‹ä¿¡æ¯ï¼šä½œä¸šåã€æäº¤æ—¶é—´ã€æ‰€éœ€çš„è¿è¡Œæ—¶é—´ã€ä½œä¸šçŠ¶æ€ç­‰ç­‰ã€‚</p>\n<p>ä½œä¸šçš„çŠ¶æ€å¯ä»¥æ˜¯ç­‰å¾…W(Wait)ã€è¿è¡ŒR(Run)å’Œå®ŒæˆF(Finish)ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ã€‚æ¯ä¸ªä½œä¸šçš„æœ€åˆçŠ¶æ€æ€»æ˜¯ç­‰å¾…Wã€‚ å„ä¸ªç­‰å¾…çš„ä½œä¸šæŒ‰ç…§æäº¤æ—¶åˆ»çš„å…ˆåæ¬¡åºæ’é˜Ÿã€‚</p>\n<p>æ¯ä¸ªä½œä¸šå®Œæˆåè¦è¾“å‡ºè¯¥ä½œä¸šçš„å¼€å§‹è¿è¡Œæ—¶åˆ»ã€å®Œæˆæ—¶åˆ»ã€å‘¨è½¬æ—¶é—´å’Œå¸¦æƒå‘¨è½¬æ—¶é—´ï¼Œè¿™ä¸€ç»„ä½œä¸šå®Œæˆåè®¡ç®—å¹¶è¾“å‡ºè¿™ç»„ä½œä¸šçš„å¹³å‡å‘¨è½¬æ—¶é—´ã€å¹³å‡å¸¦æƒå‘¨è½¬æ—¶é—´ã€‚</p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><p>å¤§éƒ¨åˆ†ä»£ç ä¸è¿›ç¨‹è°ƒåº¦ï¼ˆä¸Šï¼‰ç›¸åŒï¼Œåªéœ€æ·»åŠ å’Œä¿®æ”¹éƒ¨åˆ†ä»£ç </p>\n<figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\">PCB* <span class=\"title function_\">Getshort</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq)</span> &#123;</span><br><span class=\"line\">\tPCB* p = rq.head; PCB* p1 = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p-&gt;needtime &lt; p1-&gt;needtime)p1 = p;</span><br><span class=\"line\">\t\tp = p-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">FCFS</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq, ReadyQueue* rq1, <span class=\"keyword\">struct</span> ReadyQueue* rq2)</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tPCB* p = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (rq1-&gt;head != <span class=\"literal\">NULL</span> || p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!rq1-&gt;head) i = p-&gt;arrivetime;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p)Processin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\tPCB* p1 = rq1-&gt;head;</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (p1-&gt;needtime) &#123;</span><br><span class=\"line\">\t\t\tp1-&gt;state = <span class=\"string\">&#x27;R&#x27;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ç¬¬%dä¸ªæ—¶åˆ»\\n&quot;</span>, i);</span><br><span class=\"line\">\t\t\tPrint(*rq1);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;******************************\\n&quot;</span>);</span><br><span class=\"line\">\t\t\ti++;</span><br><span class=\"line\">\t\t\tp1-&gt;servicetime += <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\tp1-&gt;state = <span class=\"string\">&#x27;W&#x27;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p)Processin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\t\tp1-&gt;needtime -= <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tp1-&gt;finishtime = i;</span><br><span class=\"line\">\t\tp1-&gt;state = <span class=\"string\">&#x27;F&#x27;</span>;</span><br><span class=\"line\">\t\tDelete(rq1, p1); EnQueue(rq2, p1);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">SJF</span><span class=\"params\">(<span class=\"keyword\">struct</span> ReadyQueue rq, ReadyQueue* rq1, <span class=\"keyword\">struct</span> ReadyQueue* rq2)</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tPCB* p = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (rq1-&gt;head != <span class=\"literal\">NULL</span> || p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!rq1-&gt;head) i = p-&gt;arrivetime;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p)Processin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\tPCB* p1 = Getshort(*rq1);</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (p1-&gt;needtime) &#123;</span><br><span class=\"line\">\t\t\tp1-&gt;state = <span class=\"string\">&#x27;R&#x27;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ç¬¬%dä¸ªæ—¶åˆ»\\n&quot;</span>, i);</span><br><span class=\"line\">\t\t\tPrint(*rq1);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;******************************\\n&quot;</span>);</span><br><span class=\"line\">\t\t\ti++;</span><br><span class=\"line\">\t\t\tp1-&gt;servicetime += <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\tp1-&gt;state = <span class=\"string\">&#x27;W&#x27;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p)Processin(&amp;p, rq1, i);</span><br><span class=\"line\">\t\t\tp1-&gt;needtime -= <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tp1-&gt;finishtime = i;</span><br><span class=\"line\">\t\tp1-&gt;state = <span class=\"string\">&#x27;F&#x27;</span>;</span><br><span class=\"line\">\t\tDelete(rq1, p1); EnQueue(rq2, p1);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tReadyQueue rq, rq2; ReadyQueue rq1; initQueue(&amp;rq1);</span><br><span class=\"line\">\tinitQueue(&amp;rq); initQueue(&amp;rq2);</span><br><span class=\"line\">\t<span class=\"type\">int</span> n1, n2;</span><br><span class=\"line\">\t<span class=\"comment\">//scanf(&quot;%d%d&quot;, &amp;n1, &amp;n2);</span></span><br><span class=\"line\">\t<span class=\"built_in\">scanf</span>(<span class=\"string\">&quot;%d&quot;</span>, &amp;n1);</span><br><span class=\"line\">\tCreat(n1, &amp;rq);</span><br><span class=\"line\">\t<span class=\"comment\">//NonPreemptive(rq, &amp;rq1, &amp;rq2);</span></span><br><span class=\"line\">\t<span class=\"comment\">//RR(n2, rq, &amp;rq1, &amp;rq2);</span></span><br><span class=\"line\">\t<span class=\"comment\">//FCFS(rq, &amp;rq1, &amp;rq2);</span></span><br><span class=\"line\">\tSJF(rq, &amp;rq1, &amp;rq2);</span><br><span class=\"line\">\tShow(rq2);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"å…ˆæ¥å…ˆæœåŠ¡æ¼”ç¤º\"><a href=\"#å…ˆæ¥å…ˆæœåŠ¡æ¼”ç¤º\" class=\"headerlink\" title=\"å…ˆæ¥å…ˆæœåŠ¡æ¼”ç¤º\"></a>å…ˆæ¥å…ˆæœåŠ¡æ¼”ç¤º</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-4.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-5.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"çŸ­ä½œä¸šä¼˜å…ˆæ¼”ç¤º\"><a href=\"#çŸ­ä½œä¸šä¼˜å…ˆæ¼”ç¤º\" class=\"headerlink\" title=\"çŸ­ä½œä¸šä¼˜å…ˆæ¼”ç¤º\"></a>çŸ­ä½œä¸šä¼˜å…ˆæ¼”ç¤º</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-6.png?raw=true\" alt=\"alt text\"><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-7.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒæ€»ç»“\"><a href=\"#å®éªŒæ€»ç»“\" class=\"headerlink\" title=\"å®éªŒæ€»ç»“\"></a>å®éªŒæ€»ç»“</h1><p>é€šè¿‡å®éªŒï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°è¿™ä¸¤ç§ç®—æ³•åœ¨ä¸åŒæƒ…å†µä¸‹çš„è¡¨ç°ã€‚ä¾‹å¦‚ï¼Œå¯¹äºé•¿ä½œä¸šå’ŒçŸ­ä½œä¸šæ··åˆçš„å·¥ä½œè´Ÿè½½ï¼ŒSJFé€šå¸¸ä¼šæä¾›æ›´å¥½çš„æœåŠ¡æ—¶é—´ï¼Œå› ä¸ºå®ƒé¦–å…ˆè°ƒåº¦çŸ­ä½œä¸šã€‚ç„¶è€Œï¼Œå¦‚æœæ‰€æœ‰ä½œä¸šçš„é•¿åº¦éƒ½ç›¸åŒï¼Œé‚£ä¹ˆFCFSå’ŒSJFçš„æ€§èƒ½å°±ä¼šç›¸åŒã€‚</p>\n","categories":["Operating System"]},{"title":"é¿å…æ­»é”","url":"/2023/12/08/oslab3/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><ul>\n<li>ç†è§£é“¶è¡Œå®¶ç®—æ³•</li>\n<li>æŒæ¡è¿›ç¨‹å®‰å…¨æ€§æ£€æŸ¥çš„æ–¹æ³•ä¸èµ„æºåˆ†é…çš„æ–¹æ³•</li>\n</ul>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"é“¶è¡Œå®¶ç®—æ³•\"><a href=\"#é“¶è¡Œå®¶ç®—æ³•\" class=\"headerlink\" title=\"é“¶è¡Œå®¶ç®—æ³•\"></a>é“¶è¡Œå®¶ç®—æ³•</h2><p>é“¶è¡Œå®¶ç®—æ³•æœ€åˆçº§ä¸ºé“¶è¡Œç³»ç»Ÿè®¾è®¡ï¼Œä»¥ç¡®ä¿é“¶è¡Œåœ¨å‘æ”¾ç°é‡‘è´·æ¬¾æ—¶ï¼Œä¸ä¼šå‘ç”Ÿä¸èƒ½æ»¡è¶³æ‰€æœ‰å®¢æˆ·éœ€è¦çš„æƒ…å†µã€‚åœ¨OSè®¾è®¡ä¸­ï¼Œç”¨å®ƒæ¥é¿å…æ­»é”ã€‚</p>\n<p>ä¸ºå®ç°é“¶è¡Œå®¶ç®—æ³•ï¼Œæ¯ä¸ªæ–°è¿›ç¨‹åœ¨è¿›å…¥ç³»ç»Ÿæ—¶å®ƒå¿…é¡»ç”³æ˜åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½éœ€è¦çš„æ¯ç§èµ„æºç±»å‹çš„æœ€å¤§å•å…ƒæ•°ç›®ï¼Œå…¶æ•°ç›®ä¸åº”è¶…è¿‡ç³»ç»Ÿæ‰€æ‹¥æœ‰çš„èµ„æºæ€»é‡ã€‚å½“æŸä¸€è¿›ç¨‹è¯·æ±‚æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­è¯·æ±‚é‡æ˜¯å¦å°äºè¿›ç¨‹æœ€å¤§æ‰€éœ€ï¼ŒåŒæ—¶åˆ¤æ–­è¯·æ±‚é‡æ˜¯å¦å°äºå½“å‰ç³»ç»Ÿèµ„æºå‰©ä½™é‡ã€‚è‹¥ä¸¤é¡¹å‡æ»¡è¶³ï¼Œåˆ™ç³»ç»Ÿè¯•åˆ†é…èµ„æºå¹¶æ‰§è¡Œå®‰å…¨æ€§æ£€æŸ¥ç®—æ³•ã€‚</p>\n<p>ç®—æ³•æµç¨‹å›¾å¦‚ä¸‹<span id=\"more\"></span><br><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-8.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•\"><a href=\"#å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•\" class=\"headerlink\" title=\"å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•\"></a>å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•</h2><p>.å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•ç”¨äºæ£€æŸ¥ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…åæ˜¯å¦å®‰å…¨ï¼Œè‹¥å®‰å…¨ç³»ç»Ÿæ‰å¯ä»¥æ‰§è¡Œæ­¤æ¬¡åˆ†é…ï¼›è‹¥ä¸å®‰å…¨ï¼Œåˆ™ç³»ç»Ÿä¸æ‰§è¡Œæ­¤æ¬¡åˆ†é…ã€‚<br>å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•åŸç†ä¸ºï¼šåœ¨ç³»ç»Ÿè¯•åˆ†é…èµ„æºåï¼Œç®—æ³•ä»ç°æœ‰è¿›ç¨‹åˆ—è¡¨å¯»æ‰¾å‡ºä¸€ä¸ªå¯æ‰§è¡Œçš„è¿›ç¨‹è¿›è¡Œæ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåå›æ”¶è¿›ç¨‹å ç”¨èµ„æºï¼›è¿›è€Œå¯»æ‰¾ä¸‹ä¸€ä¸ªå¯æ‰§è¡Œè¿›ç¨‹ã€‚å½“è¿›ç¨‹éœ€æ±‚é‡å¤§äºç³»ç»Ÿå¯åˆ†é…é‡æ—¶ï¼Œè¿›ç¨‹æ— æ³•æ‰§è¡Œã€‚å½“æ‰€æœ‰è¿›ç¨‹å‡å¯æ‰§è¡Œï¼Œåˆ™äº§ç”Ÿä¸€ä¸ªå®‰å…¨æ‰§è¡Œåºåˆ—ï¼Œç³»ç»Ÿèµ„æºåˆ†é…æˆåŠŸã€‚è‹¥è¿›ç¨‹æ— æ³•å…¨éƒ¨æ‰§è¡Œï¼Œå³æ— æ³•æ‰¾åˆ°ä¸€æ¡å®‰å…¨åºåˆ—ï¼Œåˆ™è¯´æ˜ç³»ç»Ÿåœ¨åˆ†é…èµ„æºåä¼šä¸å®‰å…¨ï¼Œæ‰€ä»¥æ­¤æ¬¡åˆ†é…å¤±è´¥ã€‚</p>\n<p>ç®—æ³•æµç¨‹å›¾å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-9.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"ç®—æ³•å®ç°\"><a href=\"#ç®—æ³•å®ç°\" class=\"headerlink\" title=\"ç®—æ³•å®ç°\"></a>ç®—æ³•å®ç°</h2><figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\">using namespace <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> res, pro;</span><br><span class=\"line\"><span class=\"type\">int</span> need[<span class=\"number\">10</span>][<span class=\"number\">10</span>], maxr[<span class=\"number\">10</span>][<span class=\"number\">10</span>], allocation[<span class=\"number\">10</span>][<span class=\"number\">10</span>], available[<span class=\"number\">10</span>],request[<span class=\"number\">10</span>];</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">Compare</span><span class=\"params\">(<span class=\"type\">int</span> m[], <span class=\"type\">int</span> n[])</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; res; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (m[i] &lt; n[i])<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Print</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;            allocation            need              avilable&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; pro; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&#x27;\\n&#x27;</span> &lt;&lt; <span class=\"string\">&quot;è¿›ç¨‹&quot;</span> &lt;&lt; i&lt;&lt; <span class=\"string\">&#x27;\\t&#x27;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; res; j++)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;  %2d &quot;</span>, allocation[i][j]);</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;     &quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; res; j++)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;  %2d &quot;</span>, need[i][j]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!i)</span><br><span class=\"line\">\t\t&#123; </span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;     &quot;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> j=<span class=\"number\">0</span>;j&lt;res;j++)</span><br><span class=\"line\">\t\t\t   <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;  %2d &quot;</span>, available[j]);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">init</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¯·è¾“å…¥æœ€å¤§éœ€æ±‚çŸ©é˜µmaxr\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; pro; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; res; j++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cin</span> &gt;&gt; maxr[i][j];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¯·è¾“å…¥åˆ†é…çŸ©é˜µallocation\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; pro; i++) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; res; j++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cin</span> &gt;&gt; allocation[i][j];</span><br><span class=\"line\">\t\t\tneed[i][j] = maxr[i][j] - allocation[i][j];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¯·è¾“å…¥å¯ç”¨èµ„æºå‘é‡available\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; res; i++) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cin</span> &gt;&gt; available[i];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">Safetytest</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> work[<span class=\"number\">10</span>], finish[<span class=\"number\">10</span>] = &#123; <span class=\"number\">0</span> &#125;, seq[<span class=\"number\">10</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; res; i++)</span><br><span class=\"line\">\t\twork[i] = available[i];</span><br><span class=\"line\">\t<span class=\"type\">int</span> i, k = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (k &lt; pro) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt; pro; i++)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (!finish[i] &amp;&amp; Compare(work,need[i])) <span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (i == pro)<span class=\"keyword\">break</span>;<span class=\"comment\">//ä¸å®‰å…¨</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> j = <span class=\"number\">0</span>; j &lt; res; j++)</span><br><span class=\"line\">\t\t\twork[j] +=  allocation[i][j];</span><br><span class=\"line\">\t\tfinish[i] = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tseq[k] = i; k++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (k == pro) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;å®‰å…¨åºåˆ—ä¸º:&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; pro; i++)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; seq[i] &lt;&lt; <span class=\"string\">&#x27;\\t&#x27;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Banker</span><span class=\"params\">(<span class=\"type\">int</span> n)</span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (Compare(need[n],request)) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (Compare(request, available))<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;æ— è¶³å¤Ÿèµ„æº&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span>&#123;<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; res; i++) &#123;</span><br><span class=\"line\">\t\t\tavailable[i] -= request[i];</span><br><span class=\"line\">\t\t\tallocation[n][i] += request[i];</span><br><span class=\"line\">\t\t\tneed[n][i] -= request[i];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!Safetytest()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; res; i++) &#123;</span><br><span class=\"line\">\t\t\t\tavailable[i] += request[i];</span><br><span class=\"line\">\t\t\t\tallocation[n][i] -= request[i];</span><br><span class=\"line\">\t\t\t\tneed[n][i] += request[i];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;ä¸å®‰å…¨çš„çŠ¶æ€&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;å…è®¸åˆ†é…èµ„æº&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\tPrint();</span><br><span class=\"line\">\t\t&#125;&#125;</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">else</span> <span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¯·æ±‚èµ„æºå¤§äºæ‰€éœ€èµ„æº&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> n;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¾“å…¥è¿›ç¨‹æ•°å’Œèµ„æºæ•°&quot;</span>&lt;&lt;<span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">cin</span> &gt;&gt; pro&gt;&gt;res;</span><br><span class=\"line\">\tinit();</span><br><span class=\"line\">\tPrint();</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¾“å…¥è¿›ç¨‹å·:&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">cin</span> &gt;&gt; n;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¯·æ±‚å‘é‡:&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; res; i++)</span><br><span class=\"line\">\t\t<span class=\"built_in\">cin</span> &gt;&gt; request[i];</span><br><span class=\"line\">\tBanker(n);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"å†…å®¹æ¼”ç¤º\"><a href=\"#å†…å®¹æ¼”ç¤º\" class=\"headerlink\" title=\"å†…å®¹æ¼”ç¤º\"></a>å†…å®¹æ¼”ç¤º</h2><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-10.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒæ€»ç»“\"><a href=\"#å®éªŒæ€»ç»“\" class=\"headerlink\" title=\"å®éªŒæ€»ç»“\"></a>å®éªŒæ€»ç»“</h1><p>é“¶è¡Œå®¶ç®—æ³•æ˜¯ä¸€ç§ç”¨æ¥é¿å…æ“ä½œç³»ç»Ÿæ­»é”å‡ºç°çš„æœ‰æ•ˆç®—æ³•ã€‚</p>\n<p>æ­»é”ï¼šæ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºç«äº‰èµ„æºæˆ–è€…ç”±äºå½¼æ­¤é€šä¿¡è€Œé€ æˆçš„ä¸€ç§é˜»å¡çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚æ­¤æ—¶ç§°ç³»ç»Ÿå¤„äºæ­»é”çŠ¶æ€æˆ–ç³»ç»Ÿäº§ç”Ÿäº†æ­»é”ï¼Œè¿™äº›æ°¸è¿œåœ¨äº’ç›¸ç­‰å¾…çš„è¿›ç¨‹ç§°ä¸ºæ­»é”è¿›ç¨‹ã€‚</p>\n<p>æ­»é”çš„å‘ç”Ÿå¿…é¡»å…·å¤‡ä»¥ä¸‹å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p>\n<ul>\n<li>äº’æ–¥æ¡ä»¶ï¼šæŒ‡è¿›ç¨‹å¯¹æ‰€åˆ†é…åˆ°çš„èµ„æºè¿›è¡Œæ’å®ƒæ€§ä½¿ç”¨ï¼Œå³åœ¨ä¸€æ®µæ—¶é—´å†…æŸèµ„æºåªç”±ä¸€ä¸ªè¿›ç¨‹å ç”¨ã€‚å¦‚æœæ­¤æ—¶è¿˜æœ‰å…¶å®ƒè¿›ç¨‹è¯·æ±‚èµ„æºï¼Œåˆ™è¯·æ±‚è€…åªèƒ½ç­‰å¾…ï¼Œç›´è‡³å æœ‰èµ„æºçš„è¿›ç¨‹ç”¨æ¯•é‡Šæ”¾ã€‚</li>\n<li>è¯·æ±‚å’Œä¿æŒæ¡ä»¶ï¼šæŒ‡è¿›ç¨‹å·²ç»ä¿æŒè‡³å°‘ä¸€ä¸ªèµ„æºï¼Œä½†åˆæå‡ºäº†æ–°çš„èµ„æºè¯·æ±‚ï¼Œè€Œè¯¥èµ„æºå·²è¢«å…¶å®ƒè¿›ç¨‹å æœ‰ï¼Œæ­¤æ—¶è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œä½†åˆå¯¹è‡ªå·±å·²è·å¾—çš„å…¶å®ƒèµ„æºä¿æŒä¸æ”¾ã€‚</li>\n<li>ä¸æŠ¢å æ¡ä»¶ï¼šæŒ‡è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœªä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½è¢«å‰¥å¤ºï¼Œåªèƒ½åœ¨ä½¿ç”¨å®Œæ—¶ç”±è‡ªå·±é‡Šæ”¾ã€‚</li>\n<li>å¾ªç¯ç­‰å¾…æ¡ä»¶ï¼šæŒ‡åœ¨å‘ç”Ÿæ­»é”æ—¶ï¼Œå¿…ç„¶å­˜åœ¨ä¸€ä¸ªè¿›ç¨‹â€”â€”èµ„æºçš„ç¯å½¢é“¾ï¼Œå³è¿›ç¨‹é›†åˆ$\\lbrace P_0ï¼ŒP_1ï¼ŒP_2ï¼ŒÂ·Â·Â·ï¼ŒP_n\\rbrace$ä¸­çš„$P_0$æ­£åœ¨ç­‰å¾…ä¸€ä¸ª$P_1$å ç”¨çš„èµ„æºï¼›$P_1$æ­£åœ¨ç­‰å¾…$P_2$å ç”¨çš„èµ„æºï¼Œâ€¦â€¦ï¼Œ$P_n$æ­£åœ¨ç­‰å¾…å·²è¢«$P_0$å ç”¨çš„èµ„æºã€‚</li>\n<li>é“¶è¡Œå®¶ç®—æ³•æ˜¯é¿å…æ­»é”çš„ä¸€ç§é‡è¦æ–¹æ³•ï¼Œé˜²æ­¢æ­»é”çš„æœºæ„åªèƒ½ç¡®ä¿ä¸Šè¿°å››ä¸ªæ¡ä»¶ä¹‹ä¸€ä¸å‡ºç°ï¼Œåˆ™ç³»ç»Ÿå°±ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚</li>\n</ul>\n<p>ä¸ºå®ç°é“¶è¡Œå®¶ç®—æ³•ï¼Œç³»ç»Ÿå¿…é¡»è®¾ç½®è‹¥å¹²æ•°æ®ç»“æ„ï¼ŒåŒæ—¶è¦è§£é‡Šé“¶è¡Œå®¶ç®—æ³•ï¼Œå¿…é¡»å…ˆè§£é‡Šæ“ä½œç³»ç»Ÿå®‰å…¨çŠ¶æ€å’Œä¸å®‰å…¨çŠ¶æ€ã€‚</p>\n<p>å®‰å…¨åºåˆ—:æ˜¯æŒ‡ä¸€ä¸ªè¿›ç¨‹åºåˆ—$\\lbrace P_1ï¼ŒÂ·Â·Â·ï¼ŒP_n\\rbrace$æ˜¯å®‰å…¨çš„ï¼Œå³å¯¹äºæ¯ä¸€ä¸ªè¿›ç¨‹$P_i (1â‰¤iâ‰¤n)$ï¼Œå®ƒä»¥åå°šéœ€è¦çš„èµ„æºé‡ä¸è¶…è¿‡ç³»ç»Ÿå½“å‰å‰©ä½™èµ„æºé‡ä¸æ‰€æœ‰è¿›ç¨‹$P_j (j &lt; i )$å½“å‰å æœ‰èµ„æºé‡ä¹‹å’Œã€‚<br>å®‰å…¨çŠ¶æ€ï¼šå¦‚æœå­˜åœ¨ä¸€ä¸ªç”±ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹æ„æˆçš„å®‰å…¨åºåˆ—$P_1ï¼Œâ€¦ï¼ŒP_n$ï¼Œåˆ™ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ã€‚</p>\n<p>å®‰å…¨çŠ¶æ€ä¸€å®šæ˜¯æ²¡æœ‰æ­»é”å‘ç”Ÿã€‚ä¸å®‰å…¨çŠ¶æ€ï¼šä¸å­˜åœ¨ä¸€ä¸ªå®‰å…¨åºåˆ—ã€‚ä¸å®‰å…¨çŠ¶æ€ä¸ä¸€å®šå¯¼è‡´æ­»é”</p>\n","categories":["Operating System"]},{"title":"è™šæ‹Ÿå­˜å‚¨","url":"/2023/12/14/oslab4/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"å®éªŒç›®çš„\"><a href=\"#å®éªŒç›®çš„\" class=\"headerlink\" title=\"å®éªŒç›®çš„\"></a>å®éªŒç›®çš„</h1><p>é¡µé¢ç½®æ¢ç®—æ³•ä¹Ÿç§°ä¸ºé¡µé¢æ·˜æ±°ç®—æ³•ï¼Œæ˜¯ç”¨æ¥é€‰æ‹©æ¢å‡ºé¡µé¢çš„ç®—æ³•ã€‚</p>\n<ul>\n<li>è§£å†³ï¼šéœ€è¦è°ƒå…¥é¡µé¢æ—¶ï¼Œé€‰æ‹©å†…å­˜ä¸­å“ªä¸ªæˆ–å“ªäº›ç‰©ç†é¡µé¢è¢«ç½®æ¢</li>\n<li>ç›®æ ‡ï¼šæŠŠæœªæ¥ä¸å†ä½¿ç”¨çš„æˆ–åœ¨ä»¥åä¸€æ®µæ—¶é—´å†…è¾ƒå°‘ä½¿ç”¨çš„é¡µé¢è°ƒå‡º</li>\n</ul>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"å…ˆè¿›å…ˆå‡ºç®—æ³•\"><a href=\"#å…ˆè¿›å…ˆå‡ºç®—æ³•\" class=\"headerlink\" title=\"å…ˆè¿›å…ˆå‡ºç®—æ³•\"></a>å…ˆè¿›å…ˆå‡ºç®—æ³•</h2><p>åŸºæœ¬æ€æƒ³æ˜¯æ·˜æ±°æœ€å…ˆè¿›å…¥å†…å­˜çš„é¡µé¢ï¼Œå³é€‰æ‹©åœ¨å†…å­˜é©»ç•™æ—¶é—´æœ€é•¿çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚å®ç°ç®€å•ã€‚æŒ‰é¡µé¢è°ƒå…¥å†…å­˜çš„å…ˆåé“¾ç»“ä¸ºé˜Ÿåˆ—ï¼Œè®¾ç½®ä¸€ä¸ªæ›¿æ¢æŒ‡é’ˆï¼Œæ€»æ˜¯æŒ‡å‘æœ€å…ˆè¿›å…¥å†…å­˜çš„é¡µé¢ã€‚ç¼ºç‚¹åœ¨ä¸è¿›ç¨‹å®é™…è¿è¡Œè§„å¾‹ä¸ç¬¦ï¼Œæ€§èƒ½ä¸å¥½ã€‚</p>\n<p>ç®—æ³•æµç¨‹å›¾å¦‚ä¸‹<span id=\"more\"></span></p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-11.png?raw=true\" alt=\"alt text\"></p>\n<h2 id=\"æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•\"><a href=\"#æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•\" class=\"headerlink\" title=\"æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•\"></a>æœ€ä½³é¡µé¢ç½®æ¢ç®—æ³•</h2><p>åŸºæœ¬æ€æƒ³æ˜¯æ‰€é€‰æ‹©çš„è¢«æ·˜æ±°é¡µé¢ï¼Œå°†æ˜¯ä»¥åæ°¸ä¸ä½¿ç”¨çš„ï¼Œæˆ–æ˜¯åœ¨æœ€é•¿(æœªæ¥)æ—¶é—´å†…ä¸å†è¢«è®¿é—®çš„é¡µé¢ã€‚é‡‡ç”¨æœ€ä½³ç½®æ¢ç®—æ³•ï¼Œå¯ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡ã€‚</p>\n<p>ç®—æ³•æµç¨‹å›¾å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-12.png?raw=true\"></p>\n<h2 id=\"æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•\"><a href=\"#æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•\" class=\"headerlink\" title=\"æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•\"></a>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•</h2><p>åŸºæœ¬æ€æƒ³ï¼šæœ€è¿‘æœªè®¿é—®çš„é¡µé¢ï¼Œå°†æ¥ä¸€æ®µæ—¶é—´ä¹Ÿä¸ä¼šè®¿é—®ã€‚åˆ©ç”¨å±€éƒ¨æ€§åŸç†ï¼Œæ ¹æ®ä¸€ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿‡å»çš„é¡µé¢è®¿é—®è¸ªè¿¹æ¥æ¨æµ‹æœªæ¥çš„è¡Œä¸ºã€‚æœ€è¿‘çš„è¿‡å» â†’ æœ€è¿‘çš„å°†æ¥     æ€æƒ³ï¼šé€‰æ‹©æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°ã€‚åˆ©ç”¨é¡µè¡¨ä¸­çš„è®¿é—®å­—æ®µï¼Œè®°å½•é¡µé¢è‡ªä¸Šæ¬¡è¢«è®¿é—®ä»¥æ¥æ‰€ç»å†çš„æ—¶é—´tï¼Œéœ€è¦æ·˜æ±°é¡µé¢æ—¶ï¼Œé€‰æ‹©åœ¨å†…å­˜é¡µé¢ä¸­tå€¼æœ€å¤§çš„ï¼Œå³æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢äºˆä»¥æ·˜æ±°</p>\n<p>ç®—æ³•æµç¨‹å›¾å¦‚ä¸‹</p>\n<p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-13.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"ç®—æ³•å®ç°\"><a href=\"#ç®—æ³•å®ç°\" class=\"headerlink\" title=\"ç®—æ³•å®ç°\"></a>ç®—æ³•å®ç°</h2><figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\">using namespace <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> n,j=<span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">page</span> &#123;</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> num;</span><br><span class=\"line\">\t<span class=\"type\">int</span> visit=<span class=\"number\">65535</span>;</span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">page</span>* <span class=\"title\">next</span> =</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">page</span> <span class=\"title\">Page</span>;</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">PageQueue</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">\tPage* head;</span><br><span class=\"line\">\tPage* tail;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">initQueue</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq)</span> &#123;</span><br><span class=\"line\">\trq-&gt;head = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\trq-&gt;tail = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">EnQueue</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, Page* p)</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!rq-&gt;head) &#123;</span><br><span class=\"line\">\t\trq-&gt;head = p;</span><br><span class=\"line\">\t\trq-&gt;tail = p;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\trq-&gt;tail-&gt;next = p;</span><br><span class=\"line\">\t\trq-&gt;tail = p;</span><br><span class=\"line\">\t\tp-&gt;next = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Dequeue</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, Page** p)</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (rq-&gt;head != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t*p = rq-&gt;head;</span><br><span class=\"line\">\t\trq-&gt;head = rq-&gt;head-&gt;next;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (rq-&gt;head == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t\trq-&gt;tail = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t(*p)-&gt;next = <span class=\"literal\">NULL</span>;  <span class=\"comment\">// Ensure the dequeued PCB points to NULL</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">Find</span><span class=\"params\">(<span class=\"type\">int</span> n1, <span class=\"keyword\">struct</span> PageQueue rq)</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tPage* p = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(p)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p-&gt;num == n1) <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tp = p-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">Getleast</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, <span class=\"type\">int</span> a[])</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> maxv = <span class=\"number\">0</span>, num=<span class=\"number\">0</span>;</span><br><span class=\"line\">\tPage* q = rq-&gt;head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (q) &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> k = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">while</span> (a[k] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (q-&gt;num == a[k]) &#123; q-&gt;visit = k; <span class=\"keyword\">break</span>; &#125;</span><br><span class=\"line\">\t\t\tk++;</span><br><span class=\"line\">\t\t&#125;<span class=\"keyword\">if</span> (maxv &lt; q-&gt;visit) &#123; maxv = q-&gt;visit; num = q-&gt;num; &#125;</span><br><span class=\"line\">\t\tq = q-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> num;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">Getleastr</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq)</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> num = <span class=\"number\">0</span>,minv=<span class=\"number\">65535</span>;</span><br><span class=\"line\">\tPage* q = rq-&gt;head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (q) &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> k = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (minv &gt; q-&gt;visit) &#123; minv = q-&gt;visit; num = q-&gt;num; &#125;</span><br><span class=\"line\">\t\tq = q-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> num;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Delete</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, <span class=\"type\">int</span> num)</span> &#123;</span><br><span class=\"line\">\tPage* p1 = rq-&gt;head; Page* p2;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p1-&gt;num ==num) Dequeue(rq, &amp;p2);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (p1-&gt;num != num) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">while</span> (p1-&gt;next-&gt;num != num)</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tp1 = p1-&gt;next;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p1-&gt;next == rq-&gt;tail)rq-&gt;tail = p1;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p1-&gt;next)p1-&gt;next = p1-&gt;next-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">Print</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue rq)</span> &#123;</span><br><span class=\"line\">\tPage* p = rq.head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (p) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; p-&gt;num &lt;&lt; <span class=\"string\">&#x27;\\t&#x27;</span>;</span><br><span class=\"line\">\t\tp = p-&gt;next;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">FIFO</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, <span class=\"type\">int</span> a[])</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>,count=<span class=\"number\">0</span>; </span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (a[i] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\tPage* p = new page;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!Find(a[i], *rq)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;åœ¨&quot;</span> &lt;&lt; a[i] &lt;&lt; <span class=\"string\">&quot;å¤„äº§ç”Ÿç¼ºé¡µä¸­æ–­&quot;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(count&gt;=n)Dequeue(rq, &amp;p); </span><br><span class=\"line\">\t\t\tp-&gt;num = a[i]; p-&gt;next = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\t\tEnQueue(rq, p);</span><br><span class=\"line\">\t\t\tPrint(*rq);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\tcount++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;ç¼ºé¡µæ¬¡æ•°&quot;</span> &lt;&lt; count &lt;&lt; <span class=\"string\">&quot;ç¼ºé¡µç‡&quot;</span> &lt;&lt; count * <span class=\"number\">1.0</span> / j &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">OPT</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, <span class=\"type\">int</span> a[])</span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>, count = <span class=\"number\">0</span>,num1=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (a[i] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\tPage* p = new page;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!Find(a[i], *rq)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;åœ¨&quot;</span> &lt;&lt; a[i] &lt;&lt; <span class=\"string\">&quot;å¤„äº§ç”Ÿç¼ºé¡µä¸­æ–­&quot;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (count &gt;= n) &#123;</span><br><span class=\"line\">\t\t\t\tnum1 = Getleast(rq, a);</span><br><span class=\"line\">\t\t\t\tDelete(rq, num1);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tp-&gt;num = a[i]; p-&gt;next = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\t\tEnQueue(rq, p);</span><br><span class=\"line\">\t\t\tPrint(*rq);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\tcount++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;ç¼ºé¡µæ¬¡æ•°&quot;</span> &lt;&lt; count &lt;&lt; <span class=\"string\">&quot;ç¼ºé¡µç‡&quot;</span> &lt;&lt; count * <span class=\"number\">1.0</span> / j &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">ChangeV</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, <span class=\"type\">int</span> a, <span class=\"type\">int</span> i)</span> &#123;</span><br><span class=\"line\">\tPage* q = rq-&gt;head;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (q-&gt;num != a)</span><br><span class=\"line\">\t\tq = q-&gt;next;</span><br><span class=\"line\">\tq-&gt;visit = i;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">LRU</span><span class=\"params\">(<span class=\"keyword\">struct</span> PageQueue* rq, <span class=\"type\">int</span> a[])</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>, count = <span class=\"number\">0</span>,num;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (a[i] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\tPage* p = new page;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!Find(a[i], *rq)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;åœ¨&quot;</span> &lt;&lt; a[i] &lt;&lt; <span class=\"string\">&quot;å¤„äº§ç”Ÿç¼ºé¡µä¸­æ–­&quot;</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (count &gt;= n) &#123;</span><br><span class=\"line\">\t\t\t\tnum = Getleastr(rq);</span><br><span class=\"line\">\t\t\t\tDelete(rq, num);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tp-&gt;num = a[i]; p-&gt;next = <span class=\"literal\">NULL</span>; p-&gt;visit = i;</span><br><span class=\"line\">\t\t\tEnQueue(rq, p);</span><br><span class=\"line\">\t\t\tPrint(*rq);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\t\tcount++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tChangeV(rq, a[i], i);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;ç¼ºé¡µæ¬¡æ•°&quot;</span> &lt;&lt; count &lt;&lt; <span class=\"string\">&quot;ç¼ºé¡µç‡&quot;</span> &lt;&lt; count * <span class=\"number\">1.0</span> / j &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a[<span class=\"number\">30</span>] = &#123; <span class=\"number\">0</span> &#125;,t,i=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;ä¸»å­˜å—æ•°&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">cin</span> &gt;&gt; n;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;é¡µé¢å·&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (<span class=\"built_in\">cin</span>.get() != <span class=\"string\">&#x27;\\n&#x27;</span>||j==<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cin</span> &gt;&gt; a[j];</span><br><span class=\"line\">\t\tj++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPageQueue pg;</span><br><span class=\"line\">\tinitQueue(&amp;pg);</span><br><span class=\"line\">\t<span class=\"comment\">//FIFO(&amp;pg, a);</span></span><br><span class=\"line\">\t<span class=\"comment\">//OPT(&amp;pg, a);</span></span><br><span class=\"line\">\tLRU(&amp;pg, a);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"å†…å®¹æ¼”ç¤º\"><a href=\"#å†…å®¹æ¼”ç¤º\" class=\"headerlink\" title=\"å†…å®¹æ¼”ç¤º\"></a>å†…å®¹æ¼”ç¤º</h2><h3 id=\"FIFO\"><a href=\"#FIFO\" class=\"headerlink\" title=\"FIFO\"></a>FIFO</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-14.png?raw=true\" alt=\"alt text\"></p>\n<h3 id=\"æœ€ä½³ç½®æ¢ç®—æ³•\"><a href=\"#æœ€ä½³ç½®æ¢ç®—æ³•\" class=\"headerlink\" title=\"æœ€ä½³ç½®æ¢ç®—æ³•\"></a>æœ€ä½³ç½®æ¢ç®—æ³•</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-15.png?raw=true\"></p>\n<h3 id=\"LRU\"><a href=\"#LRU\" class=\"headerlink\" title=\"LRU\"></a>LRU</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-16.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒæ€»ç»“\"><a href=\"#å®éªŒæ€»ç»“\" class=\"headerlink\" title=\"å®éªŒæ€»ç»“\"></a>å®éªŒæ€»ç»“</h1><p>é€šè¿‡æœ¬æ¬¡å®éªŒåŠ æ·±äº†æˆ‘å¯¹é¡µé¢ç½®æ¢ç®—æ³•çš„ç†è§£ï¼Œæœ¬æ¬¡å®éªŒä¸­çš„é¡µé¢ç½®æ¢ç®—æ³•æœ‰<br>FIFOï¼ˆå…ˆè¿›å…ˆå‡ºç½®æ¢ç®—æ³•ï¼‰ã€LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨é¡µé¢ç½®æ¢ç®—æ³•ï¼‰ã€OPTï¼ˆæœ€ä½³ç½®æ¢ç®—æ³•ï¼‰ã€‚</p>\n<p>FIFOç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç½®æ¢æœ€å…ˆè°ƒå…¥å†…å­˜çš„é¡µé¢ï¼Œå³ç½®æ¢åœ¨å†…å­˜ä¸­é©»ç•™æ—¶é—´æœ€ä¹…çš„é¡µé¢ã€‚æŒ‰ç…§è¿›å…¥å†…å­˜çš„å…ˆåæ¬¡åºæ’åˆ—æˆé˜Ÿåˆ—ï¼Œä»é˜Ÿå°¾è¿›å…¥ï¼Œä»é˜Ÿé¦–åˆ é™¤ã€‚ä½†æ˜¯è¯¥ç®—æ³•ä¼šæ·˜æ±°ç»å¸¸è®¿é—®çš„é¡µé¢ï¼Œä¸é€‚åº”è¿›ç¨‹å®é™…è¿è¡Œçš„è§„å¾‹ï¼Œç›®å‰å·²ç»å¾ˆå°‘ä½¿ç”¨ã€‚</p>\n<p>LRUç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç½®æ¢æœ€è¿‘ä¸€æ®µæ—¶é—´ä»¥æ¥æœ€é•¿æ—¶é—´æœªè®¿é—®è¿‡çš„é¡µé¢ã€‚æ ¹æ®ç¨‹åºå±€éƒ¨æ€§åŸç†ï¼Œåˆšè¢«è®¿é—®çš„é¡µé¢ï¼Œå¯èƒ½é©¬ä¸Šåˆè¦è¢«è®¿é—®ï¼›è€Œè¾ƒé•¿æ—¶é—´å†…æ²¡æœ‰è¢«è®¿é—®çš„é¡µé¢ï¼Œå¯èƒ½æœ€è¿‘ä¸ä¼šè¢«è®¿é—®ã€‚LRUç®—æ³•æ™®ååœ°é€‚ç”¨äºå„ç§ç±»å‹çš„ç¨‹åºï¼Œä½†æ˜¯ç³»ç»Ÿè¦æ—¶æ—¶åˆ»åˆ»å¯¹å„é¡µçš„è®¿é—®å†å²æƒ…å†µåŠ ä»¥è®°å½•å’Œæ›´æ–°ï¼Œå¼€é”€å¤ªå¤§ï¼Œå› æ­¤LRUç®—æ³•å¿…é¡»è¦æœ‰ç¡¬ä»¶çš„æ”¯æŒã€‚</p>\n<p>OPTç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ç½®æ¢ä»¥åä¸å†è¢«è®¿é—®ï¼Œæˆ–è€…åœ¨å°†æ¥æœ€è¿Ÿæ‰å›è¢«è®¿é—®çš„é¡µé¢ï¼Œç¼ºé¡µä¸­æ–­ç‡æœ€ä½ã€‚ç¼ºç‚¹ï¼šè¯¥ç®—æ³•éœ€è¦ä¾æ®ä»¥åå„ä¸šçš„ä½¿ç”¨æƒ…å†µï¼Œè€Œå½“ä¸€ä¸ªè¿›ç¨‹è¿˜æœªè¿è¡Œå®Œæˆæ˜¯ï¼Œå¾ˆéš¾ä¼°è®¡å“ªä¸€ä¸ªé¡µé¢æ˜¯ä»¥åä¸å†ä½¿ç”¨æˆ–åœ¨æœ€é•¿æ—¶é—´ä»¥åæ‰ä¼šç”¨åˆ°çš„é¡µé¢ã€‚</p>\n<p>è¿™ä¸‰ç§ç®—æ³•å¯¹æ¯”ï¼šOPT &gt; LRU &gt; FIFO ä½†æ˜¯OPTç®—æ³•æ˜¯ä¸èƒ½å®ç°çš„ï¼Œä½†è¯¥ç®—æ³•ä»ç„¶æœ‰æ„ä¹‰ï¼Œå¯ä»¥ä½œä¸ºå…¶ä»–ç®—æ³•ä¼˜åŠ£çš„ä¸€ä¸ªæ ‡å‡†ã€‚</p>\n","categories":["Operating System"]},{"title":"ç£ç›˜è°ƒåº¦","url":"/2023/12/22/oslab5/","content":"<link rel=\"stylesheet\" class=\"aplayer-secondary-style-marker\" href=\"\\assets\\css\\APlayer.min.css\"><script src=\"\\assets\\js\\APlayer.min.js\" class=\"aplayer-secondary-script-marker\"></script><script class=\"meting-secondary-script-marker\" src=\"\\assets\\js\\Meting.min.js\"></script><h1 id=\"ç£ç›˜è°ƒåº¦\"><a href=\"#ç£ç›˜è°ƒåº¦\" class=\"headerlink\" title=\"ç£ç›˜è°ƒåº¦\"></a>ç£ç›˜è°ƒåº¦</h1><p>ç£ç›˜è°ƒåº¦ä¸­å¯»é“æ—¶é—´ç›´æ¥å½±å“åˆ°æ•°æ®è®¿é—®çš„å¿«æ…¢ï¼Œå¤„ç†å¥½ç£ç›˜å¯»é“æ—¶é—´æ˜¯å…³é”®</p>\n<h1 id=\"å®éªŒåŸç†\"><a href=\"#å®éªŒåŸç†\" class=\"headerlink\" title=\"å®éªŒåŸç†\"></a>å®éªŒåŸç†</h1><h2 id=\"å…ˆæ¥å…ˆæœåŠ¡-FCFS\"><a href=\"#å…ˆæ¥å…ˆæœåŠ¡-FCFS\" class=\"headerlink\" title=\"å…ˆæ¥å…ˆæœåŠ¡(FCFS)\"></a>å…ˆæ¥å…ˆæœåŠ¡(FCFS)</h2><p>åŸºæœ¬æ€æƒ³ï¼šæŒ‰ç…§è¾“å…¥è¾“å‡ºè¯·æ±‚åˆ°è¾¾çš„é¡ºåºï¼Œé€ä¸€å®Œæˆè®¿é—®è¯·æ±‚ï¼Œå®ƒåªè€ƒè™‘è¯·æ±‚è®¿é—®è€…çš„å…ˆåæ¬¡åºï¼Œè€Œä¸è€ƒè™‘å®ƒä»¬è¦è®¿é—®çš„ç‰©ç†ä½ç½®</p>\n<h2 id=\"æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆ-SSTF\"><a href=\"#æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆ-SSTF\" class=\"headerlink\" title=\"æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆ(SSTF)\"></a>æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆ(SSTF)</h2><p>åŸºæœ¬æ€æƒ³ï¼šå…ˆå¯¹æœ€é è¿‘å½“å‰æŸ±é¢ä½ç½®çš„è¯·æ±‚è¿›è¡ŒæœåŠ¡ï¼Œå³å…ˆå¯¹å¯»æ‰¾æ—¶é—´æœ€çŸ­çš„è¯·æ±‚è¿›è¡ŒæœåŠ¡ã€‚SSTFç®—æ³•æ€»æ˜¯è®©å¯»æ‰¾æ—¶é—´æœ€çŸ­çš„é‚£ä¸ªè¯·æ±‚å…ˆæœåŠ¡ï¼Œè€Œä¸ç®¡è¯·æ±‚è®¿é—®è€…åˆ°æ¥çš„å…ˆåæ¬¡åºã€‚</p>\n<h1 id=\"å®éªŒå†…å®¹\"><a href=\"#å®éªŒå†…å®¹\" class=\"headerlink\" title=\"å®éªŒå†…å®¹\"></a>å®éªŒå†…å®¹</h1><h2 id=\"ç®—æ³•å®ç°\"><a href=\"#ç®—æ³•å®ç°\" class=\"headerlink\" title=\"ç®—æ³•å®ç°\"></a>ç®—æ³•å®ç°<span id=\"more\"></span></h2><figure class=\"highlight c\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span><span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\">using namespace <span class=\"built_in\">std</span>;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">Getmin</span><span class=\"params\">(<span class=\"type\">int</span> a[],<span class=\"type\">int</span> i,<span class=\"type\">int</span> temp)</span> &#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> min = <span class=\"number\">65535</span>,mini=<span class=\"number\">0</span>,j=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (i&gt;<span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"built_in\">abs</span>(a[j]-temp) &lt;= <span class=\"built_in\">abs</span>(min-temp)) &#123; min = a[j]; mini = j; &#125;</span><br><span class=\"line\">\t\tj++;</span><br><span class=\"line\">\t\ti--;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\ta[mini] = <span class=\"number\">65536</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> min;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">FCFS</span><span class=\"params\">(<span class=\"type\">int</span> a[])</span> &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¢«è®¿é—®çš„ä¸‹ä¸€ä¸ªç£ç›˜å·&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\t\\t&quot;</span> &lt;&lt; <span class=\"string\">&quot;ç§»åŠ¨è·ç¦»&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>,temp=<span class=\"number\">100</span>,count=<span class=\"number\">0</span>,dis=<span class=\"number\">0</span>; </span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (a[i] != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\tdis= <span class=\"built_in\">abs</span>(temp - a[i]);</span><br><span class=\"line\">\t\ttemp = a[i];</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; a[i] &lt;&lt; <span class=\"string\">&quot;\\t\\t\\t\\t&quot;</span> &lt;&lt; dis &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\tcount += dis;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;å¹³å‡å¯»é“é•¿åº¦&quot;</span> &lt;&lt; count * <span class=\"number\">1.0</span> / i &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">SSTF</span><span class=\"params\">(<span class=\"type\">int</span> a[],<span class=\"type\">int</span> j)</span> &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;è¢«è®¿é—®çš„ä¸‹ä¸€ä¸ªç£ç›˜å·&quot;</span> &lt;&lt;<span class=\"string\">&quot;\\t\\t&quot;</span> &lt;&lt; <span class=\"string\">&quot;ç§»åŠ¨è·ç¦»&quot;</span> &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = j, temp = <span class=\"number\">100</span>, count = <span class=\"number\">0</span>, dis = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (j&gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> ele = Getmin(a, i,temp);</span><br><span class=\"line\">\t\tdis = <span class=\"built_in\">abs</span>(temp - ele);</span><br><span class=\"line\">\t\ttemp = ele;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cout</span> &lt;&lt; ele &lt;&lt; <span class=\"string\">&quot;\\t\\t\\t\\t&quot;</span> &lt;&lt; dis &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">\t\tcount += dis;</span><br><span class=\"line\">\t\tj--;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">cout</span> &lt;&lt; <span class=\"string\">&quot;å¹³å‡å¯»é“é•¿åº¦&quot;</span> &lt;&lt; count * <span class=\"number\">1.0</span> / i &lt;&lt; <span class=\"built_in\">endl</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a[<span class=\"number\">30</span>] = &#123;<span class=\"number\">0</span> &#125;,i=<span class=\"number\">0</span>,j=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (j==<span class=\"number\">0</span>||<span class=\"built_in\">cin</span>.get() != <span class=\"string\">&#x27;\\n&#x27;</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">cin</span> &gt;&gt; a[j];</span><br><span class=\"line\">\t\tj++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//FCFS(a);</span></span><br><span class=\"line\">\tSSTF(a,j);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"å†…å®¹æ¼”ç¤º\"><a href=\"#å†…å®¹æ¼”ç¤º\" class=\"headerlink\" title=\"å†…å®¹æ¼”ç¤º\"></a>å†…å®¹æ¼”ç¤º</h2><h3 id=\"FCFS\"><a href=\"#FCFS\" class=\"headerlink\" title=\"FCFS\"></a>FCFS</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-17.png?raw=true\"></p>\n<h3 id=\"SSTF\"><a href=\"#SSTF\" class=\"headerlink\" title=\"SSTF\"></a>SSTF</h3><p><img src=\"https://github.com/KianaMeiZaychik/KianaMeiZaychik.github.io/blob/master/photo/os-18.png?raw=true\" alt=\"alt text\"></p>\n<h1 id=\"å®éªŒæ€»ç»“\"><a href=\"#å®éªŒæ€»ç»“\" class=\"headerlink\" title=\"å®éªŒæ€»ç»“\"></a>å®éªŒæ€»ç»“</h1><h2 id=\"å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ï¼ˆFCFSï¼‰First-Come-First-Service\"><a href=\"#å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ï¼ˆFCFSï¼‰First-Come-First-Service\" class=\"headerlink\" title=\"å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ï¼ˆFCFSï¼‰First Come First Service\"></a>å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•ï¼ˆFCFSï¼‰First Come First Service</h2><p>è¿™æ˜¯ä¸€ç§æ¯”è¾ƒç®€å•çš„ç£ç›˜è°ƒåº¦ç®—æ³•ã€‚å®ƒæ ¹æ®è¿›ç¨‹è¯·æ±‚è®¿é—®ç£ç›˜çš„å…ˆåæ¬¡åºè¿›è¡Œè°ƒåº¦ã€‚æ­¤ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å…¬å¹³ã€ç®€å•ï¼Œä¸”æ¯ä¸ªè¿›ç¨‹çš„è¯·æ±‚éƒ½èƒ½ä¾æ¬¡å¾—åˆ°å¤„ç†ï¼Œä¸ä¼šå‡ºç°æŸä¸€è¿›ç¨‹çš„è¯·æ±‚é•¿æœŸå¾—ä¸åˆ°æ»¡è¶³çš„æƒ…å†µã€‚æ­¤ç®—æ³•ç”±äºæœªå¯¹å¯»é“è¿›è¡Œä¼˜åŒ–ï¼Œåœ¨å¯¹ç£ç›˜çš„è®¿é—®è¯·æ±‚æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œæ­¤ç®—æ³•å°†é™ä½è®¾å¤‡æœåŠ¡çš„ååé‡ï¼Œè‡´ä½¿å¹³å‡å¯»é“æ—¶é—´å¯èƒ½è¾ƒé•¿ï¼Œä½†å„è¿›ç¨‹å¾—åˆ°æœåŠ¡çš„å“åº”æ—¶é—´çš„å˜åŒ–å¹…åº¦è¾ƒå°ã€‚</p>\n<h2 id=\"æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆç®—æ³•ï¼ˆSSTFï¼‰-Shortest-Seek-Time-First\"><a href=\"#æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆç®—æ³•ï¼ˆSSTFï¼‰-Shortest-Seek-Time-First\" class=\"headerlink\" title=\"æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆç®—æ³•ï¼ˆSSTFï¼‰ Shortest Seek Time First\"></a>æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆç®—æ³•ï¼ˆSSTFï¼‰ Shortest Seek Time First</h2><p>è¯¥ç®—æ³•é€‰æ‹©è¿™æ ·çš„è¿›ç¨‹ï¼Œå…¶è¦æ±‚è®¿é—®çš„ç£é“ä¸å½“å‰ç£å¤´æ‰€åœ¨çš„ç£é“è·ç¦»æœ€è¿‘ï¼Œä»¥ä½¿æ¯æ¬¡çš„å¯»é“æ—¶é—´æœ€çŸ­ï¼Œè¯¥ç®—æ³•å¯ä»¥å¾—åˆ°æ¯”è¾ƒå¥½çš„ååé‡ï¼Œä½†å´ä¸èƒ½ä¿è¯å¹³å‡å¯»é“æ—¶é—´æœ€çŸ­ã€‚å…¶ç¼ºç‚¹æ˜¯å¯¹ç”¨æˆ·çš„æœåŠ¡è¯·æ±‚çš„å“åº”æœºä¼šä¸æ˜¯å‡ç­‰çš„ï¼Œå› è€Œå¯¼è‡´å“åº”æ—¶é—´çš„å˜åŒ–å¹…åº¦å¾ˆå¤§ã€‚åœ¨æœåŠ¡è¯·æ±‚å¾ˆå¤šçš„æƒ…å†µä¸‹ï¼Œå¯¹å†…å¤–è¾¹ç¼˜ç£é“çš„è¯·æ±‚å°†ä¼šæ— é™æœŸçš„è¢«å»¶è¿Ÿï¼Œæœ‰äº›è¯·æ±‚çš„å“åº”æ—¶é—´å°†ä¸å¯é¢„æœŸã€‚</p>\n","categories":["Operating System"]}]